import{_ as ve,u as ye}from"./index-5e7125b4.js";/* empty css                   *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                      *//* empty css                        *//* empty css                    */import{r as p,b as D,j as be,ae as ke,l as _,B as k,C as f,F as a,G as n,a1 as Ve,af as we,p as T,E as m,a5 as he,K as Ce,an as xe,aK as Ue,M as Ee,ai as ze,u as U,V as $e,aL as Se,O as u,as as Fe,D as V,H,I as J,aO as Q,S as E,J as Ie,a2 as Oe,al as Ne,am as De,a6 as Te,a7 as qe,ax as Me,ay as Be,aP as Le}from"./element-plus-b8725afa.js";import{g as Re,d as je,u as Ke,c as Pe,a as Ae}from"./user-ae716573.js";import{c as Ge}from"./order-d1d1c65b.js";import{f as He}from"./format-20468769.js";const Je={class:"user-container"},Qe={class:"filter-container"},We={class:"pagination"},Xe={class:"dialog-footer"},Ye={key:0,class:"form-tip"},Ze={key:1,class:"config-details",style:{"background-color":"#f8f9fa","border-radius":"4px",border:"1px solid #e4e7ed"}},ea={key:0,class:"config-row"},aa={class:"config-value"},ta={class:"config-row"},la={class:"config-value"},na={key:0,class:"config-label"},sa={key:1,class:"config-value"},oa={class:"config-value"},ra={key:0,class:"form-tip"},ia={class:"dialog-footer"},ua={__name:"index",setup(da){const q=ye(),M=p([]),B=p(0),S=p(!1),g=D({page:1,pageSize:10,keyword:""}),w=p(!1),F=p(""),I=p(),o=D({id:void 0,username:"",password:"",company_name:"",contact_name:"",contact_phone:"",contact_email:"",remark:""}),z=p(!1),O=p(),N=p(!1),h=p(null),$=p([]),c=p(null),v=p([]),r=D({user_id:void 0,user_config_id:void 0,insurer_id:void 0,insurance_type:""}),W={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:50,message:"长度在 3 到 50 个字符",trigger:"blur"}],company_name:[{required:!0,message:"请输入企业名称",trigger:"blur"}],contact_name:[{required:!0,message:"请输入联系人姓名",trigger:"blur"}],contact_phone:[{required:!0,message:"请输入联系人手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],contact_email:[{required:!1,message:"请输入联系人邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},X={user_config_id:[{required:!0,message:"请选择用户配置",trigger:"change"}],insurer_id:[{required:!0,message:"请选择保险公司",trigger:"change"}]},Y=be(()=>$.value.length>0&&v.value.length>0&&r.user_config_id!==void 0&&r.insurer_id!==void 0),C=async()=>{S.value=!0;try{const t=await Re(g);M.value=t.data.list,B.value=t.data.total}catch(t){console.error("获取用户列表失败:",t),m.error("获取用户列表失败")}S.value=!1},L=()=>{g.page=1,C()},Z=()=>{F.value="新增用户",w.value=!0,Object.assign(o,{id:void 0,username:"",password:"",company_name:"",contact_name:"",contact_phone:"",contact_email:"",remark:""})},ee=t=>{F.value="修改用户",w.value=!0,Object.assign(o,{id:t.id,username:t.username,password:"",company_name:t.company_name,contact_name:t.contact_name,contact_phone:t.contact_phone,contact_email:t.contact_email,remark:t.remark})},ae=t=>{q.push(`/user/detail/${t.id}`)},te=t=>{Ie.confirm("确认要删除该用户吗？","警告",{type:"warning"}).then(async()=>{try{await je(t.id),m.success("删除成功"),C()}catch(e){console.error("删除用户失败:",e),m.error("删除失败")}})},le=async()=>{I.value&&await I.value.validate(async t=>{if(t)try{o.id?(await Ke(o.id,o),m.success("编辑成功")):(await Pe(o),m.success("新增成功")),w.value=!1,C()}catch(e){console.error("提交表单失败:",e),m.error("操作失败")}})},ne=t=>{g.pageSize=t,C()},se=t=>{g.page=t,C()},oe=t=>({待审核:"warning",审核通过:"success",审核拒绝:"danger",禁用:"info"})[t]||"info",re=t=>({未认证:"info",管理员资料已提交:"warning",企业基本资料已提交:"warning",已提交待审核:"warning",审核通过:"success",审核不通过:"danger",人工初审通过:"primary"})[t]||"info",ie=async t=>{if(t.status!=="审核通过"){m.warning("用户状态必须为审核通过才能创建订单");return}try{const e=await Ae(t.id);h.value=e.data,z.value=!0,Object.assign(r,{user_id:t.id,user_config_id:void 0,insurer_id:void 0,insurance_type:""}),await ue(e.data)}catch(e){console.error("获取用户详情失败:",e),m.error("获取用户详情失败")}},ue=async t=>{try{const e=t.configs||[];$.value=e;const d=t.insurers||[];if(v.value=d,e.length===1){if(r.user_config_id=e[0].id,c.value=e[0],t.insurer_ids){const i=t.insurer_ids.split(",").map(s=>parseInt(s.trim())).filter(s=>!isNaN(s));v.value=d.filter(s=>i.includes(s.id)),v.value.length===1&&(r.insurer_id=v.value[0].id)}}else c.value=null,r.user_config_id=void 0,r.insurer_id=void 0;e.length===0&&m.warning("该用户未配置任何产品，无法创建订单"),d.length===0&&m.warning("该用户未配置任何保险公司，无法创建订单")}catch(e){console.error("获取用户配置失败:",e),m.error("获取用户配置失败")}},de=t=>t.product?`${t.product.name} (${t.sell_mode})(${t.insurance_type})`:"未配置产品",ce=t=>{var d;if(!t){c.value=null,r.insurer_id=void 0;return}const e=$.value.find(i=>i.id===t);if(e){if(c.value=e,h.value&&h.value.insurer_ids){const i=h.value.insurer_ids.split(",").map(s=>parseInt(s.trim())).filter(s=>!isNaN(s));v.value=((d=h.value.insurers)==null?void 0:d.filter(s=>i.includes(s.id)))||[],v.value.length===1?r.insurer_id=v.value[0].id:r.insurer_id=void 0}}else c.value=null,r.insurer_id=void 0},pe=t=>{if(!t.account_no||t.account_no.length<4)return t.name;const e=t.account_no.slice(-4);return`${t.name} (${e})`},me=async()=>{O.value&&await O.value.validate(async t=>{if(t){N.value=!0;try{const e={user_id:r.user_id,user_config_id:r.user_config_id,insurer_id:r.insurer_id},d=await Ge(e);m.success("订单创建成功，正在跳转到投保信息录入页面..."),z.value=!1,q.push(`/order/insurance/${d.data.id}`)}catch(e){console.error("创建订单失败:",e),m.error("创建订单失败")}finally{N.value=!1}}})};return ke(()=>{C()}),(t,e)=>{const d=Oe,i=he,s=Ce,x=Ne,R=De,_e=xe,fe=Ue,y=Te,j=qe,K=Ee,P=Me,A=Be,G=Le,ge=ze;return _(),k("div",Je,[f("div",Qe,[a(i,{modelValue:g.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>g.keyword=l),placeholder:"用户名/企业名称/联系人/销售员/统一社会信用代码",style:{width:"450px !important"},class:"filter-item search-input",onKeyup:Ve(L,["enter","native"])},{prefix:n(()=>[a(d,null,{default:n(()=>[a(U($e))]),_:1})]),_:1},8,["modelValue"]),a(s,{class:"filter-item",type:"primary",onClick:L,style:{"margin-left":"10px"}},{default:n(()=>[a(d,null,{default:n(()=>[a(U(Se))]),_:1}),e[16]||(e[16]=u(" 搜索 "))]),_:1,__:[16]}),a(s,{class:"filter-item",type:"primary",onClick:Z,style:{"margin-left":"10px"}},{default:n(()=>[a(d,null,{default:n(()=>[a(U(Fe))]),_:1}),e[17]||(e[17]=u(" 新增用户 "))]),_:1,__:[17]})]),we((_(),T(_e,{data:M.value,border:"",fit:"","highlight-current-row":"",style:{width:"100%"}},{default:n(()=>[a(x,{prop:"company_name",label:"企业名称","min-width":"180","show-overflow-tooltip":""}),a(x,{prop:"username",label:"用户名",width:"120"}),a(x,{prop:"status",label:"状态",width:"100",align:"center"},{default:n(({row:l})=>[a(R,{type:oe(l.status)},{default:n(()=>[u(V(l.status),1)]),_:2},1032,["type"])]),_:1}),a(x,{prop:"audit_status",label:"认证",width:"120",align:"center"},{default:n(({row:l})=>[a(R,{type:re(l.audit_status),size:"small"},{default:n(()=>[u(V(l.audit_status||"未认证"),1)]),_:2},1032,["type"])]),_:1}),a(x,{prop:"created_at",label:"创建时间",width:"160",align:"center"},{default:n(({row:l})=>[u(V(U(He)(l.created_at)),1)]),_:1}),a(x,{label:"操作",width:"240",fixed:"right"},{default:n(({row:l})=>[a(s,{type:"primary",link:"",onClick:b=>ae(l)},{default:n(()=>e[18]||(e[18]=[u("详情")])),_:2,__:[18]},1032,["onClick"]),a(s,{type:"warning",link:"",onClick:b=>ee(l)},{default:n(()=>e[19]||(e[19]=[u("编辑")])),_:2,__:[19]},1032,["onClick"]),a(s,{type:"success",link:"",onClick:b=>ie(l),disabled:l.status!=="审核通过"},{default:n(()=>e[20]||(e[20]=[u("进件")])),_:2,__:[20]},1032,["onClick","disabled"]),a(s,{type:"danger",link:"",onClick:b=>te(l)},{default:n(()=>e[21]||(e[21]=[u("删除")])),_:2,__:[21]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ge,S.value]]),f("div",We,[a(fe,{"current-page":g.page,"onUpdate:currentPage":e[1]||(e[1]=l=>g.page=l),"page-size":g.pageSize,"onUpdate:pageSize":e[2]||(e[2]=l=>g.pageSize=l),"page-sizes":[10,20,50,100],total:B.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ne,onCurrentChange:se},null,8,["current-page","page-size","total"])]),a(K,{title:F.value,modelValue:w.value,"onUpdate:modelValue":e[11]||(e[11]=l=>w.value=l),width:"600px","close-on-click-modal":!1,"destroy-on-close":""},{footer:n(()=>[f("div",Xe,[a(s,{onClick:e[10]||(e[10]=l=>w.value=!1)},{default:n(()=>e[22]||(e[22]=[u("取 消")])),_:1,__:[22]}),a(s,{type:"primary",onClick:le},{default:n(()=>e[23]||(e[23]=[u("确 定")])),_:1,__:[23]})])]),default:n(()=>[a(j,{ref_key:"userFormRef",ref:I,model:o,rules:W,"label-width":"120px"},{default:n(()=>[a(y,{label:"手机号",prop:"username"},{default:n(()=>[a(i,{modelValue:o.username,"onUpdate:modelValue":e[3]||(e[3]=l=>o.username=l),placeholder:"请输入手机号（客户端用户登陆时的用户名）"},null,8,["modelValue"])]),_:1}),a(y,{label:"密码",prop:"password"},{default:n(()=>[a(i,{modelValue:o.password,"onUpdate:modelValue":e[4]||(e[4]=l=>o.password=l),type:"password",placeholder:"请输入密码（新增时不填则默认123456）","show-password":""},null,8,["modelValue"])]),_:1}),a(y,{label:"企业名称",prop:"company_name"},{default:n(()=>[a(i,{modelValue:o.company_name,"onUpdate:modelValue":e[5]||(e[5]=l=>o.company_name=l),placeholder:"请输入企业名称"},null,8,["modelValue"])]),_:1}),a(y,{label:"联系人姓名",prop:"contact_name"},{default:n(()=>[a(i,{modelValue:o.contact_name,"onUpdate:modelValue":e[6]||(e[6]=l=>o.contact_name=l),placeholder:"请输入联系人姓名"},null,8,["modelValue"])]),_:1}),a(y,{label:"联系人手机",prop:"contact_phone"},{default:n(()=>[a(i,{modelValue:o.contact_phone,"onUpdate:modelValue":e[7]||(e[7]=l=>o.contact_phone=l),placeholder:"请输入联系人手机号"},null,8,["modelValue"])]),_:1}),a(y,{label:"联系人邮箱",prop:"contact_email"},{default:n(()=>[a(i,{modelValue:o.contact_email,"onUpdate:modelValue":e[8]||(e[8]=l=>o.contact_email=l),placeholder:"请输入联系人邮箱"},null,8,["modelValue"])]),_:1}),a(y,{label:"备注",prop:"remark"},{default:n(()=>[a(i,{modelValue:o.remark,"onUpdate:modelValue":e[9]||(e[9]=l=>o.remark=l),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),a(K,{title:"创建订单",modelValue:z.value,"onUpdate:modelValue":e[15]||(e[15]=l=>z.value=l),width:"800px","close-on-click-modal":!1,"destroy-on-close":""},{footer:n(()=>[f("div",ia,[a(s,{onClick:e[14]||(e[14]=l=>z.value=!1)},{default:n(()=>e[29]||(e[29]=[u("取 消")])),_:1,__:[29]}),a(s,{type:"primary",onClick:me,loading:N.value,disabled:!Y.value},{default:n(()=>e[30]||(e[30]=[u("确 定")])),_:1,__:[30]},8,["loading","disabled"])])]),default:n(()=>[a(j,{ref_key:"orderFormRef",ref:O,model:r,rules:X,"label-width":"120px"},{default:n(()=>[a(y,{label:"借款人"},{default:n(()=>{var l;return[a(i,{value:(l=h.value)==null?void 0:l.company_name,readonly:"",style:{"background-color":"#f5f7fa"}},null,8,["value"])]}),_:1}),a(y,{label:"用户配置",prop:"user_config_id"},{default:n(()=>{var l;return[a(A,{modelValue:r.user_config_id,"onUpdate:modelValue":e[12]||(e[12]=b=>r.user_config_id=b),placeholder:"请选择用户配置",style:{width:"100%"},filterable:"",onChange:ce},{default:n(()=>[(_(!0),k(H,null,J($.value,b=>(_(),T(P,{key:b.id,label:de(b),value:b.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),$.value.length===1?(_(),k("div",Ye,[a(G,{type:"success",size:"small"},{default:n(()=>[a(d,null,{default:n(()=>[a(U(Q))]),_:1}),e[24]||(e[24]=u(" 仅配置一个产品，已自动选择 "))]),_:1,__:[24]})])):E("",!0),c.value?(_(),k("div",Ze,[c.value.sell_mode==="渠道"?(_(),k("div",ea,[e[25]||(e[25]=f("span",{class:"config-label"},"渠道商：",-1)),f("span",aa,V(((l=c.value.agent)==null?void 0:l.company_name)||"-"),1)])):E("",!0),f("div",ta,[e[26]||(e[26]=f("span",{class:"config-label"},"服务费：",-1)),f("span",la,V(c.value.service_fee)+"%",1),c.value.sell_mode==="渠道"?(_(),k("span",na,"渠道成本：")):E("",!0),c.value.sell_mode==="渠道"?(_(),k("span",sa,V(c.value.agent_cost)+"%",1)):E("",!0),e[27]||(e[27]=f("span",{class:"config-label",style:{"margin-left":"20px"}},"过期时间：",-1)),f("span",oa,V(c.value.overdue_date||"-"),1)])])):E("",!0)]}),_:1}),a(y,{label:"保险公司",prop:"insurer_id"},{default:n(()=>[a(A,{modelValue:r.insurer_id,"onUpdate:modelValue":e[13]||(e[13]=l=>r.insurer_id=l),placeholder:"请选择保险公司",style:{width:"100%"},filterable:""},{default:n(()=>[(_(!0),k(H,null,J(v.value,l=>(_(),T(P,{key:l.id,label:pe(l),value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),v.value.length===1?(_(),k("div",ra,[a(G,{type:"success",size:"small"},{default:n(()=>[a(d,null,{default:n(()=>[a(U(Q))]),_:1}),e[28]||(e[28]=u(" 仅配置一个保险公司，已自动选择 "))]),_:1,__:[28]})])):E("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ha=ve(ua,[["__scopeId","data-v-0fdda7da"]]);export{ha as default};
