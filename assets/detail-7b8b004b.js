import{_ as R,b as U,u as $}from"./index-823243b1.js";/* empty css               *//* empty css                *//* empty css                             *//* empty css                   *//* empty css                       */import{b as z,a as F}from"./contact-96ec1b20.js";import{f as G}from"./format-20468769.js";import{r as v,ae as H,l as s,B as g,C as u,F as n,G as a,af as J,p as _,S as h,E as c,aE as K,ag as L,ai as O,O as r,D as d,u as j,J as x,K as q,az as Q,am as W,aA as X,a5 as Y}from"./element-plus-8eb596e2.js";const Z={class:"contact-detail"},ee={class:"page-header"},te={class:"header-actions"},ae={class:"sign-url-container"},oe={key:1},ne={key:1},re={class:"pdf-container"},le=["src"],se={__name:"detail",setup(ce){const C=U(),E=$(),y=C.params.id,p=v(!1),t=v({});v(!1);const B=o=>{switch(o){case"已签署":return"success";case"未签署":return"info";case"已作废":return"danger";case"签署失败":return"warning";case"已拒签":return"danger";default:return"info"}},D=async()=>{p.value=!0;try{const{data:o}=await z(y);t.value=o}catch(o){console.error("获取合同详情失败:",o),c.error("获取合同详情失败")}p.value=!1},T=async()=>{try{await x.confirm("确认作废该合同?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await F(y),c.success("作废成功"),w()}catch(o){o!=="cancel"&&(console.error("作废合同失败:",o),c.error("作废合同失败"))}},w=()=>{E.back()},V=()=>{if(!t.value.sign_url){c.warning("请先获取签署链接");return}navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(t.value.sign_url).then(()=>{c.success("签署链接已复制到剪贴板")}).catch(o=>{console.error("使用 Clipboard API 复制失败:",o),b(t.value.sign_url)}):b(t.value.sign_url)},b=o=>{try{const e=document.createElement("textarea");e.value=o,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();const i=document.execCommand("copy");if(document.body.removeChild(e),i)c.success("签署链接已复制到剪贴板");else throw new Error("execCommand 复制失败")}catch(e){console.error("复制失败:",e),x.alert(t.value.sign_url,"请手动复制签署链接",{confirmButtonText:"确定",type:"info"})}},S=o=>{try{if(typeof window<"u"&&window.open)window.open(o,"_blank");else{const e=document.createElement("a");e.href=o,e.target="_blank",e.rel="noopener noreferrer",document.body.appendChild(e),e.click(),document.body.removeChild(e)}}catch(e){console.error("打开下载链接失败:",e),c.error("无法打开下载链接")}},I=o=>{try{if(typeof window<"u"&&window.open)window.open(o,"_blank");else{const e=document.createElement("a");e.href=o,e.target="_blank",e.rel="noopener noreferrer",document.body.appendChild(e),e.click(),document.body.removeChild(e)}}catch(e){console.error("打开预览链接失败:",e),c.error("无法打开预览链接")}};return H(()=>{D()}),(o,e)=>{const i=q,N=K,l=Q,A=W,k=X,f=L,M=Y,P=O;return s(),g("div",Z,[u("div",ee,[n(N,{onBack:w,title:t.value.contact_id||"合同详情"},{extra:a(()=>[u("div",te,[t.value.sign_status==="未签署"?(s(),_(i,{key:0,type:"danger",onClick:T},{default:a(()=>e[3]||(e[3]=[r(" 作废合同 ")])),_:1,__:[3]})):h("",!0)])]),_:1},8,["title"])]),J((s(),_(f,{class:"detail-card"},{default:a(()=>[n(k,{column:3,border:""},{default:a(()=>[n(l,{label:"合同编号"},{default:a(()=>[r(d(t.value.contact_id),1)]),_:1}),n(l,{label:"订单号"},{default:a(()=>[r(d(t.value.order_no),1)]),_:1}),n(l,{label:"借款人姓名"},{default:a(()=>[r(d(t.value.customer_name||"-"),1)]),_:1}),n(l,{label:"签署状态"},{default:a(()=>[n(A,{type:B(t.value.sign_status)},{default:a(()=>[r(d(t.value.sign_status),1)]),_:1},8,["type"])]),_:1}),n(l,{label:"签署时间"},{default:a(()=>[r(d(t.value.sign_time||"-"),1)]),_:1}),n(l,{label:"创建时间"},{default:a(()=>[r(d(j(G)(t.value.created_at)),1)]),_:1})]),_:1})]),_:1})),[[P,p.value]]),n(f,{class:"detail-card"},{default:a(()=>[n(k,{column:1,border:""},{default:a(()=>[n(l,{label:"签署链接"},{default:a(()=>[u("div",ae,[n(M,{modelValue:t.value.sign_url,"onUpdate:modelValue":e[0]||(e[0]=m=>t.value.sign_url=m),readonly:"",class:"sign-url-input"},{append:a(()=>[n(i,{onClick:V},{default:a(()=>e[4]||(e[4]=[r("复制")])),_:1,__:[4]})]),_:1},8,["modelValue"])])]),_:1}),n(l,{label:"下载地址"},{default:a(()=>[t.value.download_url?(s(),_(i,{key:0,type:"primary",onClick:e[1]||(e[1]=m=>S(t.value.download_url))},{default:a(()=>e[5]||(e[5]=[r(" 点击下载 ")])),_:1,__:[5]})):(s(),g("span",oe,"-"))]),_:1}),n(l,{label:"在线预览"},{default:a(()=>[t.value.view_pdf_url?(s(),_(i,{key:0,type:"primary",onClick:e[2]||(e[2]=m=>I(t.value.view_pdf_url))},{default:a(()=>e[6]||(e[6]=[r(" 点击预览 ")])),_:1,__:[6]})):(s(),g("span",ne,"-"))]),_:1})]),_:1})]),_:1}),t.value.view_pdf_url?(s(),_(f,{key:0,class:"detail-card"},{default:a(()=>[u("div",re,[u("iframe",{src:t.value.view_pdf_url,frameborder:"0",width:"100%",height:"600px"},null,8,le)])]),_:1})):h("",!0)])}}},ye=R(se,[["__scopeId","data-v-732ff661"]]);export{ye as default};
