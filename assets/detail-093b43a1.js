import{_ as Ce,b as xe,u as Ee,a as $e}from"./index-2c2925e9.js";/* empty css               *//* empty css                 *//* empty css                         *//* empty css                        *//* empty css                     *//* empty css               *//* empty css                             *//* empty css                *//* empty css                   *//* empty css                       */import{f as $,a as y}from"./format-20468769.js";import{a as Me,r as Te,b as Pe,d as Be,f as Se}from"./order-a33ec320.js";import{m as Ne}from"./receivable-0faba627.js";import{r as T,ae as Ve,l as f,B as h,C as c,F as e,G as a,p as x,S as C,E as b,aE as Ie,ag as De,ah as Re,M as Fe,u as _,O as s,af as K,D as o,ac as ze,av as Ae,aF as Oe,H as Ue,I as Le,J as R,K as qe,az as Ge,am as He,aA as Je,ao as Ke,al as je,an as Qe,ap as We,aq as Xe,ar as Ye,a5 as Ze,a6 as ea,a7 as aa,ai as ta}from"./element-plus-f067b2d4.js";const la={class:"order-detail"},na={class:"page-header"},oa={class:"header-actions"},ra={class:"overview-section"},sa={class:"key-metrics"},ia={class:"metric-item"},ua={class:"metric-value"},da={class:"metric-item"},ca={class:"metric-value"},_a={class:"metric-item"},pa={class:"metric-value"},ma={class:"metric-item"},fa={class:"metric-value"},va={key:0,class:"empty-state"},ya={key:0,class:"empty-state"},ga={style:{color:"#67c23a","font-weight":"bold"}},ba={style:{color:"#e6a23c","font-weight":"bold"}},ha={style:{color:"#409eff"}},wa={style:{color:"#67c23a"}},ka={key:0,style:{color:"#f56c6c"}},Ca={key:1},xa={key:0,style:{color:"#f56c6c"}},Ea={key:1},$a={key:0,style:{color:"#67c23a","font-weight":"bold"}},Ma={key:1},Ta={key:0,style:{color:"#f56c6c","font-weight":"bold"}},Pa={key:1},Ba={key:1,style:{color:"#67c23a"}},Sa={class:"log-content"},Na={class:"operator"},Va={class:"action"},Ia={key:1,class:"empty-logs"},Da={class:"dialog-footer"},Ra={class:"payment-info"},Fa={key:1,class:"payment-section"},za={key:2,class:"payment-section"},Aa={key:3,class:"payment-section"},Oa={class:"remark-content"},Ua={class:"dialog-footer"},La={__name:"detail",setup(qa){const j=xe(),F=Ee(),M=T(!1),n=T({}),P=$e(),B=T(!1),z=T(null),A=T(!1),S=T({remark:""}),I=T(!1),O=T(!1),p=T({}),Q={remark:[{required:!0,message:"请输入备注内容",trigger:"blur"}]},N=async()=>{M.value=!0;try{const r=await Me(j.params.id);n.value=r.data,n.value.total_commercial=0,n.value.insurance_type==="车险"&&n.value.car_insurance&&n.value.car_insurance.length>0?n.value.total_commercial=n.value.car_insurance.reduce((t,d)=>t+(d.commercial_amount||0),0):n.value.insurance_type==="货运险"&&n.value.cargo_insurance&&n.value.cargo_insurance.length>0&&(n.value.total_commercial=n.value.cargo_insurance.reduce((t,d)=>t+(d.commercial_amount||0),0))}catch{b.error("获取订单详情失败")}M.value=!1},W=()=>{F.back()},D=async()=>{try{let r="",t="下一状态";n.value.status==="待初审"?(r="初审通过",t="待复审"):n.value.status==="待复审"&&(r="复审通过",t="待客户签约"),await R.confirm(`确定要将订单状态从 [${n.value.status}] 更新为 [${t}] 吗？`,"审核确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),M.value=!0,await Te(n.value.id,{audit_note:r}),b.success("审核成功"),N()}catch(r){r!=="cancel"&&b.error("审核失败")}M.value=!1},X=r=>{const{columns:t,data:d}=r,m=[];return t.forEach((v,u)=>{if(u===0){m[u]="合计";return}if(v.property==="total_amount"){const g=d.reduce((k,E)=>k+(E.commercial_amount||0)+(E.compulsory_amount||0)+(E.vehicle_tax_amount||0),0);m[u]=y(g);return}const w=d.map(g=>Number(g[v.property]));if(w.every(g=>isNaN(g)))m[u]="-";else{const g=w.reduce((k,E)=>{const i=Number(E);return isNaN(i)?k:k+i},0);v.property==="commercial_amount"||v.property==="compulsory_amount"||v.property==="vehicle_tax_amount"?m[u]=y(g):m[u]="-"}}),m},Y=r=>{const{columns:t,data:d}=r,m=[];return t.forEach((v,u)=>{if(u===0){m[u]="合计";return}const w=d.map(g=>Number(g[v.property]));if(w.every(g=>isNaN(g)))m[u]="-";else{const g=w.reduce((k,E)=>{const i=Number(E);return isNaN(i)?k:k+i},0);v.property==="commercial_amount"?m[u]=y(g):m[u]="-"}}),m},Z=r=>({待审核:"warning",待复审:"warning",待客户签约:"info",待资方签约:"info",待放款:"warning",已放款:"success",已退保:"danger",已结清:"success",已作废:"danger"})[r]||"info",ee=r=>({create:"primary",update:"success",review:"warning",delete:"danger",info:"info"})[r]||"info",U=()=>{F.push(`/order/insurance/${n.value.id}`)},ae=(r,t)=>{F.push({path:`/order/attachments/${n.value.id}`,query:{ref_id:r||0,type:t||"order"}})},te=async()=>{try{await R.confirm("确定要作废该订单吗？作废后不可恢复！","作废确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),M.value=!0,await Pe(n.value.id),b.success("订单已作废"),N()}catch(r){r!=="cancel"&&b.error("作废失败")}M.value=!1},L=(r,t)=>{if(!r){b.warning(`${t}链接不存在`);return}try{if(typeof window<"u"&&window.open)window.open(r,"_blank","noopener,noreferrer");else throw new Error("window.open不可用")}catch(d){console.error(`${t}失败:`,d);try{const m=document.createElement("a");m.href=r,m.target="_blank",m.rel="noopener noreferrer",m.style.display="none",document.body.appendChild(m),m.click(),document.body.removeChild(m),b.success(`${t}链接已打开`)}catch(m){console.error("备选方案失败:",m)}}},le=r=>{if(!r){b.warning("签署链接不存在");return}q(r,"签署链接")},q=(r,t)=>{const d=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);navigator.clipboard&&(window.isSecureContext||d)?navigator.clipboard.writeText(r).then(()=>{b.success(`${t}已复制到剪贴板`)}).catch(m=>{console.error("使用 Clipboard API 复制失败:",m),G(r,t)}):G(r,t)},G=(r,t)=>{try{const d=document.createElement("textarea");d.value=r,d.style.position="fixed",d.style.left="-999999px",d.style.top="-999999px",document.body.appendChild(d),d.focus(),d.select();const m=document.execCommand("copy");if(document.body.removeChild(d),m)b.success(`${t}已复制到剪贴板`);else throw new Error("execCommand 复制失败")}catch(d){console.error("复制失败:",d),R.alert(r,`请手动复制${t}`,{confirmButtonText:"确定",type:"info",customClass:"copy-url-dialog"})}},ne=r=>({已签署:"success",未签署:"warning",已作废:"danger"})[r]||"info",oe=r=>({首付:"primary",还款:"success",利息:"warning",本金:"info",退保:"danger"})[r]||"info",re=r=>({微信:"success",支付宝:"primary",银行卡:"warning"})[r]||"info",se=r=>({待收款:"warning",已收款:"success",已逾期:"danger"})[r]||"info",ie=async r=>{try{const{value:t}=await R.prompt(`请输入第${r.period}期的实际收款金额`,"标记收款",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\d+(\.\d{1,2})?$/,inputErrorMessage:"请输入正确的金额格式",inputValue:r.amount.toString()});if(!t){b.warning("请输入收款金额");return}M.value=!0,await Ne(r.id,{actual_amount:parseFloat(t),actual_date:new Date().toISOString().split("T")[0]}),b.success("标记收款成功"),N()}catch(t){t!=="cancel"&&b.error("标记收款失败")}M.value=!1},ue=()=>{S.value.remark="",B.value=!0},de=async()=>{z.value&&await z.value.validate(async r=>{if(r){A.value=!0;try{await Be(n.value.id,{remark:S.value.remark}),b.success("添加备注成功"),B.value=!1,N()}catch(t){b.error("添加备注失败："+(t.message||"未知错误"))}A.value=!1}})},ce=async()=>{if(!n.value.id){b.warning("订单信息不存在");return}O.value=!0;try{const r=await Se(n.value.id);p.value=r.data,I.value=!0,b.success("前置款信息生成成功")}catch(r){b.error("生成前置款信息失败："+(r.message||"未知错误"))}O.value=!1},_e=()=>{if(!p.value.batch_no){b.warning("暂无前置款信息可复制");return}const r=`
批次号：${p.value.batch_no}
借款人：${p.value.borrower}
${p.value.vehicle_info}
总放款金额：${y(p.value.total_loan_amount)}

支付服务费：${y(p.value.service_fee)}
户名：${p.value.service_account_name}
账户：${p.value.service_account_no}
开户行：${p.value.service_bank_name}

支付首付款：${y(p.value.total_down_payment)}
${p.value.down_payment_detail}
户名：${p.value.funder_account_name}
账户：${p.value.funder_account_no}
开户行：${p.value.funder_bank_name}

${p.value.remark||""}
  `.trim();q(r,"前置款信息")},pe=async()=>{if(!n.value.id){b.warning("订单信息不存在");return}if(n.value.status!=="已放款"){b.warning("订单状态不是已放款，不能导出分期计划");return}window.open(`/api/admin/orders/${n.value.id}/export-plan`,"_blank")},me=async()=>{if(!n.value.id){b.warning("订单信息不存在");return}(n.value.car_insurance.length>0||n.value.cargo_insurance.length>0)&&window.open(`/api/admin/orders/${n.value.id}/export-insurance`,"_blank")},fe=async()=>{if(!n.value.id){b.warning("订单信息不存在");return}window.open(`/api/admin/orders/${n.value.id}/export-received`,"_blank")},ve=r=>{const{columns:t,data:d}=r,m=[];return t.forEach((v,u)=>{if(u===0){m[u]="合计";return}const w=d.map(g=>Number(g[v.property]));if(w.every(g=>isNaN(g)))m[u]="-";else{const g=w.reduce((k,E)=>{const i=Number(E);return isNaN(i)?k:k+i},0);v.property==="amount"||v.property==="principal_amount"||v.property==="interest_amount"||v.property==="penalty_amount"||v.property==="forfeit_amount"||v.property==="actual_amount"?m[u]=y(g):m[u]="-"}}),m};return Ve(()=>{N()}),(r,t)=>{const d=qe,m=Ie,v=De,u=Ge,w=He,g=Je,k=Ke,E=Re,i=je,V=Qe,ye=We,ge=Xe,be=Ye,he=Ze,we=ea,ke=aa,H=Fe,J=ta;return f(),h("div",la,[c("div",na,[e(m,{onBack:W,title:n.value.order_no||"订单详情"},{extra:a(()=>[c("div",oa,[n.value.status==="待初审"&&_(P).riskBasicPrivate?(f(),x(d,{key:0,type:"success",onClick:D},{default:a(()=>t[6]||(t[6]=[s("初审通过")])),_:1,__:[6]})):C("",!0),n.value.status==="待复审"&&_(P).riskManagerPrivate?(f(),x(d,{key:1,type:"warning",onClick:D},{default:a(()=>t[7]||(t[7]=[s("复审通过")])),_:1,__:[7]})):C("",!0),n.value.status==="待放款"&&_(P).operationManagerPrivate?(f(),x(d,{key:2,type:"info",onClick:D},{default:a(()=>t[8]||(t[8]=[s("放款")])),_:1,__:[8]})):C("",!0),n.value.status!=="已作废"&&(_(P).operationManagerPrivate||_(P).riskManagerPrivate)?(f(),x(d,{key:3,type:"danger",onClick:te},{default:a(()=>t[9]||(t[9]=[s("作废订单")])),_:1,__:[9]})):C("",!0),_(P).superPrivate?(f(),x(d,{key:4,type:"primary",onClick:D},{default:a(()=>t[10]||(t[10]=[s("下一状态（调试用）")])),_:1,__:[10]})):C("",!0)])]),_:1},8,["title"])]),e(v,null,{default:a(()=>[e(d,{type:"default",onClick:me},{default:a(()=>t[11]||(t[11]=[s("导出投保单")])),_:1,__:[11]}),e(d,{type:"default",onClick:pe},{default:a(()=>t[12]||(t[12]=[s("导出分期计划")])),_:1,__:[12]}),e(d,{type:"default",onClick:fe},{default:a(()=>t[13]||(t[13]=[s("导出收款记录")])),_:1,__:[13]}),e(d,{type:"default",onClick:U},{default:a(()=>t[14]||(t[14]=[s("管理投保单")])),_:1,__:[14]}),e(d,{type:"default",onClick:ce},{default:a(()=>t[15]||(t[15]=[s("生成前置款")])),_:1,__:[15]}),e(d,{type:"default",onClick:t[0]||(t[0]=l=>ae())},{default:a(()=>t[16]||(t[16]=[s("查看附件")])),_:1,__:[16]}),e(d,{type:"default",onClick:ue},{default:a(()=>t[17]||(t[17]=[s("添加备注")])),_:1,__:[17]})]),_:1}),c("div",ra,[e(E,{gutter:20},{default:a(()=>[e(k,{span:18},{default:a(()=>[K((f(),x(v,{class:"info-card"},{default:a(()=>[e(g,{column:2,border:""},{default:a(()=>[e(u,{label:"订单编号"},{default:a(()=>[s(o(n.value.order_no),1)]),_:1}),e(u,{label:"订单状态"},{default:a(()=>[e(w,{type:Z(n.value.status)},{default:a(()=>[s(o(n.value.status),1)]),_:1},8,["type"])]),_:1}),e(u,{label:"保险类型"},{default:a(()=>[s(o(n.value.insurance_type),1)]),_:1}),e(u,{label:"借款主体"},{default:a(()=>{var l;return[s(o(n.value.loan_name||((l=n.value.user)==null?void 0:l.company_name)),1)]}),_:1}),e(u,{label:"业务归属"},{default:a(()=>{var l;return[s(o(n.value.sell_mode==="直销"?"直销":((l=n.value.agent)==null?void 0:l.company_name)||"无"),1)]}),_:1}),e(u,{label:"销售员"},{default:a(()=>[s(o(n.value.seller),1)]),_:1}),e(u,{label:"服务费"},{default:a(()=>[s(o(n.value.service_fee)+"%",1)]),_:1}),e(u,{label:"渠道成本"},{default:a(()=>[s(o(n.value.agent_cost)+"%",1)]),_:1}),e(u,{span:2,label:"金融产品"},{default:a(()=>{var l;return[s(o((l=n.value.product)==null?void 0:l.name),1)]}),_:1}),e(u,{label:"承保机构",span:2},{default:a(()=>{var l;return[s(o((l=n.value.insurer)==null?void 0:l.name),1)]}),_:1})]),_:1}),e(g,{column:2,border:""},{default:a(()=>[e(u,{label:"进件时间"},{default:a(()=>[s(o(_($)(n.value.created_at)),1)]),_:1}),e(u,{label:"初审时间"},{default:a(()=>[s(o(_($)(n.value.first_review_time)||"-"),1)]),_:1}),e(u,{label:"复审时间"},{default:a(()=>[s(o(_($)(n.value.second_review_time)||"-"),1)]),_:1}),e(u,{label:"用户签约时间"},{default:a(()=>[s(o(_($)(n.value.user_sign_time)||"-"),1)]),_:1}),e(u,{label:"资方签约时间"},{default:a(()=>[s(o(_($)(n.value.funder_sign_time)||"-"),1)]),_:1}),e(u,{label:"放款时间"},{default:a(()=>[s(o(_($)(n.value.loan_time)||"-"),1)]),_:1}),e(u,{label:"最后更新时间"},{default:a(()=>[s(o(_($)(n.value.updated_at)),1)]),_:1})]),_:1})]),_:1})),[[J,M.value]])]),_:1}),e(k,{span:6},{default:a(()=>[e(v,{class:"key-metrics-card"},{default:a(()=>[c("div",sa,[c("div",ia,[t[18]||(t[18]=c("div",{class:"metric-label"},"总保费",-1)),c("div",ua,o(_(y)(n.value.total_premium)),1)]),c("div",da,[t[19]||(t[19]=c("div",{class:"metric-label"},"商业险",-1)),c("div",ca,o(_(y)(n.value.total_commercial)),1)]),c("div",_a,[t[20]||(t[20]=c("div",{class:"metric-label"},"首付金额",-1)),c("div",pa,o(_(y)(n.value.down_payment)),1)]),c("div",ma,[t[21]||(t[21]=c("div",{class:"metric-label"},"贷款金额",-1)),c("div",fa,o(_(y)(n.value.loan_amount)),1)])])]),_:1})]),_:1})]),_:1})]),n.value.insurance_type==="车险"?(f(),x(v,{key:0,class:"detail-card insurance-card"},{default:a(()=>[e(V,{data:n.value.car_insurance||[],border:"",style:{width:"100%"},"empty-text":"暂无车险投保信息","max-height":"300","show-summary":n.value.car_insurance&&n.value.car_insurance.length>0,"sum-text":"合计","summary-method":X},{default:a(()=>[e(i,{prop:"car_no",label:"车牌号",width:"120",align:"left"}),e(i,{prop:"vin",label:"车架号",width:"180",align:"left"}),e(i,{prop:"insured",label:"被保人",width:"170",align:"left"}),e(i,{prop:"commercial_amount",label:"商业险",width:"110",align:"right"},{default:a(({row:l})=>[s(o(_(y)(l.commercial_amount)),1)]),_:1}),e(i,{prop:"compulsory_amount",label:"交强险",width:"110",align:"right"},{default:a(({row:l})=>[s(o(_(y)(l.compulsory_amount)),1)]),_:1}),e(i,{prop:"vehicle_tax_amount",label:"车船税",width:"110",align:"right"},{default:a(({row:l})=>[s(o(_(y)(l.vehicle_tax_amount)),1)]),_:1}),e(i,{prop:"total_amount",label:"总保费",width:"110",align:"right"},{default:a(({row:l})=>[s(o(_(y)((l.commercial_amount||0)+(l.compulsory_amount||0)+(l.vehicle_tax_amount||0))),1)]),_:1}),e(i,{prop:"start_date",label:"保险起期",width:"100",align:"center"}),e(i,{prop:"end_date",label:"保险止期",width:"100",align:"center"})]),_:1},8,["data","show-summary"]),!n.value.car_insurance||n.value.car_insurance.length===0?(f(),h("div",va,[e(d,{type:"primary",onClick:U},{default:a(()=>t[22]||(t[22]=[s("录入车险信息")])),_:1,__:[22]})])):C("",!0)]),_:1})):C("",!0),n.value.insurance_type==="货运险"?(f(),x(v,{key:1,class:"detail-card insurance-card"},{default:a(()=>[e(V,{data:n.value.cargo_insurance||[],border:"",style:{width:"100%"},"empty-text":"暂无货运险投保信息","max-height":"300","show-summary":n.value.cargo_insurance&&n.value.cargo_insurance.length>0,"sum-text":"合计","summary-method":Y},{default:a(()=>[e(i,{prop:"track_no",label:"运输编号",width:"200",align:"left"}),e(i,{prop:"insured",label:"被保人",width:"170",align:"left"}),e(i,{prop:"name",label:"货物名称",width:"150",align:"left"}),e(i,{prop:"quantity",label:"货物数量",width:"120",align:"right"}),e(i,{prop:"carrier",label:"承运人",width:"130",align:"left"}),e(i,{prop:"consignee",label:"收货人",width:"130",align:"left"}),e(i,{prop:"commercial_amount",label:"保费",width:"140",align:"right"},{default:a(({row:l})=>[s(o(_(y)(l.commercial_amount)),1)]),_:1}),e(i,{prop:"start_date",label:"保险起期",width:"100",align:"center"}),e(i,{prop:"end_date",label:"保险止期",width:"100",align:"center"})]),_:1},8,["data","show-summary"]),!n.value.cargo_insurance||n.value.cargo_insurance.length===0?(f(),h("div",ya,[e(d,{type:"primary",onClick:U},{default:a(()=>t[23]||(t[23]=[s("录入货运险信息")])),_:1,__:[23]})])):C("",!0)]),_:1})):C("",!0),e(v,{class:"detail-card"},{default:a(()=>[e(V,{data:n.value.contacts||[],border:"",style:{width:"100%"},"empty-text":"暂无合同信息","max-height":"200"},{default:a(()=>[e(i,{prop:"contact_id",label:"合同编号",width:"250"}),e(i,{prop:"sign_status",label:"签署状态",width:"120",align:"center"},{default:a(({row:l})=>[e(w,{type:ne(l.sign_status)},{default:a(()=>[s(o(l.sign_status),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"sign_time",label:"签署时间",width:"170",align:"center"},{default:a(({row:l})=>[s(o(l.sign_time||"-"),1)]),_:1}),e(i,{prop:"created_at",label:"创建时间",width:"170",align:"center"},{default:a(({row:l})=>[s(o(_($)(l.created_at)),1)]),_:1}),e(i,{label:"操作",width:"300",align:"center",fixed:"right"},{default:a(({row:l})=>[e(d,{type:"primary",size:"small",icon:_(ze),onClick:()=>L(l.view_pdf_url,"查看PDF"),disabled:!l.view_pdf_url,class:"action-btn"},{default:a(()=>t[24]||(t[24]=[s(" 查看 ")])),_:2,__:[24]},1032,["icon","onClick","disabled"]),e(d,{type:"success",size:"small",icon:_(Ae),onClick:()=>L(l.download_url,"下载PDF"),disabled:!l.download_url,class:"action-btn"},{default:a(()=>t[25]||(t[25]=[s(" 下载 ")])),_:2,__:[25]},1032,["icon","onClick","disabled"]),e(d,{type:"info",size:"small",icon:_(Oe),onClick:()=>le(l.sign_url),disabled:!l.sign_url,class:"action-btn"},{default:a(()=>t[26]||(t[26]=[s(" 签署链接 ")])),_:2,__:[26]},1032,["icon","onClick","disabled"])]),_:1})]),_:1},8,["data"])]),_:1}),e(v,{class:"detail-card"},{default:a(()=>[e(V,{data:n.value.receiveds||[],border:"",style:{width:"100%"},"empty-text":"暂无收款记录","max-height":"200"},{default:a(()=>[e(i,{prop:"trans_no",label:"收款流水号",width:"250"}),e(i,{prop:"rec_type",label:"收款类型",width:"100"},{default:a(({row:l})=>[e(w,{type:oe(l.rec_type)},{default:a(()=>[s(o(l.rec_type),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"amount",label:"收款金额",width:"120"},{default:a(({row:l})=>[c("span",ga,o(_(y)(l.amount)),1)]),_:1}),e(i,{prop:"period",label:"期数",width:"80"},{default:a(({row:l})=>[s(o(l.period||"-"),1)]),_:1}),e(i,{prop:"method",label:"收款方式",width:"100"},{default:a(({row:l})=>[e(w,{type:re(l.method),size:"small"},{default:a(()=>[s(o(l.method),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"date_time",label:"收款时间",width:"160"}),e(i,{prop:"created_at",label:"录入时间",width:"160"},{default:a(({row:l})=>[s(o(_($)(l.created_at)),1)]),_:1}),e(i,{prop:"remark",label:"备注","min-width":"120"},{default:a(({row:l})=>[s(o(l.remark||"-"),1)]),_:1})]),_:1},8,["data"])]),_:1}),e(v,{class:"detail-card"},{default:a(()=>[e(V,{data:n.value.receivables||[],border:"",style:{width:"100%"},"empty-text":"暂无还款计划","max-height":"200","show-summary":n.value.receivables&&n.value.receivables.length>0,"sum-text":"合计","summary-method":ve},{default:a(()=>[e(i,{prop:"period",label:"期数",width:"80",align:"center"}),e(i,{prop:"date",label:"应还日期",width:"120",align:"center"}),e(i,{prop:"amount",label:"应还金额",width:"120",align:"right"},{default:a(({row:l})=>[c("span",ba,o(_(y)(l.amount)),1)]),_:1}),e(i,{prop:"principal_amount",label:"本金",width:"120",align:"right"},{default:a(({row:l})=>[c("span",ha,o(_(y)(l.principal_amount)),1)]),_:1}),e(i,{prop:"interest_amount",label:"利息",width:"120",align:"right"},{default:a(({row:l})=>[c("span",wa,o(_(y)(l.interest_amount)),1)]),_:1}),e(i,{prop:"penalty_amount",label:"违约金",width:"100",align:"right"},{default:a(({row:l})=>[l.penalty_amount>0?(f(),h("span",ka,o(_(y)(l.penalty_amount)),1)):(f(),h("span",Ca,"-"))]),_:1}),e(i,{prop:"forfeit_amount",label:"滞纳金",width:"100",align:"right"},{default:a(({row:l})=>[l.forfeit_amount>0?(f(),h("span",xa,o(_(y)(l.forfeit_amount)),1)):(f(),h("span",Ea,"-"))]),_:1}),e(i,{prop:"actual_amount",label:"实际收款",width:"120",align:"right"},{default:a(({row:l})=>[l.actual_amount>0?(f(),h("span",$a,o(_(y)(l.actual_amount)),1)):(f(),h("span",Ma,"-"))]),_:1}),e(i,{prop:"actual_date",label:"实际收款日期",width:"120",align:"center"},{default:a(({row:l})=>[s(o(l.actual_date||"-"),1)]),_:1}),e(i,{prop:"overdue_days",label:"逾期天数",width:"100",align:"center"},{default:a(({row:l})=>[l.overdue_days>0?(f(),h("span",Ta,o(l.overdue_days)+"天",1)):(f(),h("span",Pa,"-"))]),_:1}),e(i,{prop:"status",label:"状态",width:"100",align:"center"},{default:a(({row:l})=>[e(w,{type:se(l.status)},{default:a(()=>[s(o(l.status),1)]),_:2},1032,["type"])]),_:1}),e(i,{label:"操作",width:"120",align:"center",fixed:"right"},{default:a(({row:l})=>[l.status==="待收款"||l.status==="已逾期"?(f(),x(d,{key:0,type:"primary",size:"small",onClick:Ga=>ie(l)},{default:a(()=>t[27]||(t[27]=[s(" 标记收款 ")])),_:2,__:[27]},1032,["onClick"])):(f(),h("span",Ba,"已收款"))]),_:1})]),_:1},8,["data","show-summary"])]),_:1}),e(v,{class:"detail-card"},{default:a(()=>[n.value.logs&&n.value.logs.length>0?(f(),x(ge,{key:0},{default:a(()=>[(f(!0),h(Ue,null,Le(n.value.logs,l=>(f(),x(ye,{key:l.id,timestamp:_($)(l.created_at),type:ee(l.action)},{default:a(()=>[c("div",Sa,[c("span",Na,o(l.admin_name),1),c("span",Va,o(l.content),1)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})):(f(),h("div",Ia,[e(be,{description:"暂无操作日志","image-size":80})]))]),_:1}),e(H,{modelValue:B.value,"onUpdate:modelValue":t[3]||(t[3]=l=>B.value=l),title:"添加备注",width:"500px"},{footer:a(()=>[c("span",Da,[e(d,{onClick:t[2]||(t[2]=l=>B.value=!1)},{default:a(()=>t[28]||(t[28]=[s("取消")])),_:1,__:[28]}),e(d,{type:"primary",onClick:de,loading:A.value},{default:a(()=>t[29]||(t[29]=[s("确定")])),_:1,__:[29]},8,["loading"])])]),default:a(()=>[e(ke,{ref_key:"remarkFormRef",ref:z,model:S.value,rules:Q,"label-width":"80px"},{default:a(()=>[e(we,{label:"备注内容",prop:"remark"},{default:a(()=>[e(he,{modelValue:S.value.remark,"onUpdate:modelValue":t[1]||(t[1]=l=>S.value.remark=l),type:"textarea",rows:4,placeholder:"请输入备注内容",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),t[30]||(t[30]=c("div",{style:{"margin-top":"10px","text-align":"right"}},"添加的备注将显示在日志列表里",-1))]),_:1,__:[30]},8,["modelValue"]),e(H,{modelValue:I.value,"onUpdate:modelValue":t[5]||(t[5]=l=>I.value=l),title:"前置款信息",width:"600px","close-on-click-modal":!1},{footer:a(()=>[c("span",Ua,[e(d,{onClick:t[4]||(t[4]=l=>I.value=!1)},{default:a(()=>t[31]||(t[31]=[s("关闭")])),_:1,__:[31]}),e(d,{type:"primary",onClick:_e},{default:a(()=>t[32]||(t[32]=[s("复制信息")])),_:1,__:[32]})])]),default:a(()=>[K((f(),h("div",Ra,[p.value.batch_no?(f(),x(g,{key:0,column:1,border:"",size:"small"},{default:a(()=>[e(u,{label:"批次号"},{default:a(()=>[c("span",null,o(p.value.batch_no),1)]),_:1}),e(u,{label:"借款人"},{default:a(()=>[c("span",null,o(p.value.borrower),1)]),_:1}),e(u,{label:"车辆信息"},{default:a(()=>[c("span",null,o(p.value.vehicle_info),1)]),_:1}),e(u,{label:"总保费"},{default:a(()=>[c("span",null,o(_(y)(p.value.total_premium)),1)]),_:1})]),_:1})):C("",!0),p.value.service_fee?(f(),h("div",Fa,[e(g,{column:1,border:"",size:"small"},{default:a(()=>[e(u,{label:"支付服务费"},{default:a(()=>[c("span",null,o(_(y)(p.value.service_fee)),1)]),_:1}),e(u,{label:"收款户名"},{default:a(()=>[c("span",null,o(p.value.service_account_name),1)]),_:1}),e(u,{label:"收款账户"},{default:a(()=>[c("span",null,o(p.value.service_account_no),1)]),_:1}),e(u,{label:"开户行"},{default:a(()=>[c("span",null,o(p.value.service_bank_name),1)]),_:1})]),_:1})])):C("",!0),p.value.total_down_payment?(f(),h("div",za,[e(g,{column:1,border:"",size:"small"},{default:a(()=>[e(u,{label:"支付首付款"},{default:a(()=>[c("span",null,o(_(y)(p.value.total_down_payment)),1)]),_:1}),e(u,{label:"明细"},{default:a(()=>[c("span",null,o(p.value.down_payment_detail),1)]),_:1}),e(u,{label:"收款户名"},{default:a(()=>[c("span",null,o(p.value.funder_account_name),1)]),_:1}),e(u,{label:"收款账户"},{default:a(()=>[c("span",null,o(p.value.funder_account_no),1)]),_:1}),e(u,{label:"开户行"},{default:a(()=>[c("span",null,o(p.value.funder_bank_name),1)]),_:1})]),_:1})])):C("",!0),p.value.remark?(f(),h("div",Aa,[c("div",Oa,o(p.value.remark),1)])):C("",!0)])),[[J,O.value]])]),_:1},8,["modelValue"])])}}},rt=Ce(La,[["__scopeId","data-v-2660afa0"]]);export{rt as default};
