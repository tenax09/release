import{_ as ye,u as we,b as be}from"./index-778cf4f8.js";/* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                        *//* empty css                    *//* empty css                       */import{r as c,b as he,w as xe,ae as Ce,l as w,B as V,C as m,F as a,G as o,a1 as k,af as Ve,p as E,E as u,a5 as ke,ay as Ee,aH as Se,K as Oe,an as De,aK as Me,M as Le,ai as Re,u as p,aL as A,H as L,I as R,O as i,aM as Ue,av as S,D as h,Z as N,Q as ze,T as Ye,aN as Pe,R as Ie,a2 as $e,ax as Be,al as Te,am as Fe,J as Ke}from"./element-plus-b8725afa.js";import{n as je}from"./order-b58b132e.js";import{g as Ae}from"./funder-66b0d5fe.js";import{g as Ne}from"./insurer-985f2b39.js";import{g as He}from"./user-f4adde23.js";import{f as Qe}from"./format-20468769.js";const Ge={class:"order-list"},Je={class:"filter-container"},Ze={class:"filter-row"},qe={class:"filter-row"},We={class:"filter-row"},Xe={class:"table-container"},ea={class:"pagination"},aa={class:"export-options"},ta={class:"dialog-footer"},la={__name:"index",setup(na){const H=we(),U=be(),z=c([]),Y=c(0),O=c(!0),n=he({page:1,page_size:50,order_no:"",status:"",insurance_type:"",funder_id:"",insurer_id:"",user_id:"",car_no:"",vin:"",insurance_no:"",loan_start_date:"",loan_end_date:"",create_start_date:"",create_end_date:""}),D=c([]),M=c([]),P=c([]),I=c([]),$=c([]),f=c([]),y=c(!1),g=c(null),B={OrderAll:"",OrderFirstReview:"待初审",OrderSecondReview:"待复审",OrderSign:"代签约",OrderPendingLoan:"待放款",OrderLoaned:"已放款",OrderRefunded:"已退保",OrderCompleted:"已结清",OrderCancelled:"已作废"},T=()=>{const t=U.name;B.hasOwnProperty(t)&&(n.status=B[t])},b=async()=>{O.value=!0;try{const{data:t}=await je(n);z.value=t.list,Y.value=t.total}catch(t){console.error("获取订单列表失败:",t),u.error("获取订单列表失败")}O.value=!1},_=()=>{n.page=1,b()},F=t=>t==null?"-":"¥"+parseFloat(t).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}),Q=()=>{const t=new URLSearchParams;Object.keys(n).forEach(e=>{n[e]!==""&&n[e]!==null&&n[e]!==void 0&&t.append(e,n[e])}),window.open(`/api/admin/orders/export?${t.toString()}`,"_blank")},G=t=>{g.value=t,y.value=!0},J=()=>{g.value&&(window.open(`/api/admin/orders/${g.value.id}/export-complete`,"_blank"),y.value=!1,u.success("正在导出订单全部信息..."))},Z=()=>{g.value&&(window.open(`/api/admin/orders/${g.value.id}/export-insurance`,"_blank"),y.value=!1,u.success("正在导出投保信息..."))},q=()=>{g.value&&(window.open(`/api/admin/orders/${g.value.id}/export-plan`,"_blank"),y.value=!1,u.success("正在导出分期计划..."))},W=()=>{g.value&&(window.open(`/api/admin/orders/${g.value.id}/export-received`,"_blank"),y.value=!1,u.success("正在导出收款记录..."))},X=()=>{if(f.value.length===0){u.warning("请先选择要导出的订单");return}const t=f.value.map(r=>r.id).join(","),e=new URLSearchParams;e.append("order_ids",t),window.open(`/api/admin/orders/export?${e.toString()}`,"_blank")},ee=()=>{const t=new URLSearchParams;Object.keys(n).forEach(e=>{n[e]!==""&&n[e]!==null&&n[e]!==void 0&&t.append(e,n[e])}),window.open(`/api/admin/orders/export-all-insurance?${t.toString()}`,"_blank"),u.success("正在导出投保信息...")},ae=()=>{if(f.value.length===0){u.warning("请先选择要导出的订单");return}const t=f.value.map(r=>r.id).join(","),e=new URLSearchParams;e.append("order_ids",t),window.open(`/api/admin/orders/export-all-insurance?${e.toString()}`,"_blank"),u.success("正在导出选中订单的投保信息...")},te=t=>{f.value=t},le=()=>{Object.keys(n).forEach(t=>{t!=="page"&&t!=="page_size"&&(n[t]="")}),D.value=[],M.value=[],n.page=1,b()},ne=t=>{t&&t.length===2?(n.loan_start_date=t[0],n.loan_end_date=t[1]):(n.loan_start_date="",n.loan_end_date="")},oe=t=>{t&&t.length===2?(n.create_start_date=t[0],n.create_end_date=t[1]):(n.create_start_date="",n.create_end_date="")},re=async()=>{try{const[t,e,r]=await Promise.all([Ae(),Ne(),He()]);P.value=t.data.list||[],I.value=e.data.list||[],$.value=r.data.list||[]}catch(t){console.error("加载选项数据失败:",t)}},se=t=>{H.push(`/order/detail/${t.id}`)},ie=t=>({待初审:"warning",待复审:"warning",代签约:"primary",待放款:"warning",已放款:"success",已退保:"danger",已结清:"success",已作废:"danger"})[t]||"info",de=t=>{n.page_size=t,b()},ue=t=>{n.page=t,b()},pe=t=>{if(!t){u.warning("订单号不存在");return}const e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);navigator.clipboard&&(window.isSecureContext||e)?navigator.clipboard.writeText(t).then(()=>{u.success("订单号已复制到剪贴板")}).catch(r=>{console.error("使用 Clipboard API 复制失败:",r),K(t)}):K(t)},K=t=>{try{const e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();const r=document.execCommand("copy");if(document.body.removeChild(e),r)u.success("订单号已复制到剪贴板");else throw new Error("execCommand 复制失败")}catch(e){console.error("复制失败:",e),Ke.alert(t,"请手动复制订单号",{confirmButtonText:"确定",type:"info"})}};return xe(()=>U.name,()=>{T(),n.page=1,b()},{immediate:!0}),Ce(()=>{T(),re(),b()}),(t,e)=>{const r=$e,C=ke,s=Be,x=Ee,j=Se,d=Oe,v=Te,ce=Fe,me=De,_e=Me,fe=Le,ge=Re;return w(),V("div",Ge,[m("div",Je,[m("div",Ze,[a(C,{modelValue:n.order_no,"onUpdate:modelValue":e[0]||(e[0]=l=>n.order_no=l),placeholder:"订单号",style:{width:"200px"},class:"filter-item",onKeyup:k(_,["enter","native"])},{prefix:o(()=>[a(r,null,{default:o(()=>[a(p(A))]),_:1})]),_:1},8,["modelValue"]),a(x,{modelValue:n.insurance_type,"onUpdate:modelValue":e[1]||(e[1]=l=>n.insurance_type=l),placeholder:"保险类型",style:{width:"120px"},class:"filter-item",clearable:"",onChange:_},{default:o(()=>[a(s,{label:"全部",value:""}),a(s,{label:"车险",value:"车险"}),a(s,{label:"货运险",value:"货运险"})]),_:1},8,["modelValue"]),a(x,{modelValue:n.status,"onUpdate:modelValue":e[2]||(e[2]=l=>n.status=l),placeholder:"选择状态",style:{width:"120px"},class:"filter-item",clearable:"",onChange:_},{default:o(()=>[a(s,{label:"全部",value:""}),a(s,{label:"待初审",value:"待初审"}),a(s,{label:"待复审",value:"待复审"}),a(s,{label:"代签约",value:"代签约"}),a(s,{label:"待放款",value:"待放款"}),a(s,{label:"已放款",value:"已放款"}),a(s,{label:"已退保",value:"已退保"}),a(s,{label:"已结清",value:"已结清"})]),_:1},8,["modelValue"]),a(x,{modelValue:n.funder_id,"onUpdate:modelValue":e[3]||(e[3]=l=>n.funder_id=l),placeholder:"资金方",style:{width:"200px"},class:"filter-item",clearable:"",onChange:_},{default:o(()=>[a(s,{label:"全部",value:""}),(w(!0),V(L,null,R(P.value,l=>(w(),E(s,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(x,{modelValue:n.insurer_id,"onUpdate:modelValue":e[4]||(e[4]=l=>n.insurer_id=l),placeholder:"保险公司",style:{width:"200px"},class:"filter-item",clearable:"",onChange:_},{default:o(()=>[a(s,{label:"全部",value:""}),(w(!0),V(L,null,R(I.value,l=>(w(),E(s,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(x,{modelValue:n.user_id,"onUpdate:modelValue":e[5]||(e[5]=l=>n.user_id=l),placeholder:"借款人",style:{width:"200px"},class:"filter-item",clearable:"",onChange:_},{default:o(()=>[a(s,{label:"全部",value:""}),(w(!0),V(L,null,R($.value,l=>(w(),E(s,{key:l.id,label:l.company_name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),m("div",qe,[a(C,{modelValue:n.car_no,"onUpdate:modelValue":e[6]||(e[6]=l=>n.car_no=l),placeholder:"车牌号",style:{width:"120px"},class:"filter-item",onKeyup:k(_,["enter","native"])},null,8,["modelValue"]),a(C,{modelValue:n.vin,"onUpdate:modelValue":e[7]||(e[7]=l=>n.vin=l),placeholder:"车架号",style:{width:"180px"},class:"filter-item",onKeyup:k(_,["enter","native"])},null,8,["modelValue"]),a(C,{modelValue:n.insurance_no,"onUpdate:modelValue":e[8]||(e[8]=l=>n.insurance_no=l),placeholder:"投保单号",style:{width:"150px"},class:"filter-item",onKeyup:k(_,["enter","native"])},null,8,["modelValue"]),a(j,{modelValue:D.value,"onUpdate:modelValue":e[9]||(e[9]=l=>D.value=l),type:"daterange","range-separator":"至","start-placeholder":"放款开始日期","end-placeholder":"放款结束日期",style:{width:"240px"},class:"filter-item",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:ne},null,8,["modelValue"]),a(j,{modelValue:M.value,"onUpdate:modelValue":e[10]||(e[10]=l=>M.value=l),type:"daterange","range-separator":"至","start-placeholder":"创建开始日期","end-placeholder":"创建结束日期",style:{width:"240px"},class:"filter-item",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:oe},null,8,["modelValue"])]),m("div",We,[a(d,{class:"filter-item",type:"primary",onClick:_},{default:o(()=>[a(r,null,{default:o(()=>[a(p(A))]),_:1}),e[15]||(e[15]=i(" 搜索 "))]),_:1,__:[15]}),a(d,{class:"filter-item",type:"info",onClick:le},{default:o(()=>[a(r,null,{default:o(()=>[a(p(Ue))]),_:1}),e[16]||(e[16]=i(" 重置 "))]),_:1,__:[16]}),a(d,{class:"filter-item",type:"success",onClick:Q},{default:o(()=>[a(r,null,{default:o(()=>[a(p(S))]),_:1}),e[17]||(e[17]=i(" 导出全部订单 "))]),_:1,__:[17]}),a(d,{class:"filter-item",type:"info",onClick:ee},{default:o(()=>[a(r,null,{default:o(()=>[a(p(S))]),_:1}),e[18]||(e[18]=i(" 导出全部车辆 "))]),_:1,__:[18]}),a(d,{class:"filter-item",type:"warning",onClick:X,disabled:f.value.length===0},{default:o(()=>[a(r,null,{default:o(()=>[a(p(S))]),_:1}),i(" 导出选中 ("+h(f.value.length)+") ",1)]),_:1},8,["disabled"]),a(d,{class:"filter-item",type:"info",onClick:ae,disabled:f.value.length===0},{default:o(()=>[a(r,null,{default:o(()=>[a(p(S))]),_:1}),i(" 导出选中 ("+h(f.value.length)+")车辆 ",1)]),_:1},8,["disabled"])])]),m("div",Xe,[Ve((w(),E(me,{data:z.value,border:"",fit:"","highlight-current-row":"",style:{width:"100%",cursor:"pointer"},onRowClick:se,onSelectionChange:te},{default:o(()=>[a(v,{type:"selection",width:"55",align:"center"}),a(v,{label:"订单号",prop:"order_no",align:"left","min-width":"180"}),a(v,{label:"险种",prop:"insurance_type",align:"center","min-width":"100"}),a(v,{label:"借款人",prop:"loan_name",align:"left","min-width":"230"}),a(v,{label:"总保费",prop:"total_premium",align:"center",width:"120"},{default:o(({row:l})=>[m("span",null,h(l.total_premium?F(l.total_premium):"-"),1)]),_:1}),a(v,{label:"贷款金额",prop:"loan_amount",align:"center",width:"120"},{default:o(({row:l})=>[m("span",null,h(l.loan_amount?F(l.loan_amount):"-"),1)]),_:1}),a(v,{label:"进件时间",prop:"created_at",align:"center",width:"180"},{default:o(({row:l})=>[m("span",null,h(l.created_at?p(Qe)(l.created_at):"-"),1)]),_:1}),a(v,{label:"状态",prop:"status",align:"center",width:"110"},{default:o(({row:l})=>[a(ce,{type:ie(l.status)},{default:o(()=>[i(h(l.status),1)]),_:2},1032,["type"])]),_:1}),a(v,{label:"操作",align:"center",width:"120"},{default:o(({row:l})=>[a(d,{type:"primary",link:"",onClick:N(ve=>pe(l.order_no),["stop"]),class:"copy-btn"},{default:o(()=>e[19]||(e[19]=[i(" 复制 ")])),_:2,__:[19]},1032,["onClick"]),a(d,{type:"success",link:"",onClick:N(ve=>G(l),["stop"]),class:"copy-btn"},{default:o(()=>e[20]||(e[20]=[i(" 导出 ")])),_:2,__:[20]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ge,O.value]])]),m("div",ea,[a(_e,{"current-page":n.page,"onUpdate:currentPage":e[11]||(e[11]=l=>n.page=l),"page-size":n.page_size,"onUpdate:pageSize":e[12]||(e[12]=l=>n.page_size=l),"page-sizes":[10,20,50,100],total:Y.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:de,onCurrentChange:ue},null,8,["current-page","page-size","total"])]),a(fe,{modelValue:y.value,"onUpdate:modelValue":e[14]||(e[14]=l=>y.value=l),title:"选择导出类型",width:"400px","close-on-click-modal":!1},{footer:o(()=>[m("span",ta,[a(d,{onClick:e[13]||(e[13]=l=>y.value=!1)},{default:o(()=>e[25]||(e[25]=[i("取消")])),_:1,__:[25]})])]),default:o(()=>[m("div",aa,[a(d,{type:"primary",size:"large",style:{width:"100%","margin-bottom":"12px","margin-left":"12px"},onClick:J},{default:o(()=>[a(r,{style:{"margin-right":"8px"}},{default:o(()=>[a(p(ze))]),_:1}),e[21]||(e[21]=i(" 导出当前订单全部信息 "))]),_:1,__:[21]}),a(d,{type:"success",size:"large",style:{width:"100%","margin-bottom":"12px"},onClick:Z},{default:o(()=>[a(r,{style:{"margin-right":"8px"}},{default:o(()=>[a(p(Ye))]),_:1}),e[22]||(e[22]=i(" 导出投保信息 "))]),_:1,__:[22]}),a(d,{type:"warning",size:"large",style:{width:"100%","margin-bottom":"12px"},onClick:q},{default:o(()=>[a(r,{style:{"margin-right":"8px"}},{default:o(()=>[a(p(Pe))]),_:1}),e[23]||(e[23]=i(" 导出分期计划 "))]),_:1,__:[23]}),a(d,{type:"info",size:"large",style:{width:"100%"},onClick:W},{default:o(()=>[a(r,{style:{"margin-right":"8px"}},{default:o(()=>[a(p(Ie))]),_:1}),e[24]||(e[24]=i(" 导出收款记录 "))]),_:1,__:[24]})])]),_:1},8,["modelValue"])])}}},ba=ye(la,[["__scopeId","data-v-891977ea"]]);export{ba as default};
