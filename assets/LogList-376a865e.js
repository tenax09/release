import{_ as ne,g as re}from"./index-d5294a7a.js";/* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                         */import{r as c,b as D,w as S,ae as se,l as d,B as _,F as t,G as o,H as U,I as N,p as M,u as T,aL as ie,O as u,as as de,S as R,C as g,af as ue,D as L,E as w,ax as ce,ay as _e,a6 as pe,a2 as me,K as fe,a7 as ge,am as ve,ap as ye,aq as be,ar as he,aK as Le,a5 as we,M as xe,ai as Ce}from"./element-plus-b8725afa.js";import{g as ke,a as Ee}from"./log-27d348ae.js";import{f as ze}from"./format-20468769.js";const Ve={class:"log-list-container"},Se={key:0,class:"filter-section"},Me={class:"log-content"},Te={class:"log-item"},Fe={class:"log-content-text"},Ie={class:"operator"},Ae={class:"content"},Be={key:1,class:"empty-logs"},De={key:1,class:"pagination-section"},Ue={class:"dialog-footer"},Ne={__name:"LogList",props:{referenceId:{type:[String,Number],default:""},referenceType:{type:String,default:""},logs:{type:Array,default:()=>[]},showFilter:{type:Boolean,default:!0},showPagination:{type:Boolean,default:!0},pageSize:{type:Number,default:20},autoLoad:{type:Boolean,default:!0}},emits:["update:referenceId","update:referenceType"],setup(x,{expose:P,emit:Re}){const r=x,h=c(!1),p=c([]),v=c(0),C=c([]),y=c(!1),k=c(!1),E=c(),m=D({action:"manual",content:""}),O={content:[{required:!0,message:"请输入日志内容",trigger:"blur"}]},n=D({page:1,pageSize:r.pageSize,reference_id:r.referenceId,reference_type:r.referenceType,action:"",admin_id:""}),i=async()=>{h.value=!0;try{const a=await ke(n);p.value=a.data.list||[],v.value=a.data.total||0}catch(a){console.error("获取日志列表失败:",a),w.error("获取日志列表失败"),p.value=[],v.value=0}h.value=!1};S(()=>r.referenceId,a=>{n.reference_id=a,r.autoLoad&&!r.logs.length&&i()}),S(()=>r.referenceType,a=>{n.reference_type=a,r.autoLoad&&!r.logs.length&&i()}),S(()=>r.logs,a=>{a&&a.length>0?(p.value=a,v.value=a.length):r.autoLoad&&i()},{immediate:!0});const q=async()=>{try{const a=await re({page:1,pageSize:1e3});C.value=a.data.list||[]}catch(a){console.error("获取管理员列表失败:",a),C.value=[]}},F=()=>{n.page=1,i()},I=()=>{n.module="",n.action="",n.admin_id="",n.page=1,i()},K=a=>{n.pageSize=a,n.page=1,i()},j=a=>{n.page=a,i()},G=()=>{y.value=!0,m.content=""},H=async()=>{E.value&&await E.value.validate(async a=>{if(a){k.value=!0;try{const e={reference_id:r.referenceId,reference_type:r.referenceType,action:m.action,content:m.content};await Ee(e),w.success("添加日志成功"),y.value=!1,r.logs.length>0?w.info("日志已添加，请刷新页面查看最新日志"):i()}catch(e){console.error("添加日志失败:",e),w.error("添加日志失败："+(e.message||"未知错误"))}finally{k.value=!1}}})},Q=a=>({create:"primary",update:"success",delete:"danger",review:"warning",remark:"info"})[a]||"info",$=a=>({create:"#409EFF",update:"#67C23A",delete:"#F56C6C",review:"#E6A23C",remark:"#909399"})[a]||"#909399",J=a=>({order:"订单",user:"用户",funder:"资金方",agent:"渠道",product:"产品",system:"系统",received:"收款",receivable:"应收",insurance:"投保",contract:"合同",manual:"人工"})[a]||a,W=a=>({create:"success",update:"warning",delete:"danger",review:"primary",remark:"info",upload:"info",receivable:"info",received:"info",final_review:"success",initial_review:"primary",reset_status:"info",update_config:"warning",update_insurance_status:"info",delete_insurance:"danger",add_insurance:"success",manual:"info",excel_upload:"info",batch_driver_license_upload_start:"info",batch_driver_license_ocr_init_failed:"danger",batch_driver_license_upload_complete:"success",batch_insurance_form_upload_start:"info",batch_insurance_form_ocr_init_failed:"danger",batch_insurance_form_upload_complete:"success"})[a]||"info",X=a=>({create:"创建",update:"更新",delete:"删除",review:"审核",remark:"备注",upload:"上传",receivable:"应收",received:"收款",final_review:"终审",initial_review:"初审",reset_status:"重置状态",update_config:"更新配置",update_insurance_status:"更新投保状态",delete_insurance:"删除投保",add_insurance:"添加投保",manual:"人工录入",excel_upload:"投保信息批量上传",batch_driver_license_upload_start:"批量上传行驶证",batch_driver_license_ocr_init_failed:"OCR初始化失败",batch_driver_license_upload_complete:"批量上传行驶证完成",batch_insurance_form_upload_start:"批量上传投保单",batch_insurance_form_ocr_init_failed:"OCR初始化失败",batch_insurance_form_upload_complete:"批量上传投保单完成"})[a]||a;return P({loadLogs:i,handleQuery:F,handleReset:I}),se(()=>{q(),r.autoLoad&&!r.logs.length&&i()}),(a,e)=>{const s=ce,z=_e,f=pe,A=me,b=fe,B=ge,V=ve,Y=ye,Z=be,ee=he,te=Le,ae=we,le=xe,oe=Ce;return d(),_("div",Ve,[x.showFilter&&!r.logs.length?(d(),_("div",Se,[t(B,{model:n,inline:""},{default:o(()=>[t(f,{label:"模块"},{default:o(()=>[t(z,{modelValue:n.module,"onUpdate:modelValue":e[0]||(e[0]=l=>n.module=l),placeholder:"选择模块",clearable:"",style:{width:"120px"}},{default:o(()=>[t(s,{label:"订单",value:"order"}),t(s,{label:"收款",value:"received"}),t(s,{label:"应收",value:"receivable"}),t(s,{label:"投保",value:"insurance"}),t(s,{label:"合同",value:"contract"}),t(s,{label:"人工",value:"manual"})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"操作"},{default:o(()=>[t(z,{modelValue:n.action,"onUpdate:modelValue":e[1]||(e[1]=l=>n.action=l),placeholder:"选择操作",clearable:"",style:{width:"120px"}},{default:o(()=>[t(s,{label:"创建",value:"create"}),t(s,{label:"更新",value:"update"}),t(s,{label:"删除",value:"delete"}),t(s,{label:"审核",value:"review"})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"操作人"},{default:o(()=>[t(z,{modelValue:n.admin_id,"onUpdate:modelValue":e[2]||(e[2]=l=>n.admin_id=l),placeholder:"选择操作人",clearable:"",style:{width:"150px"}},{default:o(()=>[(d(!0),_(U,null,N(C.value,l=>(d(),M(s,{key:l.id,label:l.name||l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(f,null,{default:o(()=>[t(b,{type:"primary",onClick:F,loading:h.value},{default:o(()=>[t(A,null,{default:o(()=>[t(T(ie))]),_:1}),e[8]||(e[8]=u(" 查询 "))]),_:1,__:[8]},8,["loading"]),t(b,{onClick:I},{default:o(()=>e[9]||(e[9]=[u("重置")])),_:1,__:[9]}),t(b,{type:"success",onClick:G},{default:o(()=>[t(A,null,{default:o(()=>[t(T(de))]),_:1}),e[10]||(e[10]=u(" 添加日志 "))]),_:1,__:[10]})]),_:1})]),_:1},8,["model"])])):R("",!0),g("div",Me,[ue((d(),_("div",null,[p.value&&p.value.length>0?(d(),M(Z,{key:0},{default:o(()=>[(d(!0),_(U,null,N(p.value,l=>(d(),M(Y,{key:l.id,timestamp:T(ze)(l.created_at),type:Q(l.action),color:$(l.action)},{default:o(()=>[g("div",Te,[g("div",Fe,[g("span",Ie,L(l.admin_name||"系统"),1),t(V,{type:"info",size:"small"},{default:o(()=>[u(L(J(l.module)),1)]),_:2},1024),t(V,{type:W(l.action),size:"small"},{default:o(()=>[u(L(X(l.action)),1)]),_:2},1032,["type"]),g("span",Ae,L(l.content),1)])])]),_:2},1032,["timestamp","type","color"]))),128))]),_:1})):(d(),_("div",Be,[t(ee,{description:"暂无操作日志","image-size":80})]))])),[[oe,h.value]])]),x.showPagination&&v.value>0&&!r.logs.length?(d(),_("div",De,[t(te,{"current-page":n.page,"onUpdate:currentPage":e[3]||(e[3]=l=>n.page=l),"page-size":n.pageSize,"onUpdate:pageSize":e[4]||(e[4]=l=>n.pageSize=l),"page-sizes":[10,20,50,100],total:v.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:K,onCurrentChange:j},null,8,["current-page","page-size","total"])])):R("",!0),t(le,{title:"添加日志",modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=l=>y.value=l),width:"500px","close-on-click-modal":!1,"destroy-on-close":""},{footer:o(()=>[g("span",Ue,[t(b,{onClick:e[6]||(e[6]=l=>y.value=!1)},{default:o(()=>e[12]||(e[12]=[u("取 消")])),_:1,__:[12]}),t(b,{type:"primary",onClick:H,loading:k.value},{default:o(()=>e[13]||(e[13]=[u("确 定")])),_:1,__:[13]},8,["loading"])])]),default:o(()=>[t(B,{ref_key:"addLogFormRef",ref:E,model:m,rules:O,"label-width":"100px"},{default:o(()=>[t(f,{label:"操作类型"},{default:o(()=>[t(V,{type:"info",size:"large"},{default:o(()=>e[11]||(e[11]=[u("人工录入")])),_:1,__:[11]})]),_:1}),t(f,{label:"日志内容",prop:"content"},{default:o(()=>[t(ae,{modelValue:m.content,"onUpdate:modelValue":e[5]||(e[5]=l=>m.content=l),type:"textarea",rows:4,placeholder:"请输入日志内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Xe=ne(Ne,[["__scopeId","data-v-1875033a"]]);export{Xe as L};
