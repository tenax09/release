import{_ as te,u as ae}from"./index-76be4761.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                      *//* empty css                        */import{r,b as F,ae as le,l as u,B as V,C as i,F as a,G as l,a1 as oe,af as ne,p as v,E as m,a5 as re,K as se,an as ie,aS as de,M as ue,ai as pe,u as h,aT as O,O as p,as as ce,D as g,S as _e,H as U,I,J as me,a2 as ge,al as fe,am as ye,ax as ve,ay as he,a6 as we,a7 as be}from"./element-plus-eb4b90a0.js";import{g as xe,c as Ce,a as ke}from"./contact-bf575eea.js";import{g as Ve}from"./template-71f45299.js";import{m as Ee}from"./order-32656bcb.js";import{f as ze}from"./format-20468769.js";const Te={class:"contact-container"},Be={class:"filter-container"},Se={class:"pagination"},Le={style:{float:"right",color:"#8492a6","font-size":"13px"}},De={class:"dialog-footer"},Fe={__name:"index",setup(Oe){const M=ae(),E=r([]),z=r(0),w=r(!0),n=F({page:1,page_size:20,keyword:""}),f=r(!1),b=r(null),T=r([]),s=F({template_id:"",order_id:void 0}),N={template_id:[{required:!0,message:"请选择合同模板",trigger:"change"}],order_id:[{required:!0,message:"请选择关联订单",trigger:"change"}]},x=r(!1),y=r([]),C=r(!1),$=o=>{switch(o){case"已签署":return"success";case"未签署":return"info";case"已作废":return"danger";case"签署失败":return"warning";case"已拒签":return"danger";default:return"info"}},c=async()=>{w.value=!0;try{const{data:o}=await xe(n);E.value=o.list,z.value=o.total}catch(o){console.error("获取合同列表失败:",o),m.error("获取合同列表失败")}w.value=!1},B=()=>{n.page=1,c()},K=o=>{n.page_size=o,c()},P=o=>{n.page=o,c()},R=o=>{M.push(`/contact/detail/${o.id}`)},j=async()=>{try{const{data:o}=await Ve();T.value=o,s.template_id="",s.order_id=void 0,y.value=[],f.value=!0}catch(o){console.error("获取模板列表失败:",o),m.error("获取模板列表失败")}},q=async()=>{b.value&&await b.value.validate(async o=>{if(o){x.value=!0;try{await Ce(s),m.success("创建合同成功"),f.value=!1,c()}catch(t){console.error("创建合同失败:",t),m.error("创建合同失败")}x.value=!1}})},G=async o=>{if(o){C.value=!0;try{const{data:t}=await Ee({keyword:o});y.value=t.list}catch(t){console.error("搜索订单失败:",t)}C.value=!1}else y.value=[]},H=async o=>{try{await me.confirm("确认作废该合同?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ke(o.id),m.success("作废成功"),c()}catch(t){t!=="cancel"&&(console.error("作废合同失败:",t),m.error("作废合同失败"))}};return le(()=>{c()}),(o,t)=>{const k=ge,J=re,_=se,d=fe,Q=ye,A=ie,W=de,S=ve,L=he,D=we,X=be,Y=ue,Z=pe;return u(),V("div",Te,[i("div",Be,[a(J,{modelValue:n.keyword,"onUpdate:modelValue":t[0]||(t[0]=e=>n.keyword=e),placeholder:"合同标题/签署方名称",style:{width:"450px !important"},class:"filter-item search-input",onKeyup:oe(B,["enter","native"])},{prefix:l(()=>[a(k,null,{default:l(()=>[a(h(O))]),_:1})]),_:1},8,["modelValue"]),a(_,{class:"filter-item",type:"primary",onClick:B,style:{"margin-left":"10px !important"}},{default:l(()=>[a(k,null,{default:l(()=>[a(h(O))]),_:1}),t[7]||(t[7]=p(" 搜索 "))]),_:1,__:[7]}),a(_,{class:"filter-item",type:"primary",onClick:j,style:{"margin-left":"10px !important"}},{default:l(()=>[a(k,null,{default:l(()=>[a(h(ce))]),_:1}),t[8]||(t[8]=p(" 创建合同 "))]),_:1,__:[8]})]),ne((u(),v(A,{data:E.value,border:"",fit:"","highlight-current-row":"",style:{width:"100%"}},{default:l(()=>[a(d,{label:"合同编号",prop:"contact_id",align:"left","min-width":"180"}),a(d,{label:"订单号",prop:"order_no",align:"left","min-width":"180"}),a(d,{label:"签署方",prop:"customer_name",align:"left",width:"200"},{default:l(({row:e})=>[i("span",null,g(e.customer_name||"-"),1)]),_:1}),a(d,{label:"签署状态",prop:"sign_status",align:"center",width:"100"},{default:l(({row:e})=>[a(Q,{type:$(e.sign_status)},{default:l(()=>[p(g(e.sign_status),1)]),_:2},1032,["type"])]),_:1}),a(d,{label:"签署时间",prop:"sign_time",align:"center",width:"160"},{default:l(({row:e})=>[i("span",null,g(e.sign_time||"-"),1)]),_:1}),a(d,{label:"创建时间",prop:"created_at",align:"center",width:"160"},{default:l(({row:e})=>[i("span",null,g(h(ze)(e.created_at)),1)]),_:1}),a(d,{label:"操作",align:"center",width:"130","class-name":"small-padding fixed-width",fixed:"right"},{default:l(({row:e})=>[a(_,{type:"primary",link:"",onClick:ee=>R(e)},{default:l(()=>t[9]||(t[9]=[p("详情")])),_:2,__:[9]},1032,["onClick"]),e.sign_status==="未签署"?(u(),v(_,{key:0,type:"danger",link:"",onClick:ee=>H(e)},{default:l(()=>t[10]||(t[10]=[p(" 作废 ")])),_:2,__:[10]},1032,["onClick"])):_e("",!0)]),_:1})]),_:1},8,["data"])),[[Z,w.value]]),i("div",Se,[a(W,{"current-page":n.page,"onUpdate:currentPage":t[1]||(t[1]=e=>n.page=e),"page-size":n.page_size,"onUpdate:pageSize":t[2]||(t[2]=e=>n.page_size=e),"page-sizes":[10,20,50,100],total:z.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:K,onCurrentChange:P},null,8,["current-page","page-size","total"])]),a(Y,{modelValue:f.value,"onUpdate:modelValue":t[6]||(t[6]=e=>f.value=e),title:"创建合同",width:"600px","close-on-click-modal":!1},{footer:l(()=>[i("span",De,[a(_,{onClick:t[5]||(t[5]=e=>f.value=!1)},{default:l(()=>t[11]||(t[11]=[p("取 消")])),_:1,__:[11]}),a(_,{type:"primary",onClick:q,loading:x.value},{default:l(()=>t[12]||(t[12]=[p("确 定")])),_:1,__:[12]},8,["loading"])])]),default:l(()=>[a(X,{ref_key:"templateForm",ref:b,model:s,rules:N,"label-width":"100px"},{default:l(()=>[a(D,{label:"合同模板",prop:"template_id"},{default:l(()=>[a(L,{modelValue:s.template_id,"onUpdate:modelValue":t[3]||(t[3]=e=>s.template_id=e),placeholder:"请选择合同模板",style:{width:"100%"}},{default:l(()=>[(u(!0),V(U,null,I(T.value,e=>(u(),v(S,{key:e.id,label:e.template_name,value:e.template_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(D,{label:"关联订单",prop:"order_id"},{default:l(()=>[a(L,{modelValue:s.order_id,"onUpdate:modelValue":t[4]||(t[4]=e=>s.order_id=e),placeholder:"请选择关联订单",style:{width:"100%"},filterable:"",remote:"","remote-method":G,loading:C.value},{default:l(()=>[(u(!0),V(U,null,I(y.value,e=>(u(),v(S,{key:e.id,label:e.order_no,value:e.id},{default:l(()=>[i("span",null,g(e.order_no),1),i("span",Le,g(e.insured_type==="个人"?e.person_name:e.company_name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},He=te(Fe,[["__scopeId","data-v-ce2b2d20"]]);export{He as default};
