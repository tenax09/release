import{_ as ve,u as ye,b as be}from"./index-86e0e316.js";/* empty css               *//* empty css                      *//* empty css                  *//* empty css                     *//* empty css                        *//* empty css                       */import{r as u,b as we,w as he,ae as xe,l as y,B as V,C as p,F as t,G as o,a1 as k,af as Ce,p as E,E as g,a5 as Ve,ay as ke,aL as Ee,K as Oe,an as Se,aS as De,M as Me,ai as Le,u as c,aT as j,H as M,I as L,O as i,aU as Re,as as Ue,av as N,D as x,Z as Q,Q as ze,T as Ye,aV as Pe,R as Be,a2 as Te,ax as $e,al as Fe,am as Ie,J as Ke}from"./element-plus-eb4b90a0.js";import{m as Ae}from"./order-95b27da5.js";import{g as je}from"./funder-5f1c22d9.js";import{g as Ne}from"./insurer-5125829d.js";import{g as Qe}from"./user-15860398.js";import{f as Ge}from"./format-20468769.js";const He={class:"order-list"},Je={class:"filter-container"},Ze={class:"filter-row"},qe={class:"filter-row"},We={class:"filter-row"},Xe={class:"table-container"},et={class:"pagination"},tt={class:"export-options"},at={class:"dialog-footer"},lt={__name:"index",setup(nt){const R=ye(),U=be(),z=u([]),Y=u(0),O=u(!0),n=we({page:1,page_size:50,order_no:"",status:"",insurance_type:"",funder_id:"",insurer_id:"",user_id:"",car_no:"",vin:"",policy_no:"",loan_start_date:"",loan_end_date:"",create_start_date:"",create_end_date:""}),S=u([]),D=u([]),P=u([]),B=u([]),T=u([]),w=u([]),v=u(!1),_=u(null),$={OrderAll:"",OrderFirstReview:"待初审",OrderSecondReview:"待复审",OrderFunderSign:"待资方签约",OrderCustomerSign:"待客户签约",OrderPendingLoan:"待放款",OrderLoaned:"已放款",OrderRefunded:"已退保",OrderCompleted:"已结清",OrderCancelled:"已作废"},F=()=>{const a=U.name;$.hasOwnProperty(a)&&(n.status=$[a])},b=async()=>{O.value=!0;try{const{data:a}=await Ae(n);z.value=a.list,Y.value=a.total}catch(a){console.error("获取订单列表失败:",a),g.error("获取订单列表失败")}O.value=!1},m=()=>{n.page=1,b()},I=a=>a==null?"-":"¥"+parseFloat(a).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}),G=()=>{R.push("/order/create")},H=()=>{const a=new URLSearchParams;Object.keys(n).forEach(e=>{n[e]!==""&&n[e]!==null&&n[e]!==void 0&&a.append(e,n[e])}),window.open(`/api/admin/orders/export?${a.toString()}`,"_blank")},J=a=>{_.value=a,v.value=!0},Z=()=>{_.value&&(window.open(`/api/admin/orders/${_.value.id}/export-complete`,"_blank"),v.value=!1,g.success("正在导出订单全部信息..."))},q=()=>{_.value&&(window.open(`/api/admin/orders/${_.value.id}/export-insurance`,"_blank"),v.value=!1,g.success("正在导出投保信息..."))},W=()=>{_.value&&(window.open(`/api/admin/orders/${_.value.id}/export-plan`,"_blank"),v.value=!1,g.success("正在导出分期计划..."))},X=()=>{_.value&&(window.open(`/api/admin/orders/${_.value.id}/export-received`,"_blank"),v.value=!1,g.success("正在导出收款记录..."))},ee=()=>{if(w.value.length===0){g.warning("请先选择要导出的订单");return}const a=w.value.map(r=>r.id).join(","),e=new URLSearchParams;e.append("order_ids",a),window.open(`/api/admin/orders/export?${e.toString()}`,"_blank")},te=a=>{w.value=a},ae=()=>{Object.keys(n).forEach(a=>{a!=="page"&&a!=="page_size"&&(n[a]="")}),S.value=[],D.value=[],n.page=1,b()},le=a=>{a&&a.length===2?(n.loan_start_date=a[0],n.loan_end_date=a[1]):(n.loan_start_date="",n.loan_end_date="")},ne=a=>{a&&a.length===2?(n.create_start_date=a[0],n.create_end_date=a[1]):(n.create_start_date="",n.create_end_date="")},oe=async()=>{try{const[a,e,r]=await Promise.all([je(),Ne(),Qe()]);P.value=a.data.list||[],B.value=e.data.list||[],T.value=r.data.list||[]}catch(a){console.error("加载选项数据失败:",a)}},re=a=>{R.push(`/order/detail/${a.id}`)},se=a=>({待初审:"warning",待复审:"warning",待客户签约:"primary",待资方签约:"primary",待放款:"warning",已放款:"success",已退保:"danger",已结清:"success",已作废:"info"})[a]||"info",ie=a=>{n.page_size=a,b()},de=a=>{n.page=a,b()},ue=a=>{if(!a){g.warning("订单号不存在");return}const e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);navigator.clipboard&&(window.isSecureContext||e)?navigator.clipboard.writeText(a).then(()=>{g.success("订单号已复制到剪贴板")}).catch(r=>{console.error("使用 Clipboard API 复制失败:",r),K(a)}):K(a)},K=a=>{try{const e=document.createElement("textarea");e.value=a,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();const r=document.execCommand("copy");if(document.body.removeChild(e),r)g.success("订单号已复制到剪贴板");else throw new Error("execCommand 复制失败")}catch(e){console.error("复制失败:",e),Ke.alert(a,"请手动复制订单号",{confirmButtonText:"确定",type:"info"})}};return he(()=>U.name,()=>{F(),n.page=1,b()},{immediate:!0}),xe(()=>{F(),oe(),b()}),(a,e)=>{const r=Te,C=Ve,s=$e,h=ke,A=Ee,d=Oe,f=Fe,pe=Ie,ce=Se,me=De,_e=Me,fe=Le;return y(),V("div",He,[p("div",Je,[p("div",Ze,[t(C,{modelValue:n.order_no,"onUpdate:modelValue":e[0]||(e[0]=l=>n.order_no=l),placeholder:"订单号",style:{width:"200px"},class:"filter-item",onKeyup:k(m,["enter","native"])},{prefix:o(()=>[t(r,null,{default:o(()=>[t(c(j))]),_:1})]),_:1},8,["modelValue"]),t(h,{modelValue:n.insurance_type,"onUpdate:modelValue":e[1]||(e[1]=l=>n.insurance_type=l),placeholder:"保险类型",style:{width:"120px"},class:"filter-item",clearable:"",onChange:m},{default:o(()=>[t(s,{label:"全部",value:""}),t(s,{label:"车险",value:"车险"}),t(s,{label:"货运险",value:"货运险"})]),_:1},8,["modelValue"]),t(h,{modelValue:n.status,"onUpdate:modelValue":e[2]||(e[2]=l=>n.status=l),placeholder:"选择状态",style:{width:"120px"},class:"filter-item",clearable:"",onChange:m},{default:o(()=>[t(s,{label:"全部",value:""}),t(s,{label:"待初审",value:"待初审"}),t(s,{label:"待复审",value:"待复审"}),t(s,{label:"待客户签约",value:"待客户签约"}),t(s,{label:"待资方签约",value:"待资方签约"}),t(s,{label:"待放款",value:"待放款"}),t(s,{label:"已放款",value:"已放款"}),t(s,{label:"已退保",value:"已退保"}),t(s,{label:"已结清",value:"已结清"})]),_:1},8,["modelValue"]),t(h,{modelValue:n.funder_id,"onUpdate:modelValue":e[3]||(e[3]=l=>n.funder_id=l),placeholder:"资金方",style:{width:"200px"},class:"filter-item",clearable:"",onChange:m},{default:o(()=>[t(s,{label:"全部",value:""}),(y(!0),V(M,null,L(P.value,l=>(y(),E(s,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(h,{modelValue:n.insurer_id,"onUpdate:modelValue":e[4]||(e[4]=l=>n.insurer_id=l),placeholder:"保险公司",style:{width:"200px"},class:"filter-item",clearable:"",onChange:m},{default:o(()=>[t(s,{label:"全部",value:""}),(y(!0),V(M,null,L(B.value,l=>(y(),E(s,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(h,{modelValue:n.user_id,"onUpdate:modelValue":e[5]||(e[5]=l=>n.user_id=l),placeholder:"借款人",style:{width:"200px"},class:"filter-item",clearable:"",onChange:m},{default:o(()=>[t(s,{label:"全部",value:""}),(y(!0),V(M,null,L(T.value,l=>(y(),E(s,{key:l.id,label:l.company_name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),p("div",qe,[t(C,{modelValue:n.car_no,"onUpdate:modelValue":e[6]||(e[6]=l=>n.car_no=l),placeholder:"车牌号",style:{width:"120px"},class:"filter-item",onKeyup:k(m,["enter","native"])},null,8,["modelValue"]),t(C,{modelValue:n.vin,"onUpdate:modelValue":e[7]||(e[7]=l=>n.vin=l),placeholder:"车架号",style:{width:"180px"},class:"filter-item",onKeyup:k(m,["enter","native"])},null,8,["modelValue"]),t(C,{modelValue:n.policy_no,"onUpdate:modelValue":e[8]||(e[8]=l=>n.policy_no=l),placeholder:"投保单号",style:{width:"150px"},class:"filter-item",onKeyup:k(m,["enter","native"])},null,8,["modelValue"]),t(A,{modelValue:S.value,"onUpdate:modelValue":e[9]||(e[9]=l=>S.value=l),type:"daterange","range-separator":"至","start-placeholder":"放款开始日期","end-placeholder":"放款结束日期",style:{width:"240px"},class:"filter-item",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:le},null,8,["modelValue"]),t(A,{modelValue:D.value,"onUpdate:modelValue":e[10]||(e[10]=l=>D.value=l),type:"daterange","range-separator":"至","start-placeholder":"创建开始日期","end-placeholder":"创建结束日期",style:{width:"240px"},class:"filter-item",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:ne},null,8,["modelValue"])]),p("div",We,[t(d,{class:"filter-item",type:"primary",onClick:m},{default:o(()=>[t(r,null,{default:o(()=>[t(c(j))]),_:1}),e[15]||(e[15]=i(" 搜索 "))]),_:1,__:[15]}),t(d,{class:"filter-item",type:"info",onClick:ae},{default:o(()=>[t(r,null,{default:o(()=>[t(c(Re))]),_:1}),e[16]||(e[16]=i(" 重置 "))]),_:1,__:[16]}),t(d,{class:"filter-item",type:"primary",onClick:G},{default:o(()=>[t(r,null,{default:o(()=>[t(c(Ue))]),_:1}),e[17]||(e[17]=i(" 新建订单 "))]),_:1,__:[17]}),t(d,{class:"filter-item",type:"success",onClick:H},{default:o(()=>[t(r,null,{default:o(()=>[t(c(N))]),_:1}),e[18]||(e[18]=i(" 导出Excel "))]),_:1,__:[18]}),t(d,{class:"filter-item",type:"warning",onClick:ee,disabled:w.value.length===0},{default:o(()=>[t(r,null,{default:o(()=>[t(c(N))]),_:1}),i(" 导出选中 ("+x(w.value.length)+") ",1)]),_:1},8,["disabled"])])]),p("div",Xe,[Ce((y(),E(ce,{data:z.value,border:"",fit:"","highlight-current-row":"",style:{width:"100%",cursor:"pointer"},onRowClick:re,onSelectionChange:te},{default:o(()=>[t(f,{type:"selection",width:"55",align:"center"}),t(f,{label:"订单号",prop:"order_no",align:"left","min-width":"180"}),t(f,{label:"险种",prop:"insurance_type",align:"center","min-width":"100"}),t(f,{label:"借款人",prop:"loan_name",align:"left","min-width":"230"}),t(f,{label:"总保费",prop:"total_premium",align:"center",width:"120"},{default:o(({row:l})=>[p("span",null,x(l.total_premium?I(l.total_premium):"-"),1)]),_:1}),t(f,{label:"贷款金额",prop:"loan_amount",align:"center",width:"120"},{default:o(({row:l})=>[p("span",null,x(l.loan_amount?I(l.loan_amount):"-"),1)]),_:1}),t(f,{label:"进件时间",prop:"created_at",align:"center",width:"180"},{default:o(({row:l})=>[p("span",null,x(l.created_at?c(Ge)(l.created_at):"-"),1)]),_:1}),t(f,{label:"状态",prop:"status",align:"center",width:"110"},{default:o(({row:l})=>[t(pe,{type:se(l.status)},{default:o(()=>[i(x(l.status),1)]),_:2},1032,["type"])]),_:1}),t(f,{label:"操作",align:"center",width:"120"},{default:o(({row:l})=>[t(d,{type:"primary",link:"",onClick:Q(ge=>ue(l.order_no),["stop"]),class:"copy-btn"},{default:o(()=>e[19]||(e[19]=[i(" 复制 ")])),_:2,__:[19]},1032,["onClick"]),t(d,{type:"success",link:"",onClick:Q(ge=>J(l),["stop"]),class:"copy-btn"},{default:o(()=>e[20]||(e[20]=[i(" 导出 ")])),_:2,__:[20]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[fe,O.value]])]),p("div",et,[t(me,{"current-page":n.page,"onUpdate:currentPage":e[11]||(e[11]=l=>n.page=l),"page-size":n.page_size,"onUpdate:pageSize":e[12]||(e[12]=l=>n.page_size=l),"page-sizes":[10,20,50,100],total:Y.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ie,onCurrentChange:de},null,8,["current-page","page-size","total"])]),t(_e,{modelValue:v.value,"onUpdate:modelValue":e[14]||(e[14]=l=>v.value=l),title:"选择导出类型",width:"400px","close-on-click-modal":!1},{footer:o(()=>[p("span",at,[t(d,{onClick:e[13]||(e[13]=l=>v.value=!1)},{default:o(()=>e[25]||(e[25]=[i("取消")])),_:1,__:[25]})])]),default:o(()=>[p("div",tt,[t(d,{type:"primary",size:"large",style:{width:"100%","margin-bottom":"12px","margin-left":"12px"},onClick:Z},{default:o(()=>[t(r,{style:{"margin-right":"8px"}},{default:o(()=>[t(c(ze))]),_:1}),e[21]||(e[21]=i(" 导出当前订单全部信息 "))]),_:1,__:[21]}),t(d,{type:"success",size:"large",style:{width:"100%","margin-bottom":"12px"},onClick:q},{default:o(()=>[t(r,{style:{"margin-right":"8px"}},{default:o(()=>[t(c(Ye))]),_:1}),e[22]||(e[22]=i(" 导出投保信息 "))]),_:1,__:[22]}),t(d,{type:"warning",size:"large",style:{width:"100%","margin-bottom":"12px"},onClick:W},{default:o(()=>[t(r,{style:{"margin-right":"8px"}},{default:o(()=>[t(c(Pe))]),_:1}),e[23]||(e[23]=i(" 导出分期计划 "))]),_:1,__:[23]}),t(d,{type:"info",size:"large",style:{width:"100%"},onClick:X},{default:o(()=>[t(r,{style:{"margin-right":"8px"}},{default:o(()=>[t(c(Be))]),_:1}),e[24]||(e[24]=i(" 导出收款记录 "))]),_:1,__:[24]})])]),_:1},8,["modelValue"])])}}},yt=ve(lt,[["__scopeId","data-v-5fd0edb4"]]);export{yt as default};
