import{_ as ll,b as al,u as tl}from"./index-e5eccfe7.js";/* empty css               *//* empty css                   *//* empty css                    *//* empty css                 *//* empty css                       *//* empty css                     *//* empty css                        *//* empty css                        *//* empty css                  *//* empty css                *//* empty css               *//* empty css                       */import{r,j as Ce,w as sl,ae as ol,l as v,B as b,C as s,F as l,G as a,p as q,S as U,af as Ue,u as Y,E as _,aE as nl,ag as rl,M as ul,ai as il,aG as dl,O as n,av as ml,aH as cl,aI as pl,as as vl,D as d,H as P,I as j,aw as Te,X as _l,J as fl,a2 as gl,K as bl,ao as yl,ah as wl,al as Vl,am as kl,an as hl,a5 as xl,a6 as Dl,ax as Cl,ay as Ul,aJ as Tl,aK as Yl,aL as El,a7 as Ml,aB as Fl,aC as Ll,aD as Rl}from"./element-plus-eb4b90a0.js";import{i as ql,a as Il,j as Ye,k as Bl,e as $l,u as Al}from"./order-4da6a612.js";import{a as zl}from"./user-d74bfb3e.js";import{a as Ol,A as Sl,d as Nl}from"./AttachmentUpload-a8f9e022.js";/* empty css                 */import"./format-20468769.js";const Pl={class:"insurance-detail"},jl={class:"page-header"},Gl={class:"header-actions"},Hl={class:"stat-item"},Jl={class:"stat-number"},Wl={class:"stat-item"},Kl={class:"stat-number"},Xl={class:"stat-item"},Ql={class:"stat-number"},Zl={class:"stat-item total"},ea={class:"stat-number"},la={class:"attachment-status"},aa={class:"status-item"},ta={class:"status-item"},sa={class:"stat-item total"},oa={class:"stat-number"},na={class:"stat-item"},ra={class:"stat-number"},ua={class:"stat-item"},ia={class:"stat-number"},da={class:"insured-input"},ma={class:"dialog-footer"},ca={class:"insured-input"},pa={class:"dialog-footer"},va={class:"upload-content"},_a={class:"upload-tips"},fa={key:0,class:"import-result"},ga={class:"result-summary"},ba={class:"stat-item"},ya={class:"stat-number total"},wa={class:"stat-item"},Va={class:"stat-number success"},ka={class:"stat-item"},ha={class:"stat-number fail"},xa={key:0,class:"error-list"},Da={class:"dialog-footer"},Ca={class:"upload-content"},Ua={class:"upload-tips"},Ta={key:0,class:"import-result"},Ya={class:"result-summary"},Ea={class:"stat-item"},Ma={class:"stat-number total"},Fa={class:"stat-item"},La={class:"stat-number success"},Ra={class:"stat-item"},qa={class:"stat-number fail"},Ia={key:0,class:"detail-results"},Ba={class:"result-list"},$a={class:"result-header"},Aa={class:"file-name"},za={key:0,class:"result-content success-content"},Oa={class:"ocr-info"},Sa={class:"info-item"},Na={class:"info-item"},Pa={class:"info-item"},ja={key:1,class:"result-content error-content"},Ga={class:"error-message"},Ha={key:1,class:"error-list"},Ja={class:"dialog-footer"},Wa={__name:"insurance",setup(Ka){const h=al(),me=tl(),G=r(!1),I=r(!1),x=r([]),y=r("车险"),Ee=r({}),Me=r({}),R=r([]),H=r(!1),$=r(null),ae=r(!1),E=r(null),te=r([]),V=r(null),A=r(!1),se=r(null),oe=r(!1),M=r([]),ne=r([]),w=r(null),re=r(!1),B=r(0),z=r(""),J=r(""),W=r(!1),K=r([]),O=r(!1),ue=r(null),i=r({car_no:"",vin:"",insurance_no:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,compulsory_amount:void 0,vehicle_tax_amount:void 0,start_date:"",end_date:""}),Fe={car_no:[{required:!0,message:"请输入车牌号",trigger:"blur"}],vin:[{required:!0,message:"请输入车架号",trigger:"blur"}],insurance_no:[{required:!0,message:"请输入投保单号",trigger:"blur"}],insured:[{required:!0,message:"请选择被保人",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}]},S=r(!1),ie=r(null),u=r({track_no:"",insurance_no:"",name:"",quantity:"",carrier:"",consignee:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,start_date:"",end_date:""}),Le={track_no:[{required:!0,message:"请输入运输编号",trigger:"blur"}],insurance_no:[{required:!0,message:"请输入投保单号",trigger:"blur"}],name:[{required:!0,message:"请输入货物名称",trigger:"blur"}],quantity:[{required:!0,message:"请输入货物数量",trigger:"blur"}],carrier:[{required:!0,message:"请输入承运人",trigger:"blur"}],consignee:[{required:!0,message:"请输入收货人",trigger:"blur"}],insured:[{required:!0,message:"请选择被保人",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}]},Re=()=>{me.back()},qe=()=>{me.push(`/order/detail/${h.params.id}`)},F=async()=>{G.value=!0;try{const o=await ql(h.params.id);x.value=o.data.insurances||[],o.data.type&&(y.value=o.data.type)}catch{_.error("获取投保信息失败")}G.value=!1},D=o=>o?`¥${o.toFixed(2)}`:"¥0.00",X=Ce(()=>{if(y.value!=="车险"||!x.value.length)return{commercialTotal:0,compulsoryTotal:0,vehicleTaxTotal:0,grandTotal:0};const o=x.value.reduce((e,c)=>(e.commercialTotal+=c.commercial_amount||0,e.compulsoryTotal+=c.compulsory_amount||0,e.vehicleTaxTotal+=c.vehicle_tax_amount||0,e),{commercialTotal:0,compulsoryTotal:0,vehicleTaxTotal:0});return o.grandTotal=o.commercialTotal+o.compulsoryTotal+o.vehicleTaxTotal,o}),ce=Ce(()=>{if(y.value!=="货运险"||!x.value.length)return{commercialTotal:0,averageAmount:0};const o=x.value.reduce((c,m)=>c+(m.commercial_amount||0),0),e=o/x.value.length;return{commercialTotal:o,averageAmount:e}}),Ie=()=>{if(y.value==="车险"){if(i.value={car_no:"",vin:"",insurance_no:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,compulsory_amount:void 0,vehicle_tax_amount:void 0,start_date:"",end_date:""},R.value.length===2){const o=R.value.find(e=>e.value!=="同借款人");o&&(i.value.insured=o.value)}O.value=!0}else if(y.value==="货运险"){if(u.value={track_no:"",insurance_no:"",name:"",quantity:"",carrier:"",consignee:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,start_date:"",end_date:""},R.value.length===2){const o=R.value.find(e=>e.value!=="同借款人");o&&(u.value.insured=o.value)}S.value=!0}},Be=async()=>{ue.value&&await ue.value.validate(async o=>{if(o){I.value=!0;try{await Ye(h.params.id,i.value),_.success("添加车险信息成功"),O.value=!1,F()}catch(e){_.error("添加车险信息失败："+(e.message||"未知错误"))}I.value=!1}})},$e=async()=>{ie.value&&await ie.value.validate(async o=>{if(o){I.value=!0;try{await Ye(h.params.id,u.value),_.success("添加货运险信息成功"),S.value=!1,F()}catch(e){_.error("添加货运险信息失败："+(e.message||"未知错误"))}I.value=!1}})},pe=async o=>{try{await fl.confirm("确定要删除该投保信息吗？","提示",{type:"warning"}),await Bl(h.params.id,o.id),_.success("删除成功"),F()}catch(e){e!=="cancel"&&_.error("删除失败："+(e.message||"未知错误"))}},ve=(o,e)=>{const c=e==="car"?o.car_no:o.track_no;J.value=c,B.value=o.id,z.value=e,re.value=!0},_e=(o,e)=>{const c=e==="car"?o.car_no:o.track_no;J.value=c,B.value=o.id,z.value=e,K.value=o.attachments||[],W.value=!0};sl(W,o=>{o||(K.value=[],B.value=0,z.value="")});const Ae=async()=>{await F();const o=x.value.find(e=>e.id===B.value);o&&(K.value=o.attachments||[])},ze=async o=>{try{await Nl(o)}catch(e){_.error("删除失败："+(e.message||"未知错误"))}},Oe=async()=>{window.open(`/api/admin/orders/insurances/download-template?type=${y.value}`,"_blank")},Se=()=>{E.value=null,te.value=[],V.value=null,H.value=!0},Ne=o=>{if(E.value=o.raw,!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(o.raw.type)&&!o.name.toLowerCase().endsWith(".xlsx")&&!o.name.toLowerCase().endsWith(".xls")){_.error("请上传Excel文件(.xlsx或.xls)"),$.value.clearFiles(),E.value=null;return}if(o.raw.size>10*1024*1024){_.error("文件大小不能超过10MB"),$.value.clearFiles(),E.value=null;return}},Pe=async()=>{if(!E.value){_.error("请选择要上传的文件");return}const o=new FormData;o.append("file",E.value),ae.value=!0,V.value=null;try{const e=await $l(h.params.id,o);V.value=e.data,e.data.success>0?(F(),_.success(`导入完成：成功${e.data.success}条，失败${e.data.fail}条`)):_.warning("没有成功导入任何数据，请检查文件格式")}catch(e){_.error("导入失败："+(e.message||"未知错误"))}ae.value=!1},je=()=>{H.value=!1,E.value=null,te.value=[],V.value=null,$.value&&$.value.clearFiles()},fe=o=>{o==="car"?i.value.same_as_borrower?i.value.insured="同借款人":i.value.insured="":o==="cargo"&&(u.value.same_as_borrower?u.value.insured="同借款人":u.value.insured="")},Ge=()=>{M.value=[],ne.value=[],w.value=null,A.value=!0},He=o=>{if(!["image/jpeg","image/jpg","image/png","image/bmp","image/tiff","image/webp"].includes(o.raw.type))return _.error("请上传图片文件"),!1;if(o.raw.size>5*1024*1024)return _.error("图片大小不能超过5MB"),!1;M.value.push(o.raw)},Je=o=>{const e=M.value.findIndex(c=>c.name===o.name);e!==-1&&M.value.splice(e,1)},We=()=>{A.value=!1,M.value=[],ne.value=[],w.value=null,se.value&&se.value.clearFiles()},Ke=async()=>{if(M.value.length===0){_.error("请选择要上传的行驶证图片");return}const o=new FormData;M.value.forEach(e=>{o.append("images",e)}),oe.value=!0,w.value=null;try{const e=await Al(h.params.id,o);w.value={message:e.data.message,file_count:e.data.file_count},_.success("行驶证上传成功，正在后台处理OCR识别"),A.value=!1,setTimeout(()=>{F()},2e3)}catch(e){_.error("行驶证上传失败："+(e.message||"未知错误"))}oe.value=!1},Xe=o=>o==="success"?"success":o==="fail"?"danger":"info",Qe=o=>o==="success"?"成功":o==="fail"?"失败":"处理中",Q=(o,e)=>!o||o.length===0?!1:o.some(c=>c.remark===e),Ze=async()=>{try{const o=await Il(h.params.id);Ee.value=o.data,o.data.user_id&&await el(o.data.user_id)}catch{_.error("获取订单详情失败")}},el=async o=>{try{const e=await zl(o);Me.value=e.data;const c=e.data.insureds||"",m=[];m.push({value:"同借款人",label:"同借款人"}),c&&c.split(";").filter(g=>g.trim()).forEach(g=>{const L=g.split(",");if(L.length>=2){const C=L[0].trim(),p=L[1].trim();m.push({value:C,label:p?`${C} (${p})`:C})}}),R.value=m}catch{_.error("获取用户配置失败")}};return ol(()=>{F(),Ze()}),(o,e)=>{const c=gl,m=bl,ge=nl,g=yl,L=wl,C=rl,p=Vl,N=kl,be=hl,T=xl,f=Dl,ye=Cl,we=Ul,Ve=Tl,Z=Yl,ee=El,ke=Ml,le=ul,he=Fl,xe=Ll,de=Rl,De=il;return v(),b("div",Pl,[s("div",jl,[l(ge,{onBack:Re,title:`${y.value}投保信息管理`},{extra:a(()=>[s("div",Gl,[l(m,{onClick:qe},{default:a(()=>[l(c,null,{default:a(()=>[l(Y(dl))]),_:1}),e[31]||(e[31]=n(" 返回订单详情 "))]),_:1,__:[31]}),l(m,{onClick:Oe},{default:a(()=>[l(c,null,{default:a(()=>[l(Y(ml))]),_:1}),e[32]||(e[32]=n(" 下载模板 "))]),_:1,__:[32]}),l(m,{type:"success",onClick:Se},{default:a(()=>[l(c,null,{default:a(()=>[l(Y(cl))]),_:1}),e[33]||(e[33]=n(" 批量导入 "))]),_:1,__:[33]}),y.value==="车险"?(v(),q(m,{key:0,type:"warning",onClick:Ge},{default:a(()=>[l(c,null,{default:a(()=>[l(Y(pl))]),_:1}),e[34]||(e[34]=n(" 批量上传行驶证 "))]),_:1,__:[34]})):U("",!0),l(m,{type:"primary",onClick:Ie},{default:a(()=>[l(c,null,{default:a(()=>[l(Y(vl))]),_:1}),n(" 添加"+d(y.value),1)]),_:1})])]),_:1},8,["title"])]),y.value==="车险"?(v(),q(C,{key:0,class:"detail-card"},{default:a(()=>[l(L,{gutter:20},{default:a(()=>[l(g,{span:6},{default:a(()=>[s("div",Hl,[s("div",Jl,d(D(X.value.commercialTotal)),1),e[35]||(e[35]=s("div",{class:"stat-label"},"商业险总金额",-1))])]),_:1}),l(g,{span:6},{default:a(()=>[s("div",Wl,[s("div",Kl,d(D(X.value.compulsoryTotal)),1),e[36]||(e[36]=s("div",{class:"stat-label"},"交强险总金额",-1))])]),_:1}),l(g,{span:6},{default:a(()=>[s("div",Xl,[s("div",Ql,d(D(X.value.vehicleTaxTotal)),1),e[37]||(e[37]=s("div",{class:"stat-label"},"车船税总金额",-1))])]),_:1}),l(g,{span:6},{default:a(()=>[s("div",Zl,[s("div",ea,d(D(X.value.grandTotal)),1),e[38]||(e[38]=s("div",{class:"stat-label"},"合计总保费",-1))])]),_:1})]),_:1})]),_:1})):U("",!0),y.value==="车险"?Ue((v(),q(C,{key:1,class:"detail-card"},{default:a(()=>[l(be,{data:x.value,border:"",style:{width:"100%"}},{default:a(()=>[l(p,{prop:"car_no",label:"车牌号",width:"100"}),l(p,{prop:"vin",label:"车架号","min-width":"180"}),l(p,{prop:"issue_date",label:"附件标记",width:"110"},{default:a(t=>[s("div",la,[s("div",aa,[e[39]||(e[39]=s("span",{class:"status-label"},"行驶证:",-1)),l(N,{type:Q(t.row.attachments,"行驶证")?"success":"info",size:"small"},{default:a(()=>[n(d(Q(t.row.attachments,"行驶证")?"已上传":"未上传"),1)]),_:2},1032,["type"])]),s("div",ta,[e[40]||(e[40]=s("span",{class:"status-label"},"投保单:",-1)),l(N,{type:Q(t.row.attachments,"投保单")?"success":"info",size:"small"},{default:a(()=>[n(d(Q(t.row.attachments,"投保单")?"已上传":"未上传"),1)]),_:2},1032,["type"])])])]),_:1}),l(p,{prop:"insured",label:"被保人",width:"280"}),l(p,{prop:"commercial_amount",label:"商业险",width:"100"},{default:a(t=>[n(d(D(t.row.commercial_amount)),1)]),_:1}),l(p,{prop:"compulsory_amount",label:"交强险",width:"100"},{default:a(t=>[n(d(D(t.row.compulsory_amount)),1)]),_:1}),l(p,{prop:"vehicle_tax_amount",label:"车船税",width:"100"},{default:a(t=>[n(d(D(t.row.vehicle_tax_amount)),1)]),_:1}),l(p,{prop:"start_date",label:"开始日期",width:"110"}),l(p,{prop:"end_date",label:"结束日期",width:"110"}),l(p,{label:"操作",width:"200",fixed:"right"},{default:a(t=>[l(m,{type:"info",link:"",onClick:k=>_e(t.row,"car")},{default:a(()=>e[41]||(e[41]=[n("查看附件")])),_:2,__:[41]},1032,["onClick"]),l(m,{type:"primary",link:"",onClick:k=>ve(t.row,"car")},{default:a(()=>e[42]||(e[42]=[n("上传")])),_:2,__:[42]},1032,["onClick"]),l(m,{type:"danger",link:"",onClick:k=>pe(t.row)},{default:a(()=>e[43]||(e[43]=[n("删除")])),_:2,__:[43]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[De,G.value]]):U("",!0),y.value==="货运险"?(v(),q(C,{key:2,class:"detail-card"},{default:a(()=>[l(L,{gutter:20},{default:a(()=>[l(g,{span:8},{default:a(()=>[s("div",sa,[s("div",oa,d(D(ce.value.commercialTotal)),1),e[44]||(e[44]=s("div",{class:"stat-label"},"商业险总金额",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[s("div",na,[s("div",ra,d(x.value.length),1),e[45]||(e[45]=s("div",{class:"stat-label"},"投保单数量",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[s("div",ua,[s("div",ia,d(D(ce.value.averageAmount)),1),e[46]||(e[46]=s("div",{class:"stat-label"},"平均保费",-1))])]),_:1})]),_:1})]),_:1})):U("",!0),y.value==="货运险"?Ue((v(),q(C,{key:3,class:"detail-card"},{default:a(()=>[l(be,{data:x.value,border:"",style:{width:"100%"}},{default:a(()=>[l(p,{prop:"track_no",label:"运输编号",width:"140"}),l(p,{prop:"insurance_no",label:"投保单号","min-width":"180"}),l(p,{prop:"name",label:"货物名称",width:"120"}),l(p,{prop:"quantity",label:"货物数量",width:"100"}),l(p,{prop:"carrier",label:"承运人",width:"120"}),l(p,{prop:"consignee",label:"收货人",width:"120"}),l(p,{prop:"insured",label:"被保人",width:"280"}),l(p,{prop:"commercial_amount",label:"商业险",width:"120"},{default:a(t=>[n(d(D(t.row.commercial_amount)),1)]),_:1}),l(p,{prop:"start_date",label:"开始日期",width:"110"}),l(p,{prop:"end_date",label:"结束日期",width:"110"}),l(p,{label:"操作",width:"230",fixed:"right"},{default:a(t=>[l(m,{type:"info",link:"",onClick:k=>_e(t.row,"cargo")},{default:a(()=>e[47]||(e[47]=[n("查看附件")])),_:2,__:[47]},1032,["onClick"]),l(m,{type:"primary",link:"",onClick:k=>ve(t.row,"cargo")},{default:a(()=>e[48]||(e[48]=[n("上传")])),_:2,__:[48]},1032,["onClick"]),l(m,{type:"danger",link:"",onClick:k=>pe(t.row)},{default:a(()=>e[49]||(e[49]=[n("删除")])),_:2,__:[49]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[De,G.value]]):U("",!0),l(le,{modelValue:O.value,"onUpdate:modelValue":e[12]||(e[12]=t=>O.value=t),title:"添加车险信息",width:"600px"},{footer:a(()=>[s("span",ma,[l(m,{onClick:e[11]||(e[11]=t=>O.value=!1)},{default:a(()=>e[51]||(e[51]=[n("取消")])),_:1,__:[51]}),l(m,{type:"primary",onClick:Be,loading:I.value},{default:a(()=>e[52]||(e[52]=[n("确定")])),_:1,__:[52]},8,["loading"])])]),default:a(()=>[l(ke,{ref_key:"carFormRef",ref:ue,model:i.value,rules:Fe,"label-width":"120px"},{default:a(()=>[l(f,{label:"车牌号",prop:"car_no"},{default:a(()=>[l(T,{modelValue:i.value.car_no,"onUpdate:modelValue":e[0]||(e[0]=t=>i.value.car_no=t),placeholder:"请输入车牌号"},null,8,["modelValue"])]),_:1}),l(f,{label:"车架号",prop:"vin"},{default:a(()=>[l(T,{modelValue:i.value.vin,"onUpdate:modelValue":e[1]||(e[1]=t=>i.value.vin=t),placeholder:"请输入车架号"},null,8,["modelValue"])]),_:1}),l(f,{label:"投保单号",prop:"insurance_no"},{default:a(()=>[l(T,{modelValue:i.value.insurance_no,"onUpdate:modelValue":e[2]||(e[2]=t=>i.value.insurance_no=t),placeholder:"请输入投保单号"},null,8,["modelValue"])]),_:1}),l(f,{label:"被保人",prop:"insured"},{default:a(()=>[s("div",da,[l(we,{modelValue:i.value.insured,"onUpdate:modelValue":e[3]||(e[3]=t=>i.value.insured=t),placeholder:"请选择被保人",style:{width:"300px"},disabled:i.value.same_as_borrower},{default:a(()=>[(v(!0),b(P,null,j(R.value,t=>(v(),q(ye,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),l(Ve,{modelValue:i.value.same_as_borrower,"onUpdate:modelValue":e[4]||(e[4]=t=>i.value.same_as_borrower=t),onChange:e[5]||(e[5]=t=>fe("car")),class:"same-borrower-checkbox",style:{"margin-left":"10px"}},{default:a(()=>e[50]||(e[50]=[n(" 同借款人 ")])),_:1,__:[50]},8,["modelValue"])])]),_:1}),l(f,{label:"商业险",prop:"commercial_amount"},{default:a(()=>[l(Z,{modelValue:i.value.commercial_amount,"onUpdate:modelValue":e[6]||(e[6]=t=>i.value.commercial_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(f,{label:"交强险",prop:"compulsory_amount"},{default:a(()=>[l(Z,{modelValue:i.value.compulsory_amount,"onUpdate:modelValue":e[7]||(e[7]=t=>i.value.compulsory_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(f,{label:"车船税",prop:"vehicle_tax_amount"},{default:a(()=>[l(Z,{modelValue:i.value.vehicle_tax_amount,"onUpdate:modelValue":e[8]||(e[8]=t=>i.value.vehicle_tax_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(f,{label:"开始日期",prop:"start_date"},{default:a(()=>[l(ee,{modelValue:i.value.start_date,"onUpdate:modelValue":e[9]||(e[9]=t=>i.value.start_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择开始日期"},null,8,["modelValue"])]),_:1}),l(f,{label:"结束日期",prop:"end_date"},{default:a(()=>[l(ee,{modelValue:i.value.end_date,"onUpdate:modelValue":e[10]||(e[10]=t=>i.value.end_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择结束日期"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(le,{modelValue:S.value,"onUpdate:modelValue":e[26]||(e[26]=t=>S.value=t),title:"添加货运险信息",width:"700px"},{footer:a(()=>[s("span",pa,[l(m,{onClick:e[25]||(e[25]=t=>S.value=!1)},{default:a(()=>e[54]||(e[54]=[n("取消")])),_:1,__:[54]}),l(m,{type:"primary",onClick:$e,loading:I.value},{default:a(()=>e[55]||(e[55]=[n("确定")])),_:1,__:[55]},8,["loading"])])]),default:a(()=>[l(ke,{ref_key:"cargoFormRef",ref:ie,model:u.value,rules:Le,"label-width":"120px"},{default:a(()=>[l(f,{label:"运输编号",prop:"track_no"},{default:a(()=>[l(T,{modelValue:u.value.track_no,"onUpdate:modelValue":e[13]||(e[13]=t=>u.value.track_no=t),placeholder:"请输入运输编号"},null,8,["modelValue"])]),_:1}),l(f,{label:"投保单号",prop:"insurance_no"},{default:a(()=>[l(T,{modelValue:u.value.insurance_no,"onUpdate:modelValue":e[14]||(e[14]=t=>u.value.insurance_no=t),placeholder:"请输入投保单号"},null,8,["modelValue"])]),_:1}),l(f,{label:"货物名称",prop:"name"},{default:a(()=>[l(T,{modelValue:u.value.name,"onUpdate:modelValue":e[15]||(e[15]=t=>u.value.name=t),placeholder:"请输入货物名称"},null,8,["modelValue"])]),_:1}),l(f,{label:"货物数量",prop:"quantity"},{default:a(()=>[l(T,{modelValue:u.value.quantity,"onUpdate:modelValue":e[16]||(e[16]=t=>u.value.quantity=t),placeholder:"请输入货物数量"},null,8,["modelValue"])]),_:1}),l(f,{label:"承运人",prop:"carrier"},{default:a(()=>[l(T,{modelValue:u.value.carrier,"onUpdate:modelValue":e[17]||(e[17]=t=>u.value.carrier=t),placeholder:"请输入承运人"},null,8,["modelValue"])]),_:1}),l(f,{label:"收货人",prop:"consignee"},{default:a(()=>[l(T,{modelValue:u.value.consignee,"onUpdate:modelValue":e[18]||(e[18]=t=>u.value.consignee=t),placeholder:"请输入收货人"},null,8,["modelValue"])]),_:1}),l(f,{label:"被保人",prop:"insured"},{default:a(()=>[s("div",ca,[l(we,{modelValue:u.value.insured,"onUpdate:modelValue":e[19]||(e[19]=t=>u.value.insured=t),placeholder:"请选择被保人",style:{width:"300px"},disabled:u.value.same_as_borrower},{default:a(()=>[(v(!0),b(P,null,j(R.value,t=>(v(),q(ye,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),l(Ve,{modelValue:u.value.same_as_borrower,"onUpdate:modelValue":e[20]||(e[20]=t=>u.value.same_as_borrower=t),onChange:e[21]||(e[21]=t=>fe("cargo")),class:"same-borrower-checkbox",style:{"margin-left":"10px"}},{default:a(()=>e[53]||(e[53]=[n(" 同借款人 ")])),_:1,__:[53]},8,["modelValue"])])]),_:1}),l(f,{label:"商业险",prop:"commercial_amount"},{default:a(()=>[l(Z,{modelValue:u.value.commercial_amount,"onUpdate:modelValue":e[22]||(e[22]=t=>u.value.commercial_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(f,{label:"开始日期",prop:"start_date"},{default:a(()=>[l(ee,{modelValue:u.value.start_date,"onUpdate:modelValue":e[23]||(e[23]=t=>u.value.start_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择开始日期"},null,8,["modelValue"])]),_:1}),l(f,{label:"结束日期",prop:"end_date"},{default:a(()=>[l(ee,{modelValue:u.value.end_date,"onUpdate:modelValue":e[24]||(e[24]=t=>u.value.end_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择结束日期"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(le,{modelValue:H.value,"onUpdate:modelValue":e[27]||(e[27]=t=>H.value=t),title:"批量导入投保信息",width:"600px"},{footer:a(()=>[s("span",Da,[l(m,{onClick:je},{default:a(()=>e[64]||(e[64]=[n("取消")])),_:1,__:[64]}),l(m,{type:"primary",onClick:Pe,loading:ae.value,disabled:!E.value},{default:a(()=>e[65]||(e[65]=[n(" 开始导入 ")])),_:1,__:[65]},8,["loading","disabled"])])]),default:a(()=>[s("div",va,[s("div",_a,[l(he,{title:"导入说明",type:"info","show-icon":"",closable:!1},{default:a(()=>e[56]||(e[56]=[s("div",{class:"tips-content"},[s("p",null,"1. 请先下载模板，按照模板格式填写数据"),s("p",null,"2. 支持 .xlsx 和 .xls 格式文件"),s("p",null,"3. 必填字段不能为空，金额字段请填写数字"),s("p",null,"4. 日期格式：YYYY-MM-DD，如：2024-01-01")],-1)])),_:1,__:[56]})]),l(xe,{ref_key:"excelUploadRef",ref:$,class:"upload-demo",drag:"","auto-upload":!1,limit:1,accept:".xlsx,.xls","on-change":Ne,"file-list":te.value},{tip:a(()=>e[57]||(e[57]=[s("div",{class:"el-upload__tip"}," 只能上传 .xlsx/.xls 文件，且不超过 10MB ",-1)])),default:a(()=>[l(c,{class:"el-icon--upload"},{default:a(()=>[l(Y(Te))]),_:1}),e[58]||(e[58]=s("div",{class:"el-upload__text"},[n(" 将Excel文件拖到此处，或"),s("em",null,"点击上传")],-1))]),_:1,__:[58]},8,["file-list"]),V.value?(v(),b("div",fa,[l(C,null,{header:a(()=>e[59]||(e[59]=[s("span",null,"导入结果",-1)])),default:a(()=>[s("div",ga,[l(L,{gutter:20},{default:a(()=>[l(g,{span:8},{default:a(()=>[s("div",ba,[s("div",ya,d(V.value.total),1),e[60]||(e[60]=s("div",{class:"stat-label"},"总数",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[s("div",wa,[s("div",Va,d(V.value.success),1),e[61]||(e[61]=s("div",{class:"stat-label"},"成功",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[s("div",ka,[s("div",ha,d(V.value.fail),1),e[62]||(e[62]=s("div",{class:"stat-label"},"失败",-1))])]),_:1})]),_:1})]),V.value.errors&&V.value.errors.length>0?(v(),b("div",xa,[l(de,{"content-position":"left"},{default:a(()=>e[63]||(e[63]=[n("错误详情")])),_:1,__:[63]}),(v(!0),b(P,null,j(V.value.errors,(t,k)=>(v(),b("div",{class:"error-item",key:k},[l(N,{type:"danger",size:"small"},{default:a(()=>[n(d(t),1)]),_:2},1024)]))),128))])):U("",!0)]),_:1})])):U("",!0)])]),_:1},8,["modelValue"]),l(le,{modelValue:A.value,"onUpdate:modelValue":e[28]||(e[28]=t=>A.value=t),title:"批量上传行驶证",width:"700px"},{footer:a(()=>[s("span",Ja,[l(m,{onClick:We},{default:a(()=>e[75]||(e[75]=[n("取消")])),_:1,__:[75]}),l(m,{type:"primary",onClick:Ke,loading:oe.value,disabled:M.value.length===0},{default:a(()=>e[76]||(e[76]=[n(" 开始上传识别 ")])),_:1,__:[76]},8,["loading","disabled"])])]),default:a(()=>[s("div",Ca,[s("div",Ua,[l(he,{title:"上传说明",type:"info","show-icon":"",closable:!1},{default:a(()=>e[66]||(e[66]=[s("div",{class:"tips-content"},[s("p",null,"1. 支持批量上传多张行驶证图片"),s("p",null,"2. 支持 JPG、PNG、BMP、TIFF、WEBP 格式"),s("p",null,"3. 每张图片不超过5MB"),s("p",null,"4. 系统将自动OCR识别行驶证信息并匹配车险记录"),s("p",null,"5. 请确保先录入车险信息再上传对应的行驶证")],-1)])),_:1,__:[66]})]),l(xe,{ref_key:"driverLicenseUploadRef",ref:se,class:"upload-demo",drag:"",multiple:"","auto-upload":!1,limit:0,accept:"image/*","on-change":He,"on-remove":Je,"file-list":ne.value},{tip:a(()=>e[67]||(e[67]=[s("div",{class:"el-upload__tip"}," 支持多张图片同时上传，每张不超过5MB ",-1)])),default:a(()=>[l(c,{class:"el-icon--upload"},{default:a(()=>[l(Y(Te))]),_:1}),e[68]||(e[68]=s("div",{class:"el-upload__text"},[n(" 将行驶证图片拖到此处，或"),s("em",null,"点击上传")],-1))]),_:1,__:[68]},8,["file-list"]),w.value?(v(),b("div",Ta,[l(C,null,{header:a(()=>e[69]||(e[69]=[s("span",null,"上传结果",-1)])),default:a(()=>[s("div",Ya,[l(L,{gutter:20},{default:a(()=>[l(g,{span:8},{default:a(()=>{var t;return[s("div",Ea,[s("div",Ma,d(((t=w.value.results)==null?void 0:t.length)||0),1),e[70]||(e[70]=s("div",{class:"stat-label"},"总数",-1))])]}),_:1}),l(g,{span:8},{default:a(()=>[s("div",Fa,[s("div",La,d(w.value.success_count||0),1),e[71]||(e[71]=s("div",{class:"stat-label"},"成功",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[s("div",Ra,[s("div",qa,d(w.value.fail_count||0),1),e[72]||(e[72]=s("div",{class:"stat-label"},"失败",-1))])]),_:1})]),_:1})]),w.value.results?(v(),b("div",Ia,[l(de,{"content-position":"left"},{default:a(()=>e[73]||(e[73]=[n("处理详情")])),_:1,__:[73]}),s("div",Ba,[(v(!0),b(P,null,j(w.value.results,(t,k)=>(v(),b("div",{key:k,class:_l(["result-item",t.status])},[s("div",$a,[s("span",Aa,d(t.file_name),1),l(N,{type:Xe(t.status),size:"small"},{default:a(()=>[n(d(Qe(t.status)),1)]),_:2},1032,["type"])]),t.status==="success"?(v(),b("div",za,[s("div",Oa,[s("span",Sa,"车牌号："+d(t.plate_no||"-"),1),s("span",Na,"车架号："+d(t.vin||"-"),1),s("span",Pa,"所有人："+d(t.owner||"-"),1)])])):(v(),b("div",ja,[s("span",Ga,d(t.error_message),1)]))],2))),128))])])):U("",!0),w.value.errors&&w.value.errors.length>0?(v(),b("div",Ha,[l(de,{"content-position":"left"},{default:a(()=>e[74]||(e[74]=[n("错误汇总")])),_:1,__:[74]}),(v(!0),b(P,null,j(w.value.errors,(t,k)=>(v(),b("div",{class:"error-item",key:k},[l(N,{type:"danger",size:"small"},{default:a(()=>[n(d(t),1)]),_:2},1024)]))),128))])):U("",!0)]),_:1})])):U("",!0)])]),_:1},8,["modelValue"]),l(Ol,{visible:re.value,"onUpdate:visible":e[29]||(e[29]=t=>re.value=t),title:J.value,"order-id":Y(h).params.id,"ref-id":B.value,type:z.value,onSuccess:F},null,8,["visible","title","order-id","ref-id","type"]),l(Sl,{visible:W.value,"onUpdate:visible":e[30]||(e[30]=t=>W.value=t),title:J.value,attachments:K.value,"order-id":Y(h).params.id,"ref-id":B.value,type:z.value,onRefresh:Ae,onDelete:ze,"allow-delete":!0},null,8,["visible","title","attachments","order-id","ref-id","type"])])}}},ft=ll(Wa,[["__scopeId","data-v-1d018fa2"]]);export{ft as default};
