import{_ as ba,b as ha,u as wa,a as ka}from"./index-b0a522d4.js";/* empty css                   *//* empty css                       *//* empty css                     *//* empty css               *//* empty css                  *//* empty css                        *//* empty css                        *//* empty css                    *//* empty css               *//* empty css                *//* empty css                             *//* empty css                   *//* empty css                       */import{f as N,a as f}from"./format-20468769.js";import{a as Ca,r as Va,b as $a,m as Ma,d as xa,f as Aa}from"./order-213b5f9e.js";import{A as F,u as Ua}from"./AttachmentList-513c4f6e.js";import{m as Sa}from"./receivable-41e5ac3c.js";import{c as Ea}from"./received-e7c92e9b.js";import{r as b,ae as Pa,l as g,B as $,C as m,F as a,G as l,p as M,S as V,E as h,aE as Da,ag as Ra,ah as Na,M as Ta,u as _,O as o,af as Ie,D as u,aF as Ia,J as O,K as Ba,az as za,am as Ya,aA as Fa,ao as Oa,al as qa,an as Ha,a5 as La,a6 as Ga,aG as Ja,ax as Ka,ay as Qa,aH as ja,a7 as Wa,ai as Xa}from"./element-plus-e9590f8a.js";import{A as K}from"./AttachmentUpload-55b03148.js";import{L as Za}from"./LogList-1598f3ab.js";/* empty css                 *//* empty css                    *//* empty css                      *//* empty css                         */import"./log-4688b338.js";const et={class:"order-detail"},at={class:"page-header"},tt={class:"header-actions"},lt={class:"overview-section"},nt={class:"key-metrics"},rt={class:"metric-item"},st={class:"metric-value"},ot={class:"metric-item"},ut={class:"metric-value"},it={class:"metric-item"},dt={class:"metric-value"},ct={class:"metric-item"},mt={class:"metric-value"},pt={class:"metric-item"},_t={class:"metric-value"},vt={key:0,class:"empty-state"},ft={key:0,class:"empty-state"},yt={style:{color:"#67c23a","font-weight":"bold"}},gt={style:{color:"#e6a23c","font-weight":"bold"}},bt={style:{color:"#409eff"}},ht={style:{color:"#67c23a"}},wt={key:0,style:{color:"#67c23a","font-weight":"bold"}},kt={key:1},Ct={key:0,style:{color:"#f56c6c"}},Vt={key:1},$t={key:0,style:{color:"#f56c6c"}},Mt={key:1},xt={key:0,style:{color:"#f56c6c","font-weight":"bold"}},At={key:1},Ut={key:1,style:{color:"#67c23a"}},St={class:"payment-info"},Et={key:1,class:"payment-section"},Pt={class:"payment-section"},Dt={key:2,class:"payment-section"},Rt={class:"remark-content"},Nt={class:"dialog-footer"},Tt={class:"dialog-footer"},It={class:"dialog-footer"},Bt={__name:"detail",setup(zt){const _e=ha(),ve=wa(),U=b(!1),n=b({}),R=ka(),B=b(!1),Q=b(null),j=b(!1),w=b({rec_type:"",amount:0,method:"",date_time:"",remark:""}),z=b(!1),W=b(null),X=b(!1),q=b(null),S=b({actual_amount:0,method:"",actual_date:""}),H=b(!1),Z=b(!1),c=b({}),ee=b(!1),ae=b(!1),te=b(!1),le=b(!1),ne=b(!1),re=b(!1),se=b(!1),oe=b(!1),A=b(null),T=b(null),ue=b(!1),ie=b(null),Be={rec_type:[{required:!0,message:"请选择收款类型",trigger:"change"}],amount:[{required:!0,message:"请输入还款金额",trigger:"blur"},{type:"number",min:.01,message:"金额必须大于0",trigger:"blur"}],method:[{required:!0,message:"请选择还款方式",trigger:"change"}],date_time:[{required:!0,message:"请选择还款时间",trigger:"change"}]},ze={actual_amount:[{required:!0,message:"请输入实际收款金额",trigger:"blur"},{type:"number",min:.01,message:"金额必须大于0",trigger:"blur"}],method:[{required:!0,message:"请选择收款方式",trigger:"change"}],actual_date:[{required:!0,message:"请选择收款日期",trigger:"change"}]},D=async()=>{U.value=!0;try{const r=await Ca(_e.params.id);n.value=r.data,n.value.total_commercial=0,n.value.insurance_type==="车险"&&n.value.car_insurance&&n.value.car_insurance.length>0?n.value.total_commercial=n.value.car_insurance.reduce((e,s)=>e+(s.commercial_amount||0),0):n.value.insurance_type==="货运险"&&n.value.cargo_insurance&&n.value.cargo_insurance.length>0&&(n.value.total_commercial=n.value.cargo_insurance.reduce((e,s)=>e+(s.commercial_amount||0),0))}catch{h.error("获取订单详情失败")}U.value=!1},Ye=()=>{ve.back()},L=async()=>{try{let r="",e="下一状态";n.value.status==="待初审"?(r="初审通过",e="待复审"):n.value.status==="待复审"&&(r="复审通过",e="待客户签约"),await O.confirm(`确定要将订单状态从 [${n.value.status}] 更新为 [${e}] 吗？`,"审核确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),U.value=!0,await Va(n.value.id,{audit_note:r}),h.success("审核成功"),D()}catch(r){r!=="cancel"&&h.error("审核失败")}U.value=!1},Fe=r=>{const{columns:e,data:s}=r,p=[];return e.forEach((i,v)=>{if(v===0){p[v]="合计";return}if(i.property==="total_amount"){const y=s.reduce((C,x)=>C+(x.commercial_amount||0)+(x.compulsory_amount||0)+(x.vehicle_tax_amount||0),0);p[v]=f(y);return}const k=s.map(y=>Number(y[i.property]));if(k.every(y=>isNaN(y)))p[v]="-";else{const y=k.reduce((C,x)=>{const d=Number(x);return isNaN(d)?C:C+d},0);i.property==="commercial_amount"||i.property==="compulsory_amount"||i.property==="vehicle_tax_amount"?p[v]=f(y):p[v]="-"}}),p},Oe=r=>{const{columns:e,data:s}=r,p=[];return e.forEach((i,v)=>{if(v===0){p[v]="合计";return}const k=s.map(y=>Number(y[i.property]));if(k.every(y=>isNaN(y)))p[v]="-";else{const y=k.reduce((C,x)=>{const d=Number(x);return isNaN(d)?C:C+d},0);i.property==="commercial_amount"?p[v]=f(y):p[v]="-"}}),p},fe=r=>({正常:"success",结清退保:"success",逾期退保:"danger",提前结清:"success",逾期结清:"danger",退保结清:"danger"})[r]||"info",qe=r=>({待审核:"warning",待复审:"warning",待客户签约:"info",待资方签约:"info",待放款:"warning",已放款:"success",已退保:"danger",已结清:"success",已作废:"danger"})[r]||"info",de=()=>{ve.push(`/order/insurance/${n.value.id}`)},He=(r,e)=>{if(!n.value.attachments||n.value.attachments.length===0){h.warning("暂无附件可查看");return}const s=r.find(p=>p.remark===e);if(!s){h.warning("暂无附件可查看");return}window.open(`/api/admin/attachments/${s.id}/view`)},Le=()=>{ce(n.value.attachments,"缴费通知书")?He(n.value.attachments,"缴费通知书"):Ge("缴费通知书")},Ge=r=>{const e=document.createElement("input");e.type="file",e.accept="*/*",e.style.display="none",e.onchange=async s=>{const p=s.target.files[0];if(p){try{const i=new FormData;i.append("files",p),i.append("remarks",r),await Ua(n.value.id,0,i),h.success("上传成功"),D()}catch(i){console.error("上传失败:",i),h.error("上传失败")}document.body.removeChild(e)}},document.body.appendChild(e),e.click()},Je=()=>{ee.value=!0},Ke=()=>{ae.value=!0},G=()=>{h.success("附件上传成功"),D()},Qe=r=>{A.value=r,te.value=!0},je=r=>{A.value=r,le.value=!0},We=r=>{A.value=r,ne.value=!0},Xe=r=>{A.value=r,re.value=!0},Ze=async()=>{try{await O.confirm("确定要作废该订单吗？作废后不可恢复！","作废确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),U.value=!0,await $a(n.value.id),h.success("订单已作废"),D()}catch(r){r!=="cancel"&&h.error("作废失败")}U.value=!1},ea=r=>{if(!r){h.warning("签署链接不存在");return}ye(r,"签署链接")},ye=(r,e)=>{const s=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);navigator.clipboard&&(window.isSecureContext||s)?navigator.clipboard.writeText(r).then(()=>{h.success(`${e}已复制到剪贴板`)}).catch(p=>{console.error("使用 Clipboard API 复制失败:",p),ge(r,e)}):ge(r,e)},ge=(r,e)=>{try{const s=document.createElement("textarea");s.value=r,s.style.position="fixed",s.style.left="-999999px",s.style.top="-999999px",document.body.appendChild(s),s.focus(),s.select();const p=document.execCommand("copy");if(document.body.removeChild(s),p)h.success(`${e}已复制到剪贴板`);else throw new Error("execCommand 复制失败")}catch(s){console.error("复制失败:",s),O.alert(r,`请手动复制${e}`,{confirmButtonText:"确定",type:"info",customClass:"copy-url-dialog"})}},aa=r=>({已签署:"success",未签署:"warning",已作废:"danger"})[r]||"info",ta=r=>({已签署:"success",未签署:"warning",已作废:"danger",签署失败:"danger",信托签署中:"warning"})[r]||"info",la=r=>({还款:"success",本金:"primary",利息:"info",退保:"danger",违约金:"warning",滞纳金:"warning"})[r]||"info",na=r=>({微信:"success",支付宝:"primary",银行卡:"warning"})[r]||"info",ra=r=>({待收款:"warning",已收款:"success",已逾期:"danger"})[r]||"info",sa=()=>{w.value={rec_type:"",amount:0,method:"",date_time:new Date().toISOString().slice(0,19).replace("T"," "),remark:""},B.value=!0},oa=async()=>{Q.value&&await Q.value.validate(async r=>{if(r){j.value=!0;try{const e={rec_type:w.value.rec_type,user_id:n.value.user_id,order_id:n.value.id,order_no:n.value.order_no,amount:w.value.amount,method:w.value.method,date_time:w.value.date_time,remark:w.value.remark||w.value.rec_type};await Ea(e),h.success("提前还款记录创建成功"),B.value=!1,D()}catch(e){h.error("创建提前还款记录失败："+(e.message||"未知错误"))}j.value=!1}})},ua=r=>{q.value=r,S.value={actual_amount:r.amount,method:"微信",actual_date:new Date().toISOString().split("T")[0]},z.value=!0},ia=async()=>{W.value&&await W.value.validate(async r=>{if(r){X.value=!0;try{await Sa(q.value.id,{actual_amount:S.value.actual_amount,actual_date:S.value.actual_date,method:S.value.method}),h.success("标记收款成功"),z.value=!1,D()}catch(e){h.error("标记收款失败："+(e.message||"未知错误"))}X.value=!1}})},da=r=>{T.value=r,se.value=!0},ca=r=>{T.value=r,oe.value=!0},ma=async r=>{try{await O.confirm("确定要手动触发资方签署吗？这将调用信托签署接口。","资方签署确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),U.value=!0,await Ma(n.value.id,r.id),h.success("资方签署已触发，请查看订单日志了解进度"),await D()}catch(e){e!=="cancel"&&(console.error("手动资方签署失败:",e),h.error("资方签署失败："+(e.message||"未知错误")))}finally{U.value=!1}},pa=r=>{ie.value=r,ue.value=!0},_a=async()=>{if(!n.value.id){h.warning("订单信息不存在");return}Z.value=!0;try{const r=await xa(n.value.id);c.value=r.data,H.value=!0,h.success("前置款信息生成成功")}catch(r){h.error("生成前置款信息失败："+(r.message||"未知错误"))}Z.value=!1},va=()=>{if(!c.value.batch_no){h.warning("暂无前置款信息可复制");return}let r="";c.value.is_recv_srv_fee=="是"?r=`
批次号：${c.value.batch_no}
借款人：${c.value.borrower}
${c.value.vehicle_info}
总保费：${f(c.value.total_premium)}

支付首付款：${f(c.value.total_down_payment)}
${c.value.down_payment_detail}
户名：${c.value.funder_account_name}
账户：${c.value.funder_account_no}
开户行：${c.value.funder_bank_name}

${c.value.remark||""}
  `.trim():r=`
批次号：${c.value.batch_no}
借款人：${c.value.borrower}
${c.value.vehicle_info}
总保费：${f(c.value.total_premium)}

支付服务费：${f(c.value.service_fee)}
户名：${c.value.service_account_name}
账户：${c.value.service_account_no}
开户行：${c.value.service_bank_name}

支付首付款：${f(c.value.total_down_payment)}
${c.value.down_payment_detail}
户名：${c.value.funder_account_name}
账户：${c.value.funder_account_no}
开户行：${c.value.funder_bank_name}

${c.value.remark||""}
  `.trim(),ye(r,"前置款信息")},fa=async()=>{var r;try{const e=((r=n.value.receiveds)==null?void 0:r.filter(i=>i.rec_type==="本金").reduce((i,v)=>i+(v.amount||0),0))||0,s=n.value.loan_amount-e;if(s<=0){h.warning("该订单本金已全部还清，无需重新生成还款计划");return}await O.confirm(`确定要重新生成还款计划吗？
      
当前贷款金额：${f(n.value.loan_amount)}
已还本金总额：${f(e)}
剩余本金：${f(s)}

操作将会：
1. 作废当前所有未收款的还款计划
2. 基于剩余本金重新生成新的还款计划
3. 保留已收款的还款记录不变

此操作不可逆，请谨慎操作！`,"重新生成还款计划确认",{type:"warning",confirmButtonText:"确定重新生成",cancelButtonText:"取消",dangerouslyUseHTMLString:!0}),U.value=!0;const p=await Aa(n.value.id);h.success(`重新生成还款计划成功！
剩余本金：${f(p.data.remaining_principal)}
新生成期数：${p.data.new_periods}期
起始期数：第${p.data.start_period}期`),await D()}catch(e){e!=="cancel"&&(console.error("重新生成还款计划失败:",e),h.error("重新生成还款计划失败："+(e.message||"未知错误")))}U.value=!1},ya=r=>{const{columns:e,data:s}=r,p=[];return e.forEach((i,v)=>{if(v===0){p[v]="合计";return}const k=s.map(y=>Number(y[i.property]));if(k.every(y=>isNaN(y)))p[v]="-";else{const y=k.reduce((C,x)=>{const d=Number(x);return isNaN(d)?C:C+d},0);i.property==="amount"||i.property==="principal_amount"||i.property==="interest_amount"||i.property==="penalty_amount"||i.property==="forfeit_amount"||i.property==="actual_amount"?p[v]=f(y):p[v]="-"}}),p},ga=r=>{const{columns:e,data:s}=r,p=[];return e.forEach((i,v)=>{if(v===0){p[v]="合计";return}const k=s.map(y=>Number(y[i.property]));if(k.every(y=>isNaN(y)))p[v]="-";else{const y=k.reduce((C,x)=>{const d=Number(x);return isNaN(d)?C:C+d},0);i.property==="amount"?p[v]=f(y):p[v]="-"}}),p},ce=(r,e)=>!r||r.length===0?!1:r.some(s=>s.remark===e);return Pa(()=>{D()}),(r,e)=>{var Ce,Ve,$e,Me,xe,Ae,Ue,Se,Ee,Pe,De,Re,Ne,Te;const s=Ba,p=Da,i=za,v=Ya,k=Fa,y=Ra,C=Oa,x=Na,d=qa,Y=Ha,me=Ta,J=La,E=Ga,be=Ja,P=Ka,pe=Qa,he=ja,we=Wa,ke=Xa;return g(),$("div",et,[m("div",at,[a(p,{onBack:Ye,title:n.value.order_no||"订单详情"},{extra:l(()=>[m("div",tt,[n.value.status==="待初审"&&_(R).riskBasicPrivate?(g(),M(s,{key:0,type:"success",onClick:L},{default:l(()=>e[25]||(e[25]=[o("初审通过")])),_:1,__:[25]})):V("",!0),n.value.status==="待复审"&&_(R).riskManagerPrivate?(g(),M(s,{key:1,type:"warning",onClick:L},{default:l(()=>e[26]||(e[26]=[o("复审通过")])),_:1,__:[26]})):V("",!0),n.value.status==="待放款"&&_(R).operationManagerPrivate?(g(),M(s,{key:2,type:"info",onClick:L},{default:l(()=>e[27]||(e[27]=[o("放款")])),_:1,__:[27]})):V("",!0),n.value.status==="已放款"&&_(R).operationManagerPrivate?(g(),M(s,{key:3,type:"warning",onClick:fa},{default:l(()=>e[28]||(e[28]=[o("重新生成还款计划")])),_:1,__:[28]})):V("",!0),n.value.status==="已放款"&&_(R).operationManagerPrivate?(g(),M(s,{key:4,type:"success",onClick:sa},{default:l(()=>e[29]||(e[29]=[o("提前还款")])),_:1,__:[29]})):V("",!0),n.value.status!=="已作废"&&(_(R).operationManagerPrivate||_(R).riskManagerPrivate)?(g(),M(s,{key:5,type:"danger",onClick:Ze},{default:l(()=>e[30]||(e[30]=[o("作废订单")])),_:1,__:[30]})):V("",!0),_(R).superPrivate?(g(),M(s,{key:6,type:"primary",onClick:L},{default:l(()=>e[31]||(e[31]=[o("下一状态（调试用）")])),_:1,__:[31]})):V("",!0),a(s,{type:"default",onClick:de},{default:l(()=>e[32]||(e[32]=[o("管理投保单")])),_:1,__:[32]}),a(s,{type:"default",onClick:_a},{default:l(()=>e[33]||(e[33]=[o("生成前置款")])),_:1,__:[33]}),a(s,{type:"default",onClick:e[0]||(e[0]=t=>Je())},{default:l(()=>e[34]||(e[34]=[o("查看附件")])),_:1,__:[34]}),a(s,{type:"default",onClick:e[1]||(e[1]=t=>Ke())},{default:l(()=>e[35]||(e[35]=[o("上传附件")])),_:1,__:[35]})])]),_:1},8,["title"])]),m("div",lt,[a(x,{gutter:20},{default:l(()=>[a(C,{span:18},{default:l(()=>[Ie((g(),M(y,{class:"info-card"},{default:l(()=>[a(k,{column:2,border:""},{default:l(()=>[a(i,{label:"订单编号"},{default:l(()=>[o(u(n.value.order_no),1)]),_:1}),a(i,{label:"订单状态"},{default:l(()=>[a(v,{type:qe(n.value.status)},{default:l(()=>[o(u(n.value.status),1)]),_:1},8,["type"]),e[36]||(e[36]=m("span",{style:{"margin-left":"10px"}},null,-1)),a(v,{style:{cursor:"pointer"},onClick:Le,type:ce(n.value.attachments,"缴费通知书")?"success":"info"},{default:l(()=>[o(u(ce(n.value.attachments,"缴费通知书")?"缴费通知书已上传":"缴费通知书未上传"),1)]),_:1},8,["type"])]),_:1,__:[36]}),a(i,{label:"保险类型"},{default:l(()=>[o(u(n.value.insurance_type),1)]),_:1}),a(i,{label:"借款主体"},{default:l(()=>{var t;return[o(u(n.value.loan_name||((t=n.value.user)==null?void 0:t.company_name)),1)]}),_:1}),a(i,{label:"业务归属"},{default:l(()=>{var t;return[o(u(n.value.sell_mode==="直销"?"直销":((t=n.value.agent)==null?void 0:t.company_name)||"无"),1)]}),_:1}),a(i,{label:"销售员"},{default:l(()=>[o(u(n.value.seller),1)]),_:1}),a(i,{label:"服务费"},{default:l(()=>[o(u(n.value.service_fee)+"%",1)]),_:1}),a(i,{label:"渠道成本"},{default:l(()=>[o(u(n.value.agent_cost)+"%",1)]),_:1}),a(i,{span:2,label:"金融产品"},{default:l(()=>{var t;return[o(u((t=n.value.product)==null?void 0:t.name),1)]}),_:1}),a(i,{label:"承保机构",span:2},{default:l(()=>{var t;return[o(u((t=n.value.insurer)==null?void 0:t.name),1)]}),_:1})]),_:1}),a(k,{column:2,border:""},{default:l(()=>[a(i,{label:"进件时间"},{default:l(()=>[o(u(_(N)(n.value.created_at)),1)]),_:1}),a(i,{label:"初审时间"},{default:l(()=>[o(u(_(N)(n.value.first_review_time)||"-"),1)]),_:1}),a(i,{label:"复审时间"},{default:l(()=>[o(u(_(N)(n.value.second_review_time)||"-"),1)]),_:1}),a(i,{label:"用户签约时间"},{default:l(()=>[o(u(_(N)(n.value.user_sign_time)||"-"),1)]),_:1}),a(i,{label:"资方签约时间"},{default:l(()=>[o(u(_(N)(n.value.funder_sign_time)||"-"),1)]),_:1}),a(i,{label:"放款时间"},{default:l(()=>[o(u(_(N)(n.value.loan_time)||"-"),1)]),_:1}),a(i,{label:"最后更新时间"},{default:l(()=>[o(u(_(N)(n.value.updated_at)),1)]),_:1})]),_:1})]),_:1})),[[ke,U.value]])]),_:1}),a(C,{span:6},{default:l(()=>[a(y,{class:"key-metrics-card"},{default:l(()=>[m("div",nt,[m("div",rt,[e[37]||(e[37]=m("div",{class:"metric-label"},"总保费",-1)),m("div",st,u(_(f)(n.value.total_premium)),1)]),m("div",ot,[e[38]||(e[38]=m("div",{class:"metric-label"},"商业险",-1)),m("div",ut,u(_(f)(n.value.total_commercial)),1)]),m("div",it,[e[39]||(e[39]=m("div",{class:"metric-label"},"首付金额",-1)),m("div",dt,u(_(f)(n.value.down_payment)),1)]),m("div",ct,[e[40]||(e[40]=m("div",{class:"metric-label"},"贷款金额",-1)),m("div",mt,u(_(f)(n.value.loan_amount)),1)]),m("div",pt,[e[41]||(e[41]=m("div",{class:"metric-label"},"服务费",-1)),m("div",_t,u(_(f)(n.value.service_fee*n.value.total_commercial/100)),1)])])]),_:1})]),_:1})]),_:1})]),n.value.insurance_type==="车险"?(g(),M(y,{key:0,class:"detail-card insurance-card"},{default:l(()=>[a(Y,{data:n.value.car_insurance||[],border:"",style:{width:"100%"},"empty-text":"暂无车险投保信息","max-height":"500","show-summary":n.value.car_insurance&&n.value.car_insurance.length>0,"sum-text":"合计","summary-method":Fe},{default:l(()=>[a(d,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(({row:t})=>[a(v,{type:fe(t.status)},{default:l(()=>[o(u(t.status),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"car_no",label:"车牌号",width:"120",align:"left"}),a(d,{prop:"vin",label:"车架号",width:"180",align:"left"}),a(d,{prop:"insured",label:"被保人",width:"230",align:"left"}),a(d,{prop:"commercial_amount",label:"商业险",width:"110",align:"right"},{default:l(({row:t})=>[o(u(_(f)(t.commercial_amount)),1)]),_:1}),a(d,{prop:"compulsory_amount",label:"交强险",width:"110",align:"center"},{default:l(({row:t})=>[o(u(_(f)(t.compulsory_amount)),1)]),_:1}),a(d,{prop:"vehicle_tax_amount",label:"车船税",width:"110",align:"center"},{default:l(({row:t})=>[o(u(_(f)(t.vehicle_tax_amount)),1)]),_:1}),a(d,{prop:"total_amount",label:"总保费",width:"110",align:"center"},{default:l(({row:t})=>[o(u(_(f)((t.commercial_amount||0)+(t.compulsory_amount||0)+(t.vehicle_tax_amount||0))),1)]),_:1}),a(d,{label:"操作",width:"200",align:"center",fixed:"right"},{default:l(({row:t})=>[a(s,{type:"info",size:"small",onClick:I=>Qe(t)},{default:l(()=>e[42]||(e[42]=[o(" 查看附件 ")])),_:2,__:[42]},1032,["onClick"]),a(s,{type:"primary",size:"small",onClick:I=>je(t)},{default:l(()=>e[43]||(e[43]=[o(" 上传附件 ")])),_:2,__:[43]},1032,["onClick"])]),_:1})]),_:1},8,["data","show-summary"]),!n.value.car_insurance||n.value.car_insurance.length===0?(g(),$("div",vt,[a(s,{type:"primary",onClick:de},{default:l(()=>e[44]||(e[44]=[o("录入车险信息")])),_:1,__:[44]})])):V("",!0)]),_:1})):V("",!0),n.value.insurance_type==="货运险"?(g(),M(y,{key:1,class:"detail-card insurance-card"},{default:l(()=>[a(Y,{data:n.value.cargo_insurance||[],border:"",style:{width:"100%"},"empty-text":"暂无货运险投保信息","max-height":"500","show-summary":n.value.cargo_insurance&&n.value.cargo_insurance.length>0,"sum-text":"合计","summary-method":Oe},{default:l(()=>[a(d,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(({row:t})=>[a(v,{type:fe(t.status)},{default:l(()=>[o(u(t.status),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"track_no",label:"运输编号",width:"200",align:"left"}),a(d,{prop:"insured",label:"被保人",width:"170",align:"left"}),a(d,{prop:"name",label:"货物名称",width:"150",align:"left"}),a(d,{prop:"quantity",label:"货物数量",width:"120",align:"right"}),a(d,{prop:"carrier",label:"承运人",width:"130",align:"left"}),a(d,{prop:"consignee",label:"收货人",width:"130",align:"left"}),a(d,{prop:"commercial_amount",label:"保费",width:"140",align:"center"},{default:l(({row:t})=>[o(u(_(f)(t.commercial_amount)),1)]),_:1}),a(d,{label:"操作",width:"200",align:"center",fixed:"right"},{default:l(({row:t})=>[a(s,{type:"info",size:"small",onClick:I=>We(t)},{default:l(()=>e[45]||(e[45]=[o(" 查看附件 ")])),_:2,__:[45]},1032,["onClick"]),a(s,{type:"primary",size:"small",onClick:I=>Xe(t)},{default:l(()=>e[46]||(e[46]=[o(" 上传附件 ")])),_:2,__:[46]},1032,["onClick"])]),_:1})]),_:1},8,["data","show-summary"]),!n.value.cargo_insurance||n.value.cargo_insurance.length===0?(g(),$("div",ft,[a(s,{type:"primary",onClick:de},{default:l(()=>e[47]||(e[47]=[o("录入货运险信息")])),_:1,__:[47]})])):V("",!0)]),_:1})):V("",!0),a(y,{class:"detail-card"},{default:l(()=>[a(Y,{data:n.value.contacts||[],border:"",style:{width:"100%"},"empty-text":"暂无合同信息","max-height":"350"},{default:l(()=>[a(d,{prop:"title",label:"合同标题","min-width":"150"}),a(d,{prop:"user_contact_id",label:"法大大合同ID",width:"180"}),a(d,{prop:"user_sign_status",label:"用户签署状态",width:"120",align:"center"},{default:l(({row:t})=>[a(v,{type:aa(t.user_sign_status)},{default:l(()=>[o(u(t.user_sign_status||"未签署"),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"user_sign_time",label:"用户签署时间",width:"150",align:"center"},{default:l(({row:t})=>[o(u(t.user_sign_time||"-"),1)]),_:1}),a(d,{prop:"funder_sign_status",label:"资方签署状态",width:"120",align:"center"},{default:l(({row:t})=>[a(v,{type:ta(t.funder_sign_status)},{default:l(()=>[o(u(t.funder_sign_status||"未签署"),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"funder_sign_time",label:"资方签署时间",width:"170",align:"center"},{default:l(({row:t})=>[o(u(t.funder_sign_time||"-"),1)]),_:1}),a(d,{label:"操作",width:"200",align:"center",fixed:"right"},{default:l(({row:t})=>[t.user_sign_status!=="已签署"?(g(),M(s,{key:0,type:"primary",size:"small",icon:_(Ia),onClick:()=>ea(t.user_sign_url),disabled:!t.user_sign_url},{default:l(()=>e[48]||(e[48]=[o(" 用户签署 ")])),_:2,__:[48]},1032,["icon","onClick","disabled"])):V("",!0),t.user_sign_status==="已签署"&&t.funder_sign_status!=="已签署"?(g(),M(s,{key:1,type:"warning",size:"small",onClick:()=>ma(t)},{default:l(()=>e[49]||(e[49]=[o(" 资方签署 ")])),_:2,__:[49]},1032,["onClick"])):V("",!0),a(s,{type:"info",size:"small",onClick:()=>pa(t)},{default:l(()=>e[50]||(e[50]=[o(" 查看附件 ")])),_:2,__:[50]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),a(y,{class:"detail-card"},{default:l(()=>[a(Y,{data:n.value.receiveds||[],border:"",style:{width:"100%"},"empty-text":"暂无收款记录","max-height":"500","show-summary":n.value.receiveds&&n.value.receiveds.length>0,"sum-text":"合计","summary-method":ga},{default:l(()=>[a(d,{prop:"trans_no",label:"收款流水号",width:"200"}),a(d,{prop:"rec_type",label:"收款类型",width:"80",align:"center"},{default:l(({row:t})=>[a(v,{type:la(t.rec_type)},{default:l(()=>[o(u(t.rec_type),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"amount",label:"收款金额",width:"100",align:"center"},{default:l(({row:t})=>[m("span",yt,u(_(f)(t.amount)),1)]),_:1}),a(d,{prop:"method",label:"收款方式",width:"80",align:"center"},{default:l(({row:t})=>[a(v,{type:na(t.method),size:"small"},{default:l(()=>[o(u(t.method),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"date_time",label:"收款时间",width:"150",align:"center"}),a(d,{prop:"created_at",label:"录入时间",width:"150",align:"center"},{default:l(({row:t})=>[o(u(_(N)(t.created_at)),1)]),_:1}),a(d,{prop:"remark",label:"备注","min-width":"80"},{default:l(({row:t})=>[o(u(t.remark||"-"),1)]),_:1}),a(d,{label:"操作",width:"200",align:"center",fixed:"right"},{default:l(({row:t})=>[a(s,{type:"info",size:"small",onClick:I=>da(t)},{default:l(()=>e[51]||(e[51]=[o(" 查看附件 ")])),_:2,__:[51]},1032,["onClick"]),a(s,{type:"primary",size:"small",onClick:I=>ca(t)},{default:l(()=>e[52]||(e[52]=[o(" 上传附件 ")])),_:2,__:[52]},1032,["onClick"])]),_:1})]),_:1},8,["data","show-summary"])]),_:1}),a(y,{class:"detail-card"},{default:l(()=>[a(Y,{data:n.value.receivables||[],border:"",style:{width:"100%"},"empty-text":"暂无还款计划","show-summary":n.value.receivables&&n.value.receivables.length>0,"sum-text":"合计","summary-method":ya},{default:l(()=>[a(d,{prop:"period",label:"期数",width:"80",align:"center"}),a(d,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(({row:t})=>[a(v,{type:ra(t.status)},{default:l(()=>[o(u(t.status),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"date",label:"应还日期",width:"120",align:"center"}),a(d,{prop:"amount",label:"应还金额",width:"120",align:"right"},{default:l(({row:t})=>[m("span",gt,u(_(f)(t.amount)),1)]),_:1}),a(d,{prop:"principal_amount",label:"本金",width:"120",align:"right"},{default:l(({row:t})=>[m("span",bt,u(_(f)(t.principal_amount)),1)]),_:1}),a(d,{prop:"interest_amount",label:"利息",width:"120",align:"right"},{default:l(({row:t})=>[m("span",ht,u(_(f)(t.interest_amount)),1)]),_:1}),a(d,{prop:"actual_amount",label:"实际收款",width:"120",align:"right"},{default:l(({row:t})=>[t.actual_amount>0?(g(),$("span",wt,u(_(f)(t.actual_amount)),1)):(g(),$("span",kt,"-"))]),_:1}),a(d,{prop:"actual_date",label:"实际收款日期",width:"120",align:"center"},{default:l(({row:t})=>[o(u(t.actual_date||"-"),1)]),_:1}),a(d,{prop:"penalty_amount",label:"违约金",width:"100",align:"right"},{default:l(({row:t})=>[t.penalty_amount>0?(g(),$("span",Ct,u(_(f)(t.penalty_amount)),1)):(g(),$("span",Vt,"-"))]),_:1}),a(d,{prop:"forfeit_amount",label:"滞纳金",width:"100",align:"right"},{default:l(({row:t})=>[t.forfeit_amount>0?(g(),$("span",$t,u(_(f)(t.forfeit_amount)),1)):(g(),$("span",Mt,"-"))]),_:1}),a(d,{prop:"overdue_days",label:"逾期天数",width:"100",align:"center"},{default:l(({row:t})=>[t.overdue_days>0?(g(),$("span",xt,u(t.overdue_days)+"天",1)):(g(),$("span",At,"-"))]),_:1}),a(d,{label:"操作",width:"120",align:"center",fixed:"right"},{default:l(({row:t})=>[t.status==="待收款"||t.status==="已逾期"?(g(),M(s,{key:0,type:"primary",size:"small",onClick:I=>ua(t)},{default:l(()=>e[53]||(e[53]=[o(" 标记收款 ")])),_:2,__:[53]},1032,["onClick"])):(g(),$("span",Ut,"已收款"))]),_:1})]),_:1},8,["data","show-summary"])]),_:1}),a(y,{class:"detail-card"},{default:l(()=>[a(Za,{"reference-id":_(_e).params.id,"reference-type":"order","show-filter":!0,"show-pagination":!0,"page-size":20,"auto-load":!0},null,8,["reference-id"])]),_:1}),a(me,{modelValue:H.value,"onUpdate:modelValue":e[3]||(e[3]=t=>H.value=t),title:"前置款信息",width:"600px","close-on-click-modal":!1},{footer:l(()=>[m("span",Nt,[a(s,{onClick:e[2]||(e[2]=t=>H.value=!1)},{default:l(()=>e[54]||(e[54]=[o("关闭")])),_:1,__:[54]}),a(s,{type:"primary",onClick:va},{default:l(()=>e[55]||(e[55]=[o("复制信息")])),_:1,__:[55]})])]),default:l(()=>[Ie((g(),$("div",St,[c.value.batch_no?(g(),M(k,{key:0,column:1,border:"",size:"small"},{default:l(()=>[a(i,{label:"批次号"},{default:l(()=>[m("span",null,u(c.value.batch_no),1)]),_:1}),a(i,{label:"借款人"},{default:l(()=>[m("span",null,u(c.value.borrower),1)]),_:1}),a(i,{label:"车辆信息"},{default:l(()=>[m("span",null,u(c.value.vehicle_info),1)]),_:1}),a(i,{label:"总保费"},{default:l(()=>[m("span",null,u(_(f)(c.value.total_premium)),1)]),_:1})]),_:1})):V("",!0),c.value.is_recv_srv_fee==="否"?(g(),$("div",Et,[a(k,{column:1,border:"",size:"small"},{default:l(()=>[a(i,{label:"服务费"},{default:l(()=>[m("span",null,u(_(f)(c.value.service_fee)),1)]),_:1}),a(i,{label:"收款户名"},{default:l(()=>[m("span",null,u(c.value.service_account_name),1)]),_:1}),a(i,{label:"收款账户"},{default:l(()=>[m("span",null,u(c.value.service_account_no),1)]),_:1}),a(i,{label:"开户行"},{default:l(()=>[m("span",null,u(c.value.service_bank_name),1)]),_:1})]),_:1})])):V("",!0),m("div",Pt,[a(k,{column:1,border:"",size:"small"},{default:l(()=>[a(i,{label:"首付款"},{default:l(()=>[m("span",null,u(_(f)(c.value.total_down_payment)),1)]),_:1}),a(i,{label:"明细"},{default:l(()=>[m("span",null,u(c.value.down_payment_detail),1)]),_:1}),a(i,{label:"收款户名"},{default:l(()=>[m("span",null,u(c.value.funder_account_name),1)]),_:1}),a(i,{label:"收款账户"},{default:l(()=>[m("span",null,u(c.value.funder_account_no),1)]),_:1}),a(i,{label:"开户行"},{default:l(()=>[m("span",null,u(c.value.funder_bank_name),1)]),_:1})]),_:1})]),c.value.remark?(g(),$("div",Dt,[m("div",Rt,u(c.value.remark),1)])):V("",!0)])),[[ke,Z.value]])]),_:1},8,["modelValue"]),a(F,{visible:ee.value,"onUpdate:visible":e[4]||(e[4]=t=>ee.value=t),title:"订单附件","order-id":n.value.id,"ref-id":0,type:"order","allow-delete":!0},null,8,["visible","order-id"]),a(K,{visible:ae.value,"onUpdate:visible":e[5]||(e[5]=t=>ae.value=t),title:"上传订单附件","order-id":n.value.id,"ref-id":0,type:"order",onSuccess:G},null,8,["visible","order-id"]),a(F,{visible:te.value,"onUpdate:visible":e[6]||(e[6]=t=>te.value=t),title:`车险附件 - ${((Ce=A.value)==null?void 0:Ce.car_no)||""}`,"order-id":n.value.id,"ref-id":((Ve=A.value)==null?void 0:Ve.id)||0,type:"car","allow-delete":!1},null,8,["visible","title","order-id","ref-id"]),a(K,{visible:le.value,"onUpdate:visible":e[7]||(e[7]=t=>le.value=t),title:`上传车险附件 - ${(($e=A.value)==null?void 0:$e.car_no)||""}`,"order-id":n.value.id,"ref-id":((Me=A.value)==null?void 0:Me.id)||0,type:"car",onSuccess:G},null,8,["visible","title","order-id","ref-id"]),a(F,{visible:ne.value,"onUpdate:visible":e[8]||(e[8]=t=>ne.value=t),title:`货运险附件 - ${((xe=A.value)==null?void 0:xe.track_no)||""}`,"order-id":n.value.id,"ref-id":((Ae=A.value)==null?void 0:Ae.id)||0,type:"cargo","allow-delete":!1},null,8,["visible","title","order-id","ref-id"]),a(K,{visible:re.value,"onUpdate:visible":e[9]||(e[9]=t=>re.value=t),title:`上传货运险附件 - ${((Ue=A.value)==null?void 0:Ue.track_no)||""}`,"order-id":n.value.id,"ref-id":((Se=A.value)==null?void 0:Se.id)||0,type:"cargo",onSuccess:G},null,8,["visible","title","order-id","ref-id"]),a(F,{visible:se.value,"onUpdate:visible":e[10]||(e[10]=t=>se.value=t),title:`收款记录附件 - ${((Ee=T.value)==null?void 0:Ee.trans_no)||""}`,"order-id":n.value.id,"ref-id":((Pe=T.value)==null?void 0:Pe.id)||0,type:"received","allow-delete":!1},null,8,["visible","title","order-id","ref-id"]),a(K,{visible:oe.value,"onUpdate:visible":e[11]||(e[11]=t=>oe.value=t),title:`上传收款记录附件 - ${((De=T.value)==null?void 0:De.trans_no)||""}`,"order-id":n.value.id,"ref-id":((Re=T.value)==null?void 0:Re.id)||0,type:"received",onSuccess:G},null,8,["visible","title","order-id","ref-id"]),a(F,{visible:ue.value,"onUpdate:visible":e[12]||(e[12]=t=>ue.value=t),title:`合同附件 - ${((Ne=ie.value)==null?void 0:Ne.title)||""}`,"order-id":n.value.id,"ref-id":((Te=ie.value)==null?void 0:Te.id)||0,type:"contact","allow-delete":!1},null,8,["visible","title","order-id","ref-id"]),a(me,{modelValue:B.value,"onUpdate:modelValue":e[19]||(e[19]=t=>B.value=t),title:"提前还款",width:"600px","close-on-click-modal":!1},{footer:l(()=>[m("span",Tt,[a(s,{onClick:e[18]||(e[18]=t=>B.value=!1)},{default:l(()=>e[56]||(e[56]=[o("取消")])),_:1,__:[56]}),a(s,{type:"primary",onClick:oa,loading:j.value},{default:l(()=>e[57]||(e[57]=[o(" 确定 ")])),_:1,__:[57]},8,["loading"])])]),default:l(()=>[a(we,{ref_key:"advanceRepaymentFormRef",ref:Q,model:w.value,rules:Be,"label-width":"120px"},{default:l(()=>[a(E,{label:"订单信息"},{default:l(()=>{var t;return[a(J,{value:`${n.value.order_no} - ${n.value.loan_name||((t=n.value.user)==null?void 0:t.company_name)}`,disabled:""},null,8,["value"])]}),_:1}),a(E,{label:"金额",prop:"amount"},{default:l(()=>[a(be,{modelValue:w.value.amount,"onUpdate:modelValue":e[13]||(e[13]=t=>w.value.amount=t),min:.01,precision:2,step:100,style:{width:"100%"},placeholder:"请输入金额"},null,8,["modelValue"])]),_:1}),a(E,{label:"收款类型",prop:"rec_type"},{default:l(()=>[a(pe,{modelValue:w.value.rec_type,"onUpdate:modelValue":e[14]||(e[14]=t=>w.value.rec_type=t),placeholder:"请选择收款类型",style:{width:"100%"},filterable:"","allow-create":"","default-first-option":""},{default:l(()=>[a(P,{label:"本金",value:"本金"}),a(P,{label:"利息",value:"利息"}),a(P,{label:"退保",value:"退保"}),a(P,{label:"违约金",value:"违约金"}),a(P,{label:"滞纳金",value:"滞纳金"})]),_:1},8,["modelValue"])]),_:1}),a(E,{label:"支付方式",prop:"method"},{default:l(()=>[a(pe,{modelValue:w.value.method,"onUpdate:modelValue":e[15]||(e[15]=t=>w.value.method=t),placeholder:"请选择支付方式",style:{width:"100%"}},{default:l(()=>[a(P,{label:"微信",value:"微信"}),a(P,{label:"支付宝",value:"支付宝"}),a(P,{label:"银行卡",value:"银行卡"})]),_:1},8,["modelValue"])]),_:1}),a(E,{label:"支付时间",prop:"date_time"},{default:l(()=>[a(he,{modelValue:w.value.date_time,"onUpdate:modelValue":e[16]||(e[16]=t=>w.value.date_time=t),type:"datetime",placeholder:"选择支付时间",style:{width:"100%"},format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),a(E,{label:"备注",prop:"remark"},{default:l(()=>[a(J,{modelValue:w.value.remark,"onUpdate:modelValue":e[17]||(e[17]=t=>w.value.remark=t),type:"textarea",rows:3,placeholder:"请输入备注信息（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(me,{modelValue:z.value,"onUpdate:modelValue":e[24]||(e[24]=t=>z.value=t),title:"标记收款",width:"500px","close-on-click-modal":!1},{footer:l(()=>[m("span",It,[a(s,{onClick:e[23]||(e[23]=t=>z.value=!1)},{default:l(()=>e[58]||(e[58]=[o("取消")])),_:1,__:[58]}),a(s,{type:"primary",onClick:ia,loading:X.value},{default:l(()=>e[59]||(e[59]=[o(" 确定 ")])),_:1,__:[59]},8,["loading"])])]),default:l(()=>[a(we,{ref_key:"markAsPaidFormRef",ref:W,model:S.value,rules:ze,"label-width":"120px"},{default:l(()=>[a(E,{label:"期数"},{default:l(()=>{var t;return[a(J,{value:`第${(t=q.value)==null?void 0:t.period}期`,disabled:""},null,8,["value"])]}),_:1}),a(E,{label:"应还金额"},{default:l(()=>{var t;return[a(J,{value:_(f)((t=q.value)==null?void 0:t.amount),disabled:""},null,8,["value"])]}),_:1}),a(E,{label:"实际收款金额",prop:"actual_amount"},{default:l(()=>[a(be,{modelValue:S.value.actual_amount,"onUpdate:modelValue":e[20]||(e[20]=t=>S.value.actual_amount=t),min:0,precision:2,step:100,style:{width:"100%"},placeholder:"请输入实际收款金额"},null,8,["modelValue"])]),_:1}),a(E,{label:"收款方式",prop:"method"},{default:l(()=>[a(pe,{modelValue:S.value.method,"onUpdate:modelValue":e[21]||(e[21]=t=>S.value.method=t),placeholder:"请选择收款方式",style:{width:"100%"}},{default:l(()=>[a(P,{label:"微信",value:"微信"}),a(P,{label:"支付宝",value:"支付宝"}),a(P,{label:"银行卡",value:"银行卡"})]),_:1},8,["modelValue"])]),_:1}),a(E,{label:"实际收款日期",prop:"actual_date"},{default:l(()=>[a(he,{modelValue:S.value.actual_date,"onUpdate:modelValue":e[22]||(e[22]=t=>S.value.actual_date=t),type:"date",placeholder:"选择收款日期",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},pl=ba(Bt,[["__scopeId","data-v-eda62725"]]);export{pl as default};
