import{_ as O}from"./index-e1227d2d.js";/* empty css                         *//* empty css                             *//* empty css               *//* empty css                *//* empty css                    */import{b as P}from"./caxt-fca08dd1.js";import{f as S}from"./format-20468769.js";import{r as u,b as L,l as n,B as p,F as a,G as t,p as x,S as f,ag as X,C as o,O as i,D as c,H,I as J,u as K,X as Q,E as m,K as W,aC as Y,a6 as Z,a5 as $,a7 as ee,am as te,az as ae,aA as le,ap as oe,aq as se}from"./element-plus-b8725afa.js";const re={class:"contact-sign-container"},ne={key:1},ie={class:"card-header"},de={class:"logs-container"},ce={class:"log-header"},ue={class:"log-operation"},pe={class:"log-content"},me={key:0,class:"log-section"},_e={class:"log-data"},fe={key:1,class:"log-section"},ge={class:"log-data"},ye={key:2,class:"log-section"},ve={class:"error-message"},be="#",we={__name:"index",setup(xe){const k=u(),E=u(),C=u(!1),g=u([]),d=u(null),y=u([]),r=L({title:"",companyName:"",contract:null}),F={title:[{required:!0,message:"请输入合同标题",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],companyName:[{required:!0,message:"请输入公司名称",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],contract:[{required:!0,message:"请选择合同文件",trigger:"change"}]},I=l=>{if(r.contract=l.raw,l.size>32*1024*1024){m.error("文件大小不能超过 32MB"),g.value=[],r.contract=null;return}if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png"].includes(l.raw.type)){m.error("不支持的文件格式"),g.value=[],r.contract=null;return}},V=()=>{r.contract=null},B=async()=>{if(!r.contract){m.error("请选择合同文件");return}try{await k.value.validate()}catch{return}C.value=!0;try{const l=new FormData;l.append("contract",r.contract),l.append("title",r.title),l.append("companyName",r.companyName);const{data:e}=await P(l);d.value=e,e.logs&&R(e.logs),m.success("合同签署成功！"),h()}catch(l){console.error("签署失败:",l),m.error("签署失败: "+(l.message||"未知错误"))}finally{C.value=!1}},h=()=>{k.value.resetFields(),g.value=[],r.contract=null,E.value.clearFiles()},q=()=>{var l;(l=d.value)!=null&&l.downloadUrl&&window.open(d.value.downloadUrl,"_blank")},z=()=>{y.value=[],m.success("日志已清空")},R=l=>{l&&Array.isArray(l)&&(y.value=l)};return(l,e)=>{const _=W,T=Y,v=Z,D=$,U=ee,b=X,N=te,w=ae,A=le,j=oe,G=se;return n(),p("div",re,[a(b,{class:"box-card"},{header:t(()=>e[2]||(e[2]=[o("div",{class:"card-header"},[o("span",null,"信托合同签署")],-1)])),default:t(()=>[a(U,{ref_key:"formRef",ref:k,model:r,rules:F,"label-width":"120px",class:"contact-form"},{default:t(()=>[a(v,{label:"合同文件",prop:"contract"},{default:t(()=>[a(T,{ref_key:"uploadRef",ref:E,class:"upload-demo",action:be,"auto-upload":!1,"on-change":I,"on-remove":V,"file-list":g.value,limit:1,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png"},{trigger:t(()=>[a(_,{type:"primary"},{default:t(()=>e[3]||(e[3]=[i("选择文件")])),_:1,__:[3]})]),tip:t(()=>e[4]||(e[4]=[o("div",{class:"el-upload__tip"}," 支持 PDF、DOC、DOCX、JPG、PNG 格式，文件大小不超过 32MB ",-1)])),_:1},8,["file-list"])]),_:1}),a(v,{label:"合同标题",prop:"title"},{default:t(()=>[a(D,{modelValue:r.title,"onUpdate:modelValue":e[0]||(e[0]=s=>r.title=s),placeholder:"请输入合同标题",clearable:"",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(v,{label:"公司名称",prop:"companyName"},{default:t(()=>[a(D,{modelValue:r.companyName,"onUpdate:modelValue":e[1]||(e[1]=s=>r.companyName=s),placeholder:"请输入公司名称",clearable:"",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(v,null,{default:t(()=>[a(_,{type:"primary",loading:C.value,onClick:B},{default:t(()=>e[5]||(e[5]=[i(" 发起签署 ")])),_:1,__:[5]},8,["loading"]),a(_,{onClick:h},{default:t(()=>e[6]||(e[6]=[i("重置")])),_:1,__:[6]})]),_:1})]),_:1},8,["model"])]),_:1}),d.value?(n(),x(b,{key:0,class:"result-card",style:{"margin-top":"20px"}},{header:t(()=>e[7]||(e[7]=[o("div",{class:"card-header"},[o("span",null,"签署结果")],-1)])),default:t(()=>[a(A,{column:2,border:""},{default:t(()=>[a(w,{label:"签署状态"},{default:t(()=>[a(N,{type:"success"},{default:t(()=>e[8]||(e[8]=[i("签署成功")])),_:1,__:[8]})]),_:1}),a(w,{label:"合同ID"},{default:t(()=>[i(c(d.value.contractId),1)]),_:1}),a(w,{label:"文档ID"},{default:t(()=>[i(c(d.value.documentId),1)]),_:1}),a(w,{label:"下载链接"},{default:t(()=>[d.value.downloadUrl?(n(),x(_,{key:0,type:"primary",size:"small",onClick:q},{default:t(()=>e[9]||(e[9]=[i(" 下载签署后的合同 ")])),_:1,__:[9]})):(n(),p("span",ne,"暂无下载链接"))]),_:1})]),_:1})]),_:1})):f("",!0),y.value.length>0?(n(),x(b,{key:1,class:"logs-card",style:{"margin-top":"20px"}},{header:t(()=>[o("div",ie,[e[11]||(e[11]=o("span",null,"操作日志",-1)),a(_,{type:"info",size:"small",onClick:z},{default:t(()=>e[10]||(e[10]=[i("清空日志")])),_:1,__:[10]})])]),default:t(()=>[o("div",de,[a(G,null,{default:t(()=>[(n(!0),p(H,null,J(y.value,(s,M)=>(n(),x(j,{key:M,type:s.error?"danger":"success",timestamp:K(S)(s.timestamp),placement:"top"},{default:t(()=>[a(b,{class:Q(["log-card",{"error-log":s.error}])},{header:t(()=>[o("div",ce,[o("span",ue,c(s.operation),1),a(N,{type:s.error?"danger":"success",size:"small"},{default:t(()=>[i(c(s.error?"失败":"成功"),1)]),_:2},1032,["type"])])]),default:t(()=>[o("div",pe,[s.request?(n(),p("div",me,[e[12]||(e[12]=o("h4",null,"请求数据:",-1)),o("pre",_e,c(s.request),1)])):f("",!0),s.response?(n(),p("div",fe,[e[13]||(e[13]=o("h4",null,"响应数据:",-1)),o("pre",ge,c(s.response),1)])):f("",!0),s.error?(n(),p("div",ye,[e[14]||(e[14]=o("h4",null,"错误信息:",-1)),o("div",ve,c(s.error),1)])):f("",!0)])]),_:2},1032,["class"])]),_:2},1032,["type","timestamp"]))),128))]),_:1})])]),_:1})):f("",!0)])}}},Be=O(we,[["__scopeId","data-v-5430c40b"]]);export{Be as default};
