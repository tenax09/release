import{_ as W}from"./index-2885c76a.js";/* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                        *//* empty css                    */import{r as m,b as z,ae as X,l as g,B as S,F as t,G as l,C as v,a1 as Y,af as Z,p as ee,E as M,a5 as te,ay as le,K as ae,M as oe,an as se,aK as ne,ai as re,O as r,D as y,S as pe,u as h,b1 as ie,aL as ue,aM as de,b2 as me,as as _e,H as ce,I as fe,a6 as ge,ax as ve,a7 as ye,a2 as he,al as be,am as we}from"./element-plus-b8725afa.js";import{a as Se,s as Ve}from"./caxt-d9e34d18.js";const xe={class:"sms-container"},Ce={class:"form-tip"},Ee={key:0,class:"phone-count"},ze={class:"dialog-footer"},Me={class:"filter-container"},ke={class:"pagination"},Fe={__name:"index",setup(De){const _=m(),V=m(!1),x=m(!1),b=m(""),k=m([]),c=m(!1),n=z({phones:[],content:"",sms_type:"1"}),T={phones:[{required:!0,message:"请输入手机号",trigger:"blur"}],content:[{required:!0,message:"请输入短信内容",trigger:"blur"}],sms_type:[{required:!0,message:"请选择短信类型",trigger:"change"}]},p=z({phone:"",success:""}),s=z({page:1,pageSize:20,total:0}),B=()=>{const o=b.value.split(`
`).map(e=>e.trim()).filter(e=>e&&/^1[3-9]\d{9}$/.test(e));n.phones=o},N=()=>{c.value=!0,F()},K=async()=>{if(_.value)try{await _.value.validate(),x.value=!0,await Ve(n),M.success("短信发送成功"),c.value=!1,i()}catch(o){M.error(o.message||"发送失败")}finally{x.value=!1}},F=()=>{_.value&&_.value.resetFields(),b.value="",n.phones=[],n.content="",n.sms_type="1"},i=async()=>{try{V.value=!0;const o={page:s.page,page_size:s.pageSize,...p},{data:e}=await Se(o);k.value=e.list,s.total=e.total}catch{M.error("加载日志失败")}finally{V.value=!1}},D=()=>{s.page=1,i()},R=()=>{p.phone="",p.success="",s.page=1,i()},q=o=>{s.pageSize=o,s.page=1,i()},P=o=>{s.page=o,i()},O=o=>({1:"info",3:"success"})[o]||"info",$=o=>({1:"通知",3:"营销"})[o]||"未知",j=o=>o?new Date(o).toLocaleString("zh-CN"):"";return X(()=>{i()}),(o,e)=>{const C=te,E=ge,w=ve,I=le,G=ye,d=ae,H=oe,f=he,u=be,U=we,A=se,J=ne,Q=re;return g(),S("div",xe,[t(H,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=a=>c.value=a),title:"发送短信",width:"600px","close-on-click-modal":!1,onClose:F},{footer:l(()=>[v("div",ze,[t(d,{onClick:e[3]||(e[3]=a=>c.value=!1)},{default:l(()=>e[11]||(e[11]=[r("取消")])),_:1,__:[11]}),t(d,{type:"primary",onClick:K,loading:x.value},{default:l(()=>e[12]||(e[12]=[r(" 发送短信 ")])),_:1,__:[12]},8,["loading"])])]),default:l(()=>[t(G,{ref_key:"smsFormRef",ref:_,model:n,rules:T,"label-width":"120px"},{default:l(()=>[t(E,{label:"手机号列表",prop:"phones"},{default:l(()=>[t(C,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),type:"textarea",rows:3,placeholder:"请输入手机号，多个手机号用换行分隔",onInput:B},null,8,["modelValue"]),v("div",Ce,[e[9]||(e[9]=r(" 支持多个手机号，每行一个 ")),n.phones.length>0?(g(),S("span",Ee," （已识别 "+y(n.phones.length)+" 个有效手机号） ",1)):pe("",!0)])]),_:1}),t(E,{label:"短信类型",prop:"sms_type"},{default:l(()=>[t(I,{modelValue:n.sms_type,"onUpdate:modelValue":e[1]||(e[1]=a=>n.sms_type=a),placeholder:"请选择短信类型",style:{width:"100%"}},{default:l(()=>[t(w,{label:"通知",value:"1"}),t(w,{label:"营销",value:"3"})]),_:1},8,["modelValue"])]),_:1}),t(E,{label:"短信内容",prop:"content"},{default:l(()=>[t(C,{modelValue:n.content,"onUpdate:modelValue":e[2]||(e[2]=a=>n.content=a),type:"textarea",rows:4,placeholder:"请输入短信内容","show-word-limit":"",maxlength:"500"},null,8,["modelValue"]),e[10]||(e[10]=v("div",{class:"form-tip"},"最多500字符",-1))]),_:1,__:[10]})]),_:1},8,["model"])]),_:1},8,["modelValue"]),v("div",Me,[t(C,{modelValue:p.phone,"onUpdate:modelValue":e[5]||(e[5]=a=>p.phone=a),placeholder:"手机号",style:{width:"200px"},class:"filter-item",onKeyup:Y(D,["enter","native"])},{prefix:l(()=>[t(f,null,{default:l(()=>[t(h(ie))]),_:1})]),_:1},8,["modelValue"]),t(I,{modelValue:p.success,"onUpdate:modelValue":e[6]||(e[6]=a=>p.success=a),placeholder:"发送状态",clearable:"",class:"filter-item",style:{width:"120px"}},{default:l(()=>[t(w,{label:"成功",value:!0}),t(w,{label:"失败",value:!1})]),_:1},8,["modelValue"]),t(d,{class:"filter-item",type:"primary",onClick:D},{default:l(()=>[t(f,null,{default:l(()=>[t(h(ue))]),_:1}),e[13]||(e[13]=r(" 搜索 "))]),_:1,__:[13]}),t(d,{class:"filter-item",onClick:R},{default:l(()=>[t(f,null,{default:l(()=>[t(h(de))]),_:1}),e[14]||(e[14]=r(" 重置 "))]),_:1,__:[14]}),t(d,{class:"filter-item",onClick:i},{default:l(()=>[t(f,null,{default:l(()=>[t(h(me))]),_:1}),e[15]||(e[15]=r(" 刷新 "))]),_:1,__:[15]}),t(d,{class:"filter-item",type:"primary",onClick:N},{default:l(()=>[t(f,null,{default:l(()=>[t(h(_e))]),_:1}),e[16]||(e[16]=r(" 发送短信 "))]),_:1,__:[16]})]),Z((g(),ee(A,{data:k.value,border:"",fit:"","highlight-current-row":"",style:{width:"100%"}},{default:l(()=>[t(u,{prop:"phones",label:"手机号",width:"160"},{default:l(({row:a})=>[(g(!0),S(ce,null,fe(a.phones,L=>(g(),S("div",{key:L},y(L),1))),128))]),_:1}),t(u,{prop:"content",label:"内容","show-overflow-tooltip":""}),t(u,{prop:"sms_type",label:"类型",width:"100",align:"center"},{default:l(({row:a})=>[t(U,{type:O(a.sms_type)},{default:l(()=>[r(y($(a.sms_type)),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"success",label:"状态",width:"100",align:"center"},{default:l(({row:a})=>[t(U,{type:a.success?"success":"danger"},{default:l(()=>[r(y(a.success?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"response_code",label:"响应码",width:"100",align:"center"}),t(u,{prop:"response_msg",label:"响应消息",width:"150","show-overflow-tooltip":""}),t(u,{prop:"created_at",label:"发送时间",width:"180"},{default:l(({row:a})=>[r(y(j(a.created_at)),1)]),_:1})]),_:1},8,["data"])),[[Q,V.value]]),v("div",ke,[t(J,{"current-page":s.page,"onUpdate:currentPage":e[7]||(e[7]=a=>s.page=a),"page-size":s.pageSize,"onUpdate:pageSize":e[8]||(e[8]=a=>s.pageSize=a),"page-sizes":[10,20,50,100],total:s.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:q,onCurrentChange:P},null,8,["current-page","page-size","total"])])])}}},Oe=W(Fe,[["__scopeId","data-v-082d364c"]]);export{Oe as default};
