import{_ as ul,b as il,u as dl}from"./index-86e0e316.js";/* empty css               *//* empty css                   *//* empty css                    *//* empty css                 *//* empty css                       *//* empty css                     *//* empty css                        *//* empty css                        *//* empty css                  *//* empty css                *//* empty css               *//* empty css                       */import{r as n,j as Ee,w as ml,ae as pl,l as f,B as T,C as o,F as l,G as a,p as R,S as E,af as Ye,u as V,E as p,aE as cl,ag as vl,M as _l,ai as fl,aG as gl,O as r,av as bl,aH as yl,aI as wl,Q as Vl,as as kl,D as v,H as ve,I as _e,aw as fe,J as xl,a2 as hl,K as Cl,ao as Dl,ah as Ul,al as Fl,am as Tl,an as El,a5 as Yl,a6 as Ml,ax as Il,ay as Ll,aJ as Rl,aK as Bl,aL as ql,a7 as $l,aB as Al,aC as Ol,aD as Pl}from"./element-plus-eb4b90a0.js";import{i as Nl,a as zl,j as Me,k as Sl,e as jl,u as Gl,l as Jl}from"./order-95b27da5.js";import{a as Wl}from"./user-15860398.js";import{a as Hl,A as Kl,d as Ql}from"./AttachmentUpload-0e56480c.js";/* empty css                 */import"./format-20468769.js";const Xl={class:"insurance-detail"},Zl={class:"page-header"},ea={class:"header-actions"},la={class:"stat-item"},aa={class:"stat-number"},ta={class:"stat-item"},sa={class:"stat-number"},oa={class:"stat-item"},na={class:"stat-number"},ra={class:"stat-item total"},ua={class:"stat-number"},ia={class:"attachment-status"},da={class:"status-item"},ma={class:"status-item"},pa={class:"stat-item total"},ca={class:"stat-number"},va={class:"stat-item"},_a={class:"stat-number"},fa={class:"stat-item"},ga={class:"stat-number"},ba={class:"insured-input"},ya={class:"dialog-footer"},wa={class:"insured-input"},Va={class:"dialog-footer"},ka={class:"upload-content"},xa={class:"upload-tips"},ha={key:0,class:"import-result"},Ca={class:"result-summary"},Da={class:"stat-item"},Ua={class:"stat-number total"},Fa={class:"stat-item"},Ta={class:"stat-number success"},Ea={class:"stat-item"},Ya={class:"stat-number fail"},Ma={key:0,class:"error-list"},Ia={class:"dialog-footer"},La={class:"upload-content"},Ra={class:"upload-tips"},Ba={key:0,class:"upload-status"},qa={class:"status-content"},$a={class:"dialog-footer"},Aa={class:"upload-content"},Oa={class:"upload-tips"},Pa={key:0,class:"upload-status"},Na={class:"status-content"},za={class:"dialog-footer"},Sa={__name:"insurance",setup(ja){const y=il(),ge=dl(),J=n(!1),B=n(!1),k=n([]),b=n("车险"),Ie=n({}),Le=n({}),M=n([]),W=n(!1),$=n(null),te=n(!1),Y=n(null),se=n([]),w=n(null),A=n(!1),oe=n(null),O=n(!1),h=n([]),ne=n([]),P=n(!1),re=n(null),H=n(!1),C=n([]),ue=n([]),ie=n(!1),q=n(0),N=n(""),K=n(""),Q=n(!1),X=n([]),z=n(!1),de=n(null),i=n({car_no:"",vin:"",insurance_no:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,compulsory_amount:void 0,vehicle_tax_amount:void 0,start_date:"",end_date:""}),Re={car_no:[{required:!0,message:"请输入车牌号",trigger:"blur"}],vin:[{required:!0,message:"请输入车架号",trigger:"blur"}],insurance_no:[{required:!0,message:"请输入投保单号",trigger:"blur"}],insured:[{required:!0,message:"请选择被保人",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}]},S=n(!1),me=n(null),u=n({track_no:"",insurance_no:"",name:"",quantity:"",carrier:"",consignee:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,start_date:"",end_date:""}),Be={track_no:[{required:!0,message:"请输入运输编号",trigger:"blur"}],insurance_no:[{required:!0,message:"请输入投保单号",trigger:"blur"}],name:[{required:!0,message:"请输入货物名称",trigger:"blur"}],quantity:[{required:!0,message:"请输入货物数量",trigger:"blur"}],carrier:[{required:!0,message:"请输入承运人",trigger:"blur"}],consignee:[{required:!0,message:"请输入收货人",trigger:"blur"}],insured:[{required:!0,message:"请选择被保人",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}]},qe=()=>{ge.back()},$e=()=>{ge.push(`/order/detail/${y.params.id}`)},D=async()=>{J.value=!0;try{const s=await Nl(y.params.id);k.value=s.data.insurances||[],s.data.type&&(b.value=s.data.type)}catch{p.error("获取投保信息失败")}J.value=!1},x=s=>s?`¥${s.toFixed(2)}`:"¥0.00",Z=Ee(()=>{if(b.value!=="车险"||!k.value.length)return{commercialTotal:0,compulsoryTotal:0,vehicleTaxTotal:0,grandTotal:0};const s=k.value.reduce((e,d)=>(e.commercialTotal+=d.commercial_amount||0,e.compulsoryTotal+=d.compulsory_amount||0,e.vehicleTaxTotal+=d.vehicle_tax_amount||0,e),{commercialTotal:0,compulsoryTotal:0,vehicleTaxTotal:0});return s.grandTotal=s.commercialTotal+s.compulsoryTotal+s.vehicleTaxTotal,s}),be=Ee(()=>{if(b.value!=="货运险"||!k.value.length)return{commercialTotal:0,averageAmount:0};const s=k.value.reduce((d,m)=>d+(m.commercial_amount||0),0),e=s/k.value.length;return{commercialTotal:s,averageAmount:e}}),Ae=()=>{if(b.value==="车险"){if(i.value={car_no:"",vin:"",insurance_no:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,compulsory_amount:void 0,vehicle_tax_amount:void 0,start_date:"",end_date:""},M.value.length===2){const s=M.value.find(e=>e.value!=="同借款人");s&&(i.value.insured=s.value)}z.value=!0}else if(b.value==="货运险"){if(u.value={track_no:"",insurance_no:"",name:"",quantity:"",carrier:"",consignee:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,start_date:"",end_date:""},M.value.length===2){const s=M.value.find(e=>e.value!=="同借款人");s&&(u.value.insured=s.value)}S.value=!0}},Oe=async()=>{de.value&&await de.value.validate(async s=>{if(s){B.value=!0;try{await Me(y.params.id,i.value),p.success("添加车险信息成功"),z.value=!1,D()}catch(e){p.error("添加车险信息失败："+(e.message||"未知错误"))}B.value=!1}})},Pe=async()=>{me.value&&await me.value.validate(async s=>{if(s){B.value=!0;try{await Me(y.params.id,u.value),p.success("添加货运险信息成功"),S.value=!1,D()}catch(e){p.error("添加货运险信息失败："+(e.message||"未知错误"))}B.value=!1}})},ye=async s=>{try{await xl.confirm("确定要删除该投保信息吗？","提示",{type:"warning"}),await Sl(y.params.id,s.id),p.success("删除成功"),D()}catch(e){e!=="cancel"&&p.error("删除失败："+(e.message||"未知错误"))}},we=(s,e)=>{const d=e==="car"?s.car_no:s.track_no;K.value=d,q.value=s.id,N.value=e,ie.value=!0},Ve=(s,e)=>{const d=e==="car"?s.car_no:s.track_no;K.value=d,q.value=s.id,N.value=e,X.value=s.attachments||[],Q.value=!0};ml(Q,s=>{s||(X.value=[],q.value=0,N.value="")});const Ne=async()=>{await D();const s=k.value.find(e=>e.id===q.value);s&&(X.value=s.attachments||[])},ze=async s=>{try{await Ql(s)}catch(e){p.error("删除失败："+(e.message||"未知错误"))}},Se=async()=>{window.open(`/api/admin/orders/insurances/download-template?type=${b.value}`,"_blank")},je=()=>{Y.value=null,se.value=[],w.value=null,W.value=!0},Ge=s=>{if(Y.value=s.raw,!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(s.raw.type)&&!s.name.toLowerCase().endsWith(".xlsx")&&!s.name.toLowerCase().endsWith(".xls")){p.error("请上传Excel文件(.xlsx或.xls)"),$.value.clearFiles(),Y.value=null;return}if(s.raw.size>10*1024*1024){p.error("文件大小不能超过10MB"),$.value.clearFiles(),Y.value=null;return}},Je=async()=>{if(!Y.value){p.error("请选择要上传的文件");return}const s=new FormData;s.append("file",Y.value),te.value=!0,w.value=null;try{const e=await jl(y.params.id,s);w.value=e.data,e.data.success>0?(D(),p.success(`导入完成：成功${e.data.success}条，失败${e.data.fail}条`)):p.warning("没有成功导入任何数据，请检查文件格式")}catch(e){p.error("导入失败："+(e.message||"未知错误"))}te.value=!1},We=()=>{W.value=!1,Y.value=null,se.value=[],w.value=null,$.value&&$.value.clearFiles()},ke=s=>{s==="car"?i.value.same_as_borrower?i.value.insured="同借款人":i.value.insured="":s==="cargo"&&(u.value.same_as_borrower?u.value.insured="同借款人":u.value.insured="")},He=()=>{h.value=[],ne.value=[],A.value=!0},Ke=s=>{if(!["image/jpeg","image/jpg","image/png","image/bmp","image/tiff","image/webp"].includes(s.raw.type))return p.error("请上传图片文件"),!1;if(s.raw.size>5*1024*1024)return p.error("图片大小不能超过5MB"),!1;h.value.push(s.raw)},Qe=s=>{const e=h.value.findIndex(d=>d.name===s.name);e!==-1&&h.value.splice(e,1)},Xe=()=>{A.value=!1,h.value=[],ne.value=[],oe.value&&oe.value.clearFiles()},Ze=async()=>{if(h.value.length===0){p.error("请选择要上传的行驶证图片");return}const s=new FormData;h.value.forEach(e=>{s.append("images",e)}),O.value=!0;try{await Gl(y.params.id,s),p.success("行驶证上传成功，正在后台处理OCR识别"),setTimeout(()=>{O.value=!1,A.value=!1,D()},2e3)}catch(e){p.error("行驶证上传失败："+(e.message||"未知错误"))}O.value=!1},el=()=>{C.value=[],ue.value=[],P.value=!0},ll=s=>{if(!["image/jpeg","image/jpg","image/png","image/bmp","image/tiff","image/webp"].includes(s.raw.type))return p.error("请上传图片文件"),!1;if(s.raw.size>5*1024*1024)return p.error("图片大小不能超过5MB"),!1;C.value.push(s.raw)},al=s=>{const e=C.value.findIndex(d=>d.name===s.name);e!==-1&&C.value.splice(e,1)},tl=()=>{P.value=!1,C.value=[],ue.value=[],re.value&&re.value.clearFiles()},sl=async()=>{if(C.value.length===0){p.error("请选择要上传的投保单图片");return}const s=new FormData;C.value.forEach(e=>{s.append("images",e)}),H.value=!0;try{await Jl(y.params.id,s),p.success("投保单上传成功，正在后台处理OCR识别"),setTimeout(()=>{H.value=!1,P.value=!1,D()},2e3)}catch(e){p.error("投保单上传失败："+(e.message||"未知错误"))}},ee=(s,e)=>!s||s.length===0?!1:s.some(d=>d.remark===e),ol=async()=>{try{const s=await zl(y.params.id);Ie.value=s.data,s.data.user_id&&await nl(s.data.user_id)}catch{p.error("获取订单详情失败")}},nl=async s=>{try{const e=await Wl(s);Le.value=e.data;const d=e.data.insureds||"",m=[];m.push({value:"同借款人",label:"同借款人"}),d&&d.split(";").filter(g=>g.trim()).forEach(g=>{const I=g.split(",");if(I.length>=2){const U=I[0].trim(),c=I[1].trim();m.push({value:U,label:c?`${U} (${c})`:U})}}),M.value=m}catch{p.error("获取用户配置失败")}};return pl(()=>{D(),ol()}),(s,e)=>{const d=hl,m=Cl,xe=cl,g=Dl,I=Ul,U=vl,c=Fl,pe=Tl,he=El,F=Yl,_=Ml,Ce=Il,De=Ll,Ue=Rl,le=Bl,ae=ql,Fe=$l,j=_l,G=Al,ce=Ol,rl=Pl,Te=fl;return f(),T("div",Xl,[o("div",Zl,[l(xe,{onBack:qe,title:`${b.value}投保信息管理`},{extra:a(()=>[o("div",ea,[l(m,{onClick:$e},{default:a(()=>[l(d,null,{default:a(()=>[l(V(gl))]),_:1}),e[32]||(e[32]=r(" 返回订单详情 "))]),_:1,__:[32]}),l(m,{onClick:Se},{default:a(()=>[l(d,null,{default:a(()=>[l(V(bl))]),_:1}),e[33]||(e[33]=r(" 下载模板 "))]),_:1,__:[33]}),l(m,{type:"success",onClick:je},{default:a(()=>[l(d,null,{default:a(()=>[l(V(yl))]),_:1}),e[34]||(e[34]=r(" 批量导入 "))]),_:1,__:[34]}),b.value==="车险"?(f(),R(m,{key:0,type:"warning",onClick:He},{default:a(()=>[l(d,null,{default:a(()=>[l(V(wl))]),_:1}),e[35]||(e[35]=r(" 批量上传行驶证 "))]),_:1,__:[35]})):E("",!0),l(m,{type:"info",onClick:el},{default:a(()=>[l(d,null,{default:a(()=>[l(V(Vl))]),_:1}),e[36]||(e[36]=r(" 批量上传投保单 "))]),_:1,__:[36]}),l(m,{type:"primary",onClick:Ae},{default:a(()=>[l(d,null,{default:a(()=>[l(V(kl))]),_:1}),r(" 添加"+v(b.value),1)]),_:1})])]),_:1},8,["title"])]),b.value==="车险"?(f(),R(U,{key:0,class:"detail-card"},{default:a(()=>[l(I,{gutter:20},{default:a(()=>[l(g,{span:6},{default:a(()=>[o("div",la,[o("div",aa,v(x(Z.value.commercialTotal)),1),e[37]||(e[37]=o("div",{class:"stat-label"},"商业险总金额",-1))])]),_:1}),l(g,{span:6},{default:a(()=>[o("div",ta,[o("div",sa,v(x(Z.value.compulsoryTotal)),1),e[38]||(e[38]=o("div",{class:"stat-label"},"交强险总金额",-1))])]),_:1}),l(g,{span:6},{default:a(()=>[o("div",oa,[o("div",na,v(x(Z.value.vehicleTaxTotal)),1),e[39]||(e[39]=o("div",{class:"stat-label"},"车船税总金额",-1))])]),_:1}),l(g,{span:6},{default:a(()=>[o("div",ra,[o("div",ua,v(x(Z.value.grandTotal)),1),e[40]||(e[40]=o("div",{class:"stat-label"},"合计总保费",-1))])]),_:1})]),_:1})]),_:1})):E("",!0),b.value==="车险"?Ye((f(),R(U,{key:1,class:"detail-card"},{default:a(()=>[l(he,{data:k.value,border:"",style:{width:"100%"}},{default:a(()=>[l(c,{prop:"car_no",label:"车牌号",width:"100"}),l(c,{prop:"vin",label:"车架号","min-width":"180"}),l(c,{prop:"issue_date",label:"附件标记",width:"110"},{default:a(t=>[o("div",ia,[o("div",da,[e[41]||(e[41]=o("span",{class:"status-label"},"行驶证:",-1)),l(pe,{type:ee(t.row.attachments,"行驶证")?"success":"info",size:"small"},{default:a(()=>[r(v(ee(t.row.attachments,"行驶证")?"已上传":"未上传"),1)]),_:2},1032,["type"])]),o("div",ma,[e[42]||(e[42]=o("span",{class:"status-label"},"投保单:",-1)),l(pe,{type:ee(t.row.attachments,"投保单")?"success":"info",size:"small"},{default:a(()=>[r(v(ee(t.row.attachments,"投保单")?"已上传":"未上传"),1)]),_:2},1032,["type"])])])]),_:1}),l(c,{prop:"insured",label:"被保人",width:"280"}),l(c,{prop:"commercial_amount",label:"商业险",width:"100"},{default:a(t=>[r(v(x(t.row.commercial_amount)),1)]),_:1}),l(c,{prop:"compulsory_amount",label:"交强险",width:"100"},{default:a(t=>[r(v(x(t.row.compulsory_amount)),1)]),_:1}),l(c,{prop:"vehicle_tax_amount",label:"车船税",width:"100"},{default:a(t=>[r(v(x(t.row.vehicle_tax_amount)),1)]),_:1}),l(c,{prop:"start_date",label:"开始日期",width:"110"}),l(c,{prop:"end_date",label:"结束日期",width:"110"}),l(c,{label:"操作",width:"200",fixed:"right"},{default:a(t=>[l(m,{type:"info",link:"",onClick:L=>Ve(t.row,"car")},{default:a(()=>e[43]||(e[43]=[r("查看附件")])),_:2,__:[43]},1032,["onClick"]),l(m,{type:"primary",link:"",onClick:L=>we(t.row,"car")},{default:a(()=>e[44]||(e[44]=[r("上传")])),_:2,__:[44]},1032,["onClick"]),l(m,{type:"danger",link:"",onClick:L=>ye(t.row)},{default:a(()=>e[45]||(e[45]=[r("删除")])),_:2,__:[45]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[Te,J.value]]):E("",!0),b.value==="货运险"?(f(),R(U,{key:2,class:"detail-card"},{default:a(()=>[l(I,{gutter:20},{default:a(()=>[l(g,{span:8},{default:a(()=>[o("div",pa,[o("div",ca,v(x(be.value.commercialTotal)),1),e[46]||(e[46]=o("div",{class:"stat-label"},"商业险总金额",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[o("div",va,[o("div",_a,v(k.value.length),1),e[47]||(e[47]=o("div",{class:"stat-label"},"投保单数量",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[o("div",fa,[o("div",ga,v(x(be.value.averageAmount)),1),e[48]||(e[48]=o("div",{class:"stat-label"},"平均保费",-1))])]),_:1})]),_:1})]),_:1})):E("",!0),b.value==="货运险"?Ye((f(),R(U,{key:3,class:"detail-card"},{default:a(()=>[l(he,{data:k.value,border:"",style:{width:"100%"}},{default:a(()=>[l(c,{prop:"track_no",label:"运输编号",width:"140"}),l(c,{prop:"insurance_no",label:"投保单号","min-width":"180"}),l(c,{prop:"name",label:"货物名称",width:"120"}),l(c,{prop:"quantity",label:"货物数量",width:"100"}),l(c,{prop:"carrier",label:"承运人",width:"120"}),l(c,{prop:"consignee",label:"收货人",width:"120"}),l(c,{prop:"insured",label:"被保人",width:"280"}),l(c,{prop:"commercial_amount",label:"商业险",width:"120"},{default:a(t=>[r(v(x(t.row.commercial_amount)),1)]),_:1}),l(c,{prop:"start_date",label:"开始日期",width:"110"}),l(c,{prop:"end_date",label:"结束日期",width:"110"}),l(c,{label:"操作",width:"230",fixed:"right"},{default:a(t=>[l(m,{type:"info",link:"",onClick:L=>Ve(t.row,"cargo")},{default:a(()=>e[49]||(e[49]=[r("查看附件")])),_:2,__:[49]},1032,["onClick"]),l(m,{type:"primary",link:"",onClick:L=>we(t.row,"cargo")},{default:a(()=>e[50]||(e[50]=[r("上传")])),_:2,__:[50]},1032,["onClick"]),l(m,{type:"danger",link:"",onClick:L=>ye(t.row)},{default:a(()=>e[51]||(e[51]=[r("删除")])),_:2,__:[51]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[Te,J.value]]):E("",!0),l(j,{modelValue:z.value,"onUpdate:modelValue":e[12]||(e[12]=t=>z.value=t),title:"添加车险信息",width:"600px"},{footer:a(()=>[o("span",ya,[l(m,{onClick:e[11]||(e[11]=t=>z.value=!1)},{default:a(()=>e[53]||(e[53]=[r("取消")])),_:1,__:[53]}),l(m,{type:"primary",onClick:Oe,loading:B.value},{default:a(()=>e[54]||(e[54]=[r("确定")])),_:1,__:[54]},8,["loading"])])]),default:a(()=>[l(Fe,{ref_key:"carFormRef",ref:de,model:i.value,rules:Re,"label-width":"120px"},{default:a(()=>[l(_,{label:"车牌号",prop:"car_no"},{default:a(()=>[l(F,{modelValue:i.value.car_no,"onUpdate:modelValue":e[0]||(e[0]=t=>i.value.car_no=t),placeholder:"请输入车牌号"},null,8,["modelValue"])]),_:1}),l(_,{label:"车架号",prop:"vin"},{default:a(()=>[l(F,{modelValue:i.value.vin,"onUpdate:modelValue":e[1]||(e[1]=t=>i.value.vin=t),placeholder:"请输入车架号"},null,8,["modelValue"])]),_:1}),l(_,{label:"投保单号",prop:"insurance_no"},{default:a(()=>[l(F,{modelValue:i.value.insurance_no,"onUpdate:modelValue":e[2]||(e[2]=t=>i.value.insurance_no=t),placeholder:"请输入投保单号"},null,8,["modelValue"])]),_:1}),l(_,{label:"被保人",prop:"insured"},{default:a(()=>[o("div",ba,[l(De,{modelValue:i.value.insured,"onUpdate:modelValue":e[3]||(e[3]=t=>i.value.insured=t),placeholder:"请选择被保人",style:{width:"300px"},disabled:i.value.same_as_borrower},{default:a(()=>[(f(!0),T(ve,null,_e(M.value,t=>(f(),R(Ce,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),l(Ue,{modelValue:i.value.same_as_borrower,"onUpdate:modelValue":e[4]||(e[4]=t=>i.value.same_as_borrower=t),onChange:e[5]||(e[5]=t=>ke("car")),class:"same-borrower-checkbox",style:{"margin-left":"10px"}},{default:a(()=>e[52]||(e[52]=[r(" 同借款人 ")])),_:1,__:[52]},8,["modelValue"])])]),_:1}),l(_,{label:"商业险",prop:"commercial_amount"},{default:a(()=>[l(le,{modelValue:i.value.commercial_amount,"onUpdate:modelValue":e[6]||(e[6]=t=>i.value.commercial_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(_,{label:"交强险",prop:"compulsory_amount"},{default:a(()=>[l(le,{modelValue:i.value.compulsory_amount,"onUpdate:modelValue":e[7]||(e[7]=t=>i.value.compulsory_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(_,{label:"车船税",prop:"vehicle_tax_amount"},{default:a(()=>[l(le,{modelValue:i.value.vehicle_tax_amount,"onUpdate:modelValue":e[8]||(e[8]=t=>i.value.vehicle_tax_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(_,{label:"开始日期",prop:"start_date"},{default:a(()=>[l(ae,{modelValue:i.value.start_date,"onUpdate:modelValue":e[9]||(e[9]=t=>i.value.start_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择开始日期"},null,8,["modelValue"])]),_:1}),l(_,{label:"结束日期",prop:"end_date"},{default:a(()=>[l(ae,{modelValue:i.value.end_date,"onUpdate:modelValue":e[10]||(e[10]=t=>i.value.end_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择结束日期"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(j,{modelValue:S.value,"onUpdate:modelValue":e[26]||(e[26]=t=>S.value=t),title:"添加货运险信息",width:"700px"},{footer:a(()=>[o("span",Va,[l(m,{onClick:e[25]||(e[25]=t=>S.value=!1)},{default:a(()=>e[56]||(e[56]=[r("取消")])),_:1,__:[56]}),l(m,{type:"primary",onClick:Pe,loading:B.value},{default:a(()=>e[57]||(e[57]=[r("确定")])),_:1,__:[57]},8,["loading"])])]),default:a(()=>[l(Fe,{ref_key:"cargoFormRef",ref:me,model:u.value,rules:Be,"label-width":"120px"},{default:a(()=>[l(_,{label:"运输编号",prop:"track_no"},{default:a(()=>[l(F,{modelValue:u.value.track_no,"onUpdate:modelValue":e[13]||(e[13]=t=>u.value.track_no=t),placeholder:"请输入运输编号"},null,8,["modelValue"])]),_:1}),l(_,{label:"投保单号",prop:"insurance_no"},{default:a(()=>[l(F,{modelValue:u.value.insurance_no,"onUpdate:modelValue":e[14]||(e[14]=t=>u.value.insurance_no=t),placeholder:"请输入投保单号"},null,8,["modelValue"])]),_:1}),l(_,{label:"货物名称",prop:"name"},{default:a(()=>[l(F,{modelValue:u.value.name,"onUpdate:modelValue":e[15]||(e[15]=t=>u.value.name=t),placeholder:"请输入货物名称"},null,8,["modelValue"])]),_:1}),l(_,{label:"货物数量",prop:"quantity"},{default:a(()=>[l(F,{modelValue:u.value.quantity,"onUpdate:modelValue":e[16]||(e[16]=t=>u.value.quantity=t),placeholder:"请输入货物数量"},null,8,["modelValue"])]),_:1}),l(_,{label:"承运人",prop:"carrier"},{default:a(()=>[l(F,{modelValue:u.value.carrier,"onUpdate:modelValue":e[17]||(e[17]=t=>u.value.carrier=t),placeholder:"请输入承运人"},null,8,["modelValue"])]),_:1}),l(_,{label:"收货人",prop:"consignee"},{default:a(()=>[l(F,{modelValue:u.value.consignee,"onUpdate:modelValue":e[18]||(e[18]=t=>u.value.consignee=t),placeholder:"请输入收货人"},null,8,["modelValue"])]),_:1}),l(_,{label:"被保人",prop:"insured"},{default:a(()=>[o("div",wa,[l(De,{modelValue:u.value.insured,"onUpdate:modelValue":e[19]||(e[19]=t=>u.value.insured=t),placeholder:"请选择被保人",style:{width:"300px"},disabled:u.value.same_as_borrower},{default:a(()=>[(f(!0),T(ve,null,_e(M.value,t=>(f(),R(Ce,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),l(Ue,{modelValue:u.value.same_as_borrower,"onUpdate:modelValue":e[20]||(e[20]=t=>u.value.same_as_borrower=t),onChange:e[21]||(e[21]=t=>ke("cargo")),class:"same-borrower-checkbox",style:{"margin-left":"10px"}},{default:a(()=>e[55]||(e[55]=[r(" 同借款人 ")])),_:1,__:[55]},8,["modelValue"])])]),_:1}),l(_,{label:"商业险",prop:"commercial_amount"},{default:a(()=>[l(le,{modelValue:u.value.commercial_amount,"onUpdate:modelValue":e[22]||(e[22]=t=>u.value.commercial_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(_,{label:"开始日期",prop:"start_date"},{default:a(()=>[l(ae,{modelValue:u.value.start_date,"onUpdate:modelValue":e[23]||(e[23]=t=>u.value.start_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择开始日期"},null,8,["modelValue"])]),_:1}),l(_,{label:"结束日期",prop:"end_date"},{default:a(()=>[l(ae,{modelValue:u.value.end_date,"onUpdate:modelValue":e[24]||(e[24]=t=>u.value.end_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择结束日期"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(j,{modelValue:W.value,"onUpdate:modelValue":e[27]||(e[27]=t=>W.value=t),title:"批量导入投保信息",width:"600px"},{footer:a(()=>[o("span",Ia,[l(m,{onClick:We},{default:a(()=>e[66]||(e[66]=[r("取消")])),_:1,__:[66]}),l(m,{type:"primary",onClick:Je,loading:te.value,disabled:!Y.value},{default:a(()=>e[67]||(e[67]=[r(" 开始导入 ")])),_:1,__:[67]},8,["loading","disabled"])])]),default:a(()=>[o("div",ka,[o("div",xa,[l(G,{title:"导入说明",type:"info","show-icon":"",closable:!1},{default:a(()=>e[58]||(e[58]=[o("div",{class:"tips-content"},[o("p",null,"1. 请先下载模板，按照模板格式填写数据"),o("p",null,"2. 支持 .xlsx 和 .xls 格式文件"),o("p",null,"3. 必填字段不能为空，金额字段请填写数字"),o("p",null,"4. 日期格式：YYYY-MM-DD，如：2024-01-01")],-1)])),_:1,__:[58]})]),l(ce,{ref_key:"excelUploadRef",ref:$,class:"upload-demo",drag:"","auto-upload":!1,limit:1,accept:".xlsx,.xls","on-change":Ge,"file-list":se.value},{tip:a(()=>e[59]||(e[59]=[o("div",{class:"el-upload__tip"}," 只能上传 .xlsx/.xls 文件，且不超过 10MB ",-1)])),default:a(()=>[l(d,{class:"el-icon--upload"},{default:a(()=>[l(V(fe))]),_:1}),e[60]||(e[60]=o("div",{class:"el-upload__text"},[r(" 将Excel文件拖到此处，或"),o("em",null,"点击上传")],-1))]),_:1,__:[60]},8,["file-list"]),w.value?(f(),T("div",ha,[l(U,null,{header:a(()=>e[61]||(e[61]=[o("span",null,"导入结果",-1)])),default:a(()=>[o("div",Ca,[l(I,{gutter:20},{default:a(()=>[l(g,{span:8},{default:a(()=>[o("div",Da,[o("div",Ua,v(w.value.total),1),e[62]||(e[62]=o("div",{class:"stat-label"},"总数",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[o("div",Fa,[o("div",Ta,v(w.value.success),1),e[63]||(e[63]=o("div",{class:"stat-label"},"成功",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[o("div",Ea,[o("div",Ya,v(w.value.fail),1),e[64]||(e[64]=o("div",{class:"stat-label"},"失败",-1))])]),_:1})]),_:1})]),w.value.errors&&w.value.errors.length>0?(f(),T("div",Ma,[l(rl,{"content-position":"left"},{default:a(()=>e[65]||(e[65]=[r("错误详情")])),_:1,__:[65]}),(f(!0),T(ve,null,_e(w.value.errors,(t,L)=>(f(),T("div",{class:"error-item",key:L},[l(pe,{type:"danger",size:"small"},{default:a(()=>[r(v(t),1)]),_:2},1024)]))),128))])):E("",!0)]),_:1})])):E("",!0)])]),_:1},8,["modelValue"]),l(j,{modelValue:A.value,"onUpdate:modelValue":e[28]||(e[28]=t=>A.value=t),title:"批量上传行驶证",width:"700px"},{footer:a(()=>[o("span",$a,[l(m,{onClick:Xe},{default:a(()=>e[72]||(e[72]=[r("取消")])),_:1,__:[72]}),l(m,{type:"primary",onClick:Ze,loading:O.value,disabled:h.value.length===0},{default:a(()=>e[73]||(e[73]=[r(" 开始上传识别 ")])),_:1,__:[73]},8,["loading","disabled"])])]),default:a(()=>[o("div",La,[o("div",Ra,[l(G,{title:"上传说明",type:"info","show-icon":"",closable:!1},{default:a(()=>e[68]||(e[68]=[o("div",{class:"tips-content"},[o("p",null,"1. 支持批量上传多张行驶证图片"),o("p",null,"2. 支持 JPG、PNG、BMP、TIFF、WEBP 格式"),o("p",null,"3. 每张图片不超过5MB"),o("p",null,"4. 系统将自动OCR识别行驶证信息并匹配车险记录"),o("p",null,"5. 请确保先录入车险信息再上传对应的行驶证")],-1)])),_:1,__:[68]})]),l(ce,{ref_key:"driverLicenseUploadRef",ref:oe,class:"upload-demo",drag:"",multiple:"","auto-upload":!1,limit:0,accept:"image/*","on-change":Ke,"on-remove":Qe,"file-list":ne.value},{tip:a(()=>e[69]||(e[69]=[o("div",{class:"el-upload__tip"}," 支持多张图片同时上传，每张不超过5MB ",-1)])),default:a(()=>[l(d,{class:"el-icon--upload"},{default:a(()=>[l(V(fe))]),_:1}),e[70]||(e[70]=o("div",{class:"el-upload__text"},[r(" 将行驶证图片拖到此处，或"),o("em",null,"点击上传")],-1))]),_:1,__:[70]},8,["file-list"]),O.value?(f(),T("div",Ba,[l(G,{title:"正在上传处理中...",type:"info","show-icon":"",closable:!1},{default:a(()=>[o("div",qa,[o("p",null,"已选择 "+v(h.value.length)+" 张图片",1),e[71]||(e[71]=o("p",null,"正在后台进行OCR识别和匹配处理，请稍后查看结果",-1))])]),_:1})])):E("",!0)])]),_:1},8,["modelValue"]),l(j,{modelValue:P.value,"onUpdate:modelValue":e[29]||(e[29]=t=>P.value=t),title:"批量上传投保单",width:"700px"},{footer:a(()=>[o("span",za,[l(m,{onClick:tl},{default:a(()=>e[78]||(e[78]=[r("取消")])),_:1,__:[78]}),l(m,{type:"primary",onClick:sl,loading:H.value,disabled:C.value.length===0},{default:a(()=>e[79]||(e[79]=[r(" 开始上传识别 ")])),_:1,__:[79]},8,["loading","disabled"])])]),default:a(()=>[o("div",Aa,[o("div",Oa,[l(G,{title:"上传说明",type:"info","show-icon":"",closable:!1},{default:a(()=>e[74]||(e[74]=[o("div",{class:"tips-content"},[o("p",null,"1. 支持批量上传多张投保单图片"),o("p",null,"2. 支持 JPG、PNG、BMP、TIFF、WEBP 格式"),o("p",null,"3. 每张图片不超过5MB"),o("p",null,"4. 系统将自动OCR识别投保单信息并匹配保险记录"),o("p",null,"5. 请确保先录入保险信息再上传对应的投保单")],-1)])),_:1,__:[74]})]),l(ce,{ref_key:"insuranceFormUploadRef",ref:re,class:"upload-demo",drag:"",multiple:"","auto-upload":!1,limit:0,accept:"image/*","on-change":ll,"on-remove":al,"file-list":ue.value},{tip:a(()=>e[75]||(e[75]=[o("div",{class:"el-upload__tip"}," 支持多张图片同时上传，每张不超过5MB ",-1)])),default:a(()=>[l(d,{class:"el-icon--upload"},{default:a(()=>[l(V(fe))]),_:1}),e[76]||(e[76]=o("div",{class:"el-upload__text"},[r(" 将投保单图片拖到此处，或"),o("em",null,"点击上传")],-1))]),_:1,__:[76]},8,["file-list"]),H.value?(f(),T("div",Pa,[l(G,{title:"正在上传处理中...",type:"info","show-icon":"",closable:!1},{default:a(()=>[o("div",Na,[o("p",null,"已选择 "+v(C.value.length)+" 张图片",1),e[77]||(e[77]=o("p",null,"正在后台进行OCR识别和匹配处理，请稍后查看结果",-1))])]),_:1})])):E("",!0)])]),_:1},8,["modelValue"]),l(Hl,{visible:ie.value,"onUpdate:visible":e[30]||(e[30]=t=>ie.value=t),title:K.value,"order-id":V(y).params.id,"ref-id":q.value,type:N.value,onSuccess:D},null,8,["visible","title","order-id","ref-id","type"]),l(Kl,{visible:Q.value,"onUpdate:visible":e[31]||(e[31]=t=>Q.value=t),title:K.value,attachments:X.value,"order-id":V(y).params.id,"ref-id":q.value,type:N.value,onRefresh:Ne,onDelete:ze,"allow-delete":!0},null,8,["visible","title","attachments","order-id","ref-id","type"])])}}},mt=ul(Sa,[["__scopeId","data-v-d25b818d"]]);export{mt as default};
