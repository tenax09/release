import{_ as z}from"./index-520d6774.js";/* empty css                             *//* empty css               *//* empty css                *//* empty css                    */import{b as G}from"./caxt-6ffa7e83.js";import{r as d,b as M,l as c,B as N,F as l,G as a,p as b,S as D,ag as O,C as n,O as s,D as x,E as i,K as P,aC as A,a6 as L,a5 as S,a7 as J,am as K,az as X,aA as H}from"./element-plus-e9590f8a.js";const Q={class:"contact-sign-container"},W={key:1},Y={class:"logs-container"},Z={class:"log-content"},$={class:"log-data"},ee="#",ae={__name:"index",setup(te){const f=d(),C=d(),g=d(!1),p=d([]),r=d(null),v=d(""),o=M({title:"",companyName:"",contract:null}),F={title:[{required:!0,message:"请输入合同标题",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],companyName:[{required:!0,message:"请输入公司名称",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],contract:[{required:!0,message:"请选择合同文件",trigger:"change"}]},V=t=>{if(o.contract=t.raw,t.size>32*1024*1024){i.error("文件大小不能超过 32MB"),p.value=[],o.contract=null;return}if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png"].includes(t.raw.type)){i.error("不支持的文件格式"),p.value=[],o.contract=null;return}},B=()=>{o.contract=null},I=async()=>{if(!o.contract){i.error("请选择合同文件");return}try{await f.value.validate()}catch{return}g.value=!0;try{const t=new FormData;t.append("contract",o.contract),t.append("title",o.title),t.append("companyName",o.companyName);const{data:e}=await G(t);r.value=e,e.error&&R(e.error),i.success("合同签署成功！"),k()}catch(t){console.error("签署失败:",t),i.error("签署失败: "+(t.message||"未知错误"))}finally{g.value=!1}},k=()=>{f.value.resetFields(),p.value=[],o.contract=null,C.value.clearFiles()},h=()=>{var t;(t=r.value)!=null&&t.downloadUrl&&window.open(r.value.downloadUrl,"_blank")},R=t=>{t&&(v.value=t)};return(t,e)=>{const u=P,U=A,m=L,E=S,T=J,y=O,j=K,_=X,q=H;return c(),N("div",Q,[l(y,{class:"box-card"},{header:a(()=>e[2]||(e[2]=[n("div",{class:"card-header"},[n("span",null,"信托合同签署")],-1)])),default:a(()=>[l(T,{ref_key:"formRef",ref:f,model:o,rules:F,"label-width":"120px",class:"contact-form"},{default:a(()=>[l(m,{label:"合同文件",prop:"contract"},{default:a(()=>[l(U,{ref_key:"uploadRef",ref:C,class:"upload-demo",action:ee,"auto-upload":!1,"on-change":V,"on-remove":B,"file-list":p.value,limit:1,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png"},{trigger:a(()=>[l(u,{type:"primary"},{default:a(()=>e[3]||(e[3]=[s("选择文件")])),_:1,__:[3]})]),tip:a(()=>e[4]||(e[4]=[n("div",{class:"el-upload__tip"}," 支持 PDF、DOC、DOCX、JPG、PNG 格式，文件大小不超过 32MB ",-1)])),_:1},8,["file-list"])]),_:1}),l(m,{label:"合同标题",prop:"title"},{default:a(()=>[l(E,{modelValue:o.title,"onUpdate:modelValue":e[0]||(e[0]=w=>o.title=w),placeholder:"请输入合同标题",clearable:"",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(m,{label:"公司名称",prop:"companyName"},{default:a(()=>[l(E,{modelValue:o.companyName,"onUpdate:modelValue":e[1]||(e[1]=w=>o.companyName=w),placeholder:"请输入公司名称",clearable:"",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(m,null,{default:a(()=>[l(u,{type:"primary",loading:g.value,onClick:I},{default:a(()=>e[5]||(e[5]=[s(" 发起签署 ")])),_:1,__:[5]},8,["loading"]),l(u,{onClick:k},{default:a(()=>e[6]||(e[6]=[s("重置")])),_:1,__:[6]})]),_:1})]),_:1},8,["model"])]),_:1}),r.value?(c(),b(y,{key:0,class:"result-card",style:{"margin-top":"20px"}},{header:a(()=>e[7]||(e[7]=[n("div",{class:"card-header"},[n("span",null,"签署结果")],-1)])),default:a(()=>[l(q,{column:2,border:""},{default:a(()=>[l(_,{label:"签署状态"},{default:a(()=>[l(j,{type:"success"},{default:a(()=>e[8]||(e[8]=[s("签署成功")])),_:1,__:[8]})]),_:1}),l(_,{label:"合同ID"},{default:a(()=>[s(x(r.value.contractId),1)]),_:1}),l(_,{label:"文档ID"},{default:a(()=>[s(x(r.value.documentId),1)]),_:1}),l(_,{label:"下载链接"},{default:a(()=>[r.value.downloadUrl?(c(),b(u,{key:0,type:"primary",size:"small",onClick:h},{default:a(()=>e[9]||(e[9]=[s(" 下载签署后的合同 ")])),_:1,__:[9]})):(c(),N("span",W,"暂无下载链接"))]),_:1})]),_:1})]),_:1})):D("",!0),v.value?(c(),b(y,{key:1,class:"logs-card",style:{"margin-top":"20px"}},{header:a(()=>e[10]||(e[10]=[n("div",{class:"card-header"},[n("span",null,"操作日志")],-1)])),default:a(()=>[n("div",Y,[n("div",Z,[n("pre",$,x(v.value),1)])])]),_:1})):D("",!0)])}}},ie=z(ae,[["__scopeId","data-v-067aa97c"]]);export{ie as default};
