import{_ as Ze,b as et,u as tt,a as at}from"./index-39d81bcc.js";/* empty css               *//* empty css                 *//* empty css                         *//* empty css                        *//* empty css                     *//* empty css               *//* empty css                *//* empty css                             *//* empty css                   *//* empty css                       */import{f as V,a as v}from"./format-20468769.js";import{a as lt,r as nt,b as ve,d as st,f as rt,h as ot}from"./order-a79ca20f.js";import{A as X,a as Y,d as it,u as ut}from"./AttachmentUpload-b3b6793c.js";import{m as dt}from"./receivable-21793138.js";import{r as w,ae as ct,l as f,B as h,C as c,F as t,G as a,p as C,S as k,E as b,aE as _t,ag as pt,ah as mt,M as ft,u as _,O as o,af as ye,D as r,ac as vt,av as yt,aF as gt,H as bt,I as ht,J as z,K as wt,az as kt,am as Ct,aA as xt,ao as $t,al as Et,an as Mt,ap as Vt,aq as At,ar as It,a5 as St,a6 as Tt,a7 as Ut,ai as Dt}from"./element-plus-eb4b90a0.js";/* empty css                    */const Pt={class:"order-detail"},Bt={class:"page-header"},Nt={class:"header-actions"},zt={class:"overview-section"},Rt={class:"key-metrics"},Ft={class:"metric-item"},Ot={class:"metric-value"},Lt={class:"metric-item"},qt={class:"metric-value"},Gt={class:"metric-item"},Ht={class:"metric-value"},Jt={class:"metric-item"},Kt={class:"metric-value"},Qt={class:"metric-item"},jt={class:"metric-value"},Wt={key:0,class:"empty-state"},Xt={key:0,class:"empty-state"},Yt={style:{color:"#67c23a","font-weight":"bold"}},Zt={style:{color:"#e6a23c","font-weight":"bold"}},ea={style:{color:"#409eff"}},ta={style:{color:"#67c23a"}},aa={key:0,style:{color:"#67c23a","font-weight":"bold"}},la={key:1},na={key:0,style:{color:"#f56c6c"}},sa={key:1},ra={key:0,style:{color:"#f56c6c"}},oa={key:1},ia={key:0,style:{color:"#f56c6c","font-weight":"bold"}},ua={key:1},da={key:1,style:{color:"#67c23a"}},ca={class:"log-content"},_a={class:"operator"},pa={class:"action"},ma={key:1,class:"empty-logs"},fa={class:"dialog-footer"},va={class:"payment-info"},ya={key:1,class:"payment-section"},ga={key:2,class:"payment-section"},ba={key:3,class:"payment-section"},ha={class:"remark-content"},wa={class:"dialog-footer"},ka={__name:"detail",setup(Ca){const ge=et(),Z=tt(),A=w(!1),n=w({}),I=at(),T=w(!1),R=w(null),F=w(!1),U=w({remark:""}),B=w(!1),O=w(!1),m=w({}),L=w(!1),q=w(!1),G=w(!1),H=w(!1),J=w(!1),K=w(!1),x=w(null),be={remark:[{required:!0,message:"请输入备注内容",trigger:"blur"}]},S=async()=>{A.value=!0;try{const s=await lt(ge.params.id);n.value=s.data,n.value.total_commercial=0,n.value.insurance_type==="车险"&&n.value.car_insurance&&n.value.car_insurance.length>0?n.value.total_commercial=n.value.car_insurance.reduce((e,i)=>e+(i.commercial_amount||0),0):n.value.insurance_type==="货运险"&&n.value.cargo_insurance&&n.value.cargo_insurance.length>0&&(n.value.total_commercial=n.value.cargo_insurance.reduce((e,i)=>e+(i.commercial_amount||0),0))}catch{b.error("获取订单详情失败")}A.value=!1},he=()=>{Z.back()},D=async()=>{try{let s="",e="下一状态";n.value.status==="待初审"?(s="初审通过",e="待复审"):n.value.status==="待复审"&&(s="复审通过",e="待客户签约"),await z.confirm(`确定要将订单状态从 [${n.value.status}] 更新为 [${e}] 吗？`,"审核确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),A.value=!0,await nt(n.value.id,{audit_note:s}),b.success("审核成功"),S()}catch(s){s!=="cancel"&&b.error("审核失败")}A.value=!1},we=s=>{const{columns:e,data:i}=s,p=[];return e.forEach((u,g)=>{if(g===0){p[g]="合计";return}if(u.property==="total_amount"){const y=i.reduce((E,M)=>E+(M.commercial_amount||0)+(M.compulsory_amount||0)+(M.vehicle_tax_amount||0),0);p[g]=v(y);return}const $=i.map(y=>Number(y[u.property]));if($.every(y=>isNaN(y)))p[g]="-";else{const y=$.reduce((E,M)=>{const d=Number(M);return isNaN(d)?E:E+d},0);u.property==="commercial_amount"||u.property==="compulsory_amount"||u.property==="vehicle_tax_amount"?p[g]=v(y):p[g]="-"}}),p},ke=s=>{const{columns:e,data:i}=s,p=[];return e.forEach((u,g)=>{if(g===0){p[g]="合计";return}const $=i.map(y=>Number(y[u.property]));if($.every(y=>isNaN(y)))p[g]="-";else{const y=$.reduce((E,M)=>{const d=Number(M);return isNaN(d)?E:E+d},0);u.property==="commercial_amount"?p[g]=v(y):p[g]="-"}}),p},ee=s=>({正常:"success",结清退保:"success",逾期退保:"danger",提前结清:"success",逾期结清:"danger",退保结清:"danger"})[s]||"info",Ce=s=>({待审核:"warning",待复审:"warning",待客户签约:"info",待资方签约:"info",待放款:"warning",已放款:"success",已退保:"danger",已结清:"success",已作废:"danger"})[s]||"info",xe=s=>({create:"primary",update:"success",review:"warning",delete:"danger",info:"info"})[s]||"info",Q=()=>{Z.push(`/order/insurance/${n.value.id}`)},$e=(s,e)=>{if(!n.value.attachments||n.value.attachments.length===0){b.warning("暂无附件可查看");return}const i=s.find(p=>p.remark===e);if(!i){b.warning("暂无附件可查看");return}window.open(`/api/admin/attachments/${i.id}/view`)},Ee=()=>{W(n.value.attachments,"缴费通知书")?$e(n.value.attachments,"缴费通知书"):Me("缴费通知书")},Me=s=>{const e=document.createElement("input");e.type="file",e.accept="*/*",e.style.display="none",e.onchange=async i=>{const p=i.target.files[0];if(p){try{const u=new FormData;u.append("files",p),u.append("remarks",s),await ut(n.value.id,0,u),b.success("上传成功"),S()}catch(u){console.error("上传失败:",u),b.error("上传失败")}document.body.removeChild(e)}},document.body.appendChild(e),e.click()},Ve=async s=>{try{await it(s)}catch(e){b.error("删除失败："+(e.message||"未知错误"))}},Ae=()=>{L.value=!0},Ie=()=>{q.value=!0},j=()=>{b.success("附件上传成功")},Se=s=>{ve(n.value.id,s.id).then(e=>{x.value=e.data,G.value=!0})},Te=s=>{x.value=s,H.value=!0},Ue=s=>{ve(n.value.id,s.id).then(e=>{x.value=e.data,J.value=!0})},De=s=>{x.value=s,K.value=!0},Pe=async()=>{try{await z.confirm("确定要作废该订单吗？作废后不可恢复！","作废确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),A.value=!0,await st(n.value.id),b.success("订单已作废"),S()}catch(s){s!=="cancel"&&b.error("作废失败")}A.value=!1},te=(s,e)=>{if(!s){b.warning(`${e}链接不存在`);return}try{if(typeof window<"u"&&window.open)window.open(s,"_blank","noopener,noreferrer");else throw new Error("window.open不可用")}catch(i){console.error(`${e}失败:`,i);try{const p=document.createElement("a");p.href=s,p.target="_blank",p.rel="noopener noreferrer",p.style.display="none",document.body.appendChild(p),p.click(),document.body.removeChild(p),b.success(`${e}链接已打开`)}catch(p){console.error("备选方案失败:",p)}}},Be=s=>{if(!s){b.warning("签署链接不存在");return}ae(s,"签署链接")},ae=(s,e)=>{const i=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);navigator.clipboard&&(window.isSecureContext||i)?navigator.clipboard.writeText(s).then(()=>{b.success(`${e}已复制到剪贴板`)}).catch(p=>{console.error("使用 Clipboard API 复制失败:",p),le(s,e)}):le(s,e)},le=(s,e)=>{try{const i=document.createElement("textarea");i.value=s,i.style.position="fixed",i.style.left="-999999px",i.style.top="-999999px",document.body.appendChild(i),i.focus(),i.select();const p=document.execCommand("copy");if(document.body.removeChild(i),p)b.success(`${e}已复制到剪贴板`);else throw new Error("execCommand 复制失败")}catch(i){console.error("复制失败:",i),z.alert(s,`请手动复制${e}`,{confirmButtonText:"确定",type:"info",customClass:"copy-url-dialog"})}},Ne=s=>({已签署:"success",未签署:"warning",已作废:"danger"})[s]||"info",ze=s=>({首付:"primary",还款:"success",利息:"warning",本金:"info",退保:"danger"})[s]||"info",Re=s=>({微信:"success",支付宝:"primary",银行卡:"warning"})[s]||"info",Fe=s=>({待收款:"warning",已收款:"success",已逾期:"danger"})[s]||"info",Oe=async s=>{try{const{value:e}=await z.prompt(`请输入第${s.period}期的实际收款金额`,"标记收款",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\d+(\.\d{1,2})?$/,inputErrorMessage:"请输入正确的金额格式",inputValue:s.amount.toString()});if(!e){b.warning("请输入收款金额");return}A.value=!0,await dt(s.id,{actual_amount:parseFloat(e),actual_date:new Date().toISOString().split("T")[0]}),b.success("标记收款成功"),S()}catch(e){e!=="cancel"&&b.error("标记收款失败")}A.value=!1},Le=()=>{U.value.remark="",T.value=!0},qe=async()=>{R.value&&await R.value.validate(async s=>{if(s){F.value=!0;try{await rt(n.value.id,{remark:U.value.remark}),b.success("添加备注成功"),T.value=!1,S()}catch(e){b.error("添加备注失败："+(e.message||"未知错误"))}F.value=!1}})},Ge=async()=>{if(!n.value.id){b.warning("订单信息不存在");return}O.value=!0;try{const s=await ot(n.value.id);m.value=s.data,B.value=!0,b.success("前置款信息生成成功")}catch(s){b.error("生成前置款信息失败："+(s.message||"未知错误"))}O.value=!1},He=()=>{if(!m.value.batch_no){b.warning("暂无前置款信息可复制");return}const s=`
批次号：${m.value.batch_no}
借款人：${m.value.borrower}
${m.value.vehicle_info}
总放款金额：${v(m.value.total_loan_amount)}

支付服务费：${v(m.value.service_fee)}
户名：${m.value.service_account_name}
账户：${m.value.service_account_no}
开户行：${m.value.service_bank_name}

支付首付款：${v(m.value.total_down_payment)}
${m.value.down_payment_detail}
户名：${m.value.funder_account_name}
账户：${m.value.funder_account_no}
开户行：${m.value.funder_bank_name}

${m.value.remark||""}
  `.trim();ae(s,"前置款信息")},Je=s=>{const{columns:e,data:i}=s,p=[];return e.forEach((u,g)=>{if(g===0){p[g]="合计";return}const $=i.map(y=>Number(y[u.property]));if($.every(y=>isNaN(y)))p[g]="-";else{const y=$.reduce((E,M)=>{const d=Number(M);return isNaN(d)?E:E+d},0);u.property==="amount"||u.property==="principal_amount"||u.property==="interest_amount"||u.property==="penalty_amount"||u.property==="forfeit_amount"||u.property==="actual_amount"?p[g]=v(y):p[g]="-"}}),p},W=(s,e)=>!s||s.length===0?!1:s.some(i=>i.remark===e);return ct(()=>{S()}),(s,e)=>{var re,oe,ie,ue,de,ce,_e,pe,me,fe;const i=wt,p=_t,u=kt,g=Ct,$=xt,y=pt,E=$t,M=mt,d=Et,P=Mt,Ke=Vt,Qe=At,je=It,We=St,Xe=Tt,Ye=Ut,ne=ft,se=Dt;return f(),h("div",Pt,[c("div",Bt,[t(p,{onBack:he,title:n.value.order_no||"订单详情"},{extra:a(()=>[c("div",Nt,[n.value.status==="待初审"&&_(I).riskBasicPrivate?(f(),C(i,{key:0,type:"success",onClick:D},{default:a(()=>e[13]||(e[13]=[o("初审通过")])),_:1,__:[13]})):k("",!0),n.value.status==="待复审"&&_(I).riskManagerPrivate?(f(),C(i,{key:1,type:"warning",onClick:D},{default:a(()=>e[14]||(e[14]=[o("复审通过")])),_:1,__:[14]})):k("",!0),n.value.status==="待放款"&&_(I).operationManagerPrivate?(f(),C(i,{key:2,type:"info",onClick:D},{default:a(()=>e[15]||(e[15]=[o("放款")])),_:1,__:[15]})):k("",!0),n.value.status==="已放款"&&_(I).operationManagerPrivate?(f(),C(i,{key:3,type:"success",onClick:D},{default:a(()=>e[16]||(e[16]=[o("结清")])),_:1,__:[16]})):k("",!0),n.value.status!=="已作废"&&(_(I).operationManagerPrivate||_(I).riskManagerPrivate)?(f(),C(i,{key:4,type:"danger",onClick:Pe},{default:a(()=>e[17]||(e[17]=[o("作废订单")])),_:1,__:[17]})):k("",!0),_(I).superPrivate?(f(),C(i,{key:5,type:"primary",onClick:D},{default:a(()=>e[18]||(e[18]=[o("下一状态（调试用）")])),_:1,__:[18]})):k("",!0),t(i,{type:"default",onClick:Q},{default:a(()=>e[19]||(e[19]=[o("管理投保单")])),_:1,__:[19]}),t(i,{type:"default",onClick:Ge},{default:a(()=>e[20]||(e[20]=[o("生成前置款")])),_:1,__:[20]}),t(i,{type:"default",onClick:Le},{default:a(()=>e[21]||(e[21]=[o("添加日志")])),_:1,__:[21]}),t(i,{type:"default",onClick:e[0]||(e[0]=l=>Ae())},{default:a(()=>e[22]||(e[22]=[o("查看附件")])),_:1,__:[22]}),t(i,{type:"default",onClick:e[1]||(e[1]=l=>Ie())},{default:a(()=>e[23]||(e[23]=[o("上传附件")])),_:1,__:[23]})])]),_:1},8,["title"])]),c("div",zt,[t(M,{gutter:20},{default:a(()=>[t(E,{span:18},{default:a(()=>[ye((f(),C(y,{class:"info-card"},{default:a(()=>[t($,{column:2,border:""},{default:a(()=>[t(u,{label:"订单编号"},{default:a(()=>[o(r(n.value.order_no),1)]),_:1}),t(u,{label:"订单状态"},{default:a(()=>[t(g,{type:Ce(n.value.status)},{default:a(()=>[o(r(n.value.status),1)]),_:1},8,["type"]),e[24]||(e[24]=c("span",{style:{"margin-left":"10px"}},null,-1)),t(g,{style:{cursor:"pointer"},onClick:Ee,type:W(n.value.attachments,"缴费通知书")?"success":"info"},{default:a(()=>[o(r(W(n.value.attachments,"缴费通知书")?"缴费通知书已上传":"缴费通知书未上传"),1)]),_:1},8,["type"])]),_:1,__:[24]}),t(u,{label:"保险类型"},{default:a(()=>[o(r(n.value.insurance_type),1)]),_:1}),t(u,{label:"借款主体"},{default:a(()=>{var l;return[o(r(n.value.loan_name||((l=n.value.user)==null?void 0:l.company_name)),1)]}),_:1}),t(u,{label:"业务归属"},{default:a(()=>{var l;return[o(r(n.value.sell_mode==="直销"?"直销":((l=n.value.agent)==null?void 0:l.company_name)||"无"),1)]}),_:1}),t(u,{label:"销售员"},{default:a(()=>[o(r(n.value.seller),1)]),_:1}),t(u,{label:"服务费"},{default:a(()=>[o(r(n.value.service_fee)+"%",1)]),_:1}),t(u,{label:"渠道成本"},{default:a(()=>[o(r(n.value.agent_cost)+"%",1)]),_:1}),t(u,{span:2,label:"金融产品"},{default:a(()=>{var l;return[o(r((l=n.value.product)==null?void 0:l.name),1)]}),_:1}),t(u,{label:"承保机构",span:2},{default:a(()=>{var l;return[o(r((l=n.value.insurer)==null?void 0:l.name),1)]}),_:1})]),_:1}),t($,{column:2,border:""},{default:a(()=>[t(u,{label:"进件时间"},{default:a(()=>[o(r(_(V)(n.value.created_at)),1)]),_:1}),t(u,{label:"初审时间"},{default:a(()=>[o(r(_(V)(n.value.first_review_time)||"-"),1)]),_:1}),t(u,{label:"复审时间"},{default:a(()=>[o(r(_(V)(n.value.second_review_time)||"-"),1)]),_:1}),t(u,{label:"用户签约时间"},{default:a(()=>[o(r(_(V)(n.value.user_sign_time)||"-"),1)]),_:1}),t(u,{label:"资方签约时间"},{default:a(()=>[o(r(_(V)(n.value.funder_sign_time)||"-"),1)]),_:1}),t(u,{label:"放款时间"},{default:a(()=>[o(r(_(V)(n.value.loan_time)||"-"),1)]),_:1}),t(u,{label:"最后更新时间"},{default:a(()=>[o(r(_(V)(n.value.updated_at)),1)]),_:1})]),_:1})]),_:1})),[[se,A.value]])]),_:1}),t(E,{span:6},{default:a(()=>[t(y,{class:"key-metrics-card"},{default:a(()=>[c("div",Rt,[c("div",Ft,[e[25]||(e[25]=c("div",{class:"metric-label"},"总保费",-1)),c("div",Ot,r(_(v)(n.value.total_premium)),1)]),c("div",Lt,[e[26]||(e[26]=c("div",{class:"metric-label"},"商业险",-1)),c("div",qt,r(_(v)(n.value.total_commercial)),1)]),c("div",Gt,[e[27]||(e[27]=c("div",{class:"metric-label"},"首付金额",-1)),c("div",Ht,r(_(v)(n.value.down_payment)),1)]),c("div",Jt,[e[28]||(e[28]=c("div",{class:"metric-label"},"贷款金额",-1)),c("div",Kt,r(_(v)(n.value.loan_amount)),1)]),c("div",Qt,[e[29]||(e[29]=c("div",{class:"metric-label"},"服务费",-1)),c("div",jt,r(_(v)(n.value.service_fee*n.value.total_commercial/100)),1)])])]),_:1})]),_:1})]),_:1})]),n.value.insurance_type==="车险"?(f(),C(y,{key:0,class:"detail-card insurance-card"},{default:a(()=>[t(P,{data:n.value.car_insurance||[],border:"",style:{width:"100%"},"empty-text":"暂无车险投保信息","max-height":"300","show-summary":n.value.car_insurance&&n.value.car_insurance.length>0,"sum-text":"合计","summary-method":we},{default:a(()=>[t(d,{prop:"status",label:"状态",width:"100",align:"center"},{default:a(({row:l})=>[t(g,{type:ee(l.status)},{default:a(()=>[o(r(l.status),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"car_no",label:"车牌号",width:"120",align:"left"}),t(d,{prop:"vin",label:"车架号",width:"180",align:"left"}),t(d,{prop:"insured",label:"被保人",width:"170",align:"left"}),t(d,{prop:"commercial_amount",label:"商业险",width:"110",align:"right"},{default:a(({row:l})=>[o(r(_(v)(l.commercial_amount)),1)]),_:1}),t(d,{prop:"compulsory_amount",label:"交强险",width:"110",align:"center"},{default:a(({row:l})=>[o(r(_(v)(l.compulsory_amount)),1)]),_:1}),t(d,{prop:"vehicle_tax_amount",label:"车船税",width:"110",align:"center"},{default:a(({row:l})=>[o(r(_(v)(l.vehicle_tax_amount)),1)]),_:1}),t(d,{prop:"total_amount",label:"总保费",width:"110",align:"center"},{default:a(({row:l})=>[o(r(_(v)((l.commercial_amount||0)+(l.compulsory_amount||0)+(l.vehicle_tax_amount||0))),1)]),_:1}),t(d,{label:"操作",width:"200",align:"center",fixed:"right"},{default:a(({row:l})=>[t(i,{type:"info",size:"small",onClick:N=>Se(l)},{default:a(()=>e[30]||(e[30]=[o(" 查看附件 ")])),_:2,__:[30]},1032,["onClick"]),t(i,{type:"primary",size:"small",onClick:N=>Te(l)},{default:a(()=>e[31]||(e[31]=[o(" 上传附件 ")])),_:2,__:[31]},1032,["onClick"])]),_:1})]),_:1},8,["data","show-summary"]),!n.value.car_insurance||n.value.car_insurance.length===0?(f(),h("div",Wt,[t(i,{type:"primary",onClick:Q},{default:a(()=>e[32]||(e[32]=[o("录入车险信息")])),_:1,__:[32]})])):k("",!0)]),_:1})):k("",!0),n.value.insurance_type==="货运险"?(f(),C(y,{key:1,class:"detail-card insurance-card"},{default:a(()=>[t(P,{data:n.value.cargo_insurance||[],border:"",style:{width:"100%"},"empty-text":"暂无货运险投保信息","max-height":"300","show-summary":n.value.cargo_insurance&&n.value.cargo_insurance.length>0,"sum-text":"合计","summary-method":ke},{default:a(()=>[t(d,{prop:"status",label:"状态",width:"100",align:"center"},{default:a(({row:l})=>[t(g,{type:ee(l.status)},{default:a(()=>[o(r(l.status),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"track_no",label:"运输编号",width:"200",align:"left"}),t(d,{prop:"insured",label:"被保人",width:"170",align:"left"}),t(d,{prop:"name",label:"货物名称",width:"150",align:"left"}),t(d,{prop:"quantity",label:"货物数量",width:"120",align:"right"}),t(d,{prop:"carrier",label:"承运人",width:"130",align:"left"}),t(d,{prop:"consignee",label:"收货人",width:"130",align:"left"}),t(d,{prop:"commercial_amount",label:"保费",width:"140",align:"center"},{default:a(({row:l})=>[o(r(_(v)(l.commercial_amount)),1)]),_:1}),t(d,{label:"操作",width:"200",align:"center",fixed:"right"},{default:a(({row:l})=>[t(i,{type:"info",size:"small",onClick:N=>Ue(l)},{default:a(()=>e[33]||(e[33]=[o(" 查看附件 ")])),_:2,__:[33]},1032,["onClick"]),t(i,{type:"primary",size:"small",onClick:N=>De(l)},{default:a(()=>e[34]||(e[34]=[o(" 上传附件 ")])),_:2,__:[34]},1032,["onClick"])]),_:1})]),_:1},8,["data","show-summary"]),!n.value.cargo_insurance||n.value.cargo_insurance.length===0?(f(),h("div",Xt,[t(i,{type:"primary",onClick:Q},{default:a(()=>e[35]||(e[35]=[o("录入货运险信息")])),_:1,__:[35]})])):k("",!0)]),_:1})):k("",!0),t(y,{class:"detail-card"},{default:a(()=>[t(P,{data:n.value.contacts||[],border:"",style:{width:"100%"},"empty-text":"暂无合同信息","max-height":"200"},{default:a(()=>[t(d,{prop:"contact_id",label:"合同编号",width:"250"}),t(d,{prop:"sign_status",label:"签署状态",width:"120",align:"center"},{default:a(({row:l})=>[t(g,{type:Ne(l.sign_status)},{default:a(()=>[o(r(l.sign_status),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"sign_time",label:"签署时间",width:"170",align:"center"},{default:a(({row:l})=>[o(r(l.sign_time||"-"),1)]),_:1}),t(d,{prop:"created_at",label:"创建时间",width:"170",align:"center"},{default:a(({row:l})=>[o(r(_(V)(l.created_at)),1)]),_:1}),t(d,{label:"操作",width:"300",align:"center",fixed:"right"},{default:a(({row:l})=>[t(i,{type:"primary",size:"small",icon:_(vt),onClick:()=>te(l.view_pdf_url,"查看PDF"),disabled:!l.view_pdf_url,class:"action-btn"},{default:a(()=>e[36]||(e[36]=[o(" 查看 ")])),_:2,__:[36]},1032,["icon","onClick","disabled"]),t(i,{type:"success",size:"small",icon:_(yt),onClick:()=>te(l.download_url,"下载PDF"),disabled:!l.download_url,class:"action-btn"},{default:a(()=>e[37]||(e[37]=[o(" 下载 ")])),_:2,__:[37]},1032,["icon","onClick","disabled"]),t(i,{type:"info",size:"small",icon:_(gt),onClick:()=>Be(l.sign_url),disabled:!l.sign_url,class:"action-btn"},{default:a(()=>e[38]||(e[38]=[o(" 签署链接 ")])),_:2,__:[38]},1032,["icon","onClick","disabled"])]),_:1})]),_:1},8,["data"])]),_:1}),t(y,{class:"detail-card"},{default:a(()=>[t(P,{data:n.value.receiveds||[],border:"",style:{width:"100%"},"empty-text":"暂无收款记录","max-height":"200"},{default:a(()=>[t(d,{prop:"trans_no",label:"收款流水号",width:"250"}),t(d,{prop:"rec_type",label:"收款类型",width:"100"},{default:a(({row:l})=>[t(g,{type:ze(l.rec_type)},{default:a(()=>[o(r(l.rec_type),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"amount",label:"收款金额",width:"120"},{default:a(({row:l})=>[c("span",Yt,r(_(v)(l.amount)),1)]),_:1}),t(d,{prop:"period",label:"期数",width:"80"},{default:a(({row:l})=>[o(r(l.period||"-"),1)]),_:1}),t(d,{prop:"method",label:"收款方式",width:"100"},{default:a(({row:l})=>[t(g,{type:Re(l.method),size:"small"},{default:a(()=>[o(r(l.method),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"date_time",label:"收款时间",width:"160"}),t(d,{prop:"created_at",label:"录入时间",width:"160"},{default:a(({row:l})=>[o(r(_(V)(l.created_at)),1)]),_:1}),t(d,{prop:"remark",label:"备注","min-width":"120"},{default:a(({row:l})=>[o(r(l.remark||"-"),1)]),_:1})]),_:1},8,["data"])]),_:1}),t(y,{class:"detail-card"},{default:a(()=>[t(P,{data:n.value.receivables||[],border:"",style:{width:"100%"},"empty-text":"暂无还款计划","show-summary":n.value.receivables&&n.value.receivables.length>0,"sum-text":"合计","summary-method":Je},{default:a(()=>[t(d,{prop:"period",label:"期数",width:"80",align:"center"}),t(d,{prop:"status",label:"状态",width:"100",align:"center"},{default:a(({row:l})=>[t(g,{type:Fe(l.status)},{default:a(()=>[o(r(l.status),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"date",label:"应还日期",width:"120",align:"center"}),t(d,{prop:"amount",label:"应还金额",width:"120",align:"right"},{default:a(({row:l})=>[c("span",Zt,r(_(v)(l.amount)),1)]),_:1}),t(d,{prop:"principal_amount",label:"本金",width:"120",align:"right"},{default:a(({row:l})=>[c("span",ea,r(_(v)(l.principal_amount)),1)]),_:1}),t(d,{prop:"interest_amount",label:"利息",width:"120",align:"right"},{default:a(({row:l})=>[c("span",ta,r(_(v)(l.interest_amount)),1)]),_:1}),t(d,{prop:"actual_amount",label:"实际收款",width:"120",align:"right"},{default:a(({row:l})=>[l.actual_amount>0?(f(),h("span",aa,r(_(v)(l.actual_amount)),1)):(f(),h("span",la,"-"))]),_:1}),t(d,{prop:"actual_date",label:"实际收款日期",width:"120",align:"center"},{default:a(({row:l})=>[o(r(l.actual_date||"-"),1)]),_:1}),t(d,{prop:"penalty_amount",label:"违约金",width:"100",align:"right"},{default:a(({row:l})=>[l.penalty_amount>0?(f(),h("span",na,r(_(v)(l.penalty_amount)),1)):(f(),h("span",sa,"-"))]),_:1}),t(d,{prop:"forfeit_amount",label:"滞纳金",width:"100",align:"right"},{default:a(({row:l})=>[l.forfeit_amount>0?(f(),h("span",ra,r(_(v)(l.forfeit_amount)),1)):(f(),h("span",oa,"-"))]),_:1}),t(d,{prop:"overdue_days",label:"逾期天数",width:"100",align:"center"},{default:a(({row:l})=>[l.overdue_days>0?(f(),h("span",ia,r(l.overdue_days)+"天",1)):(f(),h("span",ua,"-"))]),_:1}),t(d,{label:"操作",width:"120",align:"center",fixed:"right"},{default:a(({row:l})=>[l.status==="待收款"||l.status==="已逾期"?(f(),C(i,{key:0,type:"primary",size:"small",onClick:N=>Oe(l)},{default:a(()=>e[39]||(e[39]=[o(" 标记收款 ")])),_:2,__:[39]},1032,["onClick"])):(f(),h("span",da,"已收款"))]),_:1})]),_:1},8,["data","show-summary"])]),_:1}),t(y,{class:"detail-card"},{default:a(()=>[n.value.logs&&n.value.logs.length>0?(f(),C(Qe,{key:0},{default:a(()=>[(f(!0),h(bt,null,ht(n.value.logs,l=>(f(),C(Ke,{key:l.id,timestamp:_(V)(l.created_at),type:xe(l.action)},{default:a(()=>[c("div",ca,[c("span",_a,r(l.admin_name),1),c("span",pa,r(l.content),1)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})):(f(),h("div",ma,[t(je,{description:"暂无操作日志","image-size":80})]))]),_:1}),t(ne,{modelValue:T.value,"onUpdate:modelValue":e[4]||(e[4]=l=>T.value=l),title:"添加备注",width:"500px"},{footer:a(()=>[c("span",fa,[t(i,{onClick:e[3]||(e[3]=l=>T.value=!1)},{default:a(()=>e[40]||(e[40]=[o("取消")])),_:1,__:[40]}),t(i,{type:"primary",onClick:qe,loading:F.value},{default:a(()=>e[41]||(e[41]=[o("确定")])),_:1,__:[41]},8,["loading"])])]),default:a(()=>[t(Ye,{ref_key:"remarkFormRef",ref:R,model:U.value,rules:be,"label-width":"80px"},{default:a(()=>[t(Xe,{label:"备注内容",prop:"remark"},{default:a(()=>[t(We,{modelValue:U.value.remark,"onUpdate:modelValue":e[2]||(e[2]=l=>U.value.remark=l),type:"textarea",rows:4,placeholder:"请输入备注内容",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),e[42]||(e[42]=c("div",{style:{"margin-top":"10px","text-align":"right"}},"添加的备注将显示在日志列表里",-1))]),_:1,__:[42]},8,["modelValue"]),t(ne,{modelValue:B.value,"onUpdate:modelValue":e[6]||(e[6]=l=>B.value=l),title:"前置款信息",width:"600px","close-on-click-modal":!1},{footer:a(()=>[c("span",wa,[t(i,{onClick:e[5]||(e[5]=l=>B.value=!1)},{default:a(()=>e[43]||(e[43]=[o("关闭")])),_:1,__:[43]}),t(i,{type:"primary",onClick:He},{default:a(()=>e[44]||(e[44]=[o("复制信息")])),_:1,__:[44]})])]),default:a(()=>[ye((f(),h("div",va,[m.value.batch_no?(f(),C($,{key:0,column:1,border:"",size:"small"},{default:a(()=>[t(u,{label:"批次号"},{default:a(()=>[c("span",null,r(m.value.batch_no),1)]),_:1}),t(u,{label:"借款人"},{default:a(()=>[c("span",null,r(m.value.borrower),1)]),_:1}),t(u,{label:"车辆信息"},{default:a(()=>[c("span",null,r(m.value.vehicle_info),1)]),_:1}),t(u,{label:"总保费"},{default:a(()=>[c("span",null,r(_(v)(m.value.total_premium)),1)]),_:1}),m.value.repay_type==="利息前置"?(f(),C(u,{key:0,label:"总利息"},{default:a(()=>[c("span",null,r(_(v)(m.value.total_interest)),1)]),_:1})):k("",!0)]),_:1})):k("",!0),m.value.service_fee?(f(),h("div",ya,[t($,{column:1,border:"",size:"small"},{default:a(()=>[t(u,{label:"服务费"},{default:a(()=>[c("span",null,r(_(v)(m.value.service_fee)),1)]),_:1}),m.value.repay_type==="利息前置"?(f(),C(u,{key:0,label:"支付总服务费"},{default:a(()=>[c("span",null,r(_(v)(m.value.total_service_fee))+" (服务费+总利息)",1)]),_:1})):k("",!0),t(u,{label:"收款户名"},{default:a(()=>[c("span",null,r(m.value.service_account_name),1)]),_:1}),t(u,{label:"收款账户"},{default:a(()=>[c("span",null,r(m.value.service_account_no),1)]),_:1}),t(u,{label:"开户行"},{default:a(()=>[c("span",null,r(m.value.service_bank_name),1)]),_:1})]),_:1})])):k("",!0),m.value.total_down_payment?(f(),h("div",ga,[t($,{column:1,border:"",size:"small"},{default:a(()=>[t(u,{label:"支付首付款"},{default:a(()=>[c("span",null,r(_(v)(m.value.total_down_payment)),1)]),_:1}),t(u,{label:"明细"},{default:a(()=>[c("span",null,r(m.value.down_payment_detail),1)]),_:1}),t(u,{label:"收款户名"},{default:a(()=>[c("span",null,r(m.value.funder_account_name),1)]),_:1}),t(u,{label:"收款账户"},{default:a(()=>[c("span",null,r(m.value.funder_account_no),1)]),_:1}),t(u,{label:"开户行"},{default:a(()=>[c("span",null,r(m.value.funder_bank_name),1)]),_:1})]),_:1})])):k("",!0),m.value.remark?(f(),h("div",ba,[c("div",ha,r(m.value.remark),1)])):k("",!0)])),[[se,O.value]])]),_:1},8,["modelValue"]),t(X,{visible:L.value,"onUpdate:visible":e[7]||(e[7]=l=>L.value=l),title:"订单附件",attachments:n.value.attachments||[],"order-id":n.value.id,"ref-id":0,type:"order",onRefresh:S,onDelete:Ve,"allow-delete":!0},null,8,["visible","attachments","order-id"]),t(Y,{visible:q.value,"onUpdate:visible":e[8]||(e[8]=l=>q.value=l),title:"上传订单附件","order-id":n.value.id,"ref-id":0,type:"order",onSuccess:j},null,8,["visible","order-id"]),t(X,{visible:G.value,"onUpdate:visible":e[9]||(e[9]=l=>G.value=l),title:`车险附件 - ${((re=x.value)==null?void 0:re.car_no)||""}`,attachments:((oe=x.value)==null?void 0:oe.attachments)||[],"order-id":n.value.id,"ref-id":((ie=x.value)==null?void 0:ie.id)||0,type:"car","allow-delete":!1},null,8,["visible","title","attachments","order-id","ref-id"]),t(Y,{visible:H.value,"onUpdate:visible":e[10]||(e[10]=l=>H.value=l),title:`上传车险附件 - ${((ue=x.value)==null?void 0:ue.car_no)||""}`,"order-id":n.value.id,"ref-id":((de=x.value)==null?void 0:de.id)||0,type:"car",onSuccess:j},null,8,["visible","title","order-id","ref-id"]),t(X,{visible:J.value,"onUpdate:visible":e[11]||(e[11]=l=>J.value=l),title:`货运险附件 - ${((ce=x.value)==null?void 0:ce.track_no)||""}`,attachments:((_e=x.value)==null?void 0:_e.attachments)||[],"order-id":n.value.id,"ref-id":((pe=x.value)==null?void 0:pe.id)||0,type:"cargo","allow-delete":!1},null,8,["visible","title","attachments","order-id","ref-id"]),t(Y,{visible:K.value,"onUpdate:visible":e[12]||(e[12]=l=>K.value=l),title:`上传货运险附件 - ${((me=x.value)==null?void 0:me.track_no)||""}`,"order-id":n.value.id,"ref-id":((fe=x.value)==null?void 0:fe.id)||0,type:"cargo",onSuccess:j},null,8,["visible","title","order-id","ref-id"])])}}},Oa=Ze(ka,[["__scopeId","data-v-f05f51dc"]]);export{Oa as default};
