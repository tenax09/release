import{r as D,_ as ye}from"./index-49cf57c0.js";/* empty css               *//* empty css                             *//* empty css                       *//* empty css                     *//* empty css                        *//* empty css                      *//* empty css                  *//* empty css                        */import{b as G,r as _,ae as be,l as y,B as U,C as p,F as e,G as a,a1 as J,af as he,p as S,E as V,a5 as Ve,ay as xe,K as ke,an as we,aM as Ce,M as Ee,ai as Ue,u as E,aW as De,Q as ze,aN as Fe,O as n,as as Me,D as s,H as W,I as X,S as T,J as Se,a2 as $e,ax as Re,al as Oe,am as Le,a6 as qe,aK as Be,aL as Ie,a7 as Te,az as Ye,aA as Ne}from"./element-plus-f067b2d4.js";import{g as He}from"./user-d52eb09d.js";import{k as Ke}from"./order-a8df91b6.js";import{f as Z}from"./format-20468769.js";function Pe(g){return D({url:"/api/admin/receiveds",method:"get",params:g})}function je(g){return D({url:`/api/admin/receiveds/${g}`,method:"get"})}function Ae(g){return D({url:"/api/admin/receiveds",method:"post",data:g})}function Qe(g,i){return D({url:`/api/admin/receiveds/${g}`,method:"put",data:i})}function Ge(g){return D({url:`/api/admin/receiveds/${g}`,method:"delete"})}const Je={class:"received-container"},We={class:"filter-container"},Xe={style:{color:"#67c23a","font-weight":"bold"}},Ze={class:"pagination"},et={class:"form-section"},tt={class:"form-content"},lt={class:"form-section"},at={class:"form-content"},ot={class:"form-section"},rt={class:"form-content"},nt=["src"],dt={class:"dialog-footer"},st={style:{color:"#67c23a","font-weight":"bold"}},it={key:0,style:{"margin-top":"20px"}},ut={key:1,style:{"margin-top":"18px"}},pt=["src"],mt={class:"dialog-footer"},_t={__name:"index",setup(g){const i=G({page:1,pageSize:10,trans_no:"",order_no:"",rec_type:"",method:""}),Y=_([]),N=_(0),$=_(!1),H=_([]),R=_([]);_([]);const x=_(!1),z=_(!1),O=_(""),L=_(),r=G({id:void 0,rec_type:"",user_id:void 0,order_id:void 0,order_no:"",amount:void 0,method:"",date_time:"",remark:"",receipt:""}),d=_({}),ee={rec_type:[{required:!0,message:"请选择收款类型",trigger:"change"}],user_id:[{required:!0,message:"请选择用户",trigger:"change"}],order_id:[{required:!0,message:"请选择订单",trigger:"change"}],amount:[{required:!0,message:"请输入收款金额",trigger:"blur"}],method:[{required:!0,message:"请选择收款方式",trigger:"change"}],date_time:[{required:!0,message:"请选择收款时间",trigger:"change"}]},k=async()=>{$.value=!0;try{const o=await Pe(i);Y.value=o.data.list,N.value=o.data.total}catch(o){console.error("获取收款记录列表失败:",o),V.error("获取收款记录列表失败")}$.value=!1},te=async()=>{try{const o=await He({page:1,pageSize:1e3});H.value=o.data.list}catch(o){console.error("获取用户列表失败:",o)}},F=async(o="")=>{try{const t={page:1,pageSize:1e3};o&&(t.user_id=o);const c=await Ke(t);R.value=c.data.list}catch(t){console.error("获取订单列表失败:",t)}},le=o=>{r.order_id=void 0,r.order_no="",o&&F(o)},ae=o=>{const t=R.value.find(c=>c.id===o);t&&(r.order_no=t.order_no)},q=_(""),B=_(null);function oe(o){const t=o.target.files[0];if(!t)return;const c=new FileReader;c.onload=function(w){q.value=w.target.result,r.receipt=w.target.result,B.value=t},c.readAsDataURL(t)}const I=()=>{i.page=1,k()},re=()=>{O.value="新增收款记录",x.value=!0,Object.assign(r,{id:void 0,rec_type:"",user_id:void 0,order_id:void 0,order_no:"",amount:void 0,method:"",date_time:"",remark:"",receipt:""}),q.value="",B.value=null,F()},ne=o=>{O.value="编辑收款记录",x.value=!0,Object.assign(r,{id:o.id,rec_type:o.rec_type,user_id:o.user_id,order_id:o.order_id,order_no:o.order_no,amount:o.amount,method:o.method,date_time:o.date_time,remark:o.remark,receipt:o.receipt||""}),q.value=o.receipt||"",B.value=null,o.user_id?F(o.user_id):F()},de=async o=>{try{const t=await je(o.id);d.value=t.data,z.value=!0}catch(t){console.error("获取收款记录详情失败:",t),V.error("获取收款记录详情失败")}},se=o=>{Se.confirm("确认要删除该收款记录吗？","警告",{type:"warning"}).then(async()=>{try{await Ge(o.id),V.success("删除成功"),k()}catch(t){console.error("删除收款记录失败:",t),V.error("删除失败")}})},ie=async()=>{L.value&&await L.value.validate(async o=>{if(o)try{r.id?(await Qe(r.id,r),V.success("编辑成功")):(await Ae(r),V.success("新增成功")),x.value=!1,k()}catch(t){console.error("提交表单失败:",t),V.error("操作失败")}})},ue=o=>{i.pageSize=o,k()},pe=o=>{i.page=o,k()},K=o=>({首付:"primary",还款:"success",利息:"warning",本金:"info",退保:"danger"})[o]||"info",P=o=>({微信:"success",支付宝:"primary",银行卡:"warning"})[o]||"info";return be(()=>{k(),te()}),(o,t)=>{const c=$e,w=Ve,u=Re,C=xe,b=ke,h=Oe,M=Le,me=we,_e=Ce,v=qe,ce=Be,fe=Ie,ge=Te,j=Ee,m=Ye,A=Ne,ve=Ue;return y(),U("div",Je,[p("div",We,[e(w,{modelValue:i.trans_no,"onUpdate:modelValue":t[0]||(t[0]=l=>i.trans_no=l),placeholder:"流水号",style:{width:"200px"},class:"filter-item",onKeyup:J(I,["enter","native"])},{prefix:a(()=>[e(c,null,{default:a(()=>[e(E(De))]),_:1})]),_:1},8,["modelValue"]),e(w,{modelValue:i.order_no,"onUpdate:modelValue":t[1]||(t[1]=l=>i.order_no=l),placeholder:"订单号",style:{width:"200px"},class:"filter-item",onKeyup:J(I,["enter","native"])},{prefix:a(()=>[e(c,null,{default:a(()=>[e(E(ze))]),_:1})]),_:1},8,["modelValue"]),e(C,{modelValue:i.rec_type,"onUpdate:modelValue":t[2]||(t[2]=l=>i.rec_type=l),placeholder:"收款类型",clearable:"",class:"filter-item",style:{width:"120px"}},{default:a(()=>[e(u,{label:"首付",value:"首付"}),e(u,{label:"还款",value:"还款"}),e(u,{label:"利息",value:"利息"}),e(u,{label:"本金",value:"本金"}),e(u,{label:"退保",value:"退保"})]),_:1},8,["modelValue"]),e(C,{modelValue:i.method,"onUpdate:modelValue":t[3]||(t[3]=l=>i.method=l),placeholder:"收款方式",clearable:"",class:"filter-item",style:{width:"120px"}},{default:a(()=>[e(u,{label:"微信",value:"微信"}),e(u,{label:"支付宝",value:"支付宝"}),e(u,{label:"银行卡",value:"银行卡"})]),_:1},8,["modelValue"]),e(b,{class:"filter-item",type:"primary",onClick:I},{default:a(()=>[e(c,null,{default:a(()=>[e(E(Fe))]),_:1}),t[17]||(t[17]=n(" 搜索 "))]),_:1,__:[17]}),e(b,{class:"filter-item",type:"primary",onClick:re},{default:a(()=>[e(c,null,{default:a(()=>[e(E(Me))]),_:1}),t[18]||(t[18]=n(" 新增收款记录 "))]),_:1,__:[18]})]),he((y(),S(me,{data:Y.value,border:"",fit:"","highlight-current-row":"",style:{width:"100%"}},{default:a(()=>[e(h,{prop:"trans_no",label:"流水号",width:"260"}),e(h,{prop:"rec_type",label:"收款类型",width:"100"},{default:a(({row:l})=>[e(M,{type:K(l.rec_type)},{default:a(()=>[n(s(l.rec_type),1)]),_:2},1032,["type"])]),_:1}),e(h,{prop:"user",label:"用户",width:"120"},{default:a(({row:l})=>{var f,Q;return[n(s(((f=l.user)==null?void 0:f.name)||((Q=l.user)==null?void 0:Q.username)||"未知用户"),1)]}),_:1}),e(h,{prop:"order_no",label:"订单号",width:"180"}),e(h,{prop:"amount",label:"金额",width:"120"},{default:a(({row:l})=>{var f;return[p("span",Xe,"¥"+s((f=l.amount)==null?void 0:f.toFixed(2)),1)]}),_:1}),e(h,{prop:"method",label:"收款方式",width:"100"},{default:a(({row:l})=>[e(M,{type:P(l.method)},{default:a(()=>[n(s(l.method),1)]),_:2},1032,["type"])]),_:1}),e(h,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[e(b,{type:"primary",link:"",onClick:f=>ne(l)},{default:a(()=>t[19]||(t[19]=[n("编辑")])),_:2,__:[19]},1032,["onClick"]),e(b,{type:"primary",link:"",onClick:f=>de(l)},{default:a(()=>t[20]||(t[20]=[n("详情")])),_:2,__:[20]},1032,["onClick"]),e(b,{type:"danger",link:"",onClick:f=>se(l)},{default:a(()=>t[21]||(t[21]=[n("删除")])),_:2,__:[21]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ve,$.value]]),p("div",Ze,[e(_e,{"current-page":i.page,"onUpdate:currentPage":t[4]||(t[4]=l=>i.page=l),"page-size":i.pageSize,"onUpdate:pageSize":t[5]||(t[5]=l=>i.pageSize=l),"page-sizes":[10,20,50,100],total:N.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ue,onCurrentChange:pe},null,8,["current-page","page-size","total"])]),e(j,{title:O.value,modelValue:x.value,"onUpdate:modelValue":t[14]||(t[14]=l=>x.value=l),width:"900px","close-on-click-modal":!1,draggable:"","destroy-on-close":"",class:"custom-dialog"},{footer:a(()=>[p("div",dt,[e(b,{onClick:t[13]||(t[13]=l=>x.value=!1)},{default:a(()=>t[22]||(t[22]=[n("取 消")])),_:1,__:[22]}),e(b,{type:"primary",onClick:ie},{default:a(()=>t[23]||(t[23]=[n("确 定")])),_:1,__:[23]})])]),default:a(()=>[e(ge,{ref_key:"receivedFormRef",ref:L,model:r,rules:ee,"label-position":"right","label-width":"120px",class:"form-container"},{default:a(()=>[p("div",et,[p("div",tt,[e(v,{label:"收款类型",prop:"rec_type"},{default:a(()=>[e(C,{modelValue:r.rec_type,"onUpdate:modelValue":t[6]||(t[6]=l=>r.rec_type=l),placeholder:"请选择收款类型",style:{width:"100%"}},{default:a(()=>[e(u,{label:"首付",value:"首付"}),e(u,{label:"还款",value:"还款"}),e(u,{label:"利息",value:"利息"}),e(u,{label:"本金",value:"本金"}),e(u,{label:"退保",value:"退保"})]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"收款方式",prop:"method"},{default:a(()=>[e(C,{modelValue:r.method,"onUpdate:modelValue":t[7]||(t[7]=l=>r.method=l),placeholder:"请选择收款方式",style:{width:"100%"}},{default:a(()=>[e(u,{label:"微信",value:"微信"}),e(u,{label:"支付宝",value:"支付宝"}),e(u,{label:"银行卡",value:"银行卡"})]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"用户",prop:"user_id"},{default:a(()=>[e(C,{modelValue:r.user_id,"onUpdate:modelValue":t[8]||(t[8]=l=>r.user_id=l),placeholder:"请选择用户",filterable:"",style:{width:"100%"},onChange:le},{default:a(()=>[(y(!0),U(W,null,X(H.value,l=>(y(),S(u,{key:l.id,label:`${l.name||l.username} (${l.username})`,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"订单",prop:"order_id"},{default:a(()=>[e(C,{modelValue:r.order_id,"onUpdate:modelValue":t[9]||(t[9]=l=>r.order_id=l),placeholder:"请选择订单",filterable:"",style:{width:"100%"},onChange:ae},{default:a(()=>[(y(!0),U(W,null,X(R.value,l=>(y(),S(u,{key:l.id,label:`${l.order_no} (¥${l.total_premium})`,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),p("div",lt,[p("div",at,[e(v,{label:"金额",prop:"amount"},{default:a(()=>[e(ce,{modelValue:r.amount,"onUpdate:modelValue":t[10]||(t[10]=l=>r.amount=l),precision:2,step:100,min:0,max:999999999,"controls-position":o.right,style:{width:"100%"}},null,8,["modelValue","controls-position"])]),_:1}),e(v,{label:"收款时间",prop:"date_time"},{default:a(()=>[e(fe,{modelValue:r.date_time,"onUpdate:modelValue":t[11]||(t[11]=l=>r.date_time=l),type:"datetime",placeholder:"请选择收款时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])]),p("div",ot,[p("div",rt,[e(v,{label:"备注",prop:"remark",class:"full-width"},{default:a(()=>[e(w,{modelValue:r.remark,"onUpdate:modelValue":t[12]||(t[12]=l=>r.remark=l),type:"textarea",rows:3,placeholder:"请输入备注信息",maxlength:"255","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(v,{label:"收款凭证"},{default:a(()=>[p("input",{type:"file",accept:"image/*",onChange:oe},null,32)]),_:1}),r.receipt?(y(),S(v,{key:0},{default:a(()=>[p("img",{src:r.receipt,alt:"收款凭证预览",style:{"max-width":"180px","max-height":"120px",border:"1px solid #eee"}},null,8,nt)]),_:1})):T("",!0)])])]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),e(j,{title:"收款记录详情",modelValue:z.value,"onUpdate:modelValue":t[16]||(t[16]=l=>z.value=l),width:"700px","close-on-click-modal":!1,draggable:"","destroy-on-close":""},{footer:a(()=>[p("div",mt,[e(b,{onClick:t[15]||(t[15]=l=>z.value=!1)},{default:a(()=>t[26]||(t[26]=[n("关 闭")])),_:1,__:[26]})])]),default:a(()=>[e(A,{column:2,border:""},{default:a(()=>[e(m,{label:"流水号"},{default:a(()=>[n(s(d.value.trans_no),1)]),_:1}),e(m,{label:"收款类型"},{default:a(()=>[e(M,{type:K(d.value.rec_type)},{default:a(()=>[n(s(d.value.rec_type),1)]),_:1},8,["type"])]),_:1}),e(m,{label:"用户"},{default:a(()=>{var l,f;return[n(s(((l=d.value.user)==null?void 0:l.name)||((f=d.value.user)==null?void 0:f.username)||"未知用户"),1)]}),_:1}),e(m,{label:"订单号"},{default:a(()=>[n(s(d.value.order_no),1)]),_:1}),e(m,{label:"收款金额"},{default:a(()=>{var l;return[p("span",st,"¥"+s((l=d.value.amount)==null?void 0:l.toFixed(2)),1)]}),_:1}),e(m,{label:"收款方式"},{default:a(()=>[e(M,{type:P(d.value.method)},{default:a(()=>[n(s(d.value.method),1)]),_:1},8,["type"])]),_:1}),e(m,{label:"收款时间"},{default:a(()=>[n(s(d.value.date_time),1)]),_:1}),e(m,{label:"创建时间"},{default:a(()=>[n(s(E(Z)(d.value.created_at)),1)]),_:1}),e(m,{label:"更新时间"},{default:a(()=>[n(s(E(Z)(d.value.updated_at)),1)]),_:1}),e(m,{label:"备注",span:"2"},{default:a(()=>[n(s(d.value.remark||"无"),1)]),_:1})]),_:1}),d.value.order?(y(),U("div",it,[t[24]||(t[24]=p("h4",{style:{margin:"0 0 16px 0",color:"#303133"}},"关联订单信息",-1)),e(A,{column:2,border:"",size:"small"},{default:a(()=>[e(m,{label:"订单号"},{default:a(()=>[n(s(d.value.order.order_no),1)]),_:1}),e(m,{label:"总保费"},{default:a(()=>{var l;return[n("¥"+s((l=d.value.order.total_premium)==null?void 0:l.toFixed(2)),1)]}),_:1}),e(m,{label:"贷款金额"},{default:a(()=>{var l;return[n("¥"+s((l=d.value.order.loan_amount)==null?void 0:l.toFixed(2)),1)]}),_:1}),e(m,{label:"首付金额"},{default:a(()=>{var l;return[n("¥"+s((l=d.value.order.down_payment)==null?void 0:l.toFixed(2)),1)]}),_:1}),e(m,{label:"订单状态"},{default:a(()=>[n(s(d.value.order.status),1)]),_:1}),e(m,{label:"保险类型"},{default:a(()=>[n(s(d.value.order.insurance_type),1)]),_:1})]),_:1})])):T("",!0),d.value.receipt?(y(),U("div",ut,[t[25]||(t[25]=p("div",{style:{"font-weight":"bold","margin-bottom":"6px"}},"收款凭证：",-1)),p("img",{src:d.value.receipt,alt:"收款凭证",style:{"max-width":"320px","max-height":"200px",border:"1px solid #eee"}},null,8,pt)])):T("",!0)]),_:1},8,["modelValue"])])}}},Ut=ye(_t,[["__scopeId","data-v-968e210d"]]);export{Ut as default};
