import{_ as He,b as We,u as Je}from"./index-31409f0b.js";/* empty css               *//* empty css                   *//* empty css                    *//* empty css                 *//* empty css                       *//* empty css                     *//* empty css                        *//* empty css                        *//* empty css                  *//* empty css                 *//* empty css                *//* empty css               *//* empty css                       */import{r as m,j as we,ae as Ke,l as _,B as b,C as s,F as l,G as a,p as F,S as h,af as Ve,E as f,aE as Xe,ag as Qe,M as Ze,ai as el,u as L,aL as ll,O as r,av as al,aH as tl,aM as sl,as as ol,D as d,H as P,I as S,aw as xe,X as rl,J as nl,a2 as ul,K as dl,ao as il,ah as ml,al as pl,am as _l,an as cl,ar as vl,a5 as fl,a6 as gl,ax as bl,ay as yl,aN as wl,aO as Vl,aP as xl,a7 as hl,aB as kl,aC as Dl,aD as Yl}from"./element-plus-3147ea74.js";import{h as Cl,a as Tl,i as he,j as Ul,e as Ml,u as El}from"./order-295e8841.js";import{a as Fl}from"./user-60b5f53d.js";const Ll={class:"insurance-detail"},ql={class:"page-header"},Rl={class:"header-actions"},Bl={class:"stat-item"},$l={class:"stat-number"},Il={class:"stat-item"},zl={class:"stat-number"},Ol={class:"stat-item"},Al={class:"stat-number"},Nl={class:"stat-item total"},Pl={class:"stat-number"},Sl={class:"attachment-status"},jl={class:"status-item"},Gl={class:"status-item"},Hl={class:"stat-item total"},Wl={class:"stat-number"},Jl={class:"stat-item"},Kl={class:"stat-number"},Xl={class:"stat-item"},Ql={class:"stat-number"},Zl={class:"empty-state"},ea={class:"insured-input"},la={class:"dialog-footer"},aa={class:"insured-input"},ta={class:"dialog-footer"},sa={class:"upload-content"},oa={class:"upload-tips"},ra={key:0,class:"import-result"},na={class:"result-summary"},ua={class:"stat-item"},da={class:"stat-number total"},ia={class:"stat-item"},ma={class:"stat-number success"},pa={class:"stat-item"},_a={class:"stat-number fail"},ca={key:0,class:"error-list"},va={class:"dialog-footer"},fa={class:"upload-content"},ga={class:"upload-tips"},ba={key:0,class:"import-result"},ya={class:"result-summary"},wa={class:"stat-item"},Va={class:"stat-number total"},xa={class:"stat-item"},ha={class:"stat-number success"},ka={class:"stat-item"},Da={class:"stat-number fail"},Ya={key:0,class:"detail-results"},Ca={class:"result-list"},Ta={class:"result-header"},Ua={class:"file-name"},Ma={key:0,class:"result-content success-content"},Ea={class:"ocr-info"},Fa={class:"info-item"},La={class:"info-item"},qa={class:"info-item"},Ra={key:1,class:"result-content error-content"},Ba={class:"error-message"},$a={key:1,class:"error-list"},Ia={class:"dialog-footer"},za={__name:"insurance",setup(Oa){const Y=We(),K=Je(),$=m(!1),q=m(!1),k=m([]),y=m("车险"),ke=m({}),De=m({}),X=m([]),j=m(!1),I=m(null),Q=m(!1),U=m(null),Z=m([]),V=m(null),z=m(!1),ee=m(null),le=m(!1),M=m([]),ae=m([]),w=m(null),O=m(!1),te=m(null),u=m({car_no:"",vin:"",insurance_no:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,compulsory_amount:void 0,vehicle_tax_amount:void 0,start_date:"",end_date:"",issue_date:""}),Ye={car_no:[{required:!0,message:"请输入车牌号",trigger:"blur"}],vin:[{required:!0,message:"请输入车架号",trigger:"blur"}],insurance_no:[{required:!0,message:"请输入投保单号",trigger:"blur"}],insured:[{required:!0,message:"请选择被保人",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}],issue_date:[{required:!0,message:"请选择出单日期",trigger:"change"}]},A=m(!1),se=m(null),n=m({track_no:"",insurance_no:"",name:"",quantity:"",carrier:"",consignee:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,start_date:"",end_date:"",issue_date:""}),Ce={track_no:[{required:!0,message:"请输入运输编号",trigger:"blur"}],insurance_no:[{required:!0,message:"请输入投保单号",trigger:"blur"}],name:[{required:!0,message:"请输入货物名称",trigger:"blur"}],quantity:[{required:!0,message:"请输入货物数量",trigger:"blur"}],carrier:[{required:!0,message:"请输入承运人",trigger:"blur"}],consignee:[{required:!0,message:"请输入收货人",trigger:"blur"}],insured:[{required:!0,message:"请选择被保人",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}],issue_date:[{required:!0,message:"请选择出单日期",trigger:"change"}]},Te=()=>{K.back()},Ue=()=>{K.push(`/order/detail/${Y.params.id}`)},R=async()=>{$.value=!0;try{const o=await Cl(Y.params.id);k.value=o.data.insurances||[],o.data.type&&(y.value=o.data.type)}catch{f.error("获取投保信息失败")}$.value=!1},D=o=>o?`¥${o.toFixed(2)}`:"¥0.00",G=we(()=>{if(y.value!=="车险"||!k.value.length)return{commercialTotal:0,compulsoryTotal:0,vehicleTaxTotal:0,grandTotal:0};const o=k.value.reduce((e,v)=>(e.commercialTotal+=v.commercial_amount||0,e.compulsoryTotal+=v.compulsory_amount||0,e.vehicleTaxTotal+=v.vehicle_tax_amount||0,e),{commercialTotal:0,compulsoryTotal:0,vehicleTaxTotal:0});return o.grandTotal=o.commercialTotal+o.compulsoryTotal+o.vehicleTaxTotal,o}),re=we(()=>{if(y.value!=="货运险"||!k.value.length)return{commercialTotal:0,averageAmount:0};const o=k.value.reduce((v,p)=>v+(p.commercial_amount||0),0),e=o/k.value.length;return{commercialTotal:o,averageAmount:e}}),ne=()=>{y.value==="车险"?(u.value={car_no:"",vin:"",insurance_no:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,compulsory_amount:void 0,vehicle_tax_amount:void 0,start_date:"",end_date:"",issue_date:""},O.value=!0):y.value==="货运险"&&(n.value={track_no:"",insurance_no:"",name:"",quantity:"",carrier:"",consignee:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,start_date:"",end_date:"",issue_date:""},A.value=!0)},Me=async()=>{te.value&&await te.value.validate(async o=>{if(o){q.value=!0;try{await he(Y.params.id,u.value),f.success("添加车险信息成功"),O.value=!1,R()}catch(e){f.error("添加车险信息失败："+(e.message||"未知错误"))}q.value=!1}})},Ee=async()=>{se.value&&await se.value.validate(async o=>{if(o){q.value=!0;try{await he(Y.params.id,n.value),f.success("添加货运险信息成功"),A.value=!1,R()}catch(e){f.error("添加货运险信息失败："+(e.message||"未知错误"))}q.value=!1}})},ue=async o=>{try{await nl.confirm("确定要删除该投保信息吗？","提示",{type:"warning"}),await Ul(Y.params.id,o.id),f.success("删除成功"),R()}catch(e){e!=="cancel"&&f.error("删除失败："+(e.message||"未知错误"))}},de=(o,e)=>{K.push({path:`/order/attachments/${Y.params.id}`,query:{ref_id:o||0,type:e||"order"}})},Fe=async()=>{window.open(`/api/admin/orders/insurances/download-template?type=${y.value}`,"_blank")},Le=()=>{U.value=null,Z.value=[],V.value=null,j.value=!0},qe=o=>{if(U.value=o.raw,!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(o.raw.type)&&!o.name.toLowerCase().endsWith(".xlsx")&&!o.name.toLowerCase().endsWith(".xls")){f.error("请上传Excel文件(.xlsx或.xls)"),I.value.clearFiles(),U.value=null;return}if(o.raw.size>10*1024*1024){f.error("文件大小不能超过10MB"),I.value.clearFiles(),U.value=null;return}},Re=async()=>{if(!U.value){f.error("请选择要上传的文件");return}const o=new FormData;o.append("file",U.value),Q.value=!0,V.value=null;try{const e=await Ml(Y.params.id,o);V.value=e.data,e.data.success>0?(R(),f.success(`导入完成：成功${e.data.success}条，失败${e.data.fail}条`)):f.warning("没有成功导入任何数据，请检查文件格式")}catch(e){f.error("导入失败："+(e.message||"未知错误"))}Q.value=!1},Be=()=>{j.value=!1,U.value=null,Z.value=[],V.value=null,I.value&&I.value.clearFiles()},ie=o=>{o==="car"?u.value.same_as_borrower?u.value.insured="同借款人":u.value.insured="":o==="cargo"&&(n.value.same_as_borrower?n.value.insured="同借款人":n.value.insured="")},$e=()=>{M.value=[],ae.value=[],w.value=null,z.value=!0},Ie=o=>{if(!["image/jpeg","image/jpg","image/png","image/bmp","image/tiff","image/webp"].includes(o.raw.type))return f.error("请上传图片文件"),!1;if(o.raw.size>5*1024*1024)return f.error("图片大小不能超过5MB"),!1;M.value.push(o.raw)},ze=o=>{const e=M.value.findIndex(v=>v.name===o.name);e!==-1&&M.value.splice(e,1)},Oe=()=>{z.value=!1,M.value=[],ae.value=[],w.value=null,ee.value&&ee.value.clearFiles()},Ae=async()=>{if(M.value.length===0){f.error("请选择要上传的行驶证图片");return}const o=new FormData;M.value.forEach(e=>{o.append("images",e)}),le.value=!0,w.value=null;try{const e=await El(Y.params.id,o);w.value={message:e.data.message,file_count:e.data.file_count},f.success("行驶证上传成功，正在后台处理OCR识别"),z.value=!1,setTimeout(()=>{R()},2e3)}catch(e){f.error("行驶证上传失败："+(e.message||"未知错误"))}le.value=!1},Ne=o=>o==="success"?"success":o==="fail"?"danger":"info",Pe=o=>o==="success"?"成功":o==="fail"?"失败":"处理中",H=(o,e)=>!o||o.length===0?!1:o.some(v=>v.remark===e),Se=async()=>{try{const o=await Tl(Y.params.id);ke.value=o.data,o.data.user_id&&await je(o.data.user_id)}catch{f.error("获取订单详情失败")}},je=async o=>{try{const e=await Fl(o);De.value=e.data;const v=e.data.insureds||"",p=[];p.push({value:"同借款人",label:"同借款人"}),v&&v.split(";").filter(g=>g.trim()).forEach(g=>{const E=g.split(",");if(E.length>=2){const x=E[0].trim(),i=E[1].trim();p.push({value:x,label:i?`${x} (${i})`:x})}}),X.value=p}catch{f.error("获取用户配置失败")}};return Ke(()=>{R(),Se()}),(o,e)=>{const v=ul,p=dl,me=Xe,g=il,E=ml,x=Qe,i=pl,N=_l,pe=cl,Ge=vl,C=fl,c=gl,_e=bl,ce=yl,ve=wl,W=Vl,B=xl,fe=hl,J=Ze,ge=kl,be=Dl,oe=Yl,ye=el;return _(),b("div",Ll,[s("div",ql,[l(me,{onBack:Te,title:`${y.value}投保信息管理`},{extra:a(()=>[s("div",Rl,[l(p,{onClick:Ue},{default:a(()=>[l(v,null,{default:a(()=>[l(L(ll))]),_:1}),e[31]||(e[31]=r(" 返回订单详情 "))]),_:1,__:[31]}),l(p,{onClick:Fe},{default:a(()=>[l(v,null,{default:a(()=>[l(L(al))]),_:1}),e[32]||(e[32]=r(" 下载模板 "))]),_:1,__:[32]}),l(p,{type:"success",onClick:Le},{default:a(()=>[l(v,null,{default:a(()=>[l(L(tl))]),_:1}),e[33]||(e[33]=r(" 批量导入 "))]),_:1,__:[33]}),y.value==="车险"?(_(),F(p,{key:0,type:"warning",onClick:$e},{default:a(()=>[l(v,null,{default:a(()=>[l(L(sl))]),_:1}),e[34]||(e[34]=r(" 批量上传行驶证 "))]),_:1,__:[34]})):h("",!0),l(p,{type:"primary",onClick:ne},{default:a(()=>[l(v,null,{default:a(()=>[l(L(ol))]),_:1}),r(" 添加"+d(y.value)+"投保信息 ",1)]),_:1})])]),_:1},8,["title"])]),y.value==="车险"?(_(),F(x,{key:0,class:"detail-card"},{default:a(()=>[l(E,{gutter:20},{default:a(()=>[l(g,{span:6},{default:a(()=>[s("div",Bl,[s("div",$l,d(D(G.value.commercialTotal)),1),e[35]||(e[35]=s("div",{class:"stat-label"},"商业险总金额",-1))])]),_:1}),l(g,{span:6},{default:a(()=>[s("div",Il,[s("div",zl,d(D(G.value.compulsoryTotal)),1),e[36]||(e[36]=s("div",{class:"stat-label"},"交强险总金额",-1))])]),_:1}),l(g,{span:6},{default:a(()=>[s("div",Ol,[s("div",Al,d(D(G.value.vehicleTaxTotal)),1),e[37]||(e[37]=s("div",{class:"stat-label"},"车船税总金额",-1))])]),_:1}),l(g,{span:6},{default:a(()=>[s("div",Nl,[s("div",Pl,d(D(G.value.grandTotal)),1),e[38]||(e[38]=s("div",{class:"stat-label"},"合计总保费",-1))])]),_:1})]),_:1})]),_:1})):h("",!0),y.value==="车险"?Ve((_(),F(x,{key:1,class:"detail-card"},{default:a(()=>[l(pe,{data:k.value,border:"",style:{width:"100%"}},{default:a(()=>[l(i,{prop:"car_no",label:"车牌号",width:"100"}),l(i,{prop:"vin",label:"车架号","min-width":"180"}),l(i,{prop:"issue_date",label:"附件标记",width:"110"},{default:a(t=>[s("div",Sl,[s("div",jl,[e[39]||(e[39]=s("span",{class:"status-label"},"行驶证:",-1)),l(N,{type:H(t.row.attachments,"行驶证")?"success":"info",size:"small"},{default:a(()=>[r(d(H(t.row.attachments,"行驶证")?"已上传":"未上传"),1)]),_:2},1032,["type"])]),s("div",Gl,[e[40]||(e[40]=s("span",{class:"status-label"},"投保单:",-1)),l(N,{type:H(t.row.attachments,"投保单")?"success":"info",size:"small"},{default:a(()=>[r(d(H(t.row.attachments,"投保单")?"已上传":"未上传"),1)]),_:2},1032,["type"])])])]),_:1}),l(i,{prop:"insurance_no",label:"投保单号","min-width":"230"}),l(i,{prop:"insured",label:"被保人",width:"280"}),l(i,{prop:"commercial_amount",label:"商业险",width:"100"},{default:a(t=>[r(d(D(t.row.commercial_amount)),1)]),_:1}),l(i,{prop:"compulsory_amount",label:"交强险",width:"100"},{default:a(t=>[r(d(D(t.row.compulsory_amount)),1)]),_:1}),l(i,{prop:"vehicle_tax_amount",label:"车船税",width:"100"},{default:a(t=>[r(d(D(t.row.vehicle_tax_amount)),1)]),_:1}),l(i,{prop:"start_date",label:"开始日期",width:"110"}),l(i,{prop:"end_date",label:"结束日期",width:"110"}),l(i,{prop:"issue_date",label:"出单日期",width:"110"}),l(i,{label:"操作",width:"150",fixed:"right"},{default:a(t=>[l(p,{type:"info",link:"",onClick:T=>de(t.row.id,"car")},{default:a(()=>e[41]||(e[41]=[r("查看附件")])),_:2,__:[41]},1032,["onClick"]),l(p,{type:"danger",link:"",onClick:T=>ue(t.row)},{default:a(()=>e[42]||(e[42]=[r("删除")])),_:2,__:[42]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[ye,$.value]]):h("",!0),y.value==="货运险"?(_(),F(x,{key:2,class:"detail-card"},{default:a(()=>[l(E,{gutter:20},{default:a(()=>[l(g,{span:8},{default:a(()=>[s("div",Hl,[s("div",Wl,d(D(re.value.commercialTotal)),1),e[43]||(e[43]=s("div",{class:"stat-label"},"商业险总金额",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[s("div",Jl,[s("div",Kl,d(k.value.length),1),e[44]||(e[44]=s("div",{class:"stat-label"},"投保单数量",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[s("div",Xl,[s("div",Ql,d(D(re.value.averageAmount)),1),e[45]||(e[45]=s("div",{class:"stat-label"},"平均保费",-1))])]),_:1})]),_:1})]),_:1})):h("",!0),y.value==="货运险"?Ve((_(),F(x,{key:3,class:"detail-card"},{default:a(()=>[l(pe,{data:k.value,border:"",style:{width:"100%"}},{default:a(()=>[l(i,{prop:"track_no",label:"运输编号",width:"140"}),l(i,{prop:"insurance_no",label:"投保单号","min-width":"180"}),l(i,{prop:"name",label:"货物名称",width:"120"}),l(i,{prop:"quantity",label:"货物数量",width:"100"}),l(i,{prop:"carrier",label:"承运人",width:"120"}),l(i,{prop:"consignee",label:"收货人",width:"120"}),l(i,{prop:"insured",label:"被保人",width:"280"}),l(i,{prop:"commercial_amount",label:"商业险",width:"120"},{default:a(t=>[r(d(D(t.row.commercial_amount)),1)]),_:1}),l(i,{prop:"start_date",label:"开始日期",width:"110"}),l(i,{prop:"end_date",label:"结束日期",width:"110"}),l(i,{prop:"issue_date",label:"出单日期",width:"110"}),l(i,{label:"操作",width:"180",fixed:"right"},{default:a(t=>[l(p,{type:"info",link:"",onClick:T=>de(t.row.id,"cargo")},{default:a(()=>e[46]||(e[46]=[r("查看附件")])),_:2,__:[46]},1032,["onClick"]),l(p,{type:"danger",link:"",onClick:T=>ue(t.row)},{default:a(()=>e[47]||(e[47]=[r("删除")])),_:2,__:[47]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[ye,$.value]]):h("",!0),!$.value&&k.value.length===0?(_(),F(x,{key:4,class:"detail-card"},{default:a(()=>[s("div",Zl,[l(Ge,{description:"暂无投保信息"},{default:a(()=>[l(p,{type:"primary",onClick:ne},{default:a(()=>e[48]||(e[48]=[r("添加第一条投保信息")])),_:1,__:[48]})]),_:1})])]),_:1})):h("",!0),l(J,{modelValue:O.value,"onUpdate:modelValue":e[13]||(e[13]=t=>O.value=t),title:"添加车险信息",width:"600px"},{footer:a(()=>[s("span",la,[l(p,{onClick:e[12]||(e[12]=t=>O.value=!1)},{default:a(()=>e[50]||(e[50]=[r("取消")])),_:1,__:[50]}),l(p,{type:"primary",onClick:Me,loading:q.value},{default:a(()=>e[51]||(e[51]=[r("确定")])),_:1,__:[51]},8,["loading"])])]),default:a(()=>[l(fe,{ref_key:"carFormRef",ref:te,model:u.value,rules:Ye,"label-width":"120px"},{default:a(()=>[l(c,{label:"车牌号",prop:"car_no"},{default:a(()=>[l(C,{modelValue:u.value.car_no,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value.car_no=t),placeholder:"请输入车牌号"},null,8,["modelValue"])]),_:1}),l(c,{label:"车架号",prop:"vin"},{default:a(()=>[l(C,{modelValue:u.value.vin,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value.vin=t),placeholder:"请输入车架号"},null,8,["modelValue"])]),_:1}),l(c,{label:"投保单号",prop:"insurance_no"},{default:a(()=>[l(C,{modelValue:u.value.insurance_no,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value.insurance_no=t),placeholder:"请输入投保单号"},null,8,["modelValue"])]),_:1}),l(c,{label:"被保人",prop:"insured"},{default:a(()=>[s("div",ea,[l(ce,{modelValue:u.value.insured,"onUpdate:modelValue":e[3]||(e[3]=t=>u.value.insured=t),placeholder:"请选择被保人",style:{width:"300px"},disabled:u.value.same_as_borrower},{default:a(()=>[(_(!0),b(P,null,S(X.value,t=>(_(),F(_e,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),l(ve,{modelValue:u.value.same_as_borrower,"onUpdate:modelValue":e[4]||(e[4]=t=>u.value.same_as_borrower=t),onChange:e[5]||(e[5]=t=>ie("car")),class:"same-borrower-checkbox",style:{"margin-left":"10px"}},{default:a(()=>e[49]||(e[49]=[r(" 同借款人 ")])),_:1,__:[49]},8,["modelValue"])])]),_:1}),l(c,{label:"商业险",prop:"commercial_amount"},{default:a(()=>[l(W,{modelValue:u.value.commercial_amount,"onUpdate:modelValue":e[6]||(e[6]=t=>u.value.commercial_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(c,{label:"交强险",prop:"compulsory_amount"},{default:a(()=>[l(W,{modelValue:u.value.compulsory_amount,"onUpdate:modelValue":e[7]||(e[7]=t=>u.value.compulsory_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(c,{label:"车船税",prop:"vehicle_tax_amount"},{default:a(()=>[l(W,{modelValue:u.value.vehicle_tax_amount,"onUpdate:modelValue":e[8]||(e[8]=t=>u.value.vehicle_tax_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(c,{label:"开始日期",prop:"start_date"},{default:a(()=>[l(B,{modelValue:u.value.start_date,"onUpdate:modelValue":e[9]||(e[9]=t=>u.value.start_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择开始日期"},null,8,["modelValue"])]),_:1}),l(c,{label:"结束日期",prop:"end_date"},{default:a(()=>[l(B,{modelValue:u.value.end_date,"onUpdate:modelValue":e[10]||(e[10]=t=>u.value.end_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择结束日期"},null,8,["modelValue"])]),_:1}),l(c,{label:"出单日期",prop:"issue_date"},{default:a(()=>[l(B,{modelValue:u.value.issue_date,"onUpdate:modelValue":e[11]||(e[11]=t=>u.value.issue_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择出单日期"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(J,{modelValue:A.value,"onUpdate:modelValue":e[28]||(e[28]=t=>A.value=t),title:"添加货运险信息",width:"700px"},{footer:a(()=>[s("span",ta,[l(p,{onClick:e[27]||(e[27]=t=>A.value=!1)},{default:a(()=>e[53]||(e[53]=[r("取消")])),_:1,__:[53]}),l(p,{type:"primary",onClick:Ee,loading:q.value},{default:a(()=>e[54]||(e[54]=[r("确定")])),_:1,__:[54]},8,["loading"])])]),default:a(()=>[l(fe,{ref_key:"cargoFormRef",ref:se,model:n.value,rules:Ce,"label-width":"120px"},{default:a(()=>[l(c,{label:"运输编号",prop:"track_no"},{default:a(()=>[l(C,{modelValue:n.value.track_no,"onUpdate:modelValue":e[14]||(e[14]=t=>n.value.track_no=t),placeholder:"请输入运输编号"},null,8,["modelValue"])]),_:1}),l(c,{label:"投保单号",prop:"insurance_no"},{default:a(()=>[l(C,{modelValue:n.value.insurance_no,"onUpdate:modelValue":e[15]||(e[15]=t=>n.value.insurance_no=t),placeholder:"请输入投保单号"},null,8,["modelValue"])]),_:1}),l(c,{label:"货物名称",prop:"name"},{default:a(()=>[l(C,{modelValue:n.value.name,"onUpdate:modelValue":e[16]||(e[16]=t=>n.value.name=t),placeholder:"请输入货物名称"},null,8,["modelValue"])]),_:1}),l(c,{label:"货物数量",prop:"quantity"},{default:a(()=>[l(C,{modelValue:n.value.quantity,"onUpdate:modelValue":e[17]||(e[17]=t=>n.value.quantity=t),placeholder:"请输入货物数量"},null,8,["modelValue"])]),_:1}),l(c,{label:"承运人",prop:"carrier"},{default:a(()=>[l(C,{modelValue:n.value.carrier,"onUpdate:modelValue":e[18]||(e[18]=t=>n.value.carrier=t),placeholder:"请输入承运人"},null,8,["modelValue"])]),_:1}),l(c,{label:"收货人",prop:"consignee"},{default:a(()=>[l(C,{modelValue:n.value.consignee,"onUpdate:modelValue":e[19]||(e[19]=t=>n.value.consignee=t),placeholder:"请输入收货人"},null,8,["modelValue"])]),_:1}),l(c,{label:"被保人",prop:"insured"},{default:a(()=>[s("div",aa,[l(ce,{modelValue:n.value.insured,"onUpdate:modelValue":e[20]||(e[20]=t=>n.value.insured=t),placeholder:"请选择被保人",style:{width:"300px"},disabled:n.value.same_as_borrower},{default:a(()=>[(_(!0),b(P,null,S(X.value,t=>(_(),F(_e,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),l(ve,{modelValue:n.value.same_as_borrower,"onUpdate:modelValue":e[21]||(e[21]=t=>n.value.same_as_borrower=t),onChange:e[22]||(e[22]=t=>ie("cargo")),class:"same-borrower-checkbox",style:{"margin-left":"10px"}},{default:a(()=>e[52]||(e[52]=[r(" 同借款人 ")])),_:1,__:[52]},8,["modelValue"])])]),_:1}),l(c,{label:"商业险",prop:"commercial_amount"},{default:a(()=>[l(W,{modelValue:n.value.commercial_amount,"onUpdate:modelValue":e[23]||(e[23]=t=>n.value.commercial_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(c,{label:"开始日期",prop:"start_date"},{default:a(()=>[l(B,{modelValue:n.value.start_date,"onUpdate:modelValue":e[24]||(e[24]=t=>n.value.start_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择开始日期"},null,8,["modelValue"])]),_:1}),l(c,{label:"结束日期",prop:"end_date"},{default:a(()=>[l(B,{modelValue:n.value.end_date,"onUpdate:modelValue":e[25]||(e[25]=t=>n.value.end_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择结束日期"},null,8,["modelValue"])]),_:1}),l(c,{label:"出单日期",prop:"issue_date"},{default:a(()=>[l(B,{modelValue:n.value.issue_date,"onUpdate:modelValue":e[26]||(e[26]=t=>n.value.issue_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择出单日期"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(J,{modelValue:j.value,"onUpdate:modelValue":e[29]||(e[29]=t=>j.value=t),title:"批量导入投保信息",width:"600px"},{footer:a(()=>[s("span",va,[l(p,{onClick:Be},{default:a(()=>e[63]||(e[63]=[r("取消")])),_:1,__:[63]}),l(p,{type:"primary",onClick:Re,loading:Q.value,disabled:!U.value},{default:a(()=>e[64]||(e[64]=[r(" 开始导入 ")])),_:1,__:[64]},8,["loading","disabled"])])]),default:a(()=>[s("div",sa,[s("div",oa,[l(ge,{title:"导入说明",type:"info","show-icon":"",closable:!1},{default:a(()=>e[55]||(e[55]=[s("div",{class:"tips-content"},[s("p",null,"1. 请先下载模板，按照模板格式填写数据"),s("p",null,"2. 支持 .xlsx 和 .xls 格式文件"),s("p",null,"3. 必填字段不能为空，金额字段请填写数字"),s("p",null,"4. 日期格式：YYYY-MM-DD，如：2024-01-01")],-1)])),_:1,__:[55]})]),l(be,{ref_key:"excelUploadRef",ref:I,class:"upload-demo",drag:"","auto-upload":!1,limit:1,accept:".xlsx,.xls","on-change":qe,"file-list":Z.value},{tip:a(()=>e[56]||(e[56]=[s("div",{class:"el-upload__tip"}," 只能上传 .xlsx/.xls 文件，且不超过 10MB ",-1)])),default:a(()=>[l(v,{class:"el-icon--upload"},{default:a(()=>[l(L(xe))]),_:1}),e[57]||(e[57]=s("div",{class:"el-upload__text"},[r(" 将Excel文件拖到此处，或"),s("em",null,"点击上传")],-1))]),_:1,__:[57]},8,["file-list"]),V.value?(_(),b("div",ra,[l(x,null,{header:a(()=>e[58]||(e[58]=[s("span",null,"导入结果",-1)])),default:a(()=>[s("div",na,[l(E,{gutter:20},{default:a(()=>[l(g,{span:8},{default:a(()=>[s("div",ua,[s("div",da,d(V.value.total),1),e[59]||(e[59]=s("div",{class:"stat-label"},"总数",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[s("div",ia,[s("div",ma,d(V.value.success),1),e[60]||(e[60]=s("div",{class:"stat-label"},"成功",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[s("div",pa,[s("div",_a,d(V.value.fail),1),e[61]||(e[61]=s("div",{class:"stat-label"},"失败",-1))])]),_:1})]),_:1})]),V.value.errors&&V.value.errors.length>0?(_(),b("div",ca,[l(oe,{"content-position":"left"},{default:a(()=>e[62]||(e[62]=[r("错误详情")])),_:1,__:[62]}),(_(!0),b(P,null,S(V.value.errors,(t,T)=>(_(),b("div",{class:"error-item",key:T},[l(N,{type:"danger",size:"small"},{default:a(()=>[r(d(t),1)]),_:2},1024)]))),128))])):h("",!0)]),_:1})])):h("",!0)])]),_:1},8,["modelValue"]),l(J,{modelValue:z.value,"onUpdate:modelValue":e[30]||(e[30]=t=>z.value=t),title:"批量上传行驶证",width:"700px"},{footer:a(()=>[s("span",Ia,[l(p,{onClick:Oe},{default:a(()=>e[74]||(e[74]=[r("取消")])),_:1,__:[74]}),l(p,{type:"primary",onClick:Ae,loading:le.value,disabled:M.value.length===0},{default:a(()=>e[75]||(e[75]=[r(" 开始上传识别 ")])),_:1,__:[75]},8,["loading","disabled"])])]),default:a(()=>[s("div",fa,[s("div",ga,[l(ge,{title:"上传说明",type:"info","show-icon":"",closable:!1},{default:a(()=>e[65]||(e[65]=[s("div",{class:"tips-content"},[s("p",null,"1. 支持批量上传多张行驶证图片"),s("p",null,"2. 支持 JPG、PNG、BMP、TIFF、WEBP 格式"),s("p",null,"3. 每张图片不超过5MB"),s("p",null,"4. 系统将自动OCR识别行驶证信息并匹配车险记录"),s("p",null,"5. 请确保先录入车险信息再上传对应的行驶证")],-1)])),_:1,__:[65]})]),l(be,{ref_key:"driverLicenseUploadRef",ref:ee,class:"upload-demo",drag:"",multiple:"","auto-upload":!1,limit:0,accept:"image/*","on-change":Ie,"on-remove":ze,"file-list":ae.value},{tip:a(()=>e[66]||(e[66]=[s("div",{class:"el-upload__tip"}," 支持多张图片同时上传，每张不超过5MB ",-1)])),default:a(()=>[l(v,{class:"el-icon--upload"},{default:a(()=>[l(L(xe))]),_:1}),e[67]||(e[67]=s("div",{class:"el-upload__text"},[r(" 将行驶证图片拖到此处，或"),s("em",null,"点击上传")],-1))]),_:1,__:[67]},8,["file-list"]),w.value?(_(),b("div",ba,[l(x,null,{header:a(()=>e[68]||(e[68]=[s("span",null,"上传结果",-1)])),default:a(()=>[s("div",ya,[l(E,{gutter:20},{default:a(()=>[l(g,{span:8},{default:a(()=>{var t;return[s("div",wa,[s("div",Va,d(((t=w.value.results)==null?void 0:t.length)||0),1),e[69]||(e[69]=s("div",{class:"stat-label"},"总数",-1))])]}),_:1}),l(g,{span:8},{default:a(()=>[s("div",xa,[s("div",ha,d(w.value.success_count||0),1),e[70]||(e[70]=s("div",{class:"stat-label"},"成功",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[s("div",ka,[s("div",Da,d(w.value.fail_count||0),1),e[71]||(e[71]=s("div",{class:"stat-label"},"失败",-1))])]),_:1})]),_:1})]),w.value.results?(_(),b("div",Ya,[l(oe,{"content-position":"left"},{default:a(()=>e[72]||(e[72]=[r("处理详情")])),_:1,__:[72]}),s("div",Ca,[(_(!0),b(P,null,S(w.value.results,(t,T)=>(_(),b("div",{key:T,class:rl(["result-item",t.status])},[s("div",Ta,[s("span",Ua,d(t.file_name),1),l(N,{type:Ne(t.status),size:"small"},{default:a(()=>[r(d(Pe(t.status)),1)]),_:2},1032,["type"])]),t.status==="success"?(_(),b("div",Ma,[s("div",Ea,[s("span",Fa,"车牌号："+d(t.plate_no||"-"),1),s("span",La,"车架号："+d(t.vin||"-"),1),s("span",qa,"所有人："+d(t.owner||"-"),1)])])):(_(),b("div",Ra,[s("span",Ba,d(t.error_message),1)]))],2))),128))])])):h("",!0),w.value.errors&&w.value.errors.length>0?(_(),b("div",$a,[l(oe,{"content-position":"left"},{default:a(()=>e[73]||(e[73]=[r("错误汇总")])),_:1,__:[73]}),(_(!0),b(P,null,S(w.value.errors,(t,T)=>(_(),b("div",{class:"error-item",key:T},[l(N,{type:"danger",size:"small"},{default:a(()=>[r(d(t),1)]),_:2},1024)]))),128))])):h("",!0)]),_:1})])):h("",!0)])]),_:1},8,["modelValue"])])}}},st=He(za,[["__scopeId","data-v-756fd84d"]]);export{st as default};
