import{_ as ce,u as _e}from"./index-78e7e5a9.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                        *//* empty css                        *//* empty css                       *//* empty css                       */import{g as pe,a as me,m as ve}from"./receivable-f4b4aee8.js";import{a as fe,A as ge}from"./AttachmentUpload-bcc19096.js";import{r as i,j as ye,w as be,ae as he,l as d,B as u,C as s,F as a,G as l,H as K,I as W,D as n,af as ke,p as F,S as C,E as b,aT as xe,aH as Ve,K as De,an as Fe,M as Ce,ai as Se,O as c,aW as $e,al as Ee,a5 as Ae,a6 as Re,aG as we,ax as Me,ay as Pe,a7 as Te}from"./element-plus-e0a6c12c.js";/* empty css                 */import"./format-20468769.js";/* empty css                   *//* empty css                    */const Ue={class:"receivable-statistics-container"},Ye={class:"statistics-header"},Be={class:"statistics-card-list"},Le=["onClick"],Ie={class:"stat-main"},Ne={class:"stat-day"},Oe={class:"stat-status"},Ge={class:"stat-info"},qe={style:{color:"#e6a23c","font-weight":"bold"}},ze={style:{color:"#409eff"}},He={style:{color:"#67c23a"}},je={key:1,class:"no-data"},Ke={key:0,class:"detail-list-section"},We={class:"detail-list-title"},Je={style:{color:"#e6a23c","font-weight":"bold"}},Qe={style:{color:"#409eff"}},Xe={style:{color:"#67c23a"}},Ze={key:0,style:{color:"#67c23a","font-weight":"bold"}},et={key:1},tt={key:0,style:{color:"#f56c6c","font-weight":"bold"}},at={key:1},lt={key:0,style:{color:"#f56c6c"}},ot={key:1},st={key:0,style:{color:"#f56c6c"}},it={key:1},nt={class:"dialog-footer"},dt={__name:"index",setup(ut){const J=_e(),B=i([]),L=i(!1),h=i(""),k=i("");i([]),i(""),i(!1);const Q=[{label:"全部",value:""},{label:"待收款",value:"待收款"},{label:"已收款",value:"已收款"},{label:"已逾期",value:"已逾期"}],x=i(!1),S=i(null),$=i(!1),V=i(null),_=i({actual_amount:0,method:"",actual_date:""}),X={actual_amount:[{required:!0,message:"请输入实际收款金额",trigger:"blur"},{type:"number",min:.01,message:"金额必须大于0",trigger:"blur"}],method:[{required:!0,message:"请选择收款方式",trigger:"change"}],actual_date:[{required:!0,message:"请选择收款日期",trigger:"change"}]},E=i(!1),D=i(null),A=i(!1),R=i(null);function Z(o){V.value=o,_.value={actual_amount:o.amount,method:"微信",actual_date:new Date().toISOString().split("T")[0]},x.value=!0}async function ee(){S.value&&await S.value.validate(async o=>{if(o){$.value=!0;try{if(await ve(V.value.id,{actual_amount:_.value.actual_amount,actual_date:_.value.actual_date,method:_.value.method}),b.success("标记收款成功"),x.value=!1,v.value){const t=v.value.match(/(\d{4}-\d{2})月(\d+)号（(.+)）明细/);t&&await T(t[1],t[2],t[3])}}catch(t){b.error("标记收款失败："+(t.message||"未知错误"))}$.value=!1}})}function te(o){D.value=o,E.value=!0}function ae(o){R.value=o,A.value=!0}function le(o){o.order_id?J.push(`/order/detail/${o.order_id}`):b.warning("该应收计划未关联订单")}async function oe(){if(b.success("凭证上传成功"),v.value){const o=v.value.match(/(\d{4}-\d{2})月(\d+)号（(.+)）明细/);o&&await T(o[1],o[2],o[3])}}const I=ye(()=>B.value.filter(o=>!h.value||o.status===h.value)),w=async()=>{L.value=!0;try{const o={};if(k.value){let m=k.value;if(typeof m!="string"){const f=new Date(m);m=`${f.getFullYear()}-${String(f.getMonth()+1).padStart(2,"0")}`}o.month=m}const t=await pe(o);B.value=t.data}catch{b.error("获取还款日统计失败")}L.value=!1},M=i([]),P=i(!1),v=i("");be(()=>h.value,()=>{M.value=[],v.value=""});const T=async(o,t,m)=>{v.value=`${o}月${t}号（${m}）明细`,P.value=!0;try{const f=await me({month:o,day:t,status:m});M.value=f.data}catch{b.error("获取明细失败")}P.value=!1};return he(()=>{const o=new Date;k.value=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`,w()}),(o,t)=>{var O,G,q,z,H,j;const m=$e,f=xe,N=Ve,g=De,r=Ee,se=Fe,U=Ae,y=Re,ie=we,Y=Me,ne=Pe,de=Te,ue=Ce,re=Se;return d(),u("div",Ue,[s("div",Ye,[a(f,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e)},{default:l(()=>[(d(),u(K,null,W(Q,e=>a(m,{key:e.value,label:e.value},{default:l(()=>[c(n(e.label),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),a(N,{modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=e=>k.value=e),type:"month",placeholder:"选择月份",style:{width:"180px","margin-left":"20px"},onChange:w,clearable:""},null,8,["modelValue"]),a(g,{type:"primary",style:{"margin-left":"8px"},onClick:w},{default:l(()=>t[9]||(t[9]=[c("刷新")])),_:1,__:[9]})]),s("div",Be,[I.value.length>0?(d(!0),u(K,{key:0},W(I.value,e=>(d(),u("div",{key:e.month+"-"+e.repay_day+"-"+e.status,class:"stat-card",onClick:p=>T(e.month,e.repay_day,e.status),style:{cursor:"pointer"}},[s("div",Ie,[s("div",Ne,n(e.month)+"-"+n(e.repay_day),1),s("div",Oe,n(e.status),1)]),s("div",Ge,[s("div",null,[t[10]||(t[10]=c("还款单数：")),s("b",null,n(e.count),1)]),s("div",null,[t[11]||(t[11]=c("总金额：")),s("span",qe,"¥"+n(e.total_amount.toFixed(2)),1)]),s("div",null,[t[12]||(t[12]=c("本金统计：")),s("span",ze,"¥"+n(e.principal_total?e.principal_total.toFixed(2):"0.00"),1)]),s("div",null,[t[13]||(t[13]=c("利息统计：")),s("span",He,"¥"+n(e.interest_total?e.interest_total.toFixed(2):"0.00"),1)])])],8,Le))),128)):(d(),u("div",je,"暂无数据"))]),v.value?(d(),u("div",Ke,[s("div",We,n(v.value),1),ke((d(),F(se,{data:M.value,border:"",style:{"margin-top":"10px"}},{default:l(()=>[a(r,{prop:"order_no",label:"订单号",width:"180"},{default:l(({row:e})=>[a(g,{type:"primary",link:"",onClick:p=>le(e),disabled:!e.order_id},{default:l(()=>[c(n(e.order_no),1)]),_:2},1032,["onClick","disabled"])]),_:1}),a(r,{prop:"user.company_name",label:"借款人",width:"250"},{default:l(({row:e})=>{var p;return[s("span",null,n(((p=e.user)==null?void 0:p.company_name)||"-"),1)]}),_:1}),a(r,{prop:"period",label:"期数",width:"80",align:"center"}),a(r,{prop:"date",label:"应还日期",width:"120",align:"center"}),a(r,{prop:"amount",label:"应还金额",width:"120",align:"right"},{default:l(({row:e})=>[s("span",Je,"¥"+n(e.amount.toFixed(2)),1)]),_:1}),a(r,{prop:"principal_amount",label:"本金",width:"120",align:"right"},{default:l(({row:e})=>[s("span",Qe,"¥"+n(e.principal_amount.toFixed(2)),1)]),_:1}),a(r,{prop:"interest_amount",label:"利息",width:"120",align:"right"},{default:l(({row:e})=>[s("span",Xe,"¥"+n(e.interest_amount.toFixed(2)),1)]),_:1}),a(r,{prop:"actual_amount",label:"实际收款",width:"120",align:"right"},{default:l(({row:e})=>[e.actual_amount>0?(d(),u("span",Ze,"¥"+n(e.actual_amount.toFixed(2)),1)):(d(),u("span",et,"-"))]),_:1}),a(r,{prop:"actual_date",label:"实际收款日期",width:"120",align:"center"},{default:l(({row:e})=>[c(n(e.actual_date||"-"),1)]),_:1}),a(r,{prop:"overdue_days",label:"逾期天数",width:"100",align:"center"},{default:l(({row:e})=>[e.overdue_days>0?(d(),u("span",tt,n(e.overdue_days)+"天",1)):(d(),u("span",at,"-"))]),_:1}),a(r,{prop:"penalty_amount",label:"违约金",width:"100",align:"right"},{default:l(({row:e})=>[e.penalty_amount>0?(d(),u("span",lt,"¥"+n(e.penalty_amount.toFixed(2)),1)):(d(),u("span",ot,"-"))]),_:1}),a(r,{prop:"forfeit_amount",label:"滞纳金",width:"100",align:"right"},{default:l(({row:e})=>[e.forfeit_amount>0?(d(),u("span",st,"¥"+n(e.forfeit_amount.toFixed(2)),1)):(d(),u("span",it,"-"))]),_:1}),a(r,{label:"操作",width:"200",align:"center",fixed:"right"},{default:l(({row:e})=>[e.status==="待收款"||e.status==="已逾期"?(d(),F(g,{key:0,type:"primary",size:"small",onClick:p=>Z(e)},{default:l(()=>t[14]||(t[14]=[c(" 标记收款 ")])),_:2,__:[14]},1032,["onClick"])):C("",!0),e.status==="已收款"?(d(),F(g,{key:1,type:"success",size:"small",onClick:p=>te(e)},{default:l(()=>t[15]||(t[15]=[c(" 上传凭证 ")])),_:2,__:[15]},1032,["onClick"])):C("",!0),e.received_id?(d(),F(g,{key:2,type:"info",size:"small",onClick:p=>ae(e)},{default:l(()=>t[16]||(t[16]=[c(" 查看附件 ")])),_:2,__:[16]},1032,["onClick"])):C("",!0)]),_:1})]),_:1},8,["data"])),[[re,P.value]])])):C("",!0),a(ue,{modelValue:x.value,"onUpdate:modelValue":t[6]||(t[6]=e=>x.value=e),title:"标记收款",width:"500px","close-on-click-modal":!1},{footer:l(()=>[s("span",nt,[a(g,{onClick:t[5]||(t[5]=e=>x.value=!1)},{default:l(()=>t[17]||(t[17]=[c("取消")])),_:1,__:[17]}),a(g,{type:"primary",onClick:ee,loading:$.value},{default:l(()=>t[18]||(t[18]=[c(" 确定 ")])),_:1,__:[18]},8,["loading"])])]),default:l(()=>[a(de,{ref_key:"markAsPaidFormRef",ref:S,model:_.value,rules:X,"label-width":"120px"},{default:l(()=>[a(y,{label:"订单号"},{default:l(()=>{var e;return[a(U,{value:(e=V.value)==null?void 0:e.order_no,disabled:""},null,8,["value"])]}),_:1}),a(y,{label:"期数"},{default:l(()=>{var e;return[a(U,{value:`第${(e=V.value)==null?void 0:e.period}期`,disabled:""},null,8,["value"])]}),_:1}),a(y,{label:"应还金额"},{default:l(()=>{var e,p;return[a(U,{value:`¥${(p=(e=V.value)==null?void 0:e.amount)==null?void 0:p.toFixed(2)}`,disabled:""},null,8,["value"])]}),_:1}),a(y,{label:"实际收款金额",prop:"actual_amount"},{default:l(()=>[a(ie,{modelValue:_.value.actual_amount,"onUpdate:modelValue":t[2]||(t[2]=e=>_.value.actual_amount=e),min:0,precision:2,step:100,style:{width:"100%"},placeholder:"请输入实际收款金额"},null,8,["modelValue"])]),_:1}),a(y,{label:"收款方式",prop:"method"},{default:l(()=>[a(ne,{modelValue:_.value.method,"onUpdate:modelValue":t[3]||(t[3]=e=>_.value.method=e),placeholder:"请选择收款方式",style:{width:"100%"}},{default:l(()=>[a(Y,{label:"微信",value:"微信"}),a(Y,{label:"支付宝",value:"支付宝"}),a(Y,{label:"银行卡",value:"银行卡"})]),_:1},8,["modelValue"])]),_:1}),a(y,{label:"实际收款日期",prop:"actual_date"},{default:l(()=>[a(N,{modelValue:_.value.actual_date,"onUpdate:modelValue":t[4]||(t[4]=e=>_.value.actual_date=e),type:"date",placeholder:"选择收款日期",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(fe,{visible:E.value,"onUpdate:visible":t[7]||(t[7]=e=>E.value=e),title:`上传收款凭证 - ${((O=D.value)==null?void 0:O.order_no)||""} 第${(G=D.value)==null?void 0:G.period}期`,"order-id":((q=D.value)==null?void 0:q.order_id)||0,"ref-id":((z=D.value)==null?void 0:z.received_id)||0,type:"received",onSuccess:oe},null,8,["visible","title","order-id","ref-id"]),a(ge,{visible:A.value,"onUpdate:visible":t[8]||(t[8]=e=>A.value=e),title:"查看附件","order-id":((H=R.value)==null?void 0:H.order_id)||0,"ref-id":((j=R.value)==null?void 0:j.received_id)||0,type:"received","allow-delete":!0},null,8,["visible","order-id","ref-id"])])}}},Ft=ce(dt,[["__scopeId","data-v-4ba98d9c"]]);export{Ft as default};
