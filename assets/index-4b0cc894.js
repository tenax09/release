import{_ as _e,a as me,u as ce}from"./index-520d6774.js";/* empty css                   *//* empty css                        *//* empty css               *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                             *//* empty css                      *//* empty css                        *//* empty css                    */import{r as f,b as K,j as ge,ae as ye,l as U,B as G,C as b,F as a,G as t,a1 as ve,af as be,p as I,E as V,a5 as Ve,K as we,an as ke,aM as xe,M as Ce,ai as Ee,u as C,aJ as J,O as r,as as he,D as s,S as Ue,H as ze,I as De,J as Fe,a2 as $e,al as Ne,am as Be,az as Pe,aA as Se,a6 as Te,ax as Ie,ay as Le,ao as qe,ah as Me,aG as Oe,a7 as je}from"./element-plus-e9590f8a.js";import{g as Ke,c as Ge,u as Je,d as Re}from"./product-394464b7.js";import{g as R}from"./funder-5ee2a546.js";import{f as A}from"./format-20468769.js";const Ae={class:"product-container"},He={class:"filter-container"},Qe={class:"pagination"},We={class:"detail-container"},Xe={class:"detail-section"},Ye={class:"detail-section"},Ze={class:"detail-section"},ea={class:"dialog-footer"},aa={class:"dialog-footer"},ta={__name:"index",setup(la){const H=me();ce();const F=f([]),$=f(0),N=f(!0),_=K({page:1,page_size:20,keyword:""}),w=f(!1),B=f(""),P=f(""),m=f(null),y=f([]),S=f(!1),z=f(!1),d=f({}),n=K({id:void 0,funder_id:void 0,repay_type:"",loan_rate:void 0,periods:null,down_rate:void 0,penalty_rate:void 0,forfeit_rate:void 0,grace_day:void 0,remark:"",status:"上架"}),Q={funder_id:[{required:!0,message:"请选择资金方",trigger:"change"}],repay_type:[{required:!0,message:"请选择还款类型",trigger:"change"}],loan_rate:[{required:!0,message:"请输入利率",trigger:"blur"}],periods:[{required:!0,message:"请选择还款期数",trigger:"change"},{validator:(o,e,i)=>{e&&(e<1||e>360)?i(new Error("还款期数必须在1-360期之间")):i()},trigger:"change"}],down_rate:[{required:!0,message:"请输入首付比例",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},W=ge(()=>{const o=y.value.find(i=>i.id===n.funder_id),e=o?o.name:"";return!e||!n.repay_type||n.loan_rate===void 0||n.loan_rate===null||n.periods===void 0||n.periods===null||n.down_rate===void 0||n.down_rate===null?"":`${e}-${n.repay_type}-利率${n.loan_rate.toFixed(2)}%-${n.periods}期-首付${n.down_rate.toFixed(2)}%`}),k=async()=>{N.value=!0;try{const o=await Ke(_);F.value=o.data.list,$.value=o.data.total}catch(o){console.error("获取产品列表失败:",o),F.value=[],$.value=0,V({type:"error",message:"获取产品列表失败"})}finally{N.value=!1}},X=async o=>{if(!o){y.value=[];return}S.value=!0;try{const e=await R({page:1,page_size:50,keyword:o});y.value=e.data.list}catch(e){console.error("搜索资金方失败:",e),V({type:"error",message:"搜索资金方失败"})}finally{S.value=!1}},Y=()=>{y.value=[]},Z=o=>{if(o!=null){const e=Number(o);!isNaN(e)&&e>0?n.periods=Math.floor(e):n.periods=null}else n.periods=null},L=()=>{_.page=1,k()},ee=()=>{Object.assign(n,{id:void 0,funder_id:void 0,repay_type:"",loan_rate:void 0,periods:null,down_rate:void 0,penalty_rate:void 0,forfeit_rate:void 0,grace_day:void 0,remark:"",status:"上架"})},ae=()=>{ee(),y.value=[],B.value="create",P.value="新增产品",w.value=!0,m.value&&m.value.clearValidate()},te=async()=>{m.value&&await m.value.validate(async o=>{if(o)try{await Ge(n),await k(),w.value=!1,V({type:"success",message:"创建成功"})}catch(e){console.error("创建产品失败:",e),V({type:"error",message:"创建产品失败"})}})},le=async o=>{if(Object.assign(n,o),B.value="update",P.value="编辑产品",o.funder_id&&o.funder&&o.funder.name)y.value=[{id:o.funder_id,name:o.funder.name}];else if(o.funder_id)try{const i=(await R({page:1,page_size:100,keyword:""})).data.list.find(E=>E.id===o.funder_id);i&&(y.value=[i])}catch(e){console.error("获取资金方信息失败:",e)}w.value=!0,m.value&&m.value.clearValidate()},oe=async()=>{m.value&&await m.value.validate(async o=>{if(o){const e={...n};try{await Je(e.id,e),await k(),w.value=!1,V({type:"success",message:"更新成功"})}catch(i){console.error("更新产品失败:",i),V({type:"error",message:"更新失败"})}}})},ne=async o=>{try{await Fe.confirm("确认删除该产品?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Re(o.id),await k(),V({type:"success",message:"删除成功"})}catch(e){e!=="cancel"&&(console.error("删除产品失败:",e),V({type:"error",message:"删除失败"}))}},re=o=>{_.page_size=o,k()},se=o=>{_.page=o,k()},de=o=>{d.value={...o},z.value=!0};return ye(()=>{k()}),(o,e)=>{const i=$e,E=Ve,v=we,x=Ne,q=Be,ie=ke,ue=xe,u=Pe,T=Se,M=Ce,p=Te,c=Ie,D=Le,g=qe,O=Me,h=Oe,pe=je,fe=Ee;return U(),G("div",Ae,[b("div",He,[a(E,{modelValue:_.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>_.keyword=l),placeholder:"产品名称",style:{width:"450px !important"},class:"filter-item search-input",onKeyup:ve(L,["enter","native"])},{prefix:t(()=>[a(i,null,{default:t(()=>[a(C(J))]),_:1})]),_:1},8,["modelValue"]),a(v,{class:"filter-item",type:"primary",onClick:L,style:{"margin-left":"10px"}},{default:t(()=>[a(i,null,{default:t(()=>[a(C(J))]),_:1}),e[18]||(e[18]=r(" 搜索 "))]),_:1,__:[18]}),a(v,{class:"filter-item",type:"primary",onClick:ae,style:{"margin-left":"10px"}},{default:t(()=>[a(i,null,{default:t(()=>[a(C(he))]),_:1}),e[19]||(e[19]=r(" 新增产品 "))]),_:1,__:[19]})]),be((U(),I(ie,{data:F.value,border:"",fit:"","highlight-current-row":"",style:{width:"100%"}},{default:t(()=>[a(x,{label:"产品名称",prop:"name",align:"left","min-width":"350"}),a(x,{label:"利率",prop:"loan_rate",align:"center",width:"100"},{default:t(({row:l})=>[r(s(l.loan_rate)+"% ",1)]),_:1}),a(x,{label:"违约金%",prop:"penalty_rate",align:"center",width:"100"},{default:t(({row:l})=>[r(s(l.penalty_rate)+"% ",1)]),_:1}),a(x,{label:"滞纳金%",prop:"forfeit_rate",align:"center",width:"100"},{default:t(({row:l})=>[r(s(l.forfeit_rate)+"% ",1)]),_:1}),a(x,{label:"宽限期",prop:"grace_day",align:"center",width:"100"},{default:t(({row:l})=>[r(s(l.grace_day)+"天 ",1)]),_:1}),a(x,{label:"状态",prop:"status",align:"center",width:"80"},{default:t(({row:l})=>[a(q,{type:l.status==="上架"?"success":"info"},{default:t(()=>[r(s(l.status),1)]),_:2},1032,["type"])]),_:1}),a(x,{label:"操作",align:"center",width:"200","class-name":"small-padding fixed-width"},{default:t(({row:l})=>[a(v,{type:"primary",link:"",onClick:j=>de(l)},{default:t(()=>e[20]||(e[20]=[r("详情")])),_:2,__:[20]},1032,["onClick"]),a(v,{type:"primary",link:"",onClick:j=>le(l)},{default:t(()=>e[21]||(e[21]=[r("编辑")])),_:2,__:[21]},1032,["onClick"]),C(H).superPrivate?(U(),I(v,{key:0,type:"danger",link:"",onClick:j=>ne(l)},{default:t(()=>e[22]||(e[22]=[r("删除")])),_:2,__:[22]},1032,["onClick"])):Ue("",!0)]),_:1})]),_:1},8,["data"])),[[fe,N.value]]),b("div",Qe,[a(ue,{"current-page":_.page,"onUpdate:currentPage":e[1]||(e[1]=l=>_.page=l),"page-size":_.page_size,"onUpdate:pageSize":e[2]||(e[2]=l=>_.page_size=l),"page-sizes":[10,20,50,100],total:$.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:re,onCurrentChange:se},null,8,["current-page","page-size","total"])]),a(M,{modelValue:z.value,"onUpdate:modelValue":e[4]||(e[4]=l=>z.value=l),title:"产品详情",width:"800px","close-on-click-modal":!1,draggable:"",class:"custom-dialog"},{footer:t(()=>[b("div",ea,[a(v,{onClick:e[3]||(e[3]=l=>z.value=!1)},{default:t(()=>e[23]||(e[23]=[r("关 闭")])),_:1,__:[23]})])]),default:t(()=>[b("div",We,[b("div",Xe,[a(T,{column:2,border:""},{default:t(()=>[a(u,{label:"产品名称",span:2},{default:t(()=>[r(s(d.value.name),1)]),_:1}),a(u,{label:"状态"},{default:t(()=>[a(q,{type:d.value.status==="上架"?"success":"info"},{default:t(()=>[r(s(d.value.status),1)]),_:1},8,["type"])]),_:1})]),_:1})]),b("div",Ye,[a(T,{column:3,border:""},{default:t(()=>[a(u,{label:"还款方式"},{default:t(()=>[r(s(d.value.repay_type),1)]),_:1}),a(u,{label:"贷款利率"},{default:t(()=>[r(s(d.value.loan_rate)+"%",1)]),_:1}),a(u,{label:"还款期数"},{default:t(()=>[r(s(d.value.periods)+"期",1)]),_:1}),a(u,{label:"首付比例"},{default:t(()=>[r(s(d.value.down_rate)+"%",1)]),_:1}),a(u,{label:"违约金比例"},{default:t(()=>[r(s(d.value.penalty_rate)+"%",1)]),_:1}),a(u,{label:"滞纳金比例"},{default:t(()=>[r(s(d.value.forfeit_rate)+"%",1)]),_:1}),a(u,{label:"宽限期"},{default:t(()=>[r(s(d.value.grace_day)+"天",1)]),_:1})]),_:1})]),b("div",Ze,[a(T,{column:1,border:""},{default:t(()=>[a(u,{label:"备注"},{default:t(()=>[r(s(d.value.remark||"-"),1)]),_:1}),a(u,{label:"创建时间"},{default:t(()=>[r(s(C(A)(d.value.created_at)),1)]),_:1}),a(u,{label:"更新时间"},{default:t(()=>[r(s(C(A)(d.value.updated_at)),1)]),_:1})]),_:1})])])]),_:1},8,["modelValue"]),a(M,{modelValue:w.value,"onUpdate:modelValue":e[17]||(e[17]=l=>w.value=l),title:P.value,width:"700px","close-on-click-modal":!1,draggable:"",class:"custom-dialog"},{footer:t(()=>[b("div",aa,[a(v,{onClick:e[15]||(e[15]=l=>w.value=!1)},{default:t(()=>e[29]||(e[29]=[r("取 消")])),_:1,__:[29]}),a(v,{type:"primary",onClick:e[16]||(e[16]=l=>B.value==="create"?te():oe())},{default:t(()=>e[30]||(e[30]=[r(" 确 定 ")])),_:1,__:[30]})])]),default:t(()=>[a(pe,{ref_key:"dataForm",ref:m,rules:Q,model:n,"label-position":"right","label-width":"120px",class:"form-container"},{default:t(()=>[a(p,{label:"产品名称预览"},{default:t(()=>[a(E,{value:W.value,readonly:"",placeholder:"请完善配置信息后查看产品名称",style:{"background-color":"#f5f7fa"}},null,8,["value"])]),_:1}),a(O,{gutter:20},{default:t(()=>[a(g,{span:24},{default:t(()=>[a(p,{label:"资金方",prop:"funder_id"},{default:t(()=>[a(D,{modelValue:n.funder_id,"onUpdate:modelValue":e[5]||(e[5]=l=>n.funder_id=l),placeholder:"请输入资金方名称或代码搜索",clearable:"",filterable:"",remote:"","remote-method":X,loading:S.value,onClear:Y},{default:t(()=>[(U(!0),G(ze,null,De(y.value,l=>(U(),I(c,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),_:1}),a(O,{gutter:20},{default:t(()=>[a(g,{span:12},{default:t(()=>[a(p,{label:"还款类型",prop:"repay_type"},{default:t(()=>[a(D,{modelValue:n.repay_type,"onUpdate:modelValue":e[6]||(e[6]=l=>n.repay_type=l),placeholder:"请选择还款类型",clearable:""},{default:t(()=>[a(c,{label:"利息前置",value:"利息前置"}),a(c,{label:"等额本息",value:"等额本息"}),a(c,{label:"等额本金",value:"等额本金"}),a(c,{label:"先息后本",value:"先息后本"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(g,{span:12},{default:t(()=>[a(p,{label:"利率",prop:"loan_rate"},{default:t(()=>[a(h,{modelValue:n.loan_rate,"onUpdate:modelValue":e[7]||(e[7]=l=>n.loan_rate=l),precision:2,step:.01,min:0,"controls-position":o.right,style:{width:"100%"}},{suffix:t(()=>e[24]||(e[24]=[r("%")])),_:1},8,["modelValue","controls-position"])]),_:1})]),_:1}),a(g,{span:12},{default:t(()=>[a(p,{label:"还款期数",prop:"periods"},{default:t(()=>[a(D,{modelValue:n.periods,"onUpdate:modelValue":e[8]||(e[8]=l=>n.periods=l),placeholder:"请选择还款期数",filterable:"","allow-create":"",clearable:"",style:{width:"100%"},onChange:Z},{default:t(()=>[a(c,{label:"9期",value:9}),a(c,{label:"10期",value:10})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(g,{span:12},{default:t(()=>[a(p,{label:"首付比例",prop:"down_rate"},{default:t(()=>[a(h,{modelValue:n.down_rate,"onUpdate:modelValue":e[9]||(e[9]=l=>n.down_rate=l),precision:2,step:.01,min:0,max:100,"controls-position":o.right,style:{width:"100%"}},{suffix:t(()=>e[25]||(e[25]=[r("%")])),_:1},8,["modelValue","controls-position"])]),_:1})]),_:1}),a(g,{span:12},{default:t(()=>[a(p,{label:"违约金比例",prop:"penalty_rate"},{default:t(()=>[a(h,{modelValue:n.penalty_rate,"onUpdate:modelValue":e[10]||(e[10]=l=>n.penalty_rate=l),precision:2,step:.01,min:0,"controls-position":o.right,style:{width:"100%"}},{suffix:t(()=>e[26]||(e[26]=[r("%")])),_:1},8,["modelValue","controls-position"])]),_:1})]),_:1}),a(g,{span:12},{default:t(()=>[a(p,{label:"滞纳金比例",prop:"forfeit_rate"},{default:t(()=>[a(h,{modelValue:n.forfeit_rate,"onUpdate:modelValue":e[11]||(e[11]=l=>n.forfeit_rate=l),precision:2,step:.01,min:0,"controls-position":o.right,style:{width:"100%"}},{suffix:t(()=>e[27]||(e[27]=[r("%")])),_:1},8,["modelValue","controls-position"])]),_:1})]),_:1}),a(g,{span:12},{default:t(()=>[a(p,{label:"宽限期",prop:"grace_day"},{default:t(()=>[a(h,{modelValue:n.grace_day,"onUpdate:modelValue":e[12]||(e[12]=l=>n.grace_day=l),min:0,"controls-position":o.right,style:{width:"100%"}},{suffix:t(()=>e[28]||(e[28]=[r("天")])),_:1},8,["modelValue","controls-position"])]),_:1})]),_:1}),a(g,{span:12},{default:t(()=>[a(p,{label:"状态",prop:"status"},{default:t(()=>[a(D,{modelValue:n.status,"onUpdate:modelValue":e[13]||(e[13]=l=>n.status=l),placeholder:"请选择状态"},{default:t(()=>[a(c,{label:"上架",value:"上架"}),a(c,{label:"下架",value:"下架"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(p,{label:"备注",prop:"remark"},{default:t(()=>[a(E,{modelValue:n.remark,"onUpdate:modelValue":e[14]||(e[14]=l=>n.remark=l),type:"textarea",rows:3,placeholder:"请输入备注信息",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ba=_e(ta,[["__scopeId","data-v-563fda12"]]);export{ba as default};
