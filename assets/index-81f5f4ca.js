import{_ as ie}from"./index-36afcd41.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                             *//* empty css                        *//* empty css                       *//* empty css                       */import{g as ue,m as de,a as re,b as _e}from"./receivable-15fbb1bb.js";import{r as u,j as ce,w as pe,ae as ve,l as d,B as _,C as s,F as a,G as l,H as T,I as j,D as o,af as me,p as S,S as $,E as f,aX as fe,aP as ge,K as ye,an as be,M as he,ai as xe,O as n,a$ as ke,al as Ve,am as we,b0 as Fe,az as De,aA as Ee,a5 as Ce,a6 as Se,ax as $e,ay as Ie,a7 as Re}from"./element-plus-3147ea74.js";const Be={class:"receivable-statistics-container"},Ue={class:"statistics-header"},Le={class:"statistics-card-list"},Me=["onClick"],Te={class:"stat-main"},Ne={class:"stat-day"},Ae={class:"stat-status"},Pe={class:"stat-info"},Oe={style:{color:"#e6a23c","font-weight":"bold"}},ze={style:{color:"#409eff"}},Ge={style:{color:"#67c23a"}},Ye={key:1,class:"no-data"},je={key:0,class:"detail-list-section"},He={class:"detail-list-title"},Ke={style:{color:"#e6a23c","font-weight":"bold"}},We={style:{color:"#409eff"}},Xe={style:{color:"#67c23a"}},qe={key:0,style:{color:"#f56c6c"}},Je={key:1},Qe={key:0,style:{color:"#f56c6c"}},Ze={key:1},et={key:0,style:{color:"#67c23a","font-weight":"bold"}},tt={key:1},at={key:0,style:{color:"#f56c6c","font-weight":"bold"}},lt={key:1},ot={key:0,style:{"margin-top":"18px"}},st=["src"],nt=["src"],it=["src"],ut={__name:"index",setup(dt){const N=u([]),A=u(!1),h=u(""),x=u("");u([]),u(""),u(!1);const H=[{label:"全部",value:""},{label:"待收款",value:"待收款"},{label:"已收款",value:"已收款"},{label:"已逾期",value:"已逾期"}],k=u(!1),P=u(null),V=u(""),O=u(null),g=u(""),w=u("微信");function K(i){P.value=i,V.value="",O.value=null,g.value=i.amount,w.value="微信",k.value=!0}function W(i){const t=i.target.files[0];if(!t)return;const p=new FileReader;p.onload=function(m){V.value=m.target.result,O.value=t},p.readAsDataURL(t)}async function X(){const i=P.value;if(i){if(!g.value||isNaN(g.value)){f.warning("请输入收款金额");return}if(!w.value){f.warning("请选择收款方式");return}try{if(await de(i.id,{actual_amount:parseFloat(g.value),actual_date:new Date().toISOString().split("T")[0],receipt:V.value,method:w.value}),f.success("标记收款成功"),k.value=!1,y.value){const t=y.value.match(/(\d{4}-\d{2})月(\d+)号（(.+)）明细/);t&&await Y(t[1],t[2],t[3])}}catch{f.error("标记收款失败")}}}const z=ce(()=>N.value.filter(i=>!h.value||i.status===h.value)),I=async()=>{A.value=!0;try{const i={};if(x.value){let p=x.value;if(typeof p!="string"){const m=new Date(p);p=`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,"0")}`}i.month=p}const t=await ue(i);N.value=t.data}catch{f.error("获取还款日统计失败")}A.value=!1},R=u([]),B=u(!1),y=u(""),D=u(!1),r=u({}),E=u(!1);async function q(i){D.value=!0,E.value=!0;try{const t=await re(i.id);r.value=t.data}catch{f.error("获取详情失败"),r.value={}}E.value=!1}const G=u(""),U=u(!1);function J(i){G.value=i,U.value=!0}pe(()=>h.value,()=>{R.value=[],y.value=""});const Y=async(i,t,p)=>{y.value=`${i}月${t}号（${p}）明细`,B.value=!0;try{const m=await _e({month:i,day:t,status:p});R.value=m.data}catch{f.error("获取明细失败")}B.value=!1};return ve(()=>{const i=new Date;x.value=`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}`,I()}),(i,t)=>{const p=ke,m=fe,Q=ge,b=ye,c=Ve,Z=we,ee=be,te=Fe,v=De,ae=Ee,L=he,le=Ce,C=Se,M=$e,oe=Ie,se=Re,ne=xe;return d(),_("div",Be,[s("div",Ue,[a(m,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e)},{default:l(()=>[(d(),_(T,null,j(H,e=>a(p,{key:e.value,label:e.value},{default:l(()=>[n(o(e.label),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),a(Q,{modelValue:x.value,"onUpdate:modelValue":t[1]||(t[1]=e=>x.value=e),type:"month",placeholder:"选择月份",style:{width:"180px","margin-left":"20px"},onChange:I,clearable:""},null,8,["modelValue"]),a(b,{type:"primary",style:{"margin-left":"8px"},onClick:I},{default:l(()=>t[10]||(t[10]=[n("刷新")])),_:1,__:[10]})]),s("div",Le,[z.value.length>0?(d(!0),_(T,{key:0},j(z.value,e=>(d(),_("div",{key:e.month+"-"+e.repay_day+"-"+e.status,class:"stat-card",onClick:F=>Y(e.month,e.repay_day,e.status),style:{cursor:"pointer"}},[s("div",Te,[s("div",Ne,o(e.month)+"-"+o(e.repay_day),1),s("div",Ae,o(e.status),1)]),s("div",Pe,[s("div",null,[t[11]||(t[11]=n("还款单数：")),s("b",null,o(e.count),1)]),s("div",null,[t[12]||(t[12]=n("总金额：")),s("span",Oe,"¥"+o(e.total_amount.toFixed(2)),1)]),s("div",null,[t[13]||(t[13]=n("本金统计：")),s("span",ze,"¥"+o(e.principal_total?e.principal_total.toFixed(2):"0.00"),1)]),s("div",null,[t[14]||(t[14]=n("利息统计：")),s("span",Ge,"¥"+o(e.interest_total?e.interest_total.toFixed(2):"0.00"),1)])])],8,Me))),128)):(d(),_("div",Ye,"暂无数据"))]),y.value?(d(),_("div",je,[s("div",He,o(y.value),1),me((d(),S(ee,{data:R.value,border:"",style:{"margin-top":"10px"}},{default:l(()=>[a(c,{prop:"order_no",label:"订单号",width:"180"},{default:l(({row:e})=>[s("span",null,o(e.order_no),1)]),_:1}),a(c,{prop:"user.company_name",label:"借款人",width:"220"},{default:l(({row:e})=>{var F;return[s("span",null,o(((F=e.user)==null?void 0:F.company_name)||"-"),1)]}),_:1}),a(c,{prop:"period",label:"期数",width:"80",align:"center"}),a(c,{prop:"date",label:"应还日期",width:"120",align:"center"}),a(c,{prop:"amount",label:"应还金额",width:"120",align:"right"},{default:l(({row:e})=>[s("span",Ke,"¥"+o(e.amount.toFixed(2)),1)]),_:1}),a(c,{prop:"principal_amount",label:"本金",width:"120",align:"right"},{default:l(({row:e})=>[s("span",We,"¥"+o(e.principal_amount.toFixed(2)),1)]),_:1}),a(c,{prop:"interest_amount",label:"利息",width:"120",align:"right"},{default:l(({row:e})=>[s("span",Xe,"¥"+o(e.interest_amount.toFixed(2)),1)]),_:1}),a(c,{prop:"penalty_amount",label:"违约金",width:"100",align:"right"},{default:l(({row:e})=>[e.penalty_amount>0?(d(),_("span",qe,"¥"+o(e.penalty_amount.toFixed(2)),1)):(d(),_("span",Je,"-"))]),_:1}),a(c,{prop:"forfeit_amount",label:"滞纳金",width:"100",align:"right"},{default:l(({row:e})=>[e.forfeit_amount>0?(d(),_("span",Qe,"¥"+o(e.forfeit_amount.toFixed(2)),1)):(d(),_("span",Ze,"-"))]),_:1}),a(c,{prop:"actual_amount",label:"实际收款",width:"120",align:"right"},{default:l(({row:e})=>[e.actual_amount>0?(d(),_("span",et,"¥"+o(e.actual_amount.toFixed(2)),1)):(d(),_("span",tt,"-"))]),_:1}),a(c,{prop:"actual_date",label:"实际收款日期",width:"120",align:"center"},{default:l(({row:e})=>[n(o(e.actual_date||"-"),1)]),_:1}),a(c,{prop:"overdue_days",label:"逾期天数",width:"100",align:"center"},{default:l(({row:e})=>[e.overdue_days>0?(d(),_("span",at,o(e.overdue_days)+"天",1)):(d(),_("span",lt,"-"))]),_:1}),a(c,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(({row:e})=>[a(Z,{type:e.status==="待收款"?"warning":e.status==="已收款"?"success":e.status==="已逾期"?"danger":"info"},{default:l(()=>[n(o(e.status),1)]),_:2},1032,["type"])]),_:1}),a(c,{label:"操作",width:"220",align:"center",fixed:"right"},{default:l(({row:e})=>[e.status==="待收款"||e.status==="已逾期"?(d(),S(b,{key:0,type:"primary",size:"small",onClick:F=>K(e)},{default:l(()=>t[15]||(t[15]=[n("标记收款/上传凭证")])),_:2,__:[15]},1032,["onClick"])):$("",!0),a(b,{type:"info",size:"small",onClick:F=>q(e)},{default:l(()=>t[16]||(t[16]=[n("详情")])),_:2,__:[16]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,B.value]])])):$("",!0),a(L,{modelValue:D.value,"onUpdate:modelValue":t[5]||(t[5]=e=>D.value=e),title:"应收计划详情",width:"600px"},{footer:l(()=>[a(b,{onClick:t[4]||(t[4]=e=>D.value=!1)},{default:l(()=>t[18]||(t[18]=[n("关闭")])),_:1,__:[18]})]),default:l(()=>[E.value?(d(),S(te,{key:0,loading:E.value,animated:"",rows:6},null,8,["loading"])):(d(),_(T,{key:1},[a(ae,{column:2,border:""},{default:l(()=>[a(v,{label:"订单号"},{default:l(()=>[n(o(r.value.order_no),1)]),_:1}),a(v,{label:"借款人"},{default:l(()=>{var e;return[n(o(((e=r.value.user)==null?void 0:e.company_name)||"-"),1)]}),_:1}),a(v,{label:"应还日期"},{default:l(()=>[n(o(r.value.date),1)]),_:1}),a(v,{label:"应还金额"},{default:l(()=>{var e;return[n("¥"+o((e=r.value.amount)==null?void 0:e.toFixed(2)),1)]}),_:1}),a(v,{label:"本金"},{default:l(()=>{var e;return[n("¥"+o((e=r.value.principal_amount)==null?void 0:e.toFixed(2)),1)]}),_:1}),a(v,{label:"利息"},{default:l(()=>{var e;return[n("¥"+o((e=r.value.interest_amount)==null?void 0:e.toFixed(2)),1)]}),_:1}),a(v,{label:"违约金"},{default:l(()=>{var e;return[n("¥"+o((e=r.value.penalty_amount)==null?void 0:e.toFixed(2)),1)]}),_:1}),a(v,{label:"滞纳金"},{default:l(()=>{var e;return[n("¥"+o((e=r.value.forfeit_amount)==null?void 0:e.toFixed(2)),1)]}),_:1}),a(v,{label:"实际收款"},{default:l(()=>{var e;return[n("¥"+o((e=r.value.actual_amount)==null?void 0:e.toFixed(2)),1)]}),_:1}),a(v,{label:"实际收款日期"},{default:l(()=>[n(o(r.value.actual_date||"-"),1)]),_:1}),a(v,{label:"逾期天数"},{default:l(()=>[n(o(r.value.overdue_days>0?r.value.overdue_days+"天":"-"),1)]),_:1}),a(v,{label:"收款方式"},{default:l(()=>[n(o(r.value.received.method||"-"),1)]),_:1})]),_:1}),r.value.received&&r.value.received.receipt?(d(),_("div",ot,[t[17]||(t[17]=s("div",{style:{"font-weight":"bold","margin-bottom":"6px"}},"支付凭证：",-1)),s("img",{src:r.value.received.receipt,alt:"支付凭证",style:{"max-width":"320px","max-height":"200px",border:"1px solid #eee",cursor:"pointer"},onClick:t[2]||(t[2]=e=>J(r.value.received.receipt))},null,8,st)])):$("",!0),a(L,{modelValue:U.value,"onUpdate:modelValue":t[3]||(t[3]=e=>U.value=e),width:"auto","show-close":!0,title:"凭证大图","append-to-body":""},{default:l(()=>[s("img",{src:G.value,style:{"max-width":"90vw","max-height":"80vh",display:"block",margin:"0 auto"}},null,8,nt)]),_:1},8,["modelValue"])],64))]),_:1},8,["modelValue"]),a(L,{modelValue:k.value,"onUpdate:modelValue":t[9]||(t[9]=e=>k.value=e),title:"标记收款并上传凭证",width:"400px"},{footer:l(()=>[a(b,{onClick:t[8]||(t[8]=e=>k.value=!1)},{default:l(()=>t[19]||(t[19]=[n("取消")])),_:1,__:[19]}),a(b,{type:"primary",onClick:X},{default:l(()=>t[20]||(t[20]=[n("确定")])),_:1,__:[20]})]),default:l(()=>[a(se,{"label-width":"90px"},{default:l(()=>[a(C,{label:"收款金额"},{default:l(()=>[a(le,{modelValue:g.value,"onUpdate:modelValue":t[6]||(t[6]=e=>g.value=e),placeholder:"请输入收款金额"},null,8,["modelValue"])]),_:1}),a(C,{label:"收款方式"},{default:l(()=>[a(oe,{modelValue:w.value,"onUpdate:modelValue":t[7]||(t[7]=e=>w.value=e),placeholder:"请选择收款方式",style:{width:"100%"}},{default:l(()=>[a(M,{label:"微信",value:"微信"}),a(M,{label:"支付宝",value:"支付宝"}),a(M,{label:"银行卡",value:"银行卡"})]),_:1},8,["modelValue"])]),_:1}),a(C,{label:"收款凭证"},{default:l(()=>[s("input",{type:"file",accept:"image/*",onChange:W},null,32)]),_:1}),V.value?(d(),S(C,{key:0},{default:l(()=>[s("img",{src:V.value,alt:"预览",style:{"max-width":"100%","max-height":"180px",border:"1px solid #eee"}},null,8,it)]),_:1})):$("",!0)]),_:1})]),_:1},8,["modelValue"])])}}},ht=ie(ut,[["__scopeId","data-v-1dfe371d"]]);export{ht as default};
