import{_ as Ml,b as Rl,u as Il}from"./index-977e0fd9.js";/* empty css               *//* empty css                   *//* empty css                    *//* empty css                 *//* empty css                       *//* empty css                     *//* empty css                        *//* empty css                        *//* empty css                  *//* empty css                *//* empty css               *//* empty css                       */import{r as n,j as Ge,w as Ll,ae as Sl,l as g,B as k,C as s,F as l,G as a,p as O,S as C,af as We,u as w,E as i,aE as Bl,ag as $l,M as ql,ai as Al,aG as Ol,O as u,av as Je,aH as He,aI as zl,Q as Pl,as as Nl,D as v,H as Ye,I as Me,aw as ve,J as jl,a2 as Gl,K as Wl,ao as Jl,ah as Hl,am as Kl,al as Ql,an as Xl,a5 as Zl,a6 as ea,ax as la,ay as aa,aJ as ta,aK as sa,aL as oa,a7 as ua,aB as na,aC as ra,aD as ia}from"./element-plus-eb4b90a0.js";import{i as da,a as pa,j as Ke,k as ma,l as va,u as ca,e as _a,m as fa,n as ga}from"./order-d005cce5.js";import{a as ba}from"./user-dc016a7a.js";import{a as ya,A as wa,d as Va}from"./AttachmentUpload-ca7d4278.js";/* empty css                 */import"./format-20468769.js";const ka={class:"insurance-detail"},xa={class:"page-header"},ha={class:"header-actions"},Ua={class:"stat-item"},Ca={class:"stat-number"},Da={class:"stat-item"},Fa={class:"stat-number"},Ta={class:"stat-item"},Ea={class:"stat-number"},Ya={class:"stat-item total"},Ma={class:"stat-number"},Ra={class:"attachment-status"},Ia={class:"status-item"},La={class:"status-item"},Sa={class:"stat-item total"},Ba={class:"stat-number"},$a={class:"stat-item"},qa={class:"stat-number"},Aa={class:"stat-item"},Oa={class:"stat-number"},za={class:"insured-input"},Pa={class:"dialog-footer"},Na={class:"insured-input"},ja={class:"dialog-footer"},Ga={class:"upload-content"},Wa={class:"upload-tips"},Ja={key:0,class:"import-result"},Ha={class:"result-summary"},Ka={class:"stat-item"},Qa={class:"stat-number total"},Xa={class:"stat-item"},Za={class:"stat-number success"},et={class:"stat-item"},lt={class:"stat-number fail"},at={key:0,class:"error-list"},tt={class:"dialog-footer"},st={class:"upload-content"},ot={class:"upload-tips"},ut={key:0,class:"upload-status"},nt={class:"status-content"},rt={class:"dialog-footer"},it={class:"upload-content"},dt={class:"upload-tips"},pt={key:0,class:"upload-status"},mt={class:"status-content"},vt={class:"dialog-footer"},ct={class:"dialog-footer"},_t={class:"upload-content"},ft={class:"upload-tips"},gt={class:"tips-content"},bt={key:0},yt={key:1},wt={key:0,class:"import-result"},Vt={class:"result-summary"},kt={class:"stat-item"},xt={class:"stat-number total"},ht={class:"stat-item"},Ut={class:"stat-number success"},Ct={class:"stat-item"},Dt={class:"stat-number fail"},Ft={key:0,class:"result-details"},Tt={class:"dialog-footer"},Et={__name:"insurance",setup(Yt){const V=Rl(),Re=Il(),le=n(!1),z=n(!1),D=n([]),_=n("车险"),Qe=n({}),Xe=n({}),$=n([]),ae=n(!1),j=n(null),ce=n(!1),L=n(null),_e=n([]),x=n(null),G=n(!1),fe=n(null),W=n(!1),M=n([]),ge=n([]),J=n(!1),be=n(null),te=n(!1),R=n([]),ye=n([]),H=n(!1),we=n(null),Ve=n(!1),F=n(null),K=n({status:""}),Ze={status:[{required:!0,message:"请选择新状态",trigger:"change"}]},se=n(!1),Q=n(null),ke=n(!1),S=n(null),xe=n([]),h=n(null),he=n(!1),P=n(0),X=n(""),oe=n(""),ue=n(!1),ne=n([]),Z=n(!1),Ue=n(null),c=n({car_no:"",vin:"",insurance_no:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,compulsory_amount:void 0,vehicle_tax_amount:void 0,start_date:"",end_date:""}),el={car_no:[{required:!0,message:"请输入车牌号",trigger:"blur"}],vin:[{required:!0,message:"请输入车架号",trigger:"blur"}],insurance_no:[{required:!0,message:"请输入投保单号",trigger:"blur"}],insured:[{required:!0,message:"请选择被保人",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}]},ee=n(!1),Ce=n(null),p=n({track_no:"",insurance_no:"",name:"",quantity:"",carrier:"",consignee:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,start_date:"",end_date:""}),ll={track_no:[{required:!0,message:"请输入运输编号",trigger:"blur"}],insurance_no:[{required:!0,message:"请输入投保单号",trigger:"blur"}],name:[{required:!0,message:"请输入货物名称",trigger:"blur"}],quantity:[{required:!0,message:"请输入货物数量",trigger:"blur"}],carrier:[{required:!0,message:"请输入承运人",trigger:"blur"}],consignee:[{required:!0,message:"请输入收货人",trigger:"blur"}],insured:[{required:!0,message:"请选择被保人",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}]},De=o=>({正常:"success",结清退保:"success",逾期退保:"danger",提前结清:"success",逾期结清:"danger",退保结清:"danger"})[o]||"info",al=()=>{Re.back()},tl=()=>{Re.push(`/order/detail/${V.params.id}`)},U=async()=>{le.value=!0;try{const o=await da(V.params.id);D.value=o.data.insurances||[],o.data.type&&(_.value=o.data.type)}catch{i.error("获取投保信息失败")}le.value=!1},T=o=>o?`¥${o.toFixed(2)}`:"¥0.00",re=Ge(()=>{if(_.value!=="车险"||!D.value.length)return{commercialTotal:0,compulsoryTotal:0,vehicleTaxTotal:0,grandTotal:0};const o=D.value.reduce((e,d)=>(e.commercialTotal+=d.commercial_amount||0,e.compulsoryTotal+=d.compulsory_amount||0,e.vehicleTaxTotal+=d.vehicle_tax_amount||0,e),{commercialTotal:0,compulsoryTotal:0,vehicleTaxTotal:0});return o.grandTotal=o.commercialTotal+o.compulsoryTotal+o.vehicleTaxTotal,o}),Ie=Ge(()=>{if(_.value!=="货运险"||!D.value.length)return{commercialTotal:0,averageAmount:0};const o=D.value.reduce((d,r)=>d+(r.commercial_amount||0),0),e=o/D.value.length;return{commercialTotal:o,averageAmount:e}}),sl=()=>{if(_.value==="车险"){if(c.value={car_no:"",vin:"",insurance_no:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,compulsory_amount:void 0,vehicle_tax_amount:void 0,start_date:"",end_date:""},$.value.length===2){const o=$.value.find(e=>e.value!=="同借款人");o&&(c.value.insured=o.value)}Z.value=!0}else if(_.value==="货运险"){if(p.value={track_no:"",insurance_no:"",name:"",quantity:"",carrier:"",consignee:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,start_date:"",end_date:""},$.value.length===2){const o=$.value.find(e=>e.value!=="同借款人");o&&(p.value.insured=o.value)}ee.value=!0}},ol=async()=>{Ue.value&&await Ue.value.validate(async o=>{if(o){z.value=!0;try{await Ke(V.params.id,c.value),i.success("添加车险信息成功"),Z.value=!1,U()}catch(e){i.error("添加车险信息失败："+(e.message||"未知错误"))}z.value=!1}})},ul=async()=>{Ce.value&&await Ce.value.validate(async o=>{if(o){z.value=!0;try{await Ke(V.params.id,p.value),i.success("添加货运险信息成功"),ee.value=!1,U()}catch(e){i.error("添加货运险信息失败："+(e.message||"未知错误"))}z.value=!1}})},Le=async o=>{try{await jl.confirm("确定要删除该投保信息吗？","提示",{type:"warning"}),await ma(V.params.id,o.id),i.success("删除成功"),U()}catch(e){e!=="cancel"&&i.error("删除失败："+(e.message||"未知错误"))}},Se=(o,e)=>{const d=e==="car"?o.car_no:o.track_no;oe.value=d,P.value=o.id,X.value=e,he.value=!0},Be=(o,e)=>{const d=e==="car"?o.car_no:o.track_no;oe.value=d,P.value=o.id,X.value=e,ne.value=o.attachments||[],ue.value=!0};Ll(ue,o=>{o||(ne.value=[],P.value=0,X.value="")});const nl=async()=>{await U();const o=D.value.find(e=>e.id===P.value);o&&(ne.value=o.attachments||[])},rl=async o=>{try{await Va(o)}catch(e){i.error("删除失败："+(e.message||"未知错误"))}},il=async()=>{window.open(`/api/admin/orders/insurances/download-template?type=${_.value}`,"_blank")},dl=async()=>{window.open(`/api/admin/orders/insurances/download-status-template?type=${_.value}`,"_blank")},pl=()=>{S.value=null,xe.value=[],h.value=null,se.value=!0},ml=o=>{if(S.value=o.raw,!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(o.raw.type)&&!o.name.toLowerCase().endsWith(".xlsx")&&!o.name.toLowerCase().endsWith(".xls")){i.error("请上传Excel文件(.xlsx或.xls)"),Q.value.clearFiles(),S.value=null;return}if(o.raw.size>10*1024*1024){i.error("文件大小不能超过10MB"),Q.value.clearFiles(),S.value=null;return}},vl=async()=>{if(!S.value){i.error("请选择要上传的文件");return}const o=new FormData;o.append("file",S.value),ke.value=!0,h.value=null;try{const e=await va(V.params.id,o);h.value=e.data,e.data.success_count>0?(U(),i.success(`更新完成：成功${e.data.success_count}条，失败${e.data.fail_count}条`)):i.warning("没有成功更新任何数据，请检查文件格式")}catch(e){i.error("更新失败："+(e.message||"未知错误"))}ke.value=!1},cl=()=>{se.value=!1,S.value=null,xe.value=[],h.value=null,Q.value&&Q.value.clearFiles()},$e=o=>{F.value=o,K.value.status="",H.value=!0},_l=async()=>{we.value&&await we.value.validate(async o=>{if(o){Ve.value=!0;try{await ca(V.params.id,F.value.id,K.value),i.success("状态更新成功"),H.value=!1,U()}catch(e){i.error("状态更新失败："+(e.message||"未知错误"))}Ve.value=!1}})},fl=()=>{L.value=null,_e.value=[],x.value=null,ae.value=!0},gl=o=>{if(L.value=o.raw,!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(o.raw.type)&&!o.name.toLowerCase().endsWith(".xlsx")&&!o.name.toLowerCase().endsWith(".xls")){i.error("请上传Excel文件(.xlsx或.xls)"),j.value.clearFiles(),L.value=null;return}if(o.raw.size>10*1024*1024){i.error("文件大小不能超过10MB"),j.value.clearFiles(),L.value=null;return}},bl=async()=>{if(!L.value){i.error("请选择要上传的文件");return}const o=new FormData;o.append("file",L.value),ce.value=!0,x.value=null;try{const e=await _a(V.params.id,o);x.value=e.data,e.data.success>0?(U(),i.success(`导入完成：成功${e.data.success}条，失败${e.data.fail}条`)):i.warning("没有成功导入任何数据，请检查文件格式")}catch(e){i.error("导入失败："+(e.message||"未知错误"))}ce.value=!1},yl=()=>{ae.value=!1,L.value=null,_e.value=[],x.value=null,j.value&&j.value.clearFiles()},qe=o=>{o==="car"?c.value.same_as_borrower?c.value.insured="同借款人":c.value.insured="":o==="cargo"&&(p.value.same_as_borrower?p.value.insured="同借款人":p.value.insured="")},wl=()=>{M.value=[],ge.value=[],G.value=!0},Vl=o=>{if(!["image/jpeg","image/jpg","image/png","image/bmp","image/tiff","image/webp"].includes(o.raw.type))return i.error("请上传图片文件"),!1;if(o.raw.size>5*1024*1024)return i.error("图片大小不能超过5MB"),!1;M.value.push(o.raw)},kl=o=>{const e=M.value.findIndex(d=>d.name===o.name);e!==-1&&M.value.splice(e,1)},xl=()=>{G.value=!1,M.value=[],ge.value=[],fe.value&&fe.value.clearFiles()},hl=async()=>{if(M.value.length===0){i.error("请选择要上传的行驶证图片");return}const o=new FormData;M.value.forEach(e=>{o.append("images",e)}),W.value=!0;try{await fa(V.params.id,o),i.success("行驶证上传成功，正在后台处理OCR识别"),setTimeout(()=>{W.value=!1,G.value=!1,U()},2e3)}catch(e){i.error("行驶证上传失败："+(e.message||"未知错误"))}W.value=!1},Ul=()=>{R.value=[],ye.value=[],J.value=!0},Cl=o=>{if(!["image/jpeg","image/jpg","image/png","image/bmp","image/tiff","image/webp"].includes(o.raw.type))return i.error("请上传图片文件"),!1;if(o.raw.size>5*1024*1024)return i.error("图片大小不能超过5MB"),!1;R.value.push(o.raw)},Dl=o=>{const e=R.value.findIndex(d=>d.name===o.name);e!==-1&&R.value.splice(e,1)},Fl=()=>{J.value=!1,R.value=[],ye.value=[],be.value&&be.value.clearFiles()},Tl=async()=>{if(R.value.length===0){i.error("请选择要上传的投保单图片");return}const o=new FormData;R.value.forEach(e=>{o.append("images",e)}),te.value=!0;try{await ga(V.params.id,o),i.success("投保单上传成功，正在后台处理OCR识别"),setTimeout(()=>{te.value=!1,J.value=!1,U()},2e3)}catch(e){i.error("投保单上传失败："+(e.message||"未知错误"))}},ie=(o,e)=>!o||o.length===0?!1:o.some(d=>d.remark===e),El=async()=>{try{const o=await pa(V.params.id);Qe.value=o.data,o.data.user_id&&await Yl(o.data.user_id)}catch{i.error("获取订单详情失败")}},Yl=async o=>{try{const e=await ba(o);Xe.value=e.data;const d=e.data.insureds||"",r=[];r.push({value:"同借款人",label:"同借款人"}),d&&d.split(";").filter(y=>y.trim()).forEach(y=>{const B=y.split(",");if(B.length>=2){const E=B[0].trim(),Y=B[1].trim();r.push({value:E,label:Y?`${E} (${Y})`:E})}}),$.value=r}catch{i.error("获取用户配置失败")}};return Sl(()=>{U(),El()}),(o,e)=>{var Ne,je;const d=Gl,r=Wl,Ae=Bl,y=Jl,B=Hl,E=$l,Y=Kl,m=Ql,Fe=Xl,I=Zl,f=ea,q=la,Te=aa,Oe=ta,de=sa,pe=oa,Ee=ua,A=ql,N=na,me=ra,ze=ia,Pe=Al;return g(),k("div",ka,[s("div",xa,[l(Ae,{onBack:al,title:`${_.value}`},{extra:a(()=>[s("div",ha,[l(r,{onClick:tl},{default:a(()=>[l(d,null,{default:a(()=>[l(w(Ol))]),_:1}),e[36]||(e[36]=u(" 返回详情 "))]),_:1,__:[36]}),l(r,{onClick:il},{default:a(()=>[l(d,null,{default:a(()=>[l(w(Je))]),_:1}),e[37]||(e[37]=u(" 下载模板 "))]),_:1,__:[37]}),l(r,{type:"success",onClick:fl},{default:a(()=>[l(d,null,{default:a(()=>[l(w(He))]),_:1}),e[38]||(e[38]=u(" 批量导入 "))]),_:1,__:[38]}),_.value==="车险"?(g(),O(r,{key:0,type:"warning",onClick:wl},{default:a(()=>[l(d,null,{default:a(()=>[l(w(zl))]),_:1}),e[39]||(e[39]=u(" 上传行驶证 "))]),_:1,__:[39]})):C("",!0),l(r,{type:"info",onClick:Ul},{default:a(()=>[l(d,null,{default:a(()=>[l(w(Pl))]),_:1}),e[40]||(e[40]=u(" 上传投保单 "))]),_:1,__:[40]}),l(r,{type:"warning",onClick:dl},{default:a(()=>[l(d,null,{default:a(()=>[l(w(Je))]),_:1}),e[41]||(e[41]=u(" 下载状态模板 "))]),_:1,__:[41]}),l(r,{type:"danger",onClick:pl},{default:a(()=>[l(d,null,{default:a(()=>[l(w(He))]),_:1}),e[42]||(e[42]=u(" 批量更新状态 "))]),_:1,__:[42]}),l(r,{type:"primary",onClick:sl},{default:a(()=>[l(d,null,{default:a(()=>[l(w(Nl))]),_:1}),u(" 添加"+v(_.value),1)]),_:1})])]),_:1},8,["title"])]),_.value==="车险"?(g(),O(E,{key:0,class:"detail-card"},{default:a(()=>[l(B,{gutter:20},{default:a(()=>[l(y,{span:6},{default:a(()=>[s("div",Ua,[s("div",Ca,v(T(re.value.commercialTotal)),1),e[43]||(e[43]=s("div",{class:"stat-label"},"商业险总金额",-1))])]),_:1}),l(y,{span:6},{default:a(()=>[s("div",Da,[s("div",Fa,v(T(re.value.compulsoryTotal)),1),e[44]||(e[44]=s("div",{class:"stat-label"},"交强险总金额",-1))])]),_:1}),l(y,{span:6},{default:a(()=>[s("div",Ta,[s("div",Ea,v(T(re.value.vehicleTaxTotal)),1),e[45]||(e[45]=s("div",{class:"stat-label"},"车船税总金额",-1))])]),_:1}),l(y,{span:6},{default:a(()=>[s("div",Ya,[s("div",Ma,v(T(re.value.grandTotal)),1),e[46]||(e[46]=s("div",{class:"stat-label"},"合计总保费",-1))])]),_:1})]),_:1})]),_:1})):C("",!0),_.value==="车险"?We((g(),O(E,{key:1,class:"detail-card"},{default:a(()=>[l(Fe,{data:D.value,border:"",style:{width:"100%"}},{default:a(()=>[l(m,{prop:"status",label:"状态",width:"100",align:"center"},{default:a(({row:t})=>[l(Y,{type:De(t.status)},{default:a(()=>[u(v(t.status),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"car_no",label:"车牌号",width:"100"}),l(m,{prop:"vin",label:"车架号","min-width":"180"}),l(m,{prop:"issue_date",label:"附件标记",width:"120",align:"center"},{default:a(t=>[s("div",Ra,[s("div",Ia,[e[47]||(e[47]=s("span",{class:"status-label"},"行驶证:",-1)),l(Y,{type:ie(t.row.attachments,"行驶证")?"success":"info",size:"small"},{default:a(()=>[u(v(ie(t.row.attachments,"行驶证")?"已上传":"未上传"),1)]),_:2},1032,["type"])]),s("div",La,[e[48]||(e[48]=s("span",{class:"status-label"},"投保单:",-1)),l(Y,{type:ie(t.row.attachments,"投保单")?"success":"info",size:"small"},{default:a(()=>[u(v(ie(t.row.attachments,"投保单")?"已上传":"未上传"),1)]),_:2},1032,["type"])])])]),_:1}),l(m,{prop:"insured",label:"被保人",width:"280"}),l(m,{prop:"commercial_amount",label:"商业险",width:"100"},{default:a(t=>[u(v(T(t.row.commercial_amount)),1)]),_:1}),l(m,{prop:"compulsory_amount",label:"交强险",width:"100"},{default:a(t=>[u(v(T(t.row.compulsory_amount)),1)]),_:1}),l(m,{prop:"vehicle_tax_amount",label:"车船税",width:"100"},{default:a(t=>[u(v(T(t.row.vehicle_tax_amount)),1)]),_:1}),l(m,{prop:"start_date",label:"开始日期",width:"110"}),l(m,{prop:"end_date",label:"结束日期",width:"110"}),l(m,{label:"操作",width:"200",fixed:"right"},{default:a(t=>[l(r,{type:"info",link:"",onClick:b=>Be(t.row,"car")},{default:a(()=>e[49]||(e[49]=[u("附件")])),_:2,__:[49]},1032,["onClick"]),l(r,{type:"primary",link:"",onClick:b=>Se(t.row,"car")},{default:a(()=>e[50]||(e[50]=[u("上传")])),_:2,__:[50]},1032,["onClick"]),l(r,{type:"warning",link:"",onClick:b=>$e(t.row)},{default:a(()=>e[51]||(e[51]=[u("更新")])),_:2,__:[51]},1032,["onClick"]),l(r,{type:"danger",link:"",onClick:b=>Le(t.row)},{default:a(()=>e[52]||(e[52]=[u("删除")])),_:2,__:[52]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[Pe,le.value]]):C("",!0),_.value==="货运险"?(g(),O(E,{key:2,class:"detail-card"},{default:a(()=>[l(B,{gutter:20},{default:a(()=>[l(y,{span:8},{default:a(()=>[s("div",Sa,[s("div",Ba,v(T(Ie.value.commercialTotal)),1),e[53]||(e[53]=s("div",{class:"stat-label"},"商业险总金额",-1))])]),_:1}),l(y,{span:8},{default:a(()=>[s("div",$a,[s("div",qa,v(D.value.length),1),e[54]||(e[54]=s("div",{class:"stat-label"},"投保单数量",-1))])]),_:1}),l(y,{span:8},{default:a(()=>[s("div",Aa,[s("div",Oa,v(T(Ie.value.averageAmount)),1),e[55]||(e[55]=s("div",{class:"stat-label"},"平均保费",-1))])]),_:1})]),_:1})]),_:1})):C("",!0),_.value==="货运险"?We((g(),O(E,{key:3,class:"detail-card"},{default:a(()=>[l(Fe,{data:D.value,border:"",style:{width:"100%"}},{default:a(()=>[l(m,{prop:"status",label:"状态",width:"100",align:"center"},{default:a(({row:t})=>[l(Y,{type:De(t.status)},{default:a(()=>[u(v(t.status),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"track_no",label:"运输编号",width:"140"}),l(m,{prop:"insurance_no",label:"投保单号","min-width":"180"}),l(m,{prop:"name",label:"货物名称",width:"120"}),l(m,{prop:"quantity",label:"货物数量",width:"100"}),l(m,{prop:"carrier",label:"承运人",width:"120"}),l(m,{prop:"consignee",label:"收货人",width:"120"}),l(m,{prop:"insured",label:"被保人",width:"280"}),l(m,{prop:"commercial_amount",label:"商业险",width:"120"},{default:a(t=>[u(v(T(t.row.commercial_amount)),1)]),_:1}),l(m,{prop:"start_date",label:"开始日期",width:"110"}),l(m,{prop:"end_date",label:"结束日期",width:"110"}),l(m,{label:"操作",width:"250",fixed:"right"},{default:a(t=>[l(r,{type:"info",link:"",onClick:b=>Be(t.row,"cargo")},{default:a(()=>e[56]||(e[56]=[u("附件")])),_:2,__:[56]},1032,["onClick"]),l(r,{type:"primary",link:"",onClick:b=>Se(t.row,"cargo")},{default:a(()=>e[57]||(e[57]=[u("上传")])),_:2,__:[57]},1032,["onClick"]),l(r,{type:"warning",link:"",onClick:b=>$e(t.row)},{default:a(()=>e[58]||(e[58]=[u("更新")])),_:2,__:[58]},1032,["onClick"]),l(r,{type:"danger",link:"",onClick:b=>Le(t.row)},{default:a(()=>e[59]||(e[59]=[u("删除")])),_:2,__:[59]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[Pe,le.value]]):C("",!0),l(A,{modelValue:Z.value,"onUpdate:modelValue":e[12]||(e[12]=t=>Z.value=t),title:"添加车险信息",width:"600px"},{footer:a(()=>[s("span",Pa,[l(r,{onClick:e[11]||(e[11]=t=>Z.value=!1)},{default:a(()=>e[61]||(e[61]=[u("取消")])),_:1,__:[61]}),l(r,{type:"primary",onClick:ol,loading:z.value},{default:a(()=>e[62]||(e[62]=[u("确定")])),_:1,__:[62]},8,["loading"])])]),default:a(()=>[l(Ee,{ref_key:"carFormRef",ref:Ue,model:c.value,rules:el,"label-width":"120px"},{default:a(()=>[l(f,{label:"车牌号",prop:"car_no"},{default:a(()=>[l(I,{modelValue:c.value.car_no,"onUpdate:modelValue":e[0]||(e[0]=t=>c.value.car_no=t),placeholder:"请输入车牌号"},null,8,["modelValue"])]),_:1}),l(f,{label:"车架号",prop:"vin"},{default:a(()=>[l(I,{modelValue:c.value.vin,"onUpdate:modelValue":e[1]||(e[1]=t=>c.value.vin=t),placeholder:"请输入车架号"},null,8,["modelValue"])]),_:1}),l(f,{label:"投保单号",prop:"insurance_no"},{default:a(()=>[l(I,{modelValue:c.value.insurance_no,"onUpdate:modelValue":e[2]||(e[2]=t=>c.value.insurance_no=t),placeholder:"请输入投保单号"},null,8,["modelValue"])]),_:1}),l(f,{label:"被保人",prop:"insured"},{default:a(()=>[s("div",za,[l(Te,{modelValue:c.value.insured,"onUpdate:modelValue":e[3]||(e[3]=t=>c.value.insured=t),placeholder:"请选择被保人",style:{width:"300px"},disabled:c.value.same_as_borrower},{default:a(()=>[(g(!0),k(Ye,null,Me($.value,t=>(g(),O(q,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),l(Oe,{modelValue:c.value.same_as_borrower,"onUpdate:modelValue":e[4]||(e[4]=t=>c.value.same_as_borrower=t),onChange:e[5]||(e[5]=t=>qe("car")),class:"same-borrower-checkbox",style:{"margin-left":"10px"}},{default:a(()=>e[60]||(e[60]=[u(" 同借款人 ")])),_:1,__:[60]},8,["modelValue"])])]),_:1}),l(f,{label:"商业险",prop:"commercial_amount"},{default:a(()=>[l(de,{modelValue:c.value.commercial_amount,"onUpdate:modelValue":e[6]||(e[6]=t=>c.value.commercial_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(f,{label:"交强险",prop:"compulsory_amount"},{default:a(()=>[l(de,{modelValue:c.value.compulsory_amount,"onUpdate:modelValue":e[7]||(e[7]=t=>c.value.compulsory_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(f,{label:"车船税",prop:"vehicle_tax_amount"},{default:a(()=>[l(de,{modelValue:c.value.vehicle_tax_amount,"onUpdate:modelValue":e[8]||(e[8]=t=>c.value.vehicle_tax_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(f,{label:"开始日期",prop:"start_date"},{default:a(()=>[l(pe,{modelValue:c.value.start_date,"onUpdate:modelValue":e[9]||(e[9]=t=>c.value.start_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择开始日期"},null,8,["modelValue"])]),_:1}),l(f,{label:"结束日期",prop:"end_date"},{default:a(()=>[l(pe,{modelValue:c.value.end_date,"onUpdate:modelValue":e[10]||(e[10]=t=>c.value.end_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择结束日期"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(A,{modelValue:ee.value,"onUpdate:modelValue":e[26]||(e[26]=t=>ee.value=t),title:"添加货运险信息",width:"700px"},{footer:a(()=>[s("span",ja,[l(r,{onClick:e[25]||(e[25]=t=>ee.value=!1)},{default:a(()=>e[64]||(e[64]=[u("取消")])),_:1,__:[64]}),l(r,{type:"primary",onClick:ul,loading:z.value},{default:a(()=>e[65]||(e[65]=[u("确定")])),_:1,__:[65]},8,["loading"])])]),default:a(()=>[l(Ee,{ref_key:"cargoFormRef",ref:Ce,model:p.value,rules:ll,"label-width":"120px"},{default:a(()=>[l(f,{label:"运输编号",prop:"track_no"},{default:a(()=>[l(I,{modelValue:p.value.track_no,"onUpdate:modelValue":e[13]||(e[13]=t=>p.value.track_no=t),placeholder:"请输入运输编号"},null,8,["modelValue"])]),_:1}),l(f,{label:"投保单号",prop:"insurance_no"},{default:a(()=>[l(I,{modelValue:p.value.insurance_no,"onUpdate:modelValue":e[14]||(e[14]=t=>p.value.insurance_no=t),placeholder:"请输入投保单号"},null,8,["modelValue"])]),_:1}),l(f,{label:"货物名称",prop:"name"},{default:a(()=>[l(I,{modelValue:p.value.name,"onUpdate:modelValue":e[15]||(e[15]=t=>p.value.name=t),placeholder:"请输入货物名称"},null,8,["modelValue"])]),_:1}),l(f,{label:"货物数量",prop:"quantity"},{default:a(()=>[l(I,{modelValue:p.value.quantity,"onUpdate:modelValue":e[16]||(e[16]=t=>p.value.quantity=t),placeholder:"请输入货物数量"},null,8,["modelValue"])]),_:1}),l(f,{label:"承运人",prop:"carrier"},{default:a(()=>[l(I,{modelValue:p.value.carrier,"onUpdate:modelValue":e[17]||(e[17]=t=>p.value.carrier=t),placeholder:"请输入承运人"},null,8,["modelValue"])]),_:1}),l(f,{label:"收货人",prop:"consignee"},{default:a(()=>[l(I,{modelValue:p.value.consignee,"onUpdate:modelValue":e[18]||(e[18]=t=>p.value.consignee=t),placeholder:"请输入收货人"},null,8,["modelValue"])]),_:1}),l(f,{label:"被保人",prop:"insured"},{default:a(()=>[s("div",Na,[l(Te,{modelValue:p.value.insured,"onUpdate:modelValue":e[19]||(e[19]=t=>p.value.insured=t),placeholder:"请选择被保人",style:{width:"300px"},disabled:p.value.same_as_borrower},{default:a(()=>[(g(!0),k(Ye,null,Me($.value,t=>(g(),O(q,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),l(Oe,{modelValue:p.value.same_as_borrower,"onUpdate:modelValue":e[20]||(e[20]=t=>p.value.same_as_borrower=t),onChange:e[21]||(e[21]=t=>qe("cargo")),class:"same-borrower-checkbox",style:{"margin-left":"10px"}},{default:a(()=>e[63]||(e[63]=[u(" 同借款人 ")])),_:1,__:[63]},8,["modelValue"])])]),_:1}),l(f,{label:"商业险",prop:"commercial_amount"},{default:a(()=>[l(de,{modelValue:p.value.commercial_amount,"onUpdate:modelValue":e[22]||(e[22]=t=>p.value.commercial_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(f,{label:"开始日期",prop:"start_date"},{default:a(()=>[l(pe,{modelValue:p.value.start_date,"onUpdate:modelValue":e[23]||(e[23]=t=>p.value.start_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择开始日期"},null,8,["modelValue"])]),_:1}),l(f,{label:"结束日期",prop:"end_date"},{default:a(()=>[l(pe,{modelValue:p.value.end_date,"onUpdate:modelValue":e[24]||(e[24]=t=>p.value.end_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择结束日期"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(A,{modelValue:ae.value,"onUpdate:modelValue":e[27]||(e[27]=t=>ae.value=t),title:"批量导入投保信息",width:"600px"},{footer:a(()=>[s("span",tt,[l(r,{onClick:yl},{default:a(()=>e[74]||(e[74]=[u("取消")])),_:1,__:[74]}),l(r,{type:"primary",onClick:bl,loading:ce.value,disabled:!L.value},{default:a(()=>e[75]||(e[75]=[u(" 开始导入 ")])),_:1,__:[75]},8,["loading","disabled"])])]),default:a(()=>[s("div",Ga,[s("div",Wa,[l(N,{title:"导入说明",type:"info","show-icon":"",closable:!1},{default:a(()=>e[66]||(e[66]=[s("div",{class:"tips-content"},[s("p",null,"1. 请先下载模板，按照模板格式填写数据"),s("p",null,"2. 支持 .xlsx 和 .xls 格式文件"),s("p",null,"3. 必填字段不能为空，金额字段请填写数字"),s("p",null,"4. 日期格式：YYYY-MM-DD，如：2024-01-01")],-1)])),_:1,__:[66]})]),l(me,{ref_key:"excelUploadRef",ref:j,class:"upload-demo",drag:"","auto-upload":!1,limit:1,accept:".xlsx,.xls","on-change":gl,"file-list":_e.value},{tip:a(()=>e[67]||(e[67]=[s("div",{class:"el-upload__tip"}," 只能上传 .xlsx/.xls 文件，且不超过 10MB ",-1)])),default:a(()=>[l(d,{class:"el-icon--upload"},{default:a(()=>[l(w(ve))]),_:1}),e[68]||(e[68]=s("div",{class:"el-upload__text"},[u(" 将Excel文件拖到此处，或"),s("em",null,"点击上传")],-1))]),_:1,__:[68]},8,["file-list"]),x.value?(g(),k("div",Ja,[l(E,null,{header:a(()=>e[69]||(e[69]=[s("span",null,"导入结果",-1)])),default:a(()=>[s("div",Ha,[l(B,{gutter:20},{default:a(()=>[l(y,{span:8},{default:a(()=>[s("div",Ka,[s("div",Qa,v(x.value.total),1),e[70]||(e[70]=s("div",{class:"stat-label"},"总数",-1))])]),_:1}),l(y,{span:8},{default:a(()=>[s("div",Xa,[s("div",Za,v(x.value.success),1),e[71]||(e[71]=s("div",{class:"stat-label"},"成功",-1))])]),_:1}),l(y,{span:8},{default:a(()=>[s("div",et,[s("div",lt,v(x.value.fail),1),e[72]||(e[72]=s("div",{class:"stat-label"},"失败",-1))])]),_:1})]),_:1})]),x.value.errors&&x.value.errors.length>0?(g(),k("div",at,[l(ze,{"content-position":"left"},{default:a(()=>e[73]||(e[73]=[u("错误详情")])),_:1,__:[73]}),(g(!0),k(Ye,null,Me(x.value.errors,(t,b)=>(g(),k("div",{class:"error-item",key:b},[l(Y,{type:"danger",size:"small"},{default:a(()=>[u(v(t),1)]),_:2},1024)]))),128))])):C("",!0)]),_:1})])):C("",!0)])]),_:1},8,["modelValue"]),l(A,{modelValue:G.value,"onUpdate:modelValue":e[28]||(e[28]=t=>G.value=t),title:"批量上传行驶证",width:"700px"},{footer:a(()=>[s("span",rt,[l(r,{onClick:xl},{default:a(()=>e[80]||(e[80]=[u("取消")])),_:1,__:[80]}),l(r,{type:"primary",onClick:hl,loading:W.value,disabled:M.value.length===0},{default:a(()=>e[81]||(e[81]=[u(" 开始上传识别 ")])),_:1,__:[81]},8,["loading","disabled"])])]),default:a(()=>[s("div",st,[s("div",ot,[l(N,{type:"info","show-icon":"",closable:!1},{default:a(()=>e[76]||(e[76]=[s("div",{class:"tips-content"},[s("p",null,"1. 支持 JPG、PNG、BMP、TIFF、WEBP 格式"),s("p",null,"2. 系统将自动OCR识别行驶证信息并匹配车险记录"),s("p",null,"3. 请确保先录入车险信息再上传对应的行驶证")],-1)])),_:1,__:[76]})]),l(me,{ref_key:"driverLicenseUploadRef",ref:fe,class:"upload-demo",drag:"",multiple:"","auto-upload":!1,limit:0,accept:"image/*","on-change":Vl,"on-remove":kl,"file-list":ge.value},{tip:a(()=>e[77]||(e[77]=[s("div",{class:"el-upload__tip"}," 支持多张图片同时上传，每张不超过5MB ",-1)])),default:a(()=>[l(d,{class:"el-icon--upload"},{default:a(()=>[l(w(ve))]),_:1}),e[78]||(e[78]=s("div",{class:"el-upload__text"},[u(" 将行驶证图片拖到此处，或"),s("em",null,"点击上传")],-1))]),_:1,__:[78]},8,["file-list"]),W.value?(g(),k("div",ut,[l(N,{title:"正在上传处理中...",type:"info","show-icon":"",closable:!1},{default:a(()=>[s("div",nt,[s("p",null,"已选择 "+v(M.value.length)+" 张图片",1),e[79]||(e[79]=s("p",null,"正在后台进行OCR识别和匹配处理，请稍后查看结果",-1))])]),_:1})])):C("",!0)])]),_:1},8,["modelValue"]),l(A,{modelValue:J.value,"onUpdate:modelValue":e[29]||(e[29]=t=>J.value=t),title:"批量上传投保单",width:"700px"},{footer:a(()=>[s("span",vt,[l(r,{onClick:Fl},{default:a(()=>e[86]||(e[86]=[u("取消")])),_:1,__:[86]}),l(r,{type:"primary",onClick:Tl,loading:te.value,disabled:R.value.length===0},{default:a(()=>e[87]||(e[87]=[u(" 开始上传识别 ")])),_:1,__:[87]},8,["loading","disabled"])])]),default:a(()=>[s("div",it,[s("div",dt,[l(N,{type:"info","show-icon":"",closable:!1},{default:a(()=>e[82]||(e[82]=[s("div",{class:"tips-content"},[s("p",null,"1. 支持 JPG、PNG、BMP、TIFF、WEBP 格式"),s("p",null,"2. 系统将自动OCR识别投保单信息并匹配保险记录"),s("p",null,"3. 请确保先录入保险信息再上传对应的投保单")],-1)])),_:1,__:[82]})]),l(me,{ref_key:"insuranceFormUploadRef",ref:be,class:"upload-demo",drag:"",multiple:"","auto-upload":!1,limit:0,accept:"image/*","on-change":Cl,"on-remove":Dl,"file-list":ye.value},{tip:a(()=>e[83]||(e[83]=[s("div",{class:"el-upload__tip"}," 支持多张图片同时上传，每张不超过5MB ",-1)])),default:a(()=>[l(d,{class:"el-icon--upload"},{default:a(()=>[l(w(ve))]),_:1}),e[84]||(e[84]=s("div",{class:"el-upload__text"},[u(" 将投保单图片拖到此处，或"),s("em",null,"点击上传")],-1))]),_:1,__:[84]},8,["file-list"]),te.value?(g(),k("div",pt,[l(N,{title:"正在上传处理中...",type:"info","show-icon":"",closable:!1},{default:a(()=>[s("div",mt,[s("p",null,"已选择 "+v(R.value.length)+" 张图片",1),e[85]||(e[85]=s("p",null,"正在后台进行OCR识别和匹配处理，请稍后查看结果",-1))])]),_:1})])):C("",!0)])]),_:1},8,["modelValue"]),l(ya,{visible:he.value,"onUpdate:visible":e[30]||(e[30]=t=>he.value=t),title:oe.value,"order-id":w(V).params.id,"ref-id":P.value,type:X.value,onSuccess:U},null,8,["visible","title","order-id","ref-id","type"]),l(wa,{visible:ue.value,"onUpdate:visible":e[31]||(e[31]=t=>ue.value=t),title:oe.value,attachments:ne.value,"order-id":w(V).params.id,"ref-id":P.value,type:X.value,onRefresh:nl,onDelete:rl,"allow-delete":!0},null,8,["visible","title","attachments","order-id","ref-id","type"]),l(A,{modelValue:H.value,"onUpdate:modelValue":e[34]||(e[34]=t=>H.value=t),title:`更新${_.value}状态 - ${_.value==="车险"?(Ne=F.value)==null?void 0:Ne.car_no:(je=F.value)==null?void 0:je.track_no}`,width:"500px"},{footer:a(()=>[s("span",ct,[l(r,{onClick:e[33]||(e[33]=t=>H.value=!1)},{default:a(()=>e[88]||(e[88]=[u("取消")])),_:1,__:[88]}),l(r,{type:"primary",onClick:_l,loading:Ve.value},{default:a(()=>e[89]||(e[89]=[u(" 确定 ")])),_:1,__:[89]},8,["loading"])])]),default:a(()=>[l(Ee,{ref_key:"updateStatusFormRef",ref:we,model:K.value,rules:Ze,"label-width":"100px"},{default:a(()=>[l(f,{label:_.value==="车险"?"车牌号":"运单号"},{default:a(()=>{var t,b;return[s("span",null,v(_.value==="车险"?(t=F.value)==null?void 0:t.car_no:(b=F.value)==null?void 0:b.track_no),1)]}),_:1},8,["label"]),l(f,{label:_.value==="车险"?"车架号":"承运车辆"},{default:a(()=>{var t,b;return[s("span",null,v(_.value==="车险"?(t=F.value)==null?void 0:t.vin:(b=F.value)==null?void 0:b.carrier),1)]}),_:1},8,["label"]),l(f,{label:"当前状态"},{default:a(()=>{var t;return[l(Y,{type:De((t=F.value)==null?void 0:t.status)},{default:a(()=>{var b;return[u(v(((b=F.value)==null?void 0:b.status)||"未知"),1)]}),_:1},8,["type"])]}),_:1}),l(f,{label:"新状态",prop:"status"},{default:a(()=>[l(Te,{modelValue:K.value.status,"onUpdate:modelValue":e[32]||(e[32]=t=>K.value.status=t),placeholder:"请选择新状态",style:{width:"100%"}},{default:a(()=>[l(q,{label:"正常",value:"正常"}),l(q,{label:"逾期退保",value:"逾期退保"}),l(q,{label:"提前结清",value:"提前结清"}),l(q,{label:"逾期结清",value:"逾期结清"}),l(q,{label:"退保结清",value:"退保结清"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(A,{modelValue:se.value,"onUpdate:modelValue":e[35]||(e[35]=t=>se.value=t),title:"批量更新保险状态",width:"700px"},{footer:a(()=>[s("span",Tt,[l(r,{onClick:cl},{default:a(()=>e[100]||(e[100]=[u("取消")])),_:1,__:[100]}),l(r,{type:"primary",onClick:vl,loading:ke.value,disabled:!S.value},{default:a(()=>e[101]||(e[101]=[u(" 开始更新 ")])),_:1,__:[101]},8,["loading","disabled"])])]),default:a(()=>[s("div",_t,[s("div",ft,[l(N,{title:"更新说明",type:"info","show-icon":"",closable:!1},{default:a(()=>[s("div",gt,[e[90]||(e[90]=s("p",null,"1. 请先下载状态模板，按照模板格式填写数据",-1)),e[91]||(e[91]=s("p",null,"2. 支持 .xlsx 和 .xls 格式文件",-1)),_.value==="车险"?(g(),k("p",bt,"3. 车牌号和车架号至少填写一个")):(g(),k("p",yt,"3. 运单号和承运车辆至少填写一个")),e[92]||(e[92]=s("p",null,"4. 新状态必须是：正常、逾期退保、提前结清、逾期结清、退保结清",-1))])]),_:1})]),l(me,{ref_key:"batchUpdateStatusUploadRef",ref:Q,class:"upload-demo",drag:"","auto-upload":!1,limit:1,accept:".xlsx,.xls","on-change":ml,"file-list":xe.value},{tip:a(()=>e[93]||(e[93]=[s("div",{class:"el-upload__tip"}," 只能上传 .xlsx/.xls 文件，且不超过 10MB ",-1)])),default:a(()=>[l(d,{class:"el-icon--upload"},{default:a(()=>[l(w(ve))]),_:1}),e[94]||(e[94]=s("div",{class:"el-upload__text"},[u(" 将Excel文件拖到此处，或"),s("em",null,"点击上传")],-1))]),_:1,__:[94]},8,["file-list"]),h.value?(g(),k("div",wt,[l(E,null,{header:a(()=>e[95]||(e[95]=[s("span",null,"更新结果",-1)])),default:a(()=>[s("div",Vt,[l(B,{gutter:20},{default:a(()=>[l(y,{span:8},{default:a(()=>[s("div",kt,[s("div",xt,v(h.value.total_count),1),e[96]||(e[96]=s("div",{class:"stat-label"},"总数",-1))])]),_:1}),l(y,{span:8},{default:a(()=>[s("div",ht,[s("div",Ut,v(h.value.success_count),1),e[97]||(e[97]=s("div",{class:"stat-label"},"成功",-1))])]),_:1}),l(y,{span:8},{default:a(()=>[s("div",Ct,[s("div",Dt,v(h.value.fail_count),1),e[98]||(e[98]=s("div",{class:"stat-label"},"失败",-1))])]),_:1})]),_:1})]),h.value.results&&h.value.results.length>0?(g(),k("div",Ft,[l(ze,{"content-position":"left"},{default:a(()=>e[99]||(e[99]=[u("详细结果")])),_:1,__:[99]}),l(Fe,{data:h.value.results,border:"",size:"small","max-height":"300"},{default:a(()=>[l(m,{prop:"row",label:"行号",width:"60",align:"center"}),l(m,{prop:_.value==="车险"?"car_no":"track_no",label:_.value==="车险"?"车牌号":"运单号",width:"120"},null,8,["prop","label"]),l(m,{prop:_.value==="车险"?"vin":"carrier",label:_.value==="车险"?"车架号":"承运车辆",width:"150"},null,8,["prop","label"]),l(m,{prop:"new_status",label:"新状态",width:"100"}),l(m,{prop:"status",label:"处理状态",width:"100",align:"center"},{default:a(({row:t})=>[l(Y,{type:t.status==="success"?"success":"danger",size:"small"},{default:a(()=>[u(v(t.status==="success"?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"message",label:"消息","min-width":"200"})]),_:1},8,["data"])])):C("",!0)]),_:1})])):C("",!0)])]),_:1},8,["modelValue"])])}}},Qt=Ml(Et,[["__scopeId","data-v-82648e51"]]);export{Qt as default};
