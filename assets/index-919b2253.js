import{_ as fe,u as _e}from"./index-36afcd41.js";/* empty css               *//* empty css                        *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                             *//* empty css                      *//* empty css                        */import{r as f,b as j,j as me,ae as ce,l as D,B as K,C as b,F as a,G as t,a1 as ge,af as ye,p as R,E as w,a5 as ve,K as be,an as we,aQ as Ve,M as ke,ai as xe,u as h,aR as Q,O as r,as as Ce,D as s,H as Ee,I as he,J as Ue,a2 as ze,al as De,am as Fe,az as $e,aA as Be,a6 as Ne,ax as Pe,ay as Te,ao as Ie,ah as Le,aO as qe,a7 as Oe}from"./element-plus-3147ea74.js";import{g as Se,c as Me,u as je,d as Ke}from"./product-4c55ff99.js";import{g as A}from"./funder-fe0da81c.js";import{f as G}from"./format-20468769.js";const Re={class:"product-container"},Qe={class:"filter-container"},Ae={class:"pagination"},Ge={class:"detail-container"},He={class:"detail-section"},Je={class:"detail-section"},We={class:"detail-section"},Xe={class:"dialog-footer"},Ye={class:"dialog-footer"},Ze={__name:"index",setup(ea){_e();const F=f([]),$=f(0),B=f(!0),_=j({page:1,page_size:20,keyword:""}),V=f(!1),N=f(""),P=f(""),m=f(null),g=f([]),T=f(!1),U=f(!1),d=f({}),n=j({id:void 0,funder_id:void 0,repay_type:"",loan_rate:void 0,periods:null,down_rate:void 0,penalty_rate:void 0,forfeit_rate:void 0,grace_day:void 0,remark:"",status:"上架"}),H={funder_id:[{required:!0,message:"请选择资金方",trigger:"change"}],repay_type:[{required:!0,message:"请选择还款类型",trigger:"change"}],loan_rate:[{required:!0,message:"请输入利率",trigger:"blur"}],periods:[{required:!0,message:"请选择还款期数",trigger:"change"},{validator:(o,e,i)=>{e&&(e<1||e>360)?i(new Error("还款期数必须在1-360期之间")):i()},trigger:"change"}],down_rate:[{required:!0,message:"请输入首付比例",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},J=me(()=>{const o=g.value.find(i=>i.id===n.funder_id),e=o?o.name:"";return!e||!n.repay_type||n.loan_rate===void 0||n.loan_rate===null||n.periods===void 0||n.periods===null||n.down_rate===void 0||n.down_rate===null?"":`${e}-${n.repay_type}-利率${n.loan_rate.toFixed(2)}%-${n.periods}期-首付${n.down_rate.toFixed(2)}%`}),k=async()=>{B.value=!0;try{const o=await Se(_);F.value=o.data.list,$.value=o.data.total}catch(o){console.error("获取产品列表失败:",o),F.value=[],$.value=0,w({type:"error",message:"获取产品列表失败"})}finally{B.value=!1}},W=async o=>{if(!o){g.value=[];return}T.value=!0;try{const e=await A({page:1,page_size:50,keyword:o});g.value=e.data.list}catch(e){console.error("搜索资金方失败:",e),w({type:"error",message:"搜索资金方失败"})}finally{T.value=!1}},X=()=>{g.value=[]},Y=o=>{if(o!=null){const e=Number(o);!isNaN(e)&&e>0?n.periods=Math.floor(e):n.periods=null}else n.periods=null},L=()=>{_.page=1,k()},Z=()=>{Object.assign(n,{id:void 0,funder_id:void 0,repay_type:"",loan_rate:void 0,periods:null,down_rate:void 0,penalty_rate:void 0,forfeit_rate:void 0,grace_day:void 0,remark:"",status:"上架"})},ee=()=>{Z(),g.value=[],N.value="create",P.value="新增产品",V.value=!0,m.value&&m.value.clearValidate()},ae=async()=>{m.value&&await m.value.validate(async o=>{if(o)try{await Me(n),await k(),V.value=!1,w({type:"success",message:"创建成功"})}catch(e){console.error("创建产品失败:",e),w({type:"error",message:"创建产品失败"})}})},te=async o=>{if(Object.assign(n,o),N.value="update",P.value="编辑产品",o.funder_id&&o.funder&&o.funder.name)g.value=[{id:o.funder_id,name:o.funder.name}];else if(o.funder_id)try{const i=(await A({page:1,page_size:100,keyword:""})).data.list.find(C=>C.id===o.funder_id);i&&(g.value=[i])}catch(e){console.error("获取资金方信息失败:",e)}V.value=!0,m.value&&m.value.clearValidate()},le=async()=>{m.value&&await m.value.validate(async o=>{if(o){const e={...n};try{await je(e.id,e),await k(),V.value=!1,w({type:"success",message:"更新成功"})}catch(i){console.error("更新产品失败:",i),w({type:"error",message:"更新失败"})}}})},oe=async o=>{try{await Ue.confirm("确认删除该产品?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Ke(o.id),await k(),w({type:"success",message:"删除成功"})}catch(e){e!=="cancel"&&(console.error("删除产品失败:",e),w({type:"error",message:"删除失败"}))}},ne=o=>{_.page_size=o,k()},re=o=>{_.page=o,k()},se=o=>{d.value={...o},U.value=!0};return ce(()=>{k()}),(o,e)=>{const i=ze,C=ve,y=be,x=De,q=Fe,de=we,ie=Ve,u=$e,I=Be,O=ke,p=Ne,v=Pe,z=Te,c=Ie,S=Le,E=qe,ue=Oe,pe=xe;return D(),K("div",Re,[b("div",Qe,[a(C,{modelValue:_.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>_.keyword=l),placeholder:"产品名称",style:{width:"450px !important"},class:"filter-item search-input",onKeyup:ge(L,["enter","native"])},{prefix:t(()=>[a(i,null,{default:t(()=>[a(h(Q))]),_:1})]),_:1},8,["modelValue"]),a(y,{class:"filter-item",type:"primary",onClick:L,style:{"margin-left":"10px"}},{default:t(()=>[a(i,null,{default:t(()=>[a(h(Q))]),_:1}),e[18]||(e[18]=r(" 搜索 "))]),_:1,__:[18]}),a(y,{class:"filter-item",type:"primary",onClick:ee,style:{"margin-left":"10px"}},{default:t(()=>[a(i,null,{default:t(()=>[a(h(Ce))]),_:1}),e[19]||(e[19]=r(" 新增产品 "))]),_:1,__:[19]})]),ye((D(),R(de,{data:F.value,border:"",fit:"","highlight-current-row":"",style:{width:"100%"}},{default:t(()=>[a(x,{label:"产品名称",prop:"name",align:"left","min-width":"350"}),a(x,{label:"利率",prop:"loan_rate",align:"center",width:"100"},{default:t(({row:l})=>[r(s(l.loan_rate)+"% ",1)]),_:1}),a(x,{label:"违约金%",prop:"penalty_rate",align:"center",width:"100"},{default:t(({row:l})=>[r(s(l.penalty_rate)+"% ",1)]),_:1}),a(x,{label:"滞纳金%",prop:"forfeit_rate",align:"center",width:"100"},{default:t(({row:l})=>[r(s(l.forfeit_rate)+"% ",1)]),_:1}),a(x,{label:"宽限期",prop:"grace_day",align:"center",width:"100"},{default:t(({row:l})=>[r(s(l.grace_day)+"天 ",1)]),_:1}),a(x,{label:"状态",prop:"status",align:"center",width:"80"},{default:t(({row:l})=>[a(q,{type:l.status==="上架"?"success":"info"},{default:t(()=>[r(s(l.status),1)]),_:2},1032,["type"])]),_:1}),a(x,{label:"操作",align:"center",width:"200","class-name":"small-padding fixed-width"},{default:t(({row:l})=>[a(y,{type:"primary",link:"",onClick:M=>se(l)},{default:t(()=>e[20]||(e[20]=[r("详情")])),_:2,__:[20]},1032,["onClick"]),a(y,{type:"primary",link:"",onClick:M=>te(l)},{default:t(()=>e[21]||(e[21]=[r("编辑")])),_:2,__:[21]},1032,["onClick"]),a(y,{type:"danger",link:"",onClick:M=>oe(l)},{default:t(()=>e[22]||(e[22]=[r("删除")])),_:2,__:[22]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[pe,B.value]]),b("div",Ae,[a(ie,{"current-page":_.page,"onUpdate:currentPage":e[1]||(e[1]=l=>_.page=l),"page-size":_.page_size,"onUpdate:pageSize":e[2]||(e[2]=l=>_.page_size=l),"page-sizes":[10,20,50,100],total:$.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ne,onCurrentChange:re},null,8,["current-page","page-size","total"])]),a(O,{modelValue:U.value,"onUpdate:modelValue":e[4]||(e[4]=l=>U.value=l),title:"产品详情",width:"800px","close-on-click-modal":!1,draggable:"",class:"custom-dialog"},{footer:t(()=>[b("div",Xe,[a(y,{onClick:e[3]||(e[3]=l=>U.value=!1)},{default:t(()=>e[23]||(e[23]=[r("关 闭")])),_:1,__:[23]})])]),default:t(()=>[b("div",Ge,[b("div",He,[a(I,{column:2,border:""},{default:t(()=>[a(u,{label:"产品名称",span:2},{default:t(()=>[r(s(d.value.name),1)]),_:1}),a(u,{label:"状态"},{default:t(()=>[a(q,{type:d.value.status==="上架"?"success":"info"},{default:t(()=>[r(s(d.value.status),1)]),_:1},8,["type"])]),_:1})]),_:1})]),b("div",Je,[a(I,{column:3,border:""},{default:t(()=>[a(u,{label:"还款方式"},{default:t(()=>[r(s(d.value.repay_type),1)]),_:1}),a(u,{label:"贷款利率"},{default:t(()=>[r(s(d.value.loan_rate)+"%",1)]),_:1}),a(u,{label:"还款期数"},{default:t(()=>[r(s(d.value.periods)+"期",1)]),_:1}),a(u,{label:"首付比例"},{default:t(()=>[r(s(d.value.down_rate)+"%",1)]),_:1}),a(u,{label:"违约金比例"},{default:t(()=>[r(s(d.value.penalty_rate)+"%",1)]),_:1}),a(u,{label:"滞纳金比例"},{default:t(()=>[r(s(d.value.forfeit_rate)+"%",1)]),_:1}),a(u,{label:"宽限期"},{default:t(()=>[r(s(d.value.grace_day)+"天",1)]),_:1})]),_:1})]),b("div",We,[a(I,{column:1,border:""},{default:t(()=>[a(u,{label:"备注"},{default:t(()=>[r(s(d.value.remark||"-"),1)]),_:1}),a(u,{label:"创建时间"},{default:t(()=>[r(s(h(G)(d.value.created_at)),1)]),_:1}),a(u,{label:"更新时间"},{default:t(()=>[r(s(h(G)(d.value.updated_at)),1)]),_:1})]),_:1})])])]),_:1},8,["modelValue"]),a(O,{modelValue:V.value,"onUpdate:modelValue":e[17]||(e[17]=l=>V.value=l),title:P.value,width:"700px","close-on-click-modal":!1,draggable:"",class:"custom-dialog"},{footer:t(()=>[b("div",Ye,[a(y,{onClick:e[15]||(e[15]=l=>V.value=!1)},{default:t(()=>e[29]||(e[29]=[r("取 消")])),_:1,__:[29]}),a(y,{type:"primary",onClick:e[16]||(e[16]=l=>N.value==="create"?ae():le())},{default:t(()=>e[30]||(e[30]=[r(" 确 定 ")])),_:1,__:[30]})])]),default:t(()=>[a(ue,{ref_key:"dataForm",ref:m,rules:H,model:n,"label-position":"right","label-width":"120px",class:"form-container"},{default:t(()=>[a(p,{label:"产品名称预览"},{default:t(()=>[a(C,{value:J.value,readonly:"",placeholder:"请完善配置信息后查看产品名称",style:{"background-color":"#f5f7fa"}},null,8,["value"])]),_:1}),a(S,{gutter:20},{default:t(()=>[a(c,{span:24},{default:t(()=>[a(p,{label:"资金方",prop:"funder_id"},{default:t(()=>[a(z,{modelValue:n.funder_id,"onUpdate:modelValue":e[5]||(e[5]=l=>n.funder_id=l),placeholder:"请输入资金方名称或代码搜索",clearable:"",filterable:"",remote:"","remote-method":W,loading:T.value,onClear:X},{default:t(()=>[(D(!0),K(Ee,null,he(g.value,l=>(D(),R(v,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),_:1}),a(S,{gutter:20},{default:t(()=>[a(c,{span:12},{default:t(()=>[a(p,{label:"还款类型",prop:"repay_type"},{default:t(()=>[a(z,{modelValue:n.repay_type,"onUpdate:modelValue":e[6]||(e[6]=l=>n.repay_type=l),placeholder:"请选择还款类型",clearable:""},{default:t(()=>[a(v,{label:"等额本息",value:"等额本息"}),a(v,{label:"等额本金",value:"等额本金"}),a(v,{label:"先息后本",value:"先息后本"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(c,{span:12},{default:t(()=>[a(p,{label:"利率",prop:"loan_rate"},{default:t(()=>[a(E,{modelValue:n.loan_rate,"onUpdate:modelValue":e[7]||(e[7]=l=>n.loan_rate=l),precision:2,step:.01,min:0,"controls-position":o.right,style:{width:"100%"}},{suffix:t(()=>e[24]||(e[24]=[r("%")])),_:1},8,["modelValue","controls-position"])]),_:1})]),_:1}),a(c,{span:12},{default:t(()=>[a(p,{label:"还款期数",prop:"periods"},{default:t(()=>[a(z,{modelValue:n.periods,"onUpdate:modelValue":e[8]||(e[8]=l=>n.periods=l),placeholder:"请选择还款期数",filterable:"","allow-create":"",clearable:"",style:{width:"100%"},onChange:Y},{default:t(()=>[a(v,{label:"9期",value:9}),a(v,{label:"10期",value:10})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(c,{span:12},{default:t(()=>[a(p,{label:"首付比例",prop:"down_rate"},{default:t(()=>[a(E,{modelValue:n.down_rate,"onUpdate:modelValue":e[9]||(e[9]=l=>n.down_rate=l),precision:2,step:.01,min:0,max:100,"controls-position":o.right,style:{width:"100%"}},{suffix:t(()=>e[25]||(e[25]=[r("%")])),_:1},8,["modelValue","controls-position"])]),_:1})]),_:1}),a(c,{span:12},{default:t(()=>[a(p,{label:"违约金比例",prop:"penalty_rate"},{default:t(()=>[a(E,{modelValue:n.penalty_rate,"onUpdate:modelValue":e[10]||(e[10]=l=>n.penalty_rate=l),precision:2,step:.01,min:0,"controls-position":o.right,style:{width:"100%"}},{suffix:t(()=>e[26]||(e[26]=[r("%")])),_:1},8,["modelValue","controls-position"])]),_:1})]),_:1}),a(c,{span:12},{default:t(()=>[a(p,{label:"滞纳金比例",prop:"forfeit_rate"},{default:t(()=>[a(E,{modelValue:n.forfeit_rate,"onUpdate:modelValue":e[11]||(e[11]=l=>n.forfeit_rate=l),precision:2,step:.01,min:0,"controls-position":o.right,style:{width:"100%"}},{suffix:t(()=>e[27]||(e[27]=[r("%")])),_:1},8,["modelValue","controls-position"])]),_:1})]),_:1}),a(c,{span:12},{default:t(()=>[a(p,{label:"宽限期",prop:"grace_day"},{default:t(()=>[a(E,{modelValue:n.grace_day,"onUpdate:modelValue":e[12]||(e[12]=l=>n.grace_day=l),min:0,"controls-position":o.right,style:{width:"100%"}},{suffix:t(()=>e[28]||(e[28]=[r("天")])),_:1},8,["modelValue","controls-position"])]),_:1})]),_:1}),a(c,{span:12},{default:t(()=>[a(p,{label:"状态",prop:"status"},{default:t(()=>[a(z,{modelValue:n.status,"onUpdate:modelValue":e[13]||(e[13]=l=>n.status=l),placeholder:"请选择状态"},{default:t(()=>[a(v,{label:"上架",value:"上架"}),a(v,{label:"下架",value:"下架"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(p,{label:"备注",prop:"remark"},{default:t(()=>[a(C,{modelValue:n.remark,"onUpdate:modelValue":e[14]||(e[14]=l=>n.remark=l),type:"textarea",rows:3,placeholder:"请输入备注信息",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ma=fe(Ze,[["__scopeId","data-v-04d987bb"]]);export{ma as default};
