import{_ as ae,b as te,u as le}from"./index-31409f0b.js";/* empty css               *//* empty css                *//* empty css                        *//* empty css                     *//* empty css                    *//* empty css                   *//* empty css                       */import{f as oe}from"./format-20468769.js";import{g as ne,d as re,u as se}from"./attachment-de39a4f3.js";import{r as m,j as E,ae as de,l as p,B,C as r,F as t,D as f,G as l,af as ie,p as D,E as c,aE as ue,ag as ce,ai as pe,u as v,aw as _e,O as d,S as $,H as me,I as fe,aG as ve,aH as we,J as he,a2 as ge,K as be,aC as ke,al as ye,a5 as Ce,aI as Ee,aJ as Be,aK as De,an as xe}from"./element-plus-3147ea74.js";const Fe={class:"attachments-page"},Me={class:"page-header"},Ie={class:"type-description"},Ve={class:"upload-content"},$e={class:"upload-actions"},Re={class:"upload-drag-area"},Le={class:"upload-text"},Ue={key:0,class:"upload-files"},Ae={class:"upload-files-header"},Ge={class:"remark-input-wrapper"},Ne={class:"upload-button"},Se={__name:"attachments",setup(He){const w=te(),R=le(),h=m(!1),x=m([]),F=w.params.id,g=w.query.ref_id,_=w.query.type,L=E(()=>{switch(_){case"car":return"车险附件管理";case"cargo":return"货运险附件管理";default:return"订单附件管理"}}),U=E(()=>{switch(_){case"car":return"仅显示该车险的专属附件(如行驶证、驾驶证、投保单、保单等)";case"cargo":return"仅显示该货运险的专属附件(如货物清单、运单、投保单、保单等)";default:return"显示订单附件（缴费通知书、保单、其他文件等）"}}),A=m(null),n=m([]),b=m(!1),G=E(()=>{switch(_){case"car":return[{value:"行驶证",label:"行驶证"},{value:"驾驶证",label:"驾驶证"},{value:"投保单",label:"投保单"},{value:"其他",label:"其他"}];case"cargo":return[{value:"运单",label:"运单"},{value:"发货单",label:"发货单"},{value:"货物清单",label:"货物清单"},{value:"投保单",label:"投保单"},{value:"其他",label:"其他"}];default:return[{value:"缴费通知书",label:"缴费通知书"},{value:"保单",label:"保单"},{value:"其他文件",label:"其他文件"}]}}),N=()=>{R.back()},M=a=>a<1024?a+"B":a<1024*1024?(a/1024).toFixed(2)+"KB":a<1024*1024*1024?(a/(1024*1024)).toFixed(2)+"MB":(a/(1024*1024*1024)).toFixed(2)+"GB",k=async()=>{h.value=!0;try{const a={order_id:F};_!=="order"&&g&&(a.ref_id=g,a.type=_);const e=await ne(a);x.value=e.data}catch{c.error("获取附件列表失败")}h.value=!1},S=a=>a.size/1024/1024<10?!0:(c.error("文件大小不能超过 10MB!"),!1),H=a=>{window.open(`/api/admin/attachments/${a.id}/download`)},K=a=>{window.open(`/api/admin/attachments/${a.id}/view`)},T=async a=>{try{await he.confirm("确定要删除该附件吗？","提示",{type:"warning"}),await re(a.id),c.success("删除成功"),k()}catch(e){e!=="cancel"&&c.error("删除失败")}},q=(a,e)=>{n.value=e.map(y=>({...y,remark:""}))},z=(a,e)=>{n.value=e},J=a=>{n.value.splice(a,1)},O=async()=>{if(!n.value.length){c.warning("请选择要上传的文件");return}b.value=!0;try{const a=new FormData;n.value.forEach(e=>{a.append("files",e.raw),a.append("remarks",e.remark||"")}),await se(F,g||0,a),c.success("上传成功"),n.value=[],k()}catch(a){console.error("上传失败:",a),c.error("上传失败")}b.value=!1},j=()=>{n.value=[]},P=(a,e)=>{e!==void 0&&n.value[e]&&(n.value[e].remark=a)};return de(()=>{k()}),(a,e)=>{const y=ue,C=ge,u=be,Q=ke,i=ye,W=Ce,X=Ee,Y=Be,Z=De,I=xe,V=ce,ee=pe;return p(),B("div",Fe,[r("div",Me,[t(y,{onBack:N,title:L.value},null,8,["title"]),r("div",Ie,f(U.value),1)]),t(V,{class:"upload-card"},{default:l(()=>[r("div",Ve,[r("div",$e,[t(Q,{ref_key:"uploadRef",ref:A,class:"upload-demo",action:"#","auto-upload":!1,"on-change":q,"on-remove":z,"before-upload":S,multiple:"",drag:""},{default:l(()=>[r("div",Re,[t(C,{class:"el-icon--upload"},{default:l(()=>[t(v(_e))]),_:1}),r("div",Le,[e[1]||(e[1]=r("span",null,"将文件拖到此处或",-1)),t(u,{type:"primary",link:""},{default:l(()=>e[0]||(e[0]=[d("点击上传")])),_:1,__:[0]})]),e[2]||(e[2]=r("div",{class:"el-upload__tip"}," 支持多个文件上传,单个文件不超过10MB ",-1))])]),_:1},512)]),n.value.length>0?(p(),B("div",Ue,[r("div",Ae,[e[4]||(e[4]=r("h3",null,"待上传文件",-1)),n.value.length>0?(p(),D(u,{key:0,type:"danger",link:"",onClick:j},{default:l(()=>e[3]||(e[3]=[d(" 清空列表 ")])),_:1,__:[3]})):$("",!0)]),t(I,{data:n.value,border:"",style:{width:"100%"}},{default:l(()=>[t(i,{type:"index",label:"序号",width:"70",align:"center"}),t(i,{prop:"name",label:"文件名","min-width":"200","show-overflow-tooltip":""}),t(i,{prop:"size",label:"大小",width:"120",align:"right"},{default:l(o=>[d(f(M(o.row.size)),1)]),_:1}),t(i,{label:"备注","min-width":"200"},{default:l(o=>[r("div",Ge,[t(W,{modelValue:o.row.remark,"onUpdate:modelValue":s=>o.row.remark=s,placeholder:"请输入备注信息",clearable:"",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"]),t(Z,{onCommand:s=>P(s,o.$index),trigger:"click",placement:"bottom-end"},{dropdown:l(()=>[t(Y,{class:"remark-dropdown-menu"},{default:l(()=>[(p(!0),B(me,null,fe(G.value,s=>(p(),D(X,{key:s.value,command:s.value,class:"remark-dropdown-item"},{default:l(()=>[d(f(s.label),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:l(()=>[t(u,{type:"primary",size:"small",class:"remark-dropdown-btn"},{default:l(()=>[e[5]||(e[5]=d(" 选择 ")),t(C,{class:"el-icon--right"},{default:l(()=>[t(v(ve))]),_:1})]),_:1,__:[5]})]),_:2},1032,["onCommand"])])]),_:1}),t(i,{label:"操作",width:"80",fixed:"right",align:"center"},{default:l(o=>[t(u,{type:"danger",link:"",onClick:s=>J(o.$index)},{default:l(()=>e[6]||(e[6]=[d("移除")])),_:2,__:[6]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),r("div",Ne,[t(u,{type:"primary",disabled:!n.value.length,loading:b.value,onClick:O,size:"large"},{default:l(()=>[t(C,null,{default:l(()=>[t(v(we))]),_:1}),e[7]||(e[7]=r("span",null,"开始上传",-1))]),_:1,__:[7]},8,["disabled","loading"])])])):$("",!0)])]),_:1}),ie((p(),D(V,{class:"attachment-list-card"},{default:l(()=>[t(I,{data:x.value,border:"",style:{width:"100%"}},{default:l(()=>[t(i,{prop:"file_name",label:"文件名","min-width":"200"}),t(i,{prop:"file_size",label:"文件大小",width:"150"},{default:l(o=>[d(f(M(o.row.file_size)),1)]),_:1}),t(i,{prop:"remark",label:"备注","min-width":"200"}),t(i,{prop:"created_at",label:"上传时间",width:"180"},{default:l(o=>[d(f(v(oe)(o.row.created_at)),1)]),_:1}),t(i,{label:"操作",width:"180",fixed:"right"},{default:l(o=>[t(u,{type:"primary",link:"",onClick:s=>K(o.row)},{default:l(()=>e[8]||(e[8]=[d("查看")])),_:2,__:[8]},1032,["onClick"]),t(u,{type:"default",link:"",onClick:s=>H(o.row)},{default:l(()=>e[9]||(e[9]=[d("下载")])),_:2,__:[9]},1032,["onClick"]),t(u,{type:"danger",link:"",onClick:s=>T(o.row)},{default:l(()=>e[10]||(e[10]=[d("删除")])),_:2,__:[10]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[ee,h.value]])])}}},Ye=ae(Se,[["__scopeId","data-v-f654b690"]]);export{Ye as default};
