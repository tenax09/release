import{_ as Ll,b as $l,u as ql}from"./index-520d6774.js";/* empty css                   *//* empty css                             *//* empty css                   *//* empty css               *//* empty css                    *//* empty css                 *//* empty css                       *//* empty css                     *//* empty css                        *//* empty css                    *//* empty css                *//* empty css                        *//* empty css               *//* empty css                  *//* empty css                       */import{r,w as Bl,ae as Tl,l as b,B as L,C as s,F as l,G as a,p as E,a1 as ce,S as k,af as We,u as x,E as m,K as Ol,aE as Nl,a5 as zl,ay as Al,ag as Pl,M as Kl,ai as Gl,aI as jl,O as u,as as Jl,D as f,aJ as Se,aK as Wl,au as fe,H as Le,I as $e,aw as qe,J as Hl,a2 as Ql,ax as Xl,al as Zl,am as ea,an as la,a6 as aa,aL as ta,aG as oa,aH as sa,a7 as ua,aB as na,aC as ra,ao as ia,ah as da,aD as ma,az as pa,aA as va}from"./element-plus-e9590f8a.js";import{h as ca,a as fa,i as _a,j as ga,k as He,l as ba,u as ya,e as wa,n as Va,o as ka}from"./order-f4029049.js";import{a as xa}from"./user-47a80832.js";import{A as Ca}from"./AttachmentUpload-5286ace3.js";import{A as ha}from"./AttachmentList-b2515da6.js";/* empty css                 */import"./format-20468769.js";const Ua={class:"insurance-detail"},Da={class:"page-header"},Fa={class:"header-actions"},Ea={class:"filter-container"},Ya={class:"filter-row"},Ia={class:"insured-input"},Ma={class:"dialog-footer"},Ra={class:"insured-input"},Sa={class:"dialog-footer"},La={class:"upload-content"},$a={class:"upload-tips"},qa={key:0,class:"import-result"},Ba={class:"result-summary"},Ta={class:"stat-item"},Oa={class:"stat-number total"},Na={class:"stat-item"},za={class:"stat-number success"},Aa={class:"stat-item"},Pa={class:"stat-number fail"},Ka={key:0,class:"error-list"},Ga={class:"dialog-footer"},ja={class:"upload-content"},Ja={class:"upload-tips"},Wa={key:0,class:"upload-status"},Ha={class:"status-content"},Qa={class:"dialog-footer"},Xa={class:"upload-content"},Za={class:"upload-tips"},et={key:0,class:"upload-status"},lt={class:"status-content"},at={class:"dialog-footer"},tt={class:"dialog-footer"},ot={key:0,class:"calculation-result"},st={class:"dialog-footer"},ut={class:"dialog-footer"},nt={__name:"insurance",setup(rt){const C=$l(),Be=ql(),G=r(!1),z=r(!1),_e=r([]),y=r("车险"),Qe=r({}),Xe=r({}),N=r([]),h=r({car_no:"",vin:"",track_no:"",insured:"",status:""}),$=r([]),se=r(!1),U=r(null),j=r(!1),ge=r(null),be=r(!1),A=r({status:""}),Ze={status:[{required:!0,message:"请选择新状态",trigger:"change"}]},ue=r(!1),J=r(null),ye=r(!1),T=r(null),we=r([]),Y=r(null),W=r(!1),Ve=r(null),H=r(!1),q=r([]),ke=r([]),Q=r(!1),xe=r(null),ne=r(!1),B=r([]),Ce=r([]),X=r(!1),he=r(null),Ue=r(!1),M=r(null),Z=r({status:""}),el={status:[{required:!0,message:"请选择新状态",trigger:"change"}]},De=r(!1),ee=r(0),le=r(""),re=r(""),ie=r(!1),ae=r(!1),Fe=r(null),c=r({car_no:"",vin:"",insurance_no:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,compulsory_amount:void 0,vehicle_tax_amount:void 0,start_date:"",end_date:""}),ll={car_no:[{required:!0,message:"请输入车牌号",trigger:"blur"}],vin:[{required:!0,message:"请输入车架号",trigger:"blur"}],insurance_no:[{required:!0,message:"请输入投保单号",trigger:"blur"}],insured:[{required:!0,message:"请选择被保人",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}]},te=r(!1),Ee=r(null),p=r({track_no:"",insurance_no:"",name:"",quantity:"",carrier:"",consignee:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,start_date:"",end_date:""}),al={track_no:[{required:!0,message:"请输入运输编号",trigger:"blur"}],insurance_no:[{required:!0,message:"请输入投保单号",trigger:"blur"}],name:[{required:!0,message:"请输入货物名称",trigger:"blur"}],quantity:[{required:!0,message:"请输入货物数量",trigger:"blur"}],carrier:[{required:!0,message:"请输入承运人",trigger:"blur"}],consignee:[{required:!0,message:"请输入收货人",trigger:"blur"}],insured:[{required:!0,message:"请选择被保人",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}]},Ye=o=>({正常:"success",结清退保:"success",逾期退保:"danger",提前结清:"success",逾期结清:"danger",退保结清:"danger"})[o]||"info",tl=o=>{const{columns:e,data:d}=o,n=[];return e.forEach((R,v)=>{if(v===1){n[v]="合计";return}const _=d.map(w=>{const i=R.property;return i==="commercial_amount"?Number(w.commercial_amount)||0:i==="compulsory_amount"?Number(w.compulsory_amount)||0:i==="vehicle_tax_amount"&&Number(w.vehicle_tax_amount)||0});if(_.length>0){const w=_.reduce((i,I)=>{const K=Number(I);return isNaN(K)?i:i+I},0);R.property==="commercial_amount"||R.property==="compulsory_amount"||R.property==="vehicle_tax_amount"?n[v]=F(w):n[v]=""}else n[v]=""}),n},ol=o=>{const{columns:e,data:d}=o,n=[];return e.forEach((R,v)=>{if(v===1){n[v]="合计";return}const _=d.map(w=>R.property==="commercial_amount"&&Number(w.commercial_amount)||0);if(_.length>0){const w=_.reduce((i,I)=>{const K=Number(I);return isNaN(K)?i:i+I},0);R.property==="commercial_amount"?n[v]=F(w):n[v]=""}else n[v]=""}),n},sl=()=>{Be.back()},ul=()=>{Be.push(`/order/detail/${C.params.id}`)},D=async(o=null)=>{G.value=!0;try{const e=o||h.value,d={};y.value==="车险"?(e.car_no&&(d.car_no=e.car_no),e.vin&&(d.vin=e.vin)):y.value==="货运险"&&e.track_no&&(d.track_no=e.track_no),e.insured&&(d.insured=e.insured),e.status&&(d.status=e.status);const n=await ca(C.params.id,d);_e.value=n.data.insurances||[],n.data.type&&(y.value=n.data.type)}catch{m.error("获取投保信息失败")}G.value=!1},P=()=>{D()},nl=()=>{h.value={car_no:"",vin:"",track_no:"",insured:"",status:""},D()},Te=o=>{$.value=o},rl=async()=>{if($.value.length===0){m.warning("请先选择要计算的投保单");return}try{const o=$.value.map(d=>d.id),{data:e}=await _a(C.params.id,{insurance_ids:o});U.value=e,se.value=!0}catch(o){m.error("计算失败："+(o.message||"未知错误"))}},il=()=>{if($.value.length===0){m.warning("请先选择要更新状态的投保单");return}A.value.status="",j.value=!0},dl=async()=>{ge.value&&await ge.value.validate(async o=>{if(o){be.value=!0;try{const e=$.value.map(d=>d.id);await ga(C.params.id,{insurance_ids:e,status:A.value.status}),m.success(`状态更新为${A.value.status}成功`),j.value=!1,$.value=[],D()}catch(e){m.error("状态更新失败："+(e.message||"未知错误"))}be.value=!1}})},F=o=>o?`¥${o.toFixed(2)}`:"¥0.00",ml=()=>{if(y.value==="车险"){if(c.value={car_no:"",vin:"",insurance_no:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,compulsory_amount:void 0,vehicle_tax_amount:void 0,start_date:"",end_date:""},N.value.length===2){const o=N.value.find(e=>e.value!=="同借款人");o&&(c.value.insured=o.value)}ae.value=!0}else if(y.value==="货运险"){if(p.value={track_no:"",insurance_no:"",name:"",quantity:"",carrier:"",consignee:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,start_date:"",end_date:""},N.value.length===2){const o=N.value.find(e=>e.value!=="同借款人");o&&(p.value.insured=o.value)}te.value=!0}},pl=async()=>{Fe.value&&await Fe.value.validate(async o=>{if(o){z.value=!0;try{await He(C.params.id,c.value),m.success("添加车险信息成功"),ae.value=!1,D()}catch(e){m.error("添加车险信息失败："+(e.message||"未知错误"))}z.value=!1}})},vl=async()=>{Ee.value&&await Ee.value.validate(async o=>{if(o){z.value=!0;try{await He(C.params.id,p.value),m.success("添加货运险信息成功"),te.value=!1,D()}catch(e){m.error("添加货运险信息失败："+(e.message||"未知错误"))}z.value=!1}})},Oe=async o=>{try{await Hl.confirm("确定要删除该投保信息吗？","提示",{type:"warning"}),await ba(C.params.id,o.id),m.success("删除成功"),D()}catch(e){e!=="cancel"&&m.error("删除失败："+(e.message||"未知错误"))}},Ne=(o,e)=>{const d=e==="car"?o.car_no:o.track_no;re.value=d,ee.value=o.id,le.value=e,De.value=!0},ze=(o,e)=>{const d=e==="car"?o.car_no:o.track_no;re.value=d,ee.value=o.id,le.value=e,ie.value=!0};Bl(ie,o=>{o||(ee.value=0,le.value="")});const cl=async()=>{window.open(`/api/admin/orders/insurances/download-template?type=${y.value}`,"_blank")},Ae=o=>{M.value=o,Z.value.status="",X.value=!0},fl=async()=>{he.value&&await he.value.validate(async o=>{if(o){Ue.value=!0;try{await ya(C.params.id,M.value.id,Z.value),m.success("状态更新成功"),X.value=!1,D()}catch(e){m.error("状态更新失败："+(e.message||"未知错误"))}Ue.value=!1}})},_l=()=>{T.value=null,we.value=[],Y.value=null,ue.value=!0},gl=o=>{if(T.value=o.raw,!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(o.raw.type)&&!o.name.toLowerCase().endsWith(".xlsx")&&!o.name.toLowerCase().endsWith(".xls")){m.error("请上传Excel文件(.xlsx或.xls)"),J.value.clearFiles(),T.value=null;return}if(o.raw.size>10*1024*1024){m.error("文件大小不能超过10MB"),J.value.clearFiles(),T.value=null;return}},bl=async()=>{if(!T.value){m.error("请选择要上传的文件");return}const o=new FormData;o.append("file",T.value),ye.value=!0,Y.value=null;try{const e=await wa(C.params.id,o);Y.value=e.data,e.data.success>0?(D(),m.success(`导入完成：成功${e.data.success}条，失败${e.data.fail}条`)):m.warning("没有成功导入任何数据，请检查文件格式")}catch(e){m.error("导入失败："+(e.message||"未知错误"))}ye.value=!1},yl=()=>{ue.value=!1,T.value=null,we.value=[],Y.value=null,J.value&&J.value.clearFiles()},Pe=o=>{o==="car"?c.value.same_as_borrower?c.value.insured="同借款人":c.value.insured="":o==="cargo"&&(p.value.same_as_borrower?p.value.insured="同借款人":p.value.insured="")},wl=()=>{q.value=[],ke.value=[],W.value=!0},Vl=o=>{if(!["image/jpeg","image/jpg","image/png","image/bmp","image/tiff","image/webp"].includes(o.raw.type))return m.error("请上传图片文件"),!1;if(o.raw.size>5*1024*1024)return m.error("图片大小不能超过5MB"),!1;q.value.push(o.raw)},kl=o=>{const e=q.value.findIndex(d=>d.name===o.name);e!==-1&&q.value.splice(e,1)},xl=()=>{W.value=!1,q.value=[],ke.value=[],Ve.value&&Ve.value.clearFiles()},Cl=async()=>{if(q.value.length===0){m.error("请选择要上传的行驶证图片");return}const o=new FormData;q.value.forEach(e=>{o.append("images",e)}),H.value=!0;try{await Va(C.params.id,o),m.success("行驶证上传成功，正在后台处理OCR识别"),setTimeout(()=>{H.value=!1,W.value=!1,D()},2e3)}catch(e){m.error("行驶证上传失败："+(e.message||"未知错误"))}H.value=!1},hl=()=>{B.value=[],Ce.value=[],Q.value=!0},Ul=o=>{if(!["image/jpeg","image/jpg","image/png","image/bmp","image/tiff","image/webp"].includes(o.raw.type))return m.error("请上传图片文件"),!1;if(o.raw.size>5*1024*1024)return m.error("图片大小不能超过5MB"),!1;B.value.push(o.raw)},Dl=o=>{const e=B.value.findIndex(d=>d.name===o.name);e!==-1&&B.value.splice(e,1)},Fl=()=>{Q.value=!1,B.value=[],Ce.value=[],xe.value&&xe.value.clearFiles()},El=async()=>{if(B.value.length===0){m.error("请选择要上传的投保单图片");return}const o=new FormData;B.value.forEach(e=>{o.append("images",e)}),ne.value=!0;try{await ka(C.params.id,o),m.success("投保单上传成功，正在后台处理OCR识别"),setTimeout(()=>{ne.value=!1,Q.value=!1,D()},2e3)}catch(e){m.error("投保单上传失败："+(e.message||"未知错误"))}},de=(o,e)=>!o||o.length===0?!1:o.some(d=>d.remark===e),Yl=async()=>{try{const o=await fa(C.params.id);Qe.value=o.data,o.data.user_id&&await Il(o.data.user_id)}catch{m.error("获取订单详情失败")}},Il=async o=>{try{const e=await xa(o);Xe.value=e.data;const d=e.data.insureds||"",n=[];n.push({value:"同借款人",label:"同借款人"}),d&&d.split(";").filter(v=>v.trim()).forEach(v=>{const _=v.split(",");if(_.length>=2){const w=_[0].trim(),i=_[1].trim();n.push({value:w,label:i?`${w} (${i})`:w})}}),N.value=n}catch{m.error("获取用户配置失败")}};return Tl(()=>{D(),Yl()}),(o,e)=>{var je,Je;const d=Ql,n=Ol,R=Nl,v=zl,_=Xl,w=Al,i=Zl,I=ea,K=la,Ie=Pl,g=aa,Ke=ta,me=oa,pe=sa,ve=ua,O=Kl,oe=na,Me=ra,Re=ia,Ml=da,Rl=ma,S=pa,Sl=va,Ge=Gl;return b(),L("div",Ua,[s("div",Da,[l(R,{onBack:sl,title:`${y.value}`},{extra:a(()=>[s("div",Fa,[l(n,{onClick:ul},{default:a(()=>[l(d,null,{default:a(()=>[l(x(jl))]),_:1}),e[45]||(e[45]=u(" 返回详情 "))]),_:1,__:[45]}),l(n,{onClick:cl},{default:a(()=>e[46]||(e[46]=[u(" 下载模板 ")])),_:1,__:[46]}),l(n,{type:"success",onClick:_l},{default:a(()=>e[47]||(e[47]=[u(" 批量导入 ")])),_:1,__:[47]}),y.value==="车险"?(b(),E(n,{key:0,type:"warning",onClick:wl},{default:a(()=>e[48]||(e[48]=[u(" 上传行驶证 ")])),_:1,__:[48]})):k("",!0),l(n,{type:"info",onClick:hl},{default:a(()=>e[49]||(e[49]=[u(" 上传投保单 ")])),_:1,__:[49]}),l(n,{type:"warning",onClick:rl,disabled:$.value.length===0},{default:a(()=>e[50]||(e[50]=[u(" 计算提前结清 ")])),_:1,__:[50]},8,["disabled"]),l(n,{type:"success",onClick:il,disabled:$.value.length===0},{default:a(()=>e[51]||(e[51]=[u(" 更新状态 ")])),_:1,__:[51]},8,["disabled"]),l(n,{type:"primary",onClick:ml},{default:a(()=>[l(d,null,{default:a(()=>[l(x(Jl))]),_:1}),u(" 添加"+f(y.value),1)]),_:1})])]),_:1},8,["title"])]),s("div",Ea,[s("div",Ya,[y.value==="车险"?(b(),E(v,{key:0,modelValue:h.value.car_no,"onUpdate:modelValue":e[0]||(e[0]=t=>h.value.car_no=t),placeholder:"车牌号",style:{width:"150px"},class:"filter-item",onKeyup:ce(P,["enter","native"])},{prefix:a(()=>[l(d,null,{default:a(()=>[l(x(Se))]),_:1})]),_:1},8,["modelValue"])):k("",!0),y.value==="车险"?(b(),E(v,{key:1,modelValue:h.value.vin,"onUpdate:modelValue":e[1]||(e[1]=t=>h.value.vin=t),placeholder:"车架号",style:{width:"200px"},class:"filter-item",onKeyup:ce(P,["enter","native"])},null,8,["modelValue"])):k("",!0),y.value==="货运险"?(b(),E(v,{key:2,modelValue:h.value.track_no,"onUpdate:modelValue":e[2]||(e[2]=t=>h.value.track_no=t),placeholder:"运单号",style:{width:"180px"},class:"filter-item",onKeyup:ce(P,["enter","native"])},{prefix:a(()=>[l(d,null,{default:a(()=>[l(x(Se))]),_:1})]),_:1},8,["modelValue"])):k("",!0),l(v,{modelValue:h.value.insured,"onUpdate:modelValue":e[3]||(e[3]=t=>h.value.insured=t),placeholder:"被保人",style:{width:"180px"},class:"filter-item",onKeyup:ce(P,["enter","native"])},null,8,["modelValue"]),l(w,{modelValue:h.value.status,"onUpdate:modelValue":e[4]||(e[4]=t=>h.value.status=t),placeholder:"选择状态",style:{width:"120px"},class:"filter-item",clearable:"",onChange:P},{default:a(()=>[l(_,{label:"全部",value:""}),l(_,{label:"正常",value:"正常"}),l(_,{label:"逾期退保",value:"逾期退保"}),l(_,{label:"提前结清",value:"提前结清"}),l(_,{label:"逾期结清",value:"逾期结清"}),l(_,{label:"退保结清",value:"退保结清"})]),_:1},8,["modelValue"]),l(n,{class:"filter-item",type:"primary",onClick:P,loading:G.value},{default:a(()=>[l(d,null,{default:a(()=>[l(x(Se))]),_:1}),e[52]||(e[52]=u(" 搜索 "))]),_:1,__:[52]},8,["loading"]),l(n,{class:"filter-item",type:"info",onClick:nl},{default:a(()=>[l(d,null,{default:a(()=>[l(x(Wl))]),_:1}),e[53]||(e[53]=u(" 重置 "))]),_:1,__:[53]})])]),y.value==="车险"?We((b(),E(Ie,{key:0,class:"detail-card"},{default:a(()=>[l(K,{data:_e.value,border:"",style:{width:"100%"},"show-summary":"","sum-text":"合计","summary-method":tl,onSelectionChange:Te},{default:a(()=>[l(i,{type:"selection",width:"55",align:"center"}),l(i,{prop:"status",label:"状态",width:"100",align:"center"},{default:a(({row:t})=>[l(I,{type:Ye(t.status)},{default:a(()=>[u(f(t.status),1)]),_:2},1032,["type"])]),_:1}),l(i,{prop:"car_no",label:"车牌号",width:"110"}),l(i,{prop:"vin",label:"车架号","min-width":"180"}),l(i,{label:"行驶证",width:"80",align:"center"},{default:a(t=>[de(t.row.attachments,"行驶证")?(b(),E(d,{key:0,color:"#67c23a",size:"18"},{default:a(()=>[l(x(fe))]),_:1})):k("",!0)]),_:1}),l(i,{label:"投保单",width:"80",align:"center"},{default:a(t=>[de(t.row.attachments,"投保单")?(b(),E(d,{key:0,color:"#67c23a",size:"18"},{default:a(()=>[l(x(fe))]),_:1})):k("",!0)]),_:1}),l(i,{prop:"insured",label:"被保人",width:"280"}),l(i,{prop:"commercial_amount",label:"商业险",width:"100"},{default:a(t=>[u(f(F(t.row.commercial_amount)),1)]),_:1}),l(i,{prop:"compulsory_amount",label:"交强险",width:"100"},{default:a(t=>[u(f(F(t.row.compulsory_amount)),1)]),_:1}),l(i,{prop:"vehicle_tax_amount",label:"车船税",width:"100"},{default:a(t=>[u(f(F(t.row.vehicle_tax_amount)),1)]),_:1}),l(i,{prop:"start_date",label:"开始日期",width:"110"}),l(i,{prop:"end_date",label:"结束日期",width:"110"}),l(i,{label:"操作",width:"200",fixed:"right"},{default:a(t=>[l(n,{type:"info",link:"",onClick:V=>ze(t.row,"car")},{default:a(()=>e[54]||(e[54]=[u("附件")])),_:2,__:[54]},1032,["onClick"]),l(n,{type:"primary",link:"",onClick:V=>Ne(t.row,"car")},{default:a(()=>e[55]||(e[55]=[u("上传")])),_:2,__:[55]},1032,["onClick"]),l(n,{type:"warning",link:"",onClick:V=>Ae(t.row)},{default:a(()=>e[56]||(e[56]=[u("更新")])),_:2,__:[56]},1032,["onClick"]),l(n,{type:"danger",link:"",onClick:V=>Oe(t.row)},{default:a(()=>e[57]||(e[57]=[u("删除")])),_:2,__:[57]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[Ge,G.value]]):k("",!0),y.value==="货运险"?We((b(),E(Ie,{key:1,class:"detail-card"},{default:a(()=>[l(K,{data:_e.value,border:"",style:{width:"100%"},"show-summary":"","sum-text":"合计","summary-method":ol,onSelectionChange:Te},{default:a(()=>[l(i,{type:"selection",width:"55",align:"center"}),l(i,{prop:"status",label:"状态",width:"100",align:"center"},{default:a(({row:t})=>[l(I,{type:Ye(t.status)},{default:a(()=>[u(f(t.status),1)]),_:2},1032,["type"])]),_:1}),l(i,{prop:"track_no",label:"运输编号",width:"140"}),l(i,{prop:"insurance_no",label:"投保单号","min-width":"180"}),l(i,{label:"运单",width:"80",align:"center"},{default:a(t=>[de(t.row.attachments,"运单")?(b(),E(d,{key:0,color:"#67c23a",size:"18"},{default:a(()=>[l(x(fe))]),_:1})):k("",!0)]),_:1}),l(i,{label:"投保单",width:"80",align:"center"},{default:a(t=>[de(t.row.attachments,"投保单")?(b(),E(d,{key:0,color:"#67c23a",size:"18"},{default:a(()=>[l(x(fe))]),_:1})):k("",!0)]),_:1}),l(i,{prop:"name",label:"货物名称",width:"120"}),l(i,{prop:"quantity",label:"货物数量",width:"100"}),l(i,{prop:"carrier",label:"承运人",width:"120"}),l(i,{prop:"consignee",label:"收货人",width:"120"}),l(i,{prop:"insured",label:"被保人",width:"280"}),l(i,{prop:"commercial_amount",label:"商业险",width:"120"},{default:a(t=>[u(f(F(t.row.commercial_amount)),1)]),_:1}),l(i,{prop:"start_date",label:"开始日期",width:"110"}),l(i,{prop:"end_date",label:"结束日期",width:"110"}),l(i,{label:"操作",width:"250",fixed:"right"},{default:a(t=>[l(n,{type:"info",link:"",onClick:V=>ze(t.row,"cargo")},{default:a(()=>e[58]||(e[58]=[u("附件")])),_:2,__:[58]},1032,["onClick"]),l(n,{type:"primary",link:"",onClick:V=>Ne(t.row,"cargo")},{default:a(()=>e[59]||(e[59]=[u("上传")])),_:2,__:[59]},1032,["onClick"]),l(n,{type:"warning",link:"",onClick:V=>Ae(t.row)},{default:a(()=>e[60]||(e[60]=[u("更新")])),_:2,__:[60]},1032,["onClick"]),l(n,{type:"danger",link:"",onClick:V=>Oe(t.row)},{default:a(()=>e[61]||(e[61]=[u("删除")])),_:2,__:[61]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[Ge,G.value]]):k("",!0),l(O,{modelValue:ae.value,"onUpdate:modelValue":e[17]||(e[17]=t=>ae.value=t),title:"添加车险信息",width:"600px"},{footer:a(()=>[s("span",Ma,[l(n,{onClick:e[16]||(e[16]=t=>ae.value=!1)},{default:a(()=>e[63]||(e[63]=[u("取消")])),_:1,__:[63]}),l(n,{type:"primary",onClick:pl,loading:z.value},{default:a(()=>e[64]||(e[64]=[u("确定")])),_:1,__:[64]},8,["loading"])])]),default:a(()=>[l(ve,{ref_key:"carFormRef",ref:Fe,model:c.value,rules:ll,"label-width":"120px"},{default:a(()=>[l(g,{label:"车牌号",prop:"car_no"},{default:a(()=>[l(v,{modelValue:c.value.car_no,"onUpdate:modelValue":e[5]||(e[5]=t=>c.value.car_no=t),placeholder:"请输入车牌号"},null,8,["modelValue"])]),_:1}),l(g,{label:"车架号",prop:"vin"},{default:a(()=>[l(v,{modelValue:c.value.vin,"onUpdate:modelValue":e[6]||(e[6]=t=>c.value.vin=t),placeholder:"请输入车架号"},null,8,["modelValue"])]),_:1}),l(g,{label:"投保单号",prop:"insurance_no"},{default:a(()=>[l(v,{modelValue:c.value.insurance_no,"onUpdate:modelValue":e[7]||(e[7]=t=>c.value.insurance_no=t),placeholder:"请输入投保单号"},null,8,["modelValue"])]),_:1}),l(g,{label:"被保人",prop:"insured"},{default:a(()=>[s("div",Ia,[l(w,{modelValue:c.value.insured,"onUpdate:modelValue":e[8]||(e[8]=t=>c.value.insured=t),placeholder:"请选择被保人",style:{width:"300px"},disabled:c.value.same_as_borrower},{default:a(()=>[(b(!0),L(Le,null,$e(N.value,t=>(b(),E(_,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),l(Ke,{modelValue:c.value.same_as_borrower,"onUpdate:modelValue":e[9]||(e[9]=t=>c.value.same_as_borrower=t),onChange:e[10]||(e[10]=t=>Pe("car")),class:"same-borrower-checkbox",style:{"margin-left":"10px"}},{default:a(()=>e[62]||(e[62]=[u(" 同借款人 ")])),_:1,__:[62]},8,["modelValue"])])]),_:1}),l(g,{label:"商业险",prop:"commercial_amount"},{default:a(()=>[l(me,{modelValue:c.value.commercial_amount,"onUpdate:modelValue":e[11]||(e[11]=t=>c.value.commercial_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(g,{label:"交强险",prop:"compulsory_amount"},{default:a(()=>[l(me,{modelValue:c.value.compulsory_amount,"onUpdate:modelValue":e[12]||(e[12]=t=>c.value.compulsory_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(g,{label:"车船税",prop:"vehicle_tax_amount"},{default:a(()=>[l(me,{modelValue:c.value.vehicle_tax_amount,"onUpdate:modelValue":e[13]||(e[13]=t=>c.value.vehicle_tax_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(g,{label:"开始日期",prop:"start_date"},{default:a(()=>[l(pe,{modelValue:c.value.start_date,"onUpdate:modelValue":e[14]||(e[14]=t=>c.value.start_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择开始日期"},null,8,["modelValue"])]),_:1}),l(g,{label:"结束日期",prop:"end_date"},{default:a(()=>[l(pe,{modelValue:c.value.end_date,"onUpdate:modelValue":e[15]||(e[15]=t=>c.value.end_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择结束日期"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(O,{modelValue:te.value,"onUpdate:modelValue":e[31]||(e[31]=t=>te.value=t),title:"添加货运险信息",width:"700px"},{footer:a(()=>[s("span",Sa,[l(n,{onClick:e[30]||(e[30]=t=>te.value=!1)},{default:a(()=>e[66]||(e[66]=[u("取消")])),_:1,__:[66]}),l(n,{type:"primary",onClick:vl,loading:z.value},{default:a(()=>e[67]||(e[67]=[u("确定")])),_:1,__:[67]},8,["loading"])])]),default:a(()=>[l(ve,{ref_key:"cargoFormRef",ref:Ee,model:p.value,rules:al,"label-width":"120px"},{default:a(()=>[l(g,{label:"运输编号",prop:"track_no"},{default:a(()=>[l(v,{modelValue:p.value.track_no,"onUpdate:modelValue":e[18]||(e[18]=t=>p.value.track_no=t),placeholder:"请输入运输编号"},null,8,["modelValue"])]),_:1}),l(g,{label:"投保单号",prop:"insurance_no"},{default:a(()=>[l(v,{modelValue:p.value.insurance_no,"onUpdate:modelValue":e[19]||(e[19]=t=>p.value.insurance_no=t),placeholder:"请输入投保单号"},null,8,["modelValue"])]),_:1}),l(g,{label:"货物名称",prop:"name"},{default:a(()=>[l(v,{modelValue:p.value.name,"onUpdate:modelValue":e[20]||(e[20]=t=>p.value.name=t),placeholder:"请输入货物名称"},null,8,["modelValue"])]),_:1}),l(g,{label:"货物数量",prop:"quantity"},{default:a(()=>[l(v,{modelValue:p.value.quantity,"onUpdate:modelValue":e[21]||(e[21]=t=>p.value.quantity=t),placeholder:"请输入货物数量"},null,8,["modelValue"])]),_:1}),l(g,{label:"承运人",prop:"carrier"},{default:a(()=>[l(v,{modelValue:p.value.carrier,"onUpdate:modelValue":e[22]||(e[22]=t=>p.value.carrier=t),placeholder:"请输入承运人"},null,8,["modelValue"])]),_:1}),l(g,{label:"收货人",prop:"consignee"},{default:a(()=>[l(v,{modelValue:p.value.consignee,"onUpdate:modelValue":e[23]||(e[23]=t=>p.value.consignee=t),placeholder:"请输入收货人"},null,8,["modelValue"])]),_:1}),l(g,{label:"被保人",prop:"insured"},{default:a(()=>[s("div",Ra,[l(w,{modelValue:p.value.insured,"onUpdate:modelValue":e[24]||(e[24]=t=>p.value.insured=t),placeholder:"请选择被保人",style:{width:"300px"},disabled:p.value.same_as_borrower},{default:a(()=>[(b(!0),L(Le,null,$e(N.value,t=>(b(),E(_,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),l(Ke,{modelValue:p.value.same_as_borrower,"onUpdate:modelValue":e[25]||(e[25]=t=>p.value.same_as_borrower=t),onChange:e[26]||(e[26]=t=>Pe("cargo")),class:"same-borrower-checkbox",style:{"margin-left":"10px"}},{default:a(()=>e[65]||(e[65]=[u(" 同借款人 ")])),_:1,__:[65]},8,["modelValue"])])]),_:1}),l(g,{label:"商业险",prop:"commercial_amount"},{default:a(()=>[l(me,{modelValue:p.value.commercial_amount,"onUpdate:modelValue":e[27]||(e[27]=t=>p.value.commercial_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(g,{label:"开始日期",prop:"start_date"},{default:a(()=>[l(pe,{modelValue:p.value.start_date,"onUpdate:modelValue":e[28]||(e[28]=t=>p.value.start_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择开始日期"},null,8,["modelValue"])]),_:1}),l(g,{label:"结束日期",prop:"end_date"},{default:a(()=>[l(pe,{modelValue:p.value.end_date,"onUpdate:modelValue":e[29]||(e[29]=t=>p.value.end_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择结束日期"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(O,{modelValue:ue.value,"onUpdate:modelValue":e[32]||(e[32]=t=>ue.value=t),title:"批量导入投保信息",width:"600px"},{footer:a(()=>[s("span",Ga,[l(n,{onClick:yl},{default:a(()=>e[76]||(e[76]=[u("取消")])),_:1,__:[76]}),l(n,{type:"primary",onClick:bl,loading:ye.value,disabled:!T.value},{default:a(()=>e[77]||(e[77]=[u(" 开始导入 ")])),_:1,__:[77]},8,["loading","disabled"])])]),default:a(()=>[s("div",La,[s("div",$a,[l(oe,{title:"导入说明",type:"info","show-icon":"",closable:!1},{default:a(()=>e[68]||(e[68]=[s("div",{class:"tips-content"},[s("p",null,"1. 请先下载模板，按照模板格式填写数据"),s("p",null,"2. 支持 .xlsx 和 .xls 格式文件"),s("p",null,"3. 必填字段不能为空，金额字段请填写数字"),s("p",null,"4. 日期格式：YYYY-MM-DD，如：2024-01-01")],-1)])),_:1,__:[68]})]),l(Me,{ref_key:"excelUploadRef",ref:J,class:"upload-demo",drag:"","auto-upload":!1,limit:1,accept:".xlsx,.xls","on-change":gl,"file-list":we.value},{tip:a(()=>e[69]||(e[69]=[s("div",{class:"el-upload__tip"}," 只能上传 .xlsx/.xls 文件，且不超过 10MB ",-1)])),default:a(()=>[l(d,{class:"el-icon--upload"},{default:a(()=>[l(x(qe))]),_:1}),e[70]||(e[70]=s("div",{class:"el-upload__text"},[u(" 将Excel文件拖到此处，或"),s("em",null,"点击上传")],-1))]),_:1,__:[70]},8,["file-list"]),Y.value?(b(),L("div",qa,[l(Ie,null,{header:a(()=>e[71]||(e[71]=[s("span",null,"导入结果",-1)])),default:a(()=>[s("div",Ba,[l(Ml,{gutter:20},{default:a(()=>[l(Re,{span:8},{default:a(()=>[s("div",Ta,[s("div",Oa,f(Y.value.total),1),e[72]||(e[72]=s("div",{class:"stat-label"},"总数",-1))])]),_:1}),l(Re,{span:8},{default:a(()=>[s("div",Na,[s("div",za,f(Y.value.success),1),e[73]||(e[73]=s("div",{class:"stat-label"},"成功",-1))])]),_:1}),l(Re,{span:8},{default:a(()=>[s("div",Aa,[s("div",Pa,f(Y.value.fail),1),e[74]||(e[74]=s("div",{class:"stat-label"},"失败",-1))])]),_:1})]),_:1})]),Y.value.errors&&Y.value.errors.length>0?(b(),L("div",Ka,[l(Rl,{"content-position":"left"},{default:a(()=>e[75]||(e[75]=[u("错误详情")])),_:1,__:[75]}),(b(!0),L(Le,null,$e(Y.value.errors,(t,V)=>(b(),L("div",{class:"error-item",key:V},[l(I,{type:"danger",size:"small"},{default:a(()=>[u(f(t),1)]),_:2},1024)]))),128))])):k("",!0)]),_:1})])):k("",!0)])]),_:1},8,["modelValue"]),l(O,{modelValue:W.value,"onUpdate:modelValue":e[33]||(e[33]=t=>W.value=t),title:"批量上传行驶证",width:"700px"},{footer:a(()=>[s("span",Qa,[l(n,{onClick:xl},{default:a(()=>e[82]||(e[82]=[u("取消")])),_:1,__:[82]}),l(n,{type:"primary",onClick:Cl,loading:H.value,disabled:q.value.length===0},{default:a(()=>e[83]||(e[83]=[u(" 开始上传识别 ")])),_:1,__:[83]},8,["loading","disabled"])])]),default:a(()=>[s("div",ja,[s("div",Ja,[l(oe,{type:"info","show-icon":"",closable:!1},{default:a(()=>e[78]||(e[78]=[s("div",{class:"tips-content"},[s("p",null,"1. 支持 JPG、PNG、BMP、TIFF、WEBP 格式"),s("p",null,"2. 系统将自动OCR识别行驶证信息并匹配车险记录"),s("p",null,"3. 请确保先录入车险信息再上传对应的行驶证")],-1)])),_:1,__:[78]})]),l(Me,{ref_key:"driverLicenseUploadRef",ref:Ve,class:"upload-demo",drag:"",multiple:"","auto-upload":!1,limit:0,accept:"image/*","on-change":Vl,"on-remove":kl,"file-list":ke.value},{tip:a(()=>e[79]||(e[79]=[s("div",{class:"el-upload__tip"}," 支持多张图片同时上传，每张不超过5MB ",-1)])),default:a(()=>[l(d,{class:"el-icon--upload"},{default:a(()=>[l(x(qe))]),_:1}),e[80]||(e[80]=s("div",{class:"el-upload__text"},[u(" 将行驶证图片拖到此处，或"),s("em",null,"点击上传")],-1))]),_:1,__:[80]},8,["file-list"]),H.value?(b(),L("div",Wa,[l(oe,{title:"正在上传处理中...",type:"info","show-icon":"",closable:!1},{default:a(()=>[s("div",Ha,[s("p",null,"已选择 "+f(q.value.length)+" 张图片",1),e[81]||(e[81]=s("p",null,"正在后台进行OCR识别和匹配处理，请稍后查看结果",-1))])]),_:1})])):k("",!0)])]),_:1},8,["modelValue"]),l(O,{modelValue:Q.value,"onUpdate:modelValue":e[34]||(e[34]=t=>Q.value=t),title:"批量上传投保单",width:"700px"},{footer:a(()=>[s("span",at,[l(n,{onClick:Fl},{default:a(()=>e[88]||(e[88]=[u("取消")])),_:1,__:[88]}),l(n,{type:"primary",onClick:El,loading:ne.value,disabled:B.value.length===0},{default:a(()=>e[89]||(e[89]=[u(" 开始上传识别 ")])),_:1,__:[89]},8,["loading","disabled"])])]),default:a(()=>[s("div",Xa,[s("div",Za,[l(oe,{type:"info","show-icon":"",closable:!1},{default:a(()=>e[84]||(e[84]=[s("div",{class:"tips-content"},[s("p",null,"1. 支持 JPG、PNG、BMP、TIFF、WEBP 格式"),s("p",null,"2. 系统将自动OCR识别投保单信息并匹配保险记录"),s("p",null,"3. 请确保先录入保险信息再上传对应的投保单")],-1)])),_:1,__:[84]})]),l(Me,{ref_key:"insuranceFormUploadRef",ref:xe,class:"upload-demo",drag:"",multiple:"","auto-upload":!1,limit:0,accept:"image/*","on-change":Ul,"on-remove":Dl,"file-list":Ce.value},{tip:a(()=>e[85]||(e[85]=[s("div",{class:"el-upload__tip"}," 支持多张图片同时上传，每张不超过5MB ",-1)])),default:a(()=>[l(d,{class:"el-icon--upload"},{default:a(()=>[l(x(qe))]),_:1}),e[86]||(e[86]=s("div",{class:"el-upload__text"},[u(" 将投保单图片拖到此处，或"),s("em",null,"点击上传")],-1))]),_:1,__:[86]},8,["file-list"]),ne.value?(b(),L("div",et,[l(oe,{title:"正在上传处理中...",type:"info","show-icon":"",closable:!1},{default:a(()=>[s("div",lt,[s("p",null,"已选择 "+f(B.value.length)+" 张图片",1),e[87]||(e[87]=s("p",null,"正在后台进行OCR识别和匹配处理，请稍后查看结果",-1))])]),_:1})])):k("",!0)])]),_:1},8,["modelValue"]),l(Ca,{visible:De.value,"onUpdate:visible":e[35]||(e[35]=t=>De.value=t),title:re.value,"order-id":x(C).params.id,"ref-id":ee.value,type:le.value,onSuccess:D},null,8,["visible","title","order-id","ref-id","type"]),l(ha,{visible:ie.value,"onUpdate:visible":e[36]||(e[36]=t=>ie.value=t),title:re.value,"order-id":x(C).params.id,"ref-id":ee.value,type:le.value,"allow-delete":!0},null,8,["visible","title","order-id","ref-id","type"]),l(O,{modelValue:X.value,"onUpdate:modelValue":e[39]||(e[39]=t=>X.value=t),title:`更新${y.value}状态 - ${y.value==="车险"?(je=M.value)==null?void 0:je.car_no:(Je=M.value)==null?void 0:Je.track_no}`,width:"500px"},{footer:a(()=>[s("span",tt,[l(n,{onClick:e[38]||(e[38]=t=>X.value=!1)},{default:a(()=>e[90]||(e[90]=[u("取消")])),_:1,__:[90]}),l(n,{type:"primary",onClick:fl,loading:Ue.value},{default:a(()=>e[91]||(e[91]=[u(" 确定 ")])),_:1,__:[91]},8,["loading"])])]),default:a(()=>[l(ve,{ref_key:"updateStatusFormRef",ref:he,model:Z.value,rules:el,"label-width":"100px"},{default:a(()=>[l(g,{label:y.value==="车险"?"车牌号":"运单号"},{default:a(()=>{var t,V;return[s("span",null,f(y.value==="车险"?(t=M.value)==null?void 0:t.car_no:(V=M.value)==null?void 0:V.track_no),1)]}),_:1},8,["label"]),l(g,{label:y.value==="车险"?"车架号":"承运车辆"},{default:a(()=>{var t,V;return[s("span",null,f(y.value==="车险"?(t=M.value)==null?void 0:t.vin:(V=M.value)==null?void 0:V.carrier),1)]}),_:1},8,["label"]),l(g,{label:"当前状态"},{default:a(()=>{var t;return[l(I,{type:Ye((t=M.value)==null?void 0:t.status)},{default:a(()=>{var V;return[u(f(((V=M.value)==null?void 0:V.status)||"未知"),1)]}),_:1},8,["type"])]}),_:1}),l(g,{label:"新状态",prop:"status"},{default:a(()=>[l(w,{modelValue:Z.value.status,"onUpdate:modelValue":e[37]||(e[37]=t=>Z.value.status=t),placeholder:"请选择新状态",style:{width:"100%"}},{default:a(()=>[l(_,{label:"正常",value:"正常"}),l(_,{label:"逾期退保",value:"逾期退保"}),l(_,{label:"提前结清",value:"提前结清"}),l(_,{label:"逾期结清",value:"逾期结清"}),l(_,{label:"退保结清",value:"退保结清"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(O,{modelValue:se.value,"onUpdate:modelValue":e[41]||(e[41]=t=>se.value=t),title:"计算提前结清金额",width:"700px"},{footer:a(()=>[s("span",st,[l(n,{onClick:e[40]||(e[40]=t=>se.value=!1)},{default:a(()=>e[92]||(e[92]=[u("关闭")])),_:1,__:[92]})])]),default:a(()=>[U.value?(b(),L("div",ot,[l(Sl,{title:"计算结果",column:2,border:""},{default:a(()=>[l(S,{label:"订单号"},{default:a(()=>[u(f(U.value.order_no),1)]),_:1}),l(S,{label:"选中投保单数量"},{default:a(()=>[u(f(U.value.selected_count)+"个",1)]),_:1}),l(S,{label:"总商业险金额"},{default:a(()=>[u(f(F(U.value.total_commercial_amount)),1)]),_:1}),l(S,{label:"选中商业险金额"},{default:a(()=>[u(f(F(U.value.selected_commercial_amount)),1)]),_:1}),l(S,{label:"分摊比例"},{default:a(()=>[u(f((U.value.allocation_ratio*100).toFixed(2))+"%",1)]),_:1}),l(S,{label:"剩余本金"},{default:a(()=>[u(f(F(U.value.remaining_principal)),1)]),_:1}),l(S,{label:"分摊本金"},{default:a(()=>[u(f(F(U.value.allocated_principal)),1)]),_:1}),l(S,{label:"分摊利息"},{default:a(()=>[u(f(F(U.value.allocated_interest)),1)]),_:1}),l(S,{label:"产品还款方式"},{default:a(()=>[u(f(U.value.product_repay_type),1)]),_:1}),l(S,{label:"结清总金额",class:"highlight"},{default:a(()=>[l(I,{type:"danger",size:"large"},{default:a(()=>[u(f(F(U.value.total_settlement_amount)),1)]),_:1})]),_:1})]),_:1})])):k("",!0)]),_:1},8,["modelValue"]),l(O,{modelValue:j.value,"onUpdate:modelValue":e[44]||(e[44]=t=>j.value=t),title:"更新投保单状态",width:"500px"},{footer:a(()=>[s("span",ut,[l(n,{onClick:e[43]||(e[43]=t=>j.value=!1)},{default:a(()=>e[93]||(e[93]=[u("取消")])),_:1,__:[93]}),l(n,{type:"primary",onClick:dl,loading:be.value},{default:a(()=>e[94]||(e[94]=[u(" 确定 ")])),_:1,__:[94]},8,["loading"])])]),default:a(()=>[l(ve,{ref_key:"confirmOperationFormRef",ref:ge,model:A.value,rules:Ze,"label-width":"100px"},{default:a(()=>[l(g,{label:"选中数量"},{default:a(()=>[s("span",null,f($.value.length)+"个投保单",1)]),_:1}),l(g,{label:"新状态",prop:"status"},{default:a(()=>[l(w,{modelValue:A.value.status,"onUpdate:modelValue":e[42]||(e[42]=t=>A.value.status=t),placeholder:"请选择新状态",style:{width:"100%"}},{default:a(()=>[l(_,{label:"提前结清",value:"提前结清"}),l(_,{label:"提前退保",value:"提前退保"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Mt=Ll(nt,[["__scopeId","data-v-db6be9fb"]]);export{Mt as default};
