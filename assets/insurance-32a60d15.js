import{_ as Ge,b as He,u as Je}from"./index-2c2925e9.js";/* empty css               *//* empty css                   *//* empty css                    *//* empty css                 *//* empty css                       *//* empty css                     *//* empty css                        *//* empty css                        *//* empty css                  *//* empty css                 *//* empty css                *//* empty css               *//* empty css                       */import{r as m,j as ye,ae as We,l as _,B as b,C as s,F as l,G as a,p as F,S as x,af as we,E as v,aE as Ke,ag as Xe,M as Qe,ai as Ze,u as L,aH as el,O as r,av as ll,aG as al,aI as tl,as as sl,D as i,H as N,I as S,aw as Ve,X as ol,J as rl,a2 as nl,K as ul,ao as dl,ah as il,al as ml,an as pl,ar as _l,a5 as cl,a6 as vl,ax as fl,ay as gl,aJ as bl,aK as yl,aL as wl,a7 as Vl,aB as hl,aC as xl,aD as kl,am as Dl}from"./element-plus-f067b2d4.js";import{h as Yl,a as Cl,i as he,j as Tl,e as Ul,u as Ml}from"./order-a33ec320.js";import{a as El}from"./user-a5db3024.js";const Fl={class:"insurance-detail"},Ll={class:"page-header"},ql={class:"header-actions"},Rl={class:"stat-item"},Bl={class:"stat-number"},$l={class:"stat-item"},Il={class:"stat-number"},Ol={class:"stat-item"},zl={class:"stat-number"},Al={class:"stat-item total"},Nl={class:"stat-number"},Sl={class:"stat-item total"},Pl={class:"stat-number"},jl={class:"stat-item"},Gl={class:"stat-number"},Hl={class:"stat-item"},Jl={class:"stat-number"},Wl={class:"empty-state"},Kl={class:"insured-input"},Xl={class:"dialog-footer"},Ql={class:"insured-input"},Zl={class:"dialog-footer"},ea={class:"upload-content"},la={class:"upload-tips"},aa={key:0,class:"import-result"},ta={class:"result-summary"},sa={class:"stat-item"},oa={class:"stat-number total"},ra={class:"stat-item"},na={class:"stat-number success"},ua={class:"stat-item"},da={class:"stat-number fail"},ia={key:0,class:"error-list"},ma={class:"dialog-footer"},pa={class:"upload-content"},_a={class:"upload-tips"},ca={key:0,class:"import-result"},va={class:"result-summary"},fa={class:"stat-item"},ga={class:"stat-number total"},ba={class:"stat-item"},ya={class:"stat-number success"},wa={class:"stat-item"},Va={class:"stat-number fail"},ha={key:0,class:"detail-results"},xa={class:"result-list"},ka={class:"result-header"},Da={class:"file-name"},Ya={key:0,class:"result-content success-content"},Ca={class:"ocr-info"},Ta={class:"info-item"},Ua={class:"info-item"},Ma={class:"info-item"},Ea={key:1,class:"result-content error-content"},Fa={class:"error-message"},La={key:1,class:"error-list"},qa={class:"dialog-footer"},Ra={__name:"insurance",setup(Ba){const Y=He(),J=Je(),$=m(!1),q=m(!1),k=m([]),y=m("车险"),xe=m({}),ke=m({}),W=m([]),P=m(!1),I=m(null),K=m(!1),U=m(null),X=m([]),V=m(null),O=m(!1),Q=m(null),Z=m(!1),M=m([]),ee=m([]),w=m(null),z=m(!1),le=m(null),u=m({car_no:"",vin:"",insurance_no:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,compulsory_amount:void 0,vehicle_tax_amount:void 0,start_date:"",end_date:"",issue_date:""}),De={car_no:[{required:!0,message:"请输入车牌号",trigger:"blur"}],vin:[{required:!0,message:"请输入车架号",trigger:"blur"}],insurance_no:[{required:!0,message:"请输入投保单号",trigger:"blur"}],insured:[{required:!0,message:"请选择被保人",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}],issue_date:[{required:!0,message:"请选择出单日期",trigger:"change"}]},A=m(!1),ae=m(null),n=m({track_no:"",insurance_no:"",name:"",quantity:"",carrier:"",consignee:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,start_date:"",end_date:"",issue_date:""}),Ye={track_no:[{required:!0,message:"请输入运输编号",trigger:"blur"}],insurance_no:[{required:!0,message:"请输入投保单号",trigger:"blur"}],name:[{required:!0,message:"请输入货物名称",trigger:"blur"}],quantity:[{required:!0,message:"请输入货物数量",trigger:"blur"}],carrier:[{required:!0,message:"请输入承运人",trigger:"blur"}],consignee:[{required:!0,message:"请输入收货人",trigger:"blur"}],insured:[{required:!0,message:"请选择被保人",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}],issue_date:[{required:!0,message:"请选择出单日期",trigger:"change"}]},Ce=()=>{J.back()},Te=()=>{J.push(`/order/detail/${Y.params.id}`)},R=async()=>{$.value=!0;try{const o=await Yl(Y.params.id);k.value=o.data.insurances||[],o.data.type&&(y.value=o.data.type)}catch{v.error("获取投保信息失败")}$.value=!1},D=o=>o?`¥${o.toFixed(2)}`:"¥0.00",j=ye(()=>{if(y.value!=="车险"||!k.value.length)return{commercialTotal:0,compulsoryTotal:0,vehicleTaxTotal:0,grandTotal:0};const o=k.value.reduce((e,f)=>(e.commercialTotal+=f.commercial_amount||0,e.compulsoryTotal+=f.compulsory_amount||0,e.vehicleTaxTotal+=f.vehicle_tax_amount||0,e),{commercialTotal:0,compulsoryTotal:0,vehicleTaxTotal:0});return o.grandTotal=o.commercialTotal+o.compulsoryTotal+o.vehicleTaxTotal,o}),oe=ye(()=>{if(y.value!=="货运险"||!k.value.length)return{commercialTotal:0,averageAmount:0};const o=k.value.reduce((f,p)=>f+(p.commercial_amount||0),0),e=o/k.value.length;return{commercialTotal:o,averageAmount:e}}),re=()=>{y.value==="车险"?(u.value={car_no:"",vin:"",insurance_no:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,compulsory_amount:void 0,vehicle_tax_amount:void 0,start_date:"",end_date:"",issue_date:""},z.value=!0):y.value==="货运险"&&(n.value={track_no:"",insurance_no:"",name:"",quantity:"",carrier:"",consignee:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,start_date:"",end_date:"",issue_date:""},A.value=!0)},Ue=async()=>{le.value&&await le.value.validate(async o=>{if(o){q.value=!0;try{await he(Y.params.id,u.value),v.success("添加车险信息成功"),z.value=!1,R()}catch(e){v.error("添加车险信息失败："+(e.message||"未知错误"))}q.value=!1}})},Me=async()=>{ae.value&&await ae.value.validate(async o=>{if(o){q.value=!0;try{await he(Y.params.id,n.value),v.success("添加货运险信息成功"),A.value=!1,R()}catch(e){v.error("添加货运险信息失败："+(e.message||"未知错误"))}q.value=!1}})},ne=async o=>{try{await rl.confirm("确定要删除该投保信息吗？","提示",{type:"warning"}),await Tl(Y.params.id,o.id),v.success("删除成功"),R()}catch(e){e!=="cancel"&&v.error("删除失败："+(e.message||"未知错误"))}},ue=(o,e)=>{J.push({path:`/order/attachments/${Y.params.id}`,query:{ref_id:o||0,type:e||"order"}})},Ee=async()=>{window.open(`/api/admin/orders/insurances/download-template?type=${y.value}`,"_blank")},Fe=()=>{U.value=null,X.value=[],V.value=null,P.value=!0},Le=o=>{if(U.value=o.raw,!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(o.raw.type)&&!o.name.toLowerCase().endsWith(".xlsx")&&!o.name.toLowerCase().endsWith(".xls")){v.error("请上传Excel文件(.xlsx或.xls)"),I.value.clearFiles(),U.value=null;return}if(o.raw.size>10*1024*1024){v.error("文件大小不能超过10MB"),I.value.clearFiles(),U.value=null;return}},qe=async()=>{if(!U.value){v.error("请选择要上传的文件");return}const o=new FormData;o.append("file",U.value),K.value=!0,V.value=null;try{const e=await Ul(Y.params.id,o);V.value=e.data,e.data.success>0?(R(),v.success(`导入完成：成功${e.data.success}条，失败${e.data.fail}条`)):v.warning("没有成功导入任何数据，请检查文件格式")}catch(e){v.error("导入失败："+(e.message||"未知错误"))}K.value=!1},Re=()=>{P.value=!1,U.value=null,X.value=[],V.value=null,I.value&&I.value.clearFiles()},de=o=>{o==="car"?u.value.same_as_borrower?u.value.insured="同借款人":u.value.insured="":o==="cargo"&&(n.value.same_as_borrower?n.value.insured="同借款人":n.value.insured="")},Be=()=>{M.value=[],ee.value=[],w.value=null,O.value=!0},$e=o=>{if(!["image/jpeg","image/jpg","image/png","image/bmp","image/tiff","image/webp"].includes(o.raw.type))return v.error("请上传图片文件"),!1;if(o.raw.size>5*1024*1024)return v.error("图片大小不能超过5MB"),!1;M.value.push(o.raw)},Ie=o=>{const e=M.value.findIndex(f=>f.name===o.name);e!==-1&&M.value.splice(e,1)},Oe=()=>{O.value=!1,M.value=[],ee.value=[],w.value=null,Q.value&&Q.value.clearFiles()},ze=async()=>{if(M.value.length===0){v.error("请选择要上传的行驶证图片");return}const o=new FormData;M.value.forEach(e=>{o.append("images",e)}),Z.value=!0,w.value=null;try{const e=await Ml(Y.params.id,o);w.value={message:e.data.message,file_count:e.data.file_count},v.success("行驶证上传成功，正在后台处理OCR识别"),O.value=!1,setTimeout(()=>{R()},2e3)}catch(e){v.error("行驶证上传失败："+(e.message||"未知错误"))}Z.value=!1},Ae=o=>o==="success"?"success":o==="fail"?"danger":"info",Ne=o=>o==="success"?"成功":o==="fail"?"失败":"处理中",Se=async()=>{try{const o=await Cl(Y.params.id);xe.value=o.data,o.data.user_id&&await Pe(o.data.user_id)}catch{v.error("获取订单详情失败")}},Pe=async o=>{try{const e=await El(o);ke.value=e.data;const f=e.data.insureds||"",p=[];p.push({value:"同借款人",label:"同借款人"}),f&&f.split(";").filter(g=>g.trim()).forEach(g=>{const E=g.split(",");if(E.length>=2){const h=E[0].trim(),d=E[1].trim();p.push({value:h,label:d?`${h} (${d})`:h})}}),W.value=p}catch{v.error("获取用户配置失败")}};return We(()=>{R(),Se()}),(o,e)=>{const f=nl,p=ul,ie=Ke,g=dl,E=il,h=Xe,d=ml,me=pl,je=_l,C=cl,c=vl,pe=fl,_e=gl,ce=bl,G=yl,B=wl,ve=Vl,H=Qe,fe=hl,ge=xl,te=kl,se=Dl,be=Ze;return _(),b("div",Fl,[s("div",Ll,[l(ie,{onBack:Ce,title:`${y.value}投保信息管理`},{extra:a(()=>[s("div",ql,[l(p,{onClick:Te},{default:a(()=>[l(f,null,{default:a(()=>[l(L(el))]),_:1}),e[31]||(e[31]=r(" 返回订单详情 "))]),_:1,__:[31]}),l(p,{onClick:Ee},{default:a(()=>[l(f,null,{default:a(()=>[l(L(ll))]),_:1}),e[32]||(e[32]=r(" 下载模板 "))]),_:1,__:[32]}),l(p,{type:"success",onClick:Fe},{default:a(()=>[l(f,null,{default:a(()=>[l(L(al))]),_:1}),e[33]||(e[33]=r(" 批量导入 "))]),_:1,__:[33]}),y.value==="车险"?(_(),F(p,{key:0,type:"warning",onClick:Be},{default:a(()=>[l(f,null,{default:a(()=>[l(L(tl))]),_:1}),e[34]||(e[34]=r(" 批量上传行驶证 "))]),_:1,__:[34]})):x("",!0),l(p,{type:"primary",onClick:re},{default:a(()=>[l(f,null,{default:a(()=>[l(L(sl))]),_:1}),r(" 添加"+i(y.value)+"投保信息 ",1)]),_:1})])]),_:1},8,["title"])]),y.value==="车险"?(_(),F(h,{key:0,class:"detail-card"},{default:a(()=>[l(E,{gutter:20},{default:a(()=>[l(g,{span:6},{default:a(()=>[s("div",Rl,[s("div",Bl,i(D(j.value.commercialTotal)),1),e[35]||(e[35]=s("div",{class:"stat-label"},"商业险总金额",-1))])]),_:1}),l(g,{span:6},{default:a(()=>[s("div",$l,[s("div",Il,i(D(j.value.compulsoryTotal)),1),e[36]||(e[36]=s("div",{class:"stat-label"},"交强险总金额",-1))])]),_:1}),l(g,{span:6},{default:a(()=>[s("div",Ol,[s("div",zl,i(D(j.value.vehicleTaxTotal)),1),e[37]||(e[37]=s("div",{class:"stat-label"},"车船税总金额",-1))])]),_:1}),l(g,{span:6},{default:a(()=>[s("div",Al,[s("div",Nl,i(D(j.value.grandTotal)),1),e[38]||(e[38]=s("div",{class:"stat-label"},"合计总保费",-1))])]),_:1})]),_:1})]),_:1})):x("",!0),y.value==="车险"?we((_(),F(h,{key:1,class:"detail-card"},{default:a(()=>[l(me,{data:k.value,border:"",style:{width:"100%"}},{default:a(()=>[l(d,{prop:"car_no",label:"车牌号",width:"100"}),l(d,{prop:"vin",label:"车架号","min-width":"180"}),l(d,{prop:"insurance_no",label:"投保单号","min-width":"230"}),l(d,{prop:"insured",label:"被保人",width:"280"}),l(d,{prop:"commercial_amount",label:"商业险",width:"100"},{default:a(t=>[r(i(D(t.row.commercial_amount)),1)]),_:1}),l(d,{prop:"compulsory_amount",label:"交强险",width:"100"},{default:a(t=>[r(i(D(t.row.compulsory_amount)),1)]),_:1}),l(d,{prop:"vehicle_tax_amount",label:"车船税",width:"100"},{default:a(t=>[r(i(D(t.row.vehicle_tax_amount)),1)]),_:1}),l(d,{prop:"start_date",label:"开始日期",width:"110"}),l(d,{prop:"end_date",label:"结束日期",width:"110"}),l(d,{prop:"issue_date",label:"出单日期",width:"110"}),l(d,{prop:"attachments",label:"附件数量",width:"100"},{default:a(t=>[r(i(t.row.attachments.length),1)]),_:1}),l(d,{label:"操作",width:"150",fixed:"right"},{default:a(t=>[l(p,{type:"info",link:"",onClick:T=>ue(t.row.id,"car")},{default:a(()=>e[39]||(e[39]=[r("查看附件")])),_:2,__:[39]},1032,["onClick"]),l(p,{type:"danger",link:"",onClick:T=>ne(t.row)},{default:a(()=>e[40]||(e[40]=[r("删除")])),_:2,__:[40]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[be,$.value]]):x("",!0),y.value==="货运险"?(_(),F(h,{key:2,class:"detail-card"},{default:a(()=>[l(E,{gutter:20},{default:a(()=>[l(g,{span:8},{default:a(()=>[s("div",Sl,[s("div",Pl,i(D(oe.value.commercialTotal)),1),e[41]||(e[41]=s("div",{class:"stat-label"},"商业险总金额",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[s("div",jl,[s("div",Gl,i(k.value.length),1),e[42]||(e[42]=s("div",{class:"stat-label"},"投保单数量",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[s("div",Hl,[s("div",Jl,i(D(oe.value.averageAmount)),1),e[43]||(e[43]=s("div",{class:"stat-label"},"平均保费",-1))])]),_:1})]),_:1})]),_:1})):x("",!0),y.value==="货运险"?we((_(),F(h,{key:3,class:"detail-card"},{default:a(()=>[l(me,{data:k.value,border:"",style:{width:"100%"}},{default:a(()=>[l(d,{prop:"track_no",label:"运输编号",width:"140"}),l(d,{prop:"insurance_no",label:"投保单号","min-width":"180"}),l(d,{prop:"name",label:"货物名称",width:"120"}),l(d,{prop:"quantity",label:"货物数量",width:"100"}),l(d,{prop:"carrier",label:"承运人",width:"120"}),l(d,{prop:"consignee",label:"收货人",width:"120"}),l(d,{prop:"insured",label:"被保人",width:"280"}),l(d,{prop:"commercial_amount",label:"商业险",width:"120"},{default:a(t=>[r(i(D(t.row.commercial_amount)),1)]),_:1}),l(d,{prop:"start_date",label:"开始日期",width:"110"}),l(d,{prop:"end_date",label:"结束日期",width:"110"}),l(d,{prop:"issue_date",label:"出单日期",width:"110"}),l(d,{prop:"attachments",label:"附件数量",width:"100"},{default:a(t=>[r(i(t.row.attachments.length),1)]),_:1}),l(d,{label:"操作",width:"180",fixed:"right"},{default:a(t=>[l(p,{type:"info",link:"",onClick:T=>ue(t.row.id,"cargo")},{default:a(()=>e[44]||(e[44]=[r("查看附件")])),_:2,__:[44]},1032,["onClick"]),l(p,{type:"danger",link:"",onClick:T=>ne(t.row)},{default:a(()=>e[45]||(e[45]=[r("删除")])),_:2,__:[45]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[be,$.value]]):x("",!0),!$.value&&k.value.length===0?(_(),F(h,{key:4,class:"detail-card"},{default:a(()=>[s("div",Wl,[l(je,{description:"暂无投保信息"},{default:a(()=>[l(p,{type:"primary",onClick:re},{default:a(()=>e[46]||(e[46]=[r("添加第一条投保信息")])),_:1,__:[46]})]),_:1})])]),_:1})):x("",!0),l(H,{modelValue:z.value,"onUpdate:modelValue":e[13]||(e[13]=t=>z.value=t),title:"添加车险信息",width:"600px"},{footer:a(()=>[s("span",Xl,[l(p,{onClick:e[12]||(e[12]=t=>z.value=!1)},{default:a(()=>e[48]||(e[48]=[r("取消")])),_:1,__:[48]}),l(p,{type:"primary",onClick:Ue,loading:q.value},{default:a(()=>e[49]||(e[49]=[r("确定")])),_:1,__:[49]},8,["loading"])])]),default:a(()=>[l(ve,{ref_key:"carFormRef",ref:le,model:u.value,rules:De,"label-width":"120px"},{default:a(()=>[l(c,{label:"车牌号",prop:"car_no"},{default:a(()=>[l(C,{modelValue:u.value.car_no,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value.car_no=t),placeholder:"请输入车牌号"},null,8,["modelValue"])]),_:1}),l(c,{label:"车架号",prop:"vin"},{default:a(()=>[l(C,{modelValue:u.value.vin,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value.vin=t),placeholder:"请输入车架号"},null,8,["modelValue"])]),_:1}),l(c,{label:"投保单号",prop:"insurance_no"},{default:a(()=>[l(C,{modelValue:u.value.insurance_no,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value.insurance_no=t),placeholder:"请输入投保单号"},null,8,["modelValue"])]),_:1}),l(c,{label:"被保人",prop:"insured"},{default:a(()=>[s("div",Kl,[l(_e,{modelValue:u.value.insured,"onUpdate:modelValue":e[3]||(e[3]=t=>u.value.insured=t),placeholder:"请选择被保人",style:{width:"300px"},disabled:u.value.same_as_borrower},{default:a(()=>[(_(!0),b(N,null,S(W.value,t=>(_(),F(pe,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),l(ce,{modelValue:u.value.same_as_borrower,"onUpdate:modelValue":e[4]||(e[4]=t=>u.value.same_as_borrower=t),onChange:e[5]||(e[5]=t=>de("car")),class:"same-borrower-checkbox",style:{"margin-left":"10px"}},{default:a(()=>e[47]||(e[47]=[r(" 同借款人 ")])),_:1,__:[47]},8,["modelValue"])])]),_:1}),l(c,{label:"商业险",prop:"commercial_amount"},{default:a(()=>[l(G,{modelValue:u.value.commercial_amount,"onUpdate:modelValue":e[6]||(e[6]=t=>u.value.commercial_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(c,{label:"交强险",prop:"compulsory_amount"},{default:a(()=>[l(G,{modelValue:u.value.compulsory_amount,"onUpdate:modelValue":e[7]||(e[7]=t=>u.value.compulsory_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(c,{label:"车船税",prop:"vehicle_tax_amount"},{default:a(()=>[l(G,{modelValue:u.value.vehicle_tax_amount,"onUpdate:modelValue":e[8]||(e[8]=t=>u.value.vehicle_tax_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(c,{label:"开始日期",prop:"start_date"},{default:a(()=>[l(B,{modelValue:u.value.start_date,"onUpdate:modelValue":e[9]||(e[9]=t=>u.value.start_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择开始日期"},null,8,["modelValue"])]),_:1}),l(c,{label:"结束日期",prop:"end_date"},{default:a(()=>[l(B,{modelValue:u.value.end_date,"onUpdate:modelValue":e[10]||(e[10]=t=>u.value.end_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择结束日期"},null,8,["modelValue"])]),_:1}),l(c,{label:"出单日期",prop:"issue_date"},{default:a(()=>[l(B,{modelValue:u.value.issue_date,"onUpdate:modelValue":e[11]||(e[11]=t=>u.value.issue_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择出单日期"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(H,{modelValue:A.value,"onUpdate:modelValue":e[28]||(e[28]=t=>A.value=t),title:"添加货运险信息",width:"700px"},{footer:a(()=>[s("span",Zl,[l(p,{onClick:e[27]||(e[27]=t=>A.value=!1)},{default:a(()=>e[51]||(e[51]=[r("取消")])),_:1,__:[51]}),l(p,{type:"primary",onClick:Me,loading:q.value},{default:a(()=>e[52]||(e[52]=[r("确定")])),_:1,__:[52]},8,["loading"])])]),default:a(()=>[l(ve,{ref_key:"cargoFormRef",ref:ae,model:n.value,rules:Ye,"label-width":"120px"},{default:a(()=>[l(c,{label:"运输编号",prop:"track_no"},{default:a(()=>[l(C,{modelValue:n.value.track_no,"onUpdate:modelValue":e[14]||(e[14]=t=>n.value.track_no=t),placeholder:"请输入运输编号"},null,8,["modelValue"])]),_:1}),l(c,{label:"投保单号",prop:"insurance_no"},{default:a(()=>[l(C,{modelValue:n.value.insurance_no,"onUpdate:modelValue":e[15]||(e[15]=t=>n.value.insurance_no=t),placeholder:"请输入投保单号"},null,8,["modelValue"])]),_:1}),l(c,{label:"货物名称",prop:"name"},{default:a(()=>[l(C,{modelValue:n.value.name,"onUpdate:modelValue":e[16]||(e[16]=t=>n.value.name=t),placeholder:"请输入货物名称"},null,8,["modelValue"])]),_:1}),l(c,{label:"货物数量",prop:"quantity"},{default:a(()=>[l(C,{modelValue:n.value.quantity,"onUpdate:modelValue":e[17]||(e[17]=t=>n.value.quantity=t),placeholder:"请输入货物数量"},null,8,["modelValue"])]),_:1}),l(c,{label:"承运人",prop:"carrier"},{default:a(()=>[l(C,{modelValue:n.value.carrier,"onUpdate:modelValue":e[18]||(e[18]=t=>n.value.carrier=t),placeholder:"请输入承运人"},null,8,["modelValue"])]),_:1}),l(c,{label:"收货人",prop:"consignee"},{default:a(()=>[l(C,{modelValue:n.value.consignee,"onUpdate:modelValue":e[19]||(e[19]=t=>n.value.consignee=t),placeholder:"请输入收货人"},null,8,["modelValue"])]),_:1}),l(c,{label:"被保人",prop:"insured"},{default:a(()=>[s("div",Ql,[l(_e,{modelValue:n.value.insured,"onUpdate:modelValue":e[20]||(e[20]=t=>n.value.insured=t),placeholder:"请选择被保人",style:{width:"300px"},disabled:n.value.same_as_borrower},{default:a(()=>[(_(!0),b(N,null,S(W.value,t=>(_(),F(pe,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),l(ce,{modelValue:n.value.same_as_borrower,"onUpdate:modelValue":e[21]||(e[21]=t=>n.value.same_as_borrower=t),onChange:e[22]||(e[22]=t=>de("cargo")),class:"same-borrower-checkbox",style:{"margin-left":"10px"}},{default:a(()=>e[50]||(e[50]=[r(" 同借款人 ")])),_:1,__:[50]},8,["modelValue"])])]),_:1}),l(c,{label:"商业险",prop:"commercial_amount"},{default:a(()=>[l(G,{modelValue:n.value.commercial_amount,"onUpdate:modelValue":e[23]||(e[23]=t=>n.value.commercial_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(c,{label:"开始日期",prop:"start_date"},{default:a(()=>[l(B,{modelValue:n.value.start_date,"onUpdate:modelValue":e[24]||(e[24]=t=>n.value.start_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择开始日期"},null,8,["modelValue"])]),_:1}),l(c,{label:"结束日期",prop:"end_date"},{default:a(()=>[l(B,{modelValue:n.value.end_date,"onUpdate:modelValue":e[25]||(e[25]=t=>n.value.end_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择结束日期"},null,8,["modelValue"])]),_:1}),l(c,{label:"出单日期",prop:"issue_date"},{default:a(()=>[l(B,{modelValue:n.value.issue_date,"onUpdate:modelValue":e[26]||(e[26]=t=>n.value.issue_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择出单日期"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(H,{modelValue:P.value,"onUpdate:modelValue":e[29]||(e[29]=t=>P.value=t),title:"批量导入投保信息",width:"600px"},{footer:a(()=>[s("span",ma,[l(p,{onClick:Re},{default:a(()=>e[61]||(e[61]=[r("取消")])),_:1,__:[61]}),l(p,{type:"primary",onClick:qe,loading:K.value,disabled:!U.value},{default:a(()=>e[62]||(e[62]=[r(" 开始导入 ")])),_:1,__:[62]},8,["loading","disabled"])])]),default:a(()=>[s("div",ea,[s("div",la,[l(fe,{title:"导入说明",type:"info","show-icon":"",closable:!1},{default:a(()=>e[53]||(e[53]=[s("div",{class:"tips-content"},[s("p",null,"1. 请先下载模板，按照模板格式填写数据"),s("p",null,"2. 支持 .xlsx 和 .xls 格式文件"),s("p",null,"3. 必填字段不能为空，金额字段请填写数字"),s("p",null,"4. 日期格式：YYYY-MM-DD，如：2024-01-01")],-1)])),_:1,__:[53]})]),l(ge,{ref_key:"excelUploadRef",ref:I,class:"upload-demo",drag:"","auto-upload":!1,limit:1,accept:".xlsx,.xls","on-change":Le,"file-list":X.value},{tip:a(()=>e[54]||(e[54]=[s("div",{class:"el-upload__tip"}," 只能上传 .xlsx/.xls 文件，且不超过 10MB ",-1)])),default:a(()=>[l(f,{class:"el-icon--upload"},{default:a(()=>[l(L(Ve))]),_:1}),e[55]||(e[55]=s("div",{class:"el-upload__text"},[r(" 将Excel文件拖到此处，或"),s("em",null,"点击上传")],-1))]),_:1,__:[55]},8,["file-list"]),V.value?(_(),b("div",aa,[l(h,null,{header:a(()=>e[56]||(e[56]=[s("span",null,"导入结果",-1)])),default:a(()=>[s("div",ta,[l(E,{gutter:20},{default:a(()=>[l(g,{span:8},{default:a(()=>[s("div",sa,[s("div",oa,i(V.value.total),1),e[57]||(e[57]=s("div",{class:"stat-label"},"总数",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[s("div",ra,[s("div",na,i(V.value.success),1),e[58]||(e[58]=s("div",{class:"stat-label"},"成功",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[s("div",ua,[s("div",da,i(V.value.fail),1),e[59]||(e[59]=s("div",{class:"stat-label"},"失败",-1))])]),_:1})]),_:1})]),V.value.errors&&V.value.errors.length>0?(_(),b("div",ia,[l(te,{"content-position":"left"},{default:a(()=>e[60]||(e[60]=[r("错误详情")])),_:1,__:[60]}),(_(!0),b(N,null,S(V.value.errors,(t,T)=>(_(),b("div",{class:"error-item",key:T},[l(se,{type:"danger",size:"small"},{default:a(()=>[r(i(t),1)]),_:2},1024)]))),128))])):x("",!0)]),_:1})])):x("",!0)])]),_:1},8,["modelValue"]),l(H,{modelValue:O.value,"onUpdate:modelValue":e[30]||(e[30]=t=>O.value=t),title:"批量上传行驶证",width:"700px"},{footer:a(()=>[s("span",qa,[l(p,{onClick:Oe},{default:a(()=>e[72]||(e[72]=[r("取消")])),_:1,__:[72]}),l(p,{type:"primary",onClick:ze,loading:Z.value,disabled:M.value.length===0},{default:a(()=>e[73]||(e[73]=[r(" 开始上传识别 ")])),_:1,__:[73]},8,["loading","disabled"])])]),default:a(()=>[s("div",pa,[s("div",_a,[l(fe,{title:"上传说明",type:"info","show-icon":"",closable:!1},{default:a(()=>e[63]||(e[63]=[s("div",{class:"tips-content"},[s("p",null,"1. 支持批量上传多张行驶证图片"),s("p",null,"2. 支持 JPG、PNG、BMP、TIFF、WEBP 格式"),s("p",null,"3. 每张图片不超过5MB"),s("p",null,"4. 系统将自动OCR识别行驶证信息并匹配车险记录"),s("p",null,"5. 请确保先录入车险信息再上传对应的行驶证")],-1)])),_:1,__:[63]})]),l(ge,{ref_key:"driverLicenseUploadRef",ref:Q,class:"upload-demo",drag:"",multiple:"","auto-upload":!1,limit:0,accept:"image/*","on-change":$e,"on-remove":Ie,"file-list":ee.value},{tip:a(()=>e[64]||(e[64]=[s("div",{class:"el-upload__tip"}," 支持多张图片同时上传，每张不超过5MB ",-1)])),default:a(()=>[l(f,{class:"el-icon--upload"},{default:a(()=>[l(L(Ve))]),_:1}),e[65]||(e[65]=s("div",{class:"el-upload__text"},[r(" 将行驶证图片拖到此处，或"),s("em",null,"点击上传")],-1))]),_:1,__:[65]},8,["file-list"]),w.value?(_(),b("div",ca,[l(h,null,{header:a(()=>e[66]||(e[66]=[s("span",null,"上传结果",-1)])),default:a(()=>[s("div",va,[l(E,{gutter:20},{default:a(()=>[l(g,{span:8},{default:a(()=>{var t;return[s("div",fa,[s("div",ga,i(((t=w.value.results)==null?void 0:t.length)||0),1),e[67]||(e[67]=s("div",{class:"stat-label"},"总数",-1))])]}),_:1}),l(g,{span:8},{default:a(()=>[s("div",ba,[s("div",ya,i(w.value.success_count||0),1),e[68]||(e[68]=s("div",{class:"stat-label"},"成功",-1))])]),_:1}),l(g,{span:8},{default:a(()=>[s("div",wa,[s("div",Va,i(w.value.fail_count||0),1),e[69]||(e[69]=s("div",{class:"stat-label"},"失败",-1))])]),_:1})]),_:1})]),w.value.results?(_(),b("div",ha,[l(te,{"content-position":"left"},{default:a(()=>e[70]||(e[70]=[r("处理详情")])),_:1,__:[70]}),s("div",xa,[(_(!0),b(N,null,S(w.value.results,(t,T)=>(_(),b("div",{key:T,class:ol(["result-item",t.status])},[s("div",ka,[s("span",Da,i(t.file_name),1),l(se,{type:Ae(t.status),size:"small"},{default:a(()=>[r(i(Ne(t.status)),1)]),_:2},1032,["type"])]),t.status==="success"?(_(),b("div",Ya,[s("div",Ca,[s("span",Ta,"车牌号："+i(t.plate_no||"-"),1),s("span",Ua,"车架号："+i(t.vin||"-"),1),s("span",Ma,"所有人："+i(t.owner||"-"),1)])])):(_(),b("div",Ea,[s("span",Fa,i(t.error_message),1)]))],2))),128))])])):x("",!0),w.value.errors&&w.value.errors.length>0?(_(),b("div",La,[l(te,{"content-position":"left"},{default:a(()=>e[71]||(e[71]=[r("错误汇总")])),_:1,__:[71]}),(_(!0),b(N,null,S(w.value.errors,(t,T)=>(_(),b("div",{class:"error-item",key:T},[l(se,{type:"danger",size:"small"},{default:a(()=>[r(i(t),1)]),_:2},1024)]))),128))])):x("",!0)]),_:1})])):x("",!0)])]),_:1},8,["modelValue"])])}}},et=Ge(Ra,[["__scopeId","data-v-bcdd9e56"]]);export{et as default};
