import{_ as Me,b as Te,u as Pe,a as Be}from"./index-b0a30ee6.js";/* empty css               *//* empty css                 *//* empty css                         *//* empty css                        *//* empty css                     *//* empty css               *//* empty css                             *//* empty css                *//* empty css                   *//* empty css                       */import{f as $,a as y}from"./format-20468769.js";import{a as Se,r as Ne,b as Ve,d as De,f as Ie}from"./order-f119be1e.js";import{u as Ae}from"./attachment-1e3277ba.js";import{m as Re}from"./receivable-1e91f6d1.js";import{r as T,ae as Fe,l as v,B as h,C as c,F as a,G as t,p as C,S as k,E as g,aE as Oe,ag as ze,ah as Ue,M as Le,u as _,O as i,af as Q,D as o,ac as qe,av as Ge,aF as He,H as Je,I as Ke,J as A,K as Qe,az as je,am as We,aA as Xe,ao as Ye,al as Ze,an as ea,ap as aa,aq as ta,ar as la,a5 as na,a6 as ra,a7 as oa,ai as sa}from"./element-plus-3147ea74.js";const ia={class:"order-detail"},ua={class:"page-header"},da={class:"header-actions"},ca={class:"overview-section"},_a={class:"key-metrics"},pa={class:"metric-item"},ma={class:"metric-value"},fa={class:"metric-item"},va={class:"metric-value"},ya={class:"metric-item"},ga={class:"metric-value"},ba={class:"metric-item"},ha={class:"metric-value"},wa={class:"metric-item"},ka={class:"metric-value"},Ca={key:0,class:"empty-state"},xa={key:0,class:"empty-state"},Ea={style:{color:"#67c23a","font-weight":"bold"}},$a={style:{color:"#e6a23c","font-weight":"bold"}},Ma={style:{color:"#409eff"}},Ta={style:{color:"#67c23a"}},Pa={key:0,style:{color:"#f56c6c"}},Ba={key:1},Sa={key:0,style:{color:"#f56c6c"}},Na={key:1},Va={key:0,style:{color:"#67c23a","font-weight":"bold"}},Da={key:1},Ia={key:0,style:{color:"#f56c6c","font-weight":"bold"}},Aa={key:1},Ra={key:1,style:{color:"#67c23a"}},Fa={class:"log-content"},Oa={class:"operator"},za={class:"action"},Ua={key:1,class:"empty-logs"},La={class:"dialog-footer"},qa={class:"payment-info"},Ga={key:1,class:"payment-section"},Ha={key:2,class:"payment-section"},Ja={key:3,class:"payment-section"},Ka={class:"remark-content"},Qa={class:"dialog-footer"},ja={__name:"detail",setup(Wa){const j=Te(),R=Pe(),M=T(!1),n=T({}),P=Be(),S=T(!1),F=T(null),O=T(!1),N=T({remark:""}),D=T(!1),z=T(!1),m=T({}),W={remark:[{required:!0,message:"请输入备注内容",trigger:"blur"}]},B=async()=>{M.value=!0;try{const r=await Se(j.params.id);n.value=r.data,n.value.total_commercial=0,n.value.insurance_type==="车险"&&n.value.car_insurance&&n.value.car_insurance.length>0?n.value.total_commercial=n.value.car_insurance.reduce((e,s)=>e+(s.commercial_amount||0),0):n.value.insurance_type==="货运险"&&n.value.cargo_insurance&&n.value.cargo_insurance.length>0&&(n.value.total_commercial=n.value.cargo_insurance.reduce((e,s)=>e+(s.commercial_amount||0),0))}catch{g.error("获取订单详情失败")}M.value=!1},X=()=>{R.back()},I=async()=>{try{let r="",e="下一状态";n.value.status==="待初审"?(r="初审通过",e="待复审"):n.value.status==="待复审"&&(r="复审通过",e="待客户签约"),await A.confirm(`确定要将订单状态从 [${n.value.status}] 更新为 [${e}] 吗？`,"审核确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),M.value=!0,await Ne(n.value.id,{audit_note:r}),g.success("审核成功"),B()}catch(r){r!=="cancel"&&g.error("审核失败")}M.value=!1},Y=r=>{const{columns:e,data:s}=r,p=[];return e.forEach((f,d)=>{if(d===0){p[d]="合计";return}if(f.property==="total_amount"){const b=s.reduce((x,E)=>x+(E.commercial_amount||0)+(E.compulsory_amount||0)+(E.vehicle_tax_amount||0),0);p[d]=y(b);return}const w=s.map(b=>Number(b[f.property]));if(w.every(b=>isNaN(b)))p[d]="-";else{const b=w.reduce((x,E)=>{const u=Number(E);return isNaN(u)?x:x+u},0);f.property==="commercial_amount"||f.property==="compulsory_amount"||f.property==="vehicle_tax_amount"?p[d]=y(b):p[d]="-"}}),p},Z=r=>{const{columns:e,data:s}=r,p=[];return e.forEach((f,d)=>{if(d===0){p[d]="合计";return}const w=s.map(b=>Number(b[f.property]));if(w.every(b=>isNaN(b)))p[d]="-";else{const b=w.reduce((x,E)=>{const u=Number(E);return isNaN(u)?x:x+u},0);f.property==="commercial_amount"?p[d]=y(b):p[d]="-"}}),p},ee=r=>({待审核:"warning",待复审:"warning",待客户签约:"info",待资方签约:"info",待放款:"warning",已放款:"success",已退保:"danger",已结清:"success",已作废:"danger"})[r]||"info",ae=r=>({create:"primary",update:"success",review:"warning",delete:"danger",info:"info"})[r]||"info",U=()=>{R.push(`/order/insurance/${n.value.id}`)},te=(r,e)=>{if(!n.value.attachments||n.value.attachments.length===0){g.warning("暂无附件可查看");return}const s=r.find(p=>p.remark===e);if(!s){g.warning("暂无附件可查看");return}window.open(`/api/admin/attachments/${s.id}/view`)},le=()=>{L(n.value.attachments,"缴费通知书")?te(n.value.attachments,"缴费通知书"):ne("缴费通知书")},ne=r=>{const e=document.createElement("input");e.type="file",e.accept="*/*",e.style.display="none",e.onchange=async s=>{const p=s.target.files[0];if(p){try{const f=new FormData;f.append("files",p),f.append("remarks",r),await Ae(n.value.id,0,f),g.success("上传成功"),B()}catch(f){console.error("上传失败:",f),g.error("上传失败")}document.body.removeChild(e)}},document.body.appendChild(e),e.click()},re=(r,e)=>{R.push({path:`/order/attachments/${n.value.id}`,query:{ref_id:r||0,type:e||"order"}})},oe=async()=>{try{await A.confirm("确定要作废该订单吗？作废后不可恢复！","作废确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),M.value=!0,await Ve(n.value.id),g.success("订单已作废"),B()}catch(r){r!=="cancel"&&g.error("作废失败")}M.value=!1},q=(r,e)=>{if(!r){g.warning(`${e}链接不存在`);return}try{if(typeof window<"u"&&window.open)window.open(r,"_blank","noopener,noreferrer");else throw new Error("window.open不可用")}catch(s){console.error(`${e}失败:`,s);try{const p=document.createElement("a");p.href=r,p.target="_blank",p.rel="noopener noreferrer",p.style.display="none",document.body.appendChild(p),p.click(),document.body.removeChild(p),g.success(`${e}链接已打开`)}catch(p){console.error("备选方案失败:",p)}}},se=r=>{if(!r){g.warning("签署链接不存在");return}G(r,"签署链接")},G=(r,e)=>{const s=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);navigator.clipboard&&(window.isSecureContext||s)?navigator.clipboard.writeText(r).then(()=>{g.success(`${e}已复制到剪贴板`)}).catch(p=>{console.error("使用 Clipboard API 复制失败:",p),H(r,e)}):H(r,e)},H=(r,e)=>{try{const s=document.createElement("textarea");s.value=r,s.style.position="fixed",s.style.left="-999999px",s.style.top="-999999px",document.body.appendChild(s),s.focus(),s.select();const p=document.execCommand("copy");if(document.body.removeChild(s),p)g.success(`${e}已复制到剪贴板`);else throw new Error("execCommand 复制失败")}catch(s){console.error("复制失败:",s),A.alert(r,`请手动复制${e}`,{confirmButtonText:"确定",type:"info",customClass:"copy-url-dialog"})}},ie=r=>({已签署:"success",未签署:"warning",已作废:"danger"})[r]||"info",ue=r=>({首付:"primary",还款:"success",利息:"warning",本金:"info",退保:"danger"})[r]||"info",de=r=>({微信:"success",支付宝:"primary",银行卡:"warning"})[r]||"info",ce=r=>({待收款:"warning",已收款:"success",已逾期:"danger"})[r]||"info",_e=async r=>{try{const{value:e}=await A.prompt(`请输入第${r.period}期的实际收款金额`,"标记收款",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\d+(\.\d{1,2})?$/,inputErrorMessage:"请输入正确的金额格式",inputValue:r.amount.toString()});if(!e){g.warning("请输入收款金额");return}M.value=!0,await Re(r.id,{actual_amount:parseFloat(e),actual_date:new Date().toISOString().split("T")[0]}),g.success("标记收款成功"),B()}catch(e){e!=="cancel"&&g.error("标记收款失败")}M.value=!1},pe=()=>{N.value.remark="",S.value=!0},me=async()=>{F.value&&await F.value.validate(async r=>{if(r){O.value=!0;try{await De(n.value.id,{remark:N.value.remark}),g.success("添加备注成功"),S.value=!1,B()}catch(e){g.error("添加备注失败："+(e.message||"未知错误"))}O.value=!1}})},fe=async()=>{if(!n.value.id){g.warning("订单信息不存在");return}z.value=!0;try{const r=await Ie(n.value.id);m.value=r.data,D.value=!0,g.success("前置款信息生成成功")}catch(r){g.error("生成前置款信息失败："+(r.message||"未知错误"))}z.value=!1},ve=()=>{if(!m.value.batch_no){g.warning("暂无前置款信息可复制");return}const r=`
批次号：${m.value.batch_no}
借款人：${m.value.borrower}
${m.value.vehicle_info}
总放款金额：${y(m.value.total_loan_amount)}

支付服务费：${y(m.value.service_fee)}
户名：${m.value.service_account_name}
账户：${m.value.service_account_no}
开户行：${m.value.service_bank_name}

支付首付款：${y(m.value.total_down_payment)}
${m.value.down_payment_detail}
户名：${m.value.funder_account_name}
账户：${m.value.funder_account_no}
开户行：${m.value.funder_bank_name}

${m.value.remark||""}
  `.trim();G(r,"前置款信息")},ye=async()=>{if(!n.value.id){g.warning("订单信息不存在");return}if(n.value.status!=="已放款"){g.warning("订单状态不是已放款，不能导出分期计划");return}window.open(`/api/admin/orders/${n.value.id}/export-plan`,"_blank")},ge=async()=>{if(!n.value.id){g.warning("订单信息不存在");return}(n.value.car_insurance.length>0||n.value.cargo_insurance.length>0)&&window.open(`/api/admin/orders/${n.value.id}/export-insurance`,"_blank")},be=async()=>{if(!n.value.id){g.warning("订单信息不存在");return}window.open(`/api/admin/orders/${n.value.id}/export-received`,"_blank")},he=r=>{const{columns:e,data:s}=r,p=[];return e.forEach((f,d)=>{if(d===0){p[d]="合计";return}const w=s.map(b=>Number(b[f.property]));if(w.every(b=>isNaN(b)))p[d]="-";else{const b=w.reduce((x,E)=>{const u=Number(E);return isNaN(u)?x:x+u},0);f.property==="amount"||f.property==="principal_amount"||f.property==="interest_amount"||f.property==="penalty_amount"||f.property==="forfeit_amount"||f.property==="actual_amount"?p[d]=y(b):p[d]="-"}}),p},L=(r,e)=>!r||r.length===0?!1:r.some(s=>s.remark===e);return Fe(()=>{B()}),(r,e)=>{const s=Qe,p=Oe,f=ze,d=je,w=We,b=Xe,x=Ye,E=Ue,u=Ze,V=ea,we=aa,ke=ta,Ce=la,xe=na,Ee=ra,$e=oa,J=Le,K=sa;return v(),h("div",ia,[c("div",ua,[a(p,{onBack:X,title:n.value.order_no||"订单详情"},{extra:t(()=>[c("div",da,[n.value.status==="待初审"&&_(P).riskBasicPrivate?(v(),C(s,{key:0,type:"success",onClick:I},{default:t(()=>e[6]||(e[6]=[i("初审通过")])),_:1,__:[6]})):k("",!0),n.value.status==="待复审"&&_(P).riskManagerPrivate?(v(),C(s,{key:1,type:"warning",onClick:I},{default:t(()=>e[7]||(e[7]=[i("复审通过")])),_:1,__:[7]})):k("",!0),n.value.status==="待放款"&&_(P).operationManagerPrivate?(v(),C(s,{key:2,type:"info",onClick:I},{default:t(()=>e[8]||(e[8]=[i("放款")])),_:1,__:[8]})):k("",!0),n.value.status!=="已作废"&&(_(P).operationManagerPrivate||_(P).riskManagerPrivate)?(v(),C(s,{key:3,type:"danger",onClick:oe},{default:t(()=>e[9]||(e[9]=[i("作废订单")])),_:1,__:[9]})):k("",!0),_(P).superPrivate?(v(),C(s,{key:4,type:"primary",onClick:I},{default:t(()=>e[10]||(e[10]=[i("下一状态（调试用）")])),_:1,__:[10]})):k("",!0)])]),_:1},8,["title"])]),a(f,null,{default:t(()=>[a(s,{type:"default",onClick:ge},{default:t(()=>e[11]||(e[11]=[i("导出投保单")])),_:1,__:[11]}),a(s,{type:"default",onClick:ye},{default:t(()=>e[12]||(e[12]=[i("导出分期计划")])),_:1,__:[12]}),a(s,{type:"default",onClick:be},{default:t(()=>e[13]||(e[13]=[i("导出收款记录")])),_:1,__:[13]}),a(s,{type:"default",onClick:U},{default:t(()=>e[14]||(e[14]=[i("管理投保单")])),_:1,__:[14]}),a(s,{type:"default",onClick:fe},{default:t(()=>e[15]||(e[15]=[i("生成前置款")])),_:1,__:[15]}),a(s,{type:"default",onClick:e[0]||(e[0]=l=>re())},{default:t(()=>e[16]||(e[16]=[i("查看附件")])),_:1,__:[16]}),a(s,{type:"default",onClick:pe},{default:t(()=>e[17]||(e[17]=[i("添加备注")])),_:1,__:[17]})]),_:1}),c("div",ca,[a(E,{gutter:20},{default:t(()=>[a(x,{span:18},{default:t(()=>[Q((v(),C(f,{class:"info-card"},{default:t(()=>[a(b,{column:2,border:""},{default:t(()=>[a(d,{label:"订单编号"},{default:t(()=>[i(o(n.value.order_no),1)]),_:1}),a(d,{label:"订单状态"},{default:t(()=>[a(w,{type:ee(n.value.status)},{default:t(()=>[i(o(n.value.status),1)]),_:1},8,["type"]),e[18]||(e[18]=c("span",{style:{"margin-left":"10px"}},null,-1)),a(w,{style:{cursor:"pointer"},onClick:le,type:L(n.value.attachments,"缴费通知书")?"success":"info"},{default:t(()=>[i(o(L(n.value.attachments,"缴费通知书")?"缴费通知书已上传":"缴费通知书未上传"),1)]),_:1},8,["type"])]),_:1,__:[18]}),a(d,{label:"保险类型"},{default:t(()=>[i(o(n.value.insurance_type),1)]),_:1}),a(d,{label:"借款主体"},{default:t(()=>{var l;return[i(o(n.value.loan_name||((l=n.value.user)==null?void 0:l.company_name)),1)]}),_:1}),a(d,{label:"业务归属"},{default:t(()=>{var l;return[i(o(n.value.sell_mode==="直销"?"直销":((l=n.value.agent)==null?void 0:l.company_name)||"无"),1)]}),_:1}),a(d,{label:"销售员"},{default:t(()=>[i(o(n.value.seller),1)]),_:1}),a(d,{label:"服务费"},{default:t(()=>[i(o(n.value.service_fee)+"%",1)]),_:1}),a(d,{label:"渠道成本"},{default:t(()=>[i(o(n.value.agent_cost)+"%",1)]),_:1}),a(d,{span:2,label:"金融产品"},{default:t(()=>{var l;return[i(o((l=n.value.product)==null?void 0:l.name),1)]}),_:1}),a(d,{label:"承保机构",span:2},{default:t(()=>{var l;return[i(o((l=n.value.insurer)==null?void 0:l.name),1)]}),_:1})]),_:1}),a(b,{column:2,border:""},{default:t(()=>[a(d,{label:"进件时间"},{default:t(()=>[i(o(_($)(n.value.created_at)),1)]),_:1}),a(d,{label:"初审时间"},{default:t(()=>[i(o(_($)(n.value.first_review_time)||"-"),1)]),_:1}),a(d,{label:"复审时间"},{default:t(()=>[i(o(_($)(n.value.second_review_time)||"-"),1)]),_:1}),a(d,{label:"用户签约时间"},{default:t(()=>[i(o(_($)(n.value.user_sign_time)||"-"),1)]),_:1}),a(d,{label:"资方签约时间"},{default:t(()=>[i(o(_($)(n.value.funder_sign_time)||"-"),1)]),_:1}),a(d,{label:"放款时间"},{default:t(()=>[i(o(_($)(n.value.loan_time)||"-"),1)]),_:1}),a(d,{label:"最后更新时间"},{default:t(()=>[i(o(_($)(n.value.updated_at)),1)]),_:1})]),_:1})]),_:1})),[[K,M.value]])]),_:1}),a(x,{span:6},{default:t(()=>[a(f,{class:"key-metrics-card"},{default:t(()=>[c("div",_a,[c("div",pa,[e[19]||(e[19]=c("div",{class:"metric-label"},"总保费",-1)),c("div",ma,o(_(y)(n.value.total_premium)),1)]),c("div",fa,[e[20]||(e[20]=c("div",{class:"metric-label"},"商业险",-1)),c("div",va,o(_(y)(n.value.total_commercial)),1)]),c("div",ya,[e[21]||(e[21]=c("div",{class:"metric-label"},"首付金额",-1)),c("div",ga,o(_(y)(n.value.down_payment)),1)]),c("div",ba,[e[22]||(e[22]=c("div",{class:"metric-label"},"贷款金额",-1)),c("div",ha,o(_(y)(n.value.loan_amount)),1)]),c("div",wa,[e[23]||(e[23]=c("div",{class:"metric-label"},"服务费",-1)),c("div",ka,o(_(y)(n.value.service_fee*n.value.total_commercial/100)),1)])])]),_:1})]),_:1})]),_:1})]),n.value.insurance_type==="车险"?(v(),C(f,{key:0,class:"detail-card insurance-card"},{default:t(()=>[a(V,{data:n.value.car_insurance||[],border:"",style:{width:"100%"},"empty-text":"暂无车险投保信息","max-height":"300","show-summary":n.value.car_insurance&&n.value.car_insurance.length>0,"sum-text":"合计","summary-method":Y},{default:t(()=>[a(u,{prop:"car_no",label:"车牌号",width:"120",align:"left"}),a(u,{prop:"vin",label:"车架号",width:"180",align:"left"}),a(u,{prop:"insured",label:"被保人",width:"170",align:"left"}),a(u,{prop:"commercial_amount",label:"商业险",width:"110",align:"right"},{default:t(({row:l})=>[i(o(_(y)(l.commercial_amount)),1)]),_:1}),a(u,{prop:"compulsory_amount",label:"交强险",width:"110",align:"right"},{default:t(({row:l})=>[i(o(_(y)(l.compulsory_amount)),1)]),_:1}),a(u,{prop:"vehicle_tax_amount",label:"车船税",width:"110",align:"right"},{default:t(({row:l})=>[i(o(_(y)(l.vehicle_tax_amount)),1)]),_:1}),a(u,{prop:"total_amount",label:"总保费",width:"110",align:"right"},{default:t(({row:l})=>[i(o(_(y)((l.commercial_amount||0)+(l.compulsory_amount||0)+(l.vehicle_tax_amount||0))),1)]),_:1}),a(u,{prop:"start_date",label:"保险起期",width:"100",align:"center"}),a(u,{prop:"end_date",label:"保险止期",width:"100",align:"center"})]),_:1},8,["data","show-summary"]),!n.value.car_insurance||n.value.car_insurance.length===0?(v(),h("div",Ca,[a(s,{type:"primary",onClick:U},{default:t(()=>e[24]||(e[24]=[i("录入车险信息")])),_:1,__:[24]})])):k("",!0)]),_:1})):k("",!0),n.value.insurance_type==="货运险"?(v(),C(f,{key:1,class:"detail-card insurance-card"},{default:t(()=>[a(V,{data:n.value.cargo_insurance||[],border:"",style:{width:"100%"},"empty-text":"暂无货运险投保信息","max-height":"300","show-summary":n.value.cargo_insurance&&n.value.cargo_insurance.length>0,"sum-text":"合计","summary-method":Z},{default:t(()=>[a(u,{prop:"track_no",label:"运输编号",width:"200",align:"left"}),a(u,{prop:"insured",label:"被保人",width:"170",align:"left"}),a(u,{prop:"name",label:"货物名称",width:"150",align:"left"}),a(u,{prop:"quantity",label:"货物数量",width:"120",align:"right"}),a(u,{prop:"carrier",label:"承运人",width:"130",align:"left"}),a(u,{prop:"consignee",label:"收货人",width:"130",align:"left"}),a(u,{prop:"commercial_amount",label:"保费",width:"140",align:"right"},{default:t(({row:l})=>[i(o(_(y)(l.commercial_amount)),1)]),_:1}),a(u,{prop:"start_date",label:"保险起期",width:"100",align:"center"}),a(u,{prop:"end_date",label:"保险止期",width:"100",align:"center"})]),_:1},8,["data","show-summary"]),!n.value.cargo_insurance||n.value.cargo_insurance.length===0?(v(),h("div",xa,[a(s,{type:"primary",onClick:U},{default:t(()=>e[25]||(e[25]=[i("录入货运险信息")])),_:1,__:[25]})])):k("",!0)]),_:1})):k("",!0),a(f,{class:"detail-card"},{default:t(()=>[a(V,{data:n.value.contacts||[],border:"",style:{width:"100%"},"empty-text":"暂无合同信息","max-height":"200"},{default:t(()=>[a(u,{prop:"contact_id",label:"合同编号",width:"250"}),a(u,{prop:"sign_status",label:"签署状态",width:"120",align:"center"},{default:t(({row:l})=>[a(w,{type:ie(l.sign_status)},{default:t(()=>[i(o(l.sign_status),1)]),_:2},1032,["type"])]),_:1}),a(u,{prop:"sign_time",label:"签署时间",width:"170",align:"center"},{default:t(({row:l})=>[i(o(l.sign_time||"-"),1)]),_:1}),a(u,{prop:"created_at",label:"创建时间",width:"170",align:"center"},{default:t(({row:l})=>[i(o(_($)(l.created_at)),1)]),_:1}),a(u,{label:"操作",width:"300",align:"center",fixed:"right"},{default:t(({row:l})=>[a(s,{type:"primary",size:"small",icon:_(qe),onClick:()=>q(l.view_pdf_url,"查看PDF"),disabled:!l.view_pdf_url,class:"action-btn"},{default:t(()=>e[26]||(e[26]=[i(" 查看 ")])),_:2,__:[26]},1032,["icon","onClick","disabled"]),a(s,{type:"success",size:"small",icon:_(Ge),onClick:()=>q(l.download_url,"下载PDF"),disabled:!l.download_url,class:"action-btn"},{default:t(()=>e[27]||(e[27]=[i(" 下载 ")])),_:2,__:[27]},1032,["icon","onClick","disabled"]),a(s,{type:"info",size:"small",icon:_(He),onClick:()=>se(l.sign_url),disabled:!l.sign_url,class:"action-btn"},{default:t(()=>e[28]||(e[28]=[i(" 签署链接 ")])),_:2,__:[28]},1032,["icon","onClick","disabled"])]),_:1})]),_:1},8,["data"])]),_:1}),a(f,{class:"detail-card"},{default:t(()=>[a(V,{data:n.value.receiveds||[],border:"",style:{width:"100%"},"empty-text":"暂无收款记录","max-height":"200"},{default:t(()=>[a(u,{prop:"trans_no",label:"收款流水号",width:"250"}),a(u,{prop:"rec_type",label:"收款类型",width:"100"},{default:t(({row:l})=>[a(w,{type:ue(l.rec_type)},{default:t(()=>[i(o(l.rec_type),1)]),_:2},1032,["type"])]),_:1}),a(u,{prop:"amount",label:"收款金额",width:"120"},{default:t(({row:l})=>[c("span",Ea,o(_(y)(l.amount)),1)]),_:1}),a(u,{prop:"period",label:"期数",width:"80"},{default:t(({row:l})=>[i(o(l.period||"-"),1)]),_:1}),a(u,{prop:"method",label:"收款方式",width:"100"},{default:t(({row:l})=>[a(w,{type:de(l.method),size:"small"},{default:t(()=>[i(o(l.method),1)]),_:2},1032,["type"])]),_:1}),a(u,{prop:"date_time",label:"收款时间",width:"160"}),a(u,{prop:"created_at",label:"录入时间",width:"160"},{default:t(({row:l})=>[i(o(_($)(l.created_at)),1)]),_:1}),a(u,{prop:"remark",label:"备注","min-width":"120"},{default:t(({row:l})=>[i(o(l.remark||"-"),1)]),_:1})]),_:1},8,["data"])]),_:1}),a(f,{class:"detail-card"},{default:t(()=>[a(V,{data:n.value.receivables||[],border:"",style:{width:"100%"},"empty-text":"暂无还款计划","max-height":"200","show-summary":n.value.receivables&&n.value.receivables.length>0,"sum-text":"合计","summary-method":he},{default:t(()=>[a(u,{prop:"period",label:"期数",width:"80",align:"center"}),a(u,{prop:"date",label:"应还日期",width:"120",align:"center"}),a(u,{prop:"amount",label:"应还金额",width:"120",align:"right"},{default:t(({row:l})=>[c("span",$a,o(_(y)(l.amount)),1)]),_:1}),a(u,{prop:"principal_amount",label:"本金",width:"120",align:"right"},{default:t(({row:l})=>[c("span",Ma,o(_(y)(l.principal_amount)),1)]),_:1}),a(u,{prop:"interest_amount",label:"利息",width:"120",align:"right"},{default:t(({row:l})=>[c("span",Ta,o(_(y)(l.interest_amount)),1)]),_:1}),a(u,{prop:"penalty_amount",label:"违约金",width:"100",align:"right"},{default:t(({row:l})=>[l.penalty_amount>0?(v(),h("span",Pa,o(_(y)(l.penalty_amount)),1)):(v(),h("span",Ba,"-"))]),_:1}),a(u,{prop:"forfeit_amount",label:"滞纳金",width:"100",align:"right"},{default:t(({row:l})=>[l.forfeit_amount>0?(v(),h("span",Sa,o(_(y)(l.forfeit_amount)),1)):(v(),h("span",Na,"-"))]),_:1}),a(u,{prop:"actual_amount",label:"实际收款",width:"120",align:"right"},{default:t(({row:l})=>[l.actual_amount>0?(v(),h("span",Va,o(_(y)(l.actual_amount)),1)):(v(),h("span",Da,"-"))]),_:1}),a(u,{prop:"actual_date",label:"实际收款日期",width:"120",align:"center"},{default:t(({row:l})=>[i(o(l.actual_date||"-"),1)]),_:1}),a(u,{prop:"overdue_days",label:"逾期天数",width:"100",align:"center"},{default:t(({row:l})=>[l.overdue_days>0?(v(),h("span",Ia,o(l.overdue_days)+"天",1)):(v(),h("span",Aa,"-"))]),_:1}),a(u,{prop:"status",label:"状态",width:"100",align:"center"},{default:t(({row:l})=>[a(w,{type:ce(l.status)},{default:t(()=>[i(o(l.status),1)]),_:2},1032,["type"])]),_:1}),a(u,{label:"操作",width:"120",align:"center",fixed:"right"},{default:t(({row:l})=>[l.status==="待收款"||l.status==="已逾期"?(v(),C(s,{key:0,type:"primary",size:"small",onClick:Xa=>_e(l)},{default:t(()=>e[29]||(e[29]=[i(" 标记收款 ")])),_:2,__:[29]},1032,["onClick"])):(v(),h("span",Ra,"已收款"))]),_:1})]),_:1},8,["data","show-summary"])]),_:1}),a(f,{class:"detail-card"},{default:t(()=>[n.value.logs&&n.value.logs.length>0?(v(),C(ke,{key:0},{default:t(()=>[(v(!0),h(Je,null,Ke(n.value.logs,l=>(v(),C(we,{key:l.id,timestamp:_($)(l.created_at),type:ae(l.action)},{default:t(()=>[c("div",Fa,[c("span",Oa,o(l.admin_name),1),c("span",za,o(l.content),1)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})):(v(),h("div",Ua,[a(Ce,{description:"暂无操作日志","image-size":80})]))]),_:1}),a(J,{modelValue:S.value,"onUpdate:modelValue":e[3]||(e[3]=l=>S.value=l),title:"添加备注",width:"500px"},{footer:t(()=>[c("span",La,[a(s,{onClick:e[2]||(e[2]=l=>S.value=!1)},{default:t(()=>e[30]||(e[30]=[i("取消")])),_:1,__:[30]}),a(s,{type:"primary",onClick:me,loading:O.value},{default:t(()=>e[31]||(e[31]=[i("确定")])),_:1,__:[31]},8,["loading"])])]),default:t(()=>[a($e,{ref_key:"remarkFormRef",ref:F,model:N.value,rules:W,"label-width":"80px"},{default:t(()=>[a(Ee,{label:"备注内容",prop:"remark"},{default:t(()=>[a(xe,{modelValue:N.value.remark,"onUpdate:modelValue":e[1]||(e[1]=l=>N.value.remark=l),type:"textarea",rows:4,placeholder:"请输入备注内容",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),e[32]||(e[32]=c("div",{style:{"margin-top":"10px","text-align":"right"}},"添加的备注将显示在日志列表里",-1))]),_:1,__:[32]},8,["modelValue"]),a(J,{modelValue:D.value,"onUpdate:modelValue":e[5]||(e[5]=l=>D.value=l),title:"前置款信息",width:"600px","close-on-click-modal":!1},{footer:t(()=>[c("span",Qa,[a(s,{onClick:e[4]||(e[4]=l=>D.value=!1)},{default:t(()=>e[33]||(e[33]=[i("关闭")])),_:1,__:[33]}),a(s,{type:"primary",onClick:ve},{default:t(()=>e[34]||(e[34]=[i("复制信息")])),_:1,__:[34]})])]),default:t(()=>[Q((v(),h("div",qa,[m.value.batch_no?(v(),C(b,{key:0,column:1,border:"",size:"small"},{default:t(()=>[a(d,{label:"批次号"},{default:t(()=>[c("span",null,o(m.value.batch_no),1)]),_:1}),a(d,{label:"借款人"},{default:t(()=>[c("span",null,o(m.value.borrower),1)]),_:1}),a(d,{label:"车辆信息"},{default:t(()=>[c("span",null,o(m.value.vehicle_info),1)]),_:1}),a(d,{label:"总保费"},{default:t(()=>[c("span",null,o(_(y)(m.value.total_premium)),1)]),_:1}),m.value.repay_type==="利息前置"?(v(),C(d,{key:0,label:"总利息"},{default:t(()=>[c("span",null,o(_(y)(m.value.total_interest)),1)]),_:1})):k("",!0)]),_:1})):k("",!0),m.value.service_fee?(v(),h("div",Ga,[a(b,{column:1,border:"",size:"small"},{default:t(()=>[a(d,{label:"服务费"},{default:t(()=>[c("span",null,o(_(y)(m.value.service_fee)),1)]),_:1}),m.value.repay_type==="利息前置"?(v(),C(d,{key:0,label:"支付总服务费"},{default:t(()=>[c("span",null,o(_(y)(m.value.total_service_fee))+" (服务费+总利息)",1)]),_:1})):k("",!0),a(d,{label:"收款户名"},{default:t(()=>[c("span",null,o(m.value.service_account_name),1)]),_:1}),a(d,{label:"收款账户"},{default:t(()=>[c("span",null,o(m.value.service_account_no),1)]),_:1}),a(d,{label:"开户行"},{default:t(()=>[c("span",null,o(m.value.service_bank_name),1)]),_:1})]),_:1})])):k("",!0),m.value.total_down_payment?(v(),h("div",Ha,[a(b,{column:1,border:"",size:"small"},{default:t(()=>[a(d,{label:"支付首付款"},{default:t(()=>[c("span",null,o(_(y)(m.value.total_down_payment)),1)]),_:1}),a(d,{label:"明细"},{default:t(()=>[c("span",null,o(m.value.down_payment_detail),1)]),_:1}),a(d,{label:"收款户名"},{default:t(()=>[c("span",null,o(m.value.funder_account_name),1)]),_:1}),a(d,{label:"收款账户"},{default:t(()=>[c("span",null,o(m.value.funder_account_no),1)]),_:1}),a(d,{label:"开户行"},{default:t(()=>[c("span",null,o(m.value.funder_bank_name),1)]),_:1})]),_:1})])):k("",!0),m.value.remark?(v(),h("div",Ja,[c("div",Ka,o(m.value.remark),1)])):k("",!0)])),[[K,z.value]])]),_:1},8,["modelValue"])])}}},mt=Me(ja,[["__scopeId","data-v-5c343d46"]]);export{mt as default};
