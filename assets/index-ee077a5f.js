import{_ as ce,u as _e}from"./index-b0a522d4.js";/* empty css                   *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                      *//* empty css                        *//* empty css                    */import{r,b as K,ae as me,l as p,B as S,C as c,F as l,G as n,a1 as ge,af as fe,p as f,E as s,a5 as ye,K as ve,an as be,aM as he,M as ke,ai as we,u as k,aJ as J,O as o,as as Ce,D as m,S as z,H as P,I as R,J as j,a2 as xe,al as Ve,am as Ee,ax as Te,ay as Se,a6 as ze,a7 as Be}from"./element-plus-e9590f8a.js";import{g as Le,c as Fe,a as Ue}from"./contact-ebb0a3c0.js";import{g as De}from"./template-6be184f9.js";import{p as $e}from"./order-213b5f9e.js";import{f as Oe}from"./format-20468769.js";import{A as Ie}from"./AttachmentList-513c4f6e.js";/* empty css                 */const Me={class:"contact-container"},Ne={class:"filter-container"},Ae={class:"pagination"},Ke={style:{float:"right",color:"#8492a6","font-size":"13px"}},Je={class:"dialog-footer"},Pe={__name:"index",setup(Re){const q=_e(),B=r([]),L=r(0),w=r(!0),i=K({page:1,page_size:20,keyword:""}),y=r(!1),C=r(null),F=r([]),_=K({template_id:"",order_id:void 0}),G={template_id:[{required:!0,message:"请选择合同模板",trigger:"change"}],order_id:[{required:!0,message:"请选择关联订单",trigger:"change"}]},x=r(!1),v=r([]),V=r(!1),E=r(!1),b=r(null),H=a=>{switch(a){case"已签署":return"success";case"未签署":return"info";case"已作废":return"danger";case"已拒签":return"danger";default:return"info"}},Q=a=>{switch(a){case"已签署":return"success";case"未签署":return"info";case"已作废":return"danger";case"签署失败":return"danger";case"信托签署中":return"warning";default:return"info"}},g=async()=>{w.value=!0;try{const{data:a}=await Le(i);B.value=a.list,L.value=a.total}catch(a){console.error("获取合同列表失败:",a),s.error("获取合同列表失败")}w.value=!1},U=()=>{i.page=1,g()},W=a=>{i.page_size=a,g()},X=a=>{i.page=a,g()},Y=a=>{q.push(`/contact/detail/${a.id}`)},Z=async()=>{try{const{data:a}=await De();F.value=a,_.template_id="",_.order_id=void 0,v.value=[],y.value=!0}catch(a){console.error("获取模板列表失败:",a),s.error("获取模板列表失败")}},ee=async()=>{C.value&&await C.value.validate(async a=>{if(a){x.value=!0;try{await Fe(_),s.success("创建合同成功"),y.value=!1,g()}catch(t){console.error("创建合同失败:",t),s.error("创建合同失败")}x.value=!1}})},te=async a=>{if(a){V.value=!0;try{const{data:t}=await $e({keyword:a});v.value=t.list}catch(t){console.error("搜索订单失败:",t)}V.value=!1}else v.value=[]},ae=async a=>{try{await j.confirm("确认作废该合同?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Ue(a.id),s.success("作废成功"),g()}catch(t){t!=="cancel"&&(console.error("作废合同失败:",t),s.error("作废合同失败"))}},le=a=>{a.user_sign_url?navigator.clipboard.writeText(a.user_sign_url).then(()=>{s.success("签署链接已复制到剪贴板")}).catch(()=>{s.warning("复制失败，请手动复制："+a.user_sign_url)}):s.warning("签署链接不存在")},ne=async a=>{try{await j.confirm("确定要手动触发资方签署吗？这将调用信托签署接口。","资方签署确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),s.success("资方签署已触发，请查看订单日志了解进度")}catch(t){t!=="cancel"&&s.error("操作失败")}},re=a=>{b.value=a,E.value=!0};return me(()=>{g()}),(a,t)=>{var M,N,A;const T=xe,se=ye,u=ve,d=Ve,D=Ee,oe=be,ie=he,$=Te,O=Se,I=ze,ue=Be,de=ke,pe=we;return p(),S("div",Me,[c("div",Ne,[l(se,{modelValue:i.keyword,"onUpdate:modelValue":t[0]||(t[0]=e=>i.keyword=e),placeholder:"合同标题/签署方名称",style:{width:"450px !important"},class:"filter-item search-input",onKeyup:ge(U,["enter","native"])},{prefix:n(()=>[l(T,null,{default:n(()=>[l(k(J))]),_:1})]),_:1},8,["modelValue"]),l(u,{class:"filter-item",type:"primary",onClick:U,style:{"margin-left":"10px !important"}},{default:n(()=>[l(T,null,{default:n(()=>[l(k(J))]),_:1}),t[8]||(t[8]=o(" 搜索 "))]),_:1,__:[8]}),l(u,{class:"filter-item",type:"primary",onClick:Z,style:{"margin-left":"10px !important"}},{default:n(()=>[l(T,null,{default:n(()=>[l(k(Ce))]),_:1}),t[9]||(t[9]=o(" 创建合同 "))]),_:1,__:[9]})]),fe((p(),f(oe,{data:B.value,border:"",fit:"","highlight-current-row":"",style:{width:"100%"}},{default:n(()=>[l(d,{label:"合同标题",prop:"title",align:"left","min-width":"200"}),l(d,{label:"订单号",prop:"order_no",align:"left","min-width":"180"}),l(d,{label:"签署方",prop:"customer_name",align:"left",width:"200"},{default:n(({row:e})=>[c("span",null,m(e.customer_name||"-"),1)]),_:1}),l(d,{label:"用户签署状态",prop:"user_sign_status",align:"center",width:"120"},{default:n(({row:e})=>[l(D,{type:H(e.user_sign_status)},{default:n(()=>[o(m(e.user_sign_status||"未签署"),1)]),_:2},1032,["type"])]),_:1}),l(d,{label:"用户签署时间",prop:"user_sign_time",align:"center",width:"150"},{default:n(({row:e})=>[c("span",null,m(e.user_sign_time||"-"),1)]),_:1}),l(d,{label:"资方签署状态",prop:"funder_sign_status",align:"center",width:"120"},{default:n(({row:e})=>[l(D,{type:Q(e.funder_sign_status)},{default:n(()=>[o(m(e.funder_sign_status||"未签署"),1)]),_:2},1032,["type"])]),_:1}),l(d,{label:"资方签署时间",prop:"funder_sign_time",align:"center",width:"150"},{default:n(({row:e})=>[c("span",null,m(e.funder_sign_time||"-"),1)]),_:1}),l(d,{label:"创建时间",prop:"created_at",align:"center",width:"160"},{default:n(({row:e})=>[c("span",null,m(k(Oe)(e.created_at)),1)]),_:1}),l(d,{label:"操作",align:"center",width:"280","class-name":"small-padding fixed-width",fixed:"right"},{default:n(({row:e})=>[l(u,{type:"primary",link:"",onClick:h=>Y(e)},{default:n(()=>t[10]||(t[10]=[o("详情")])),_:2,__:[10]},1032,["onClick"]),e.user_sign_status!=="已签署"?(p(),f(u,{key:0,type:"success",link:"",onClick:h=>le(e)},{default:n(()=>t[11]||(t[11]=[o(" 用户签署 ")])),_:2,__:[11]},1032,["onClick"])):z("",!0),e.user_sign_status==="已签署"&&e.funder_sign_status!=="已签署"?(p(),f(u,{key:1,type:"warning",link:"",onClick:h=>ne(e)},{default:n(()=>t[12]||(t[12]=[o(" 资方签署 ")])),_:2,__:[12]},1032,["onClick"])):z("",!0),l(u,{type:"info",link:"",onClick:h=>re(e)},{default:n(()=>t[13]||(t[13]=[o("附件")])),_:2,__:[13]},1032,["onClick"]),e.user_sign_status==="未签署"?(p(),f(u,{key:2,type:"danger",link:"",onClick:h=>ae(e)},{default:n(()=>t[14]||(t[14]=[o(" 作废 ")])),_:2,__:[14]},1032,["onClick"])):z("",!0)]),_:1})]),_:1},8,["data"])),[[pe,w.value]]),c("div",Ae,[l(ie,{"current-page":i.page,"onUpdate:currentPage":t[1]||(t[1]=e=>i.page=e),"page-size":i.page_size,"onUpdate:pageSize":t[2]||(t[2]=e=>i.page_size=e),"page-sizes":[10,20,50,100],total:L.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:W,onCurrentChange:X},null,8,["current-page","page-size","total"])]),l(de,{modelValue:y.value,"onUpdate:modelValue":t[6]||(t[6]=e=>y.value=e),title:"创建合同",width:"600px","close-on-click-modal":!1},{footer:n(()=>[c("span",Je,[l(u,{onClick:t[5]||(t[5]=e=>y.value=!1)},{default:n(()=>t[15]||(t[15]=[o("取 消")])),_:1,__:[15]}),l(u,{type:"primary",onClick:ee,loading:x.value},{default:n(()=>t[16]||(t[16]=[o("确 定")])),_:1,__:[16]},8,["loading"])])]),default:n(()=>[l(ue,{ref_key:"templateForm",ref:C,model:_,rules:G,"label-width":"100px"},{default:n(()=>[l(I,{label:"合同模板",prop:"template_id"},{default:n(()=>[l(O,{modelValue:_.template_id,"onUpdate:modelValue":t[3]||(t[3]=e=>_.template_id=e),placeholder:"请选择合同模板",style:{width:"100%"}},{default:n(()=>[(p(!0),S(P,null,R(F.value,e=>(p(),f($,{key:e.id,label:e.template_name,value:e.template_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(I,{label:"关联订单",prop:"order_id"},{default:n(()=>[l(O,{modelValue:_.order_id,"onUpdate:modelValue":t[4]||(t[4]=e=>_.order_id=e),placeholder:"请选择关联订单",style:{width:"100%"},filterable:"",remote:"","remote-method":te,loading:V.value},{default:n(()=>[(p(!0),S(P,null,R(v.value,e=>(p(),f($,{key:e.id,label:e.order_no,value:e.id},{default:n(()=>[c("span",null,m(e.order_no),1),c("span",Ke,m(e.insured_type==="个人"?e.person_name:e.company_name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(Ie,{visible:E.value,"onUpdate:visible":t[7]||(t[7]=e=>E.value=e),title:`合同附件 - ${((M=b.value)==null?void 0:M.title)||""}`,"order-id":((N=b.value)==null?void 0:N.order_id)||0,"ref-id":((A=b.value)==null?void 0:A.id)||0,type:"contact","allow-delete":!1},null,8,["visible","title","order-id","ref-id"])])}}},st=ce(Pe,[["__scopeId","data-v-2d34a03b"]]);export{st as default};
