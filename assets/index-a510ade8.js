import{_ as ye,u as be,b as he}from"./index-55beadfc.js";/* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                        *//* empty css                    *//* empty css                       */import{r as c,b as we,w as xe,ae as Ce,l as _,B as w,C as m,F as a,G as o,a1 as k,af as Ve,p as E,E as u,a5 as ke,ay as Ee,aH as Se,K as Oe,an as De,aM as Me,M as Re,ai as Le,u as p,aJ as A,H as R,I as L,O as i,aK as Ue,av as S,D as b,Z as N,Q as ze,T as Ye,aN as Pe,R as Ie,a2 as $e,ax as Be,al as Te,am as Fe,J as Ke}from"./element-plus-e9590f8a.js";import{p as je}from"./order-0e7843c9.js";import{g as Ae}from"./funder-a16af02a.js";import{g as Ne}from"./insurer-d2cd2ffa.js";import{g as He}from"./user-98b52aed.js";import{f as Je}from"./format-20468769.js";const Qe={class:"order-list"},Ge={class:"filter-container"},Ze={class:"filter-row"},qe={class:"filter-row"},We={class:"filter-row"},Xe={class:"table-container"},ea={key:0},aa={key:1},ta={key:2},la={class:"pagination"},na={class:"export-options"},oa={class:"dialog-footer"},sa={__name:"index",setup(ra){const H=be(),U=he(),z=c([]),Y=c(0),O=c(!0),n=we({page:1,page_size:50,order_no:"",status:"",insurance_type:"",funder_id:"",insurer_id:"",user_id:"",car_no:"",vin:"",insurance_no:"",loan_start_date:"",loan_end_date:"",create_start_date:"",create_end_date:""}),D=c([]),M=c([]),P=c([]),I=c([]),$=c([]),v=c([]),h=c(!1),y=c(null),B={OrderAll:"",OrderFirstReview:"待初审",OrderSecondReview:"待复审",OrderSign:"代签约",OrderPendingLoan:"待放款",OrderLoaned:"已放款",OrderRefunded:"已退保",OrderCompleted:"已结清",OrderCancelled:"已作废"},T=()=>{const l=U.name;B.hasOwnProperty(l)&&(n.status=B[l])},x=async()=>{O.value=!0;try{const{data:l}=await je(n);z.value=l.list,Y.value=l.total}catch(l){console.error("获取订单列表失败:",l),u.error("获取订单列表失败")}O.value=!1},f=()=>{n.page=1,x()},F=l=>l==null?"-":"¥"+parseFloat(l).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}),J=()=>{const l=new URLSearchParams;Object.keys(n).forEach(e=>{n[e]!==""&&n[e]!==null&&n[e]!==void 0&&l.append(e,n[e])}),window.open(`/api/admin/orders/export?${l.toString()}`,"_blank")},Q=l=>{y.value=l,h.value=!0},G=()=>{y.value&&(window.open(`/api/admin/orders/${y.value.id}/export-complete`,"_blank"),h.value=!1,u.success("正在导出订单全部信息..."))},Z=()=>{y.value&&(window.open(`/api/admin/orders/${y.value.id}/export-insurance`,"_blank"),h.value=!1,u.success("正在导出投保信息..."))},q=()=>{y.value&&(window.open(`/api/admin/orders/${y.value.id}/export-plan`,"_blank"),h.value=!1,u.success("正在导出分期计划..."))},W=()=>{y.value&&(window.open(`/api/admin/orders/${y.value.id}/export-received`,"_blank"),h.value=!1,u.success("正在导出收款记录..."))},X=()=>{if(v.value.length===0){u.warning("请先选择要导出的订单");return}const l=v.value.map(s=>s.id).join(","),e=new URLSearchParams;e.append("order_ids",l),window.open(`/api/admin/orders/export?${e.toString()}`,"_blank")},ee=()=>{const l=new URLSearchParams;Object.keys(n).forEach(e=>{n[e]!==""&&n[e]!==null&&n[e]!==void 0&&l.append(e,n[e])}),window.open(`/api/admin/orders/export-all-insurance?${l.toString()}`,"_blank"),u.success("正在导出投保信息...")},ae=()=>{if(v.value.length===0){u.warning("请先选择要导出的订单");return}const l=v.value.map(s=>s.id).join(","),e=new URLSearchParams;e.append("order_ids",l),window.open(`/api/admin/orders/export-all-insurance?${e.toString()}`,"_blank"),u.success("正在导出选中订单的投保信息...")},te=l=>{v.value=l},le=()=>{Object.keys(n).forEach(l=>{l!=="page"&&l!=="page_size"&&(n[l]="")}),D.value=[],M.value=[],n.page=1,x()},ne=l=>{l&&l.length===2?(n.loan_start_date=l[0],n.loan_end_date=l[1]):(n.loan_start_date="",n.loan_end_date="")},oe=l=>{l&&l.length===2?(n.create_start_date=l[0],n.create_end_date=l[1]):(n.create_start_date="",n.create_end_date="")},se=async()=>{try{const[l,e,s]=await Promise.all([Ae(),Ne(),He()]);P.value=l.data.list||[],I.value=e.data.list||[],$.value=s.data.list||[]}catch(l){console.error("加载选项数据失败:",l)}},re=l=>{H.push(`/order/detail/${l.id}`)},ie=l=>({待初审:"warning",待复审:"warning",代签约:"primary",待放款:"warning",已放款:"success",已退保:"danger",已结清:"success",已作废:"danger"})[l]||"info",de=l=>{n.page_size=l,x()},ue=l=>{n.page=l,x()},pe=l=>{if(!l){u.warning("订单号不存在");return}const e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);navigator.clipboard&&(window.isSecureContext||e)?navigator.clipboard.writeText(l).then(()=>{u.success("订单号已复制到剪贴板")}).catch(s=>{console.error("使用 Clipboard API 复制失败:",s),K(l)}):K(l)},K=l=>{try{const e=document.createElement("textarea");e.value=l,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();const s=document.execCommand("copy");if(document.body.removeChild(e),s)u.success("订单号已复制到剪贴板");else throw new Error("execCommand 复制失败")}catch(e){console.error("复制失败:",e),Ke.alert(l,"请手动复制订单号",{confirmButtonText:"确定",type:"info"})}};return xe(()=>U.name,()=>{T(),n.page=1,x()},{immediate:!0}),Ce(()=>{T(),se(),x()}),(l,e)=>{const s=$e,V=ke,r=Be,C=Ee,j=Se,d=Oe,g=Te,ce=Fe,_e=De,me=Me,fe=Re,ge=Le;return _(),w("div",Qe,[m("div",Ge,[m("div",Ze,[a(V,{modelValue:n.order_no,"onUpdate:modelValue":e[0]||(e[0]=t=>n.order_no=t),placeholder:"订单号",style:{width:"200px"},class:"filter-item",onKeyup:k(f,["enter","native"])},{prefix:o(()=>[a(s,null,{default:o(()=>[a(p(A))]),_:1})]),_:1},8,["modelValue"]),a(C,{modelValue:n.insurance_type,"onUpdate:modelValue":e[1]||(e[1]=t=>n.insurance_type=t),placeholder:"保险类型",style:{width:"120px"},class:"filter-item",clearable:"",onChange:f},{default:o(()=>[a(r,{label:"全部",value:""}),a(r,{label:"车险",value:"车险"}),a(r,{label:"货运险",value:"货运险"})]),_:1},8,["modelValue"]),a(C,{modelValue:n.status,"onUpdate:modelValue":e[2]||(e[2]=t=>n.status=t),placeholder:"选择状态",style:{width:"120px"},class:"filter-item",clearable:"",onChange:f},{default:o(()=>[a(r,{label:"全部",value:""}),a(r,{label:"待初审",value:"待初审"}),a(r,{label:"待复审",value:"待复审"}),a(r,{label:"代签约",value:"代签约"}),a(r,{label:"待放款",value:"待放款"}),a(r,{label:"已放款",value:"已放款"}),a(r,{label:"已退保",value:"已退保"}),a(r,{label:"已结清",value:"已结清"})]),_:1},8,["modelValue"]),a(C,{modelValue:n.funder_id,"onUpdate:modelValue":e[3]||(e[3]=t=>n.funder_id=t),placeholder:"资金方",style:{width:"200px"},class:"filter-item",clearable:"",onChange:f},{default:o(()=>[a(r,{label:"全部",value:""}),(_(!0),w(R,null,L(P.value,t=>(_(),E(r,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(C,{modelValue:n.insurer_id,"onUpdate:modelValue":e[4]||(e[4]=t=>n.insurer_id=t),placeholder:"保险公司",style:{width:"200px"},class:"filter-item",clearable:"",onChange:f},{default:o(()=>[a(r,{label:"全部",value:""}),(_(!0),w(R,null,L(I.value,t=>(_(),E(r,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(C,{modelValue:n.user_id,"onUpdate:modelValue":e[5]||(e[5]=t=>n.user_id=t),placeholder:"借款人",style:{width:"200px"},class:"filter-item",clearable:"",onChange:f},{default:o(()=>[a(r,{label:"全部",value:""}),(_(!0),w(R,null,L($.value,t=>(_(),E(r,{key:t.id,label:t.company_name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),m("div",qe,[a(V,{modelValue:n.car_no,"onUpdate:modelValue":e[6]||(e[6]=t=>n.car_no=t),placeholder:"车牌号",style:{width:"120px"},class:"filter-item",onKeyup:k(f,["enter","native"])},null,8,["modelValue"]),a(V,{modelValue:n.vin,"onUpdate:modelValue":e[7]||(e[7]=t=>n.vin=t),placeholder:"车架号",style:{width:"180px"},class:"filter-item",onKeyup:k(f,["enter","native"])},null,8,["modelValue"]),a(V,{modelValue:n.insurance_no,"onUpdate:modelValue":e[8]||(e[8]=t=>n.insurance_no=t),placeholder:"投保单号",style:{width:"150px"},class:"filter-item",onKeyup:k(f,["enter","native"])},null,8,["modelValue"]),a(j,{modelValue:D.value,"onUpdate:modelValue":e[9]||(e[9]=t=>D.value=t),type:"daterange","range-separator":"至","start-placeholder":"放款开始日期","end-placeholder":"放款结束日期",style:{width:"240px"},class:"filter-item",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:ne},null,8,["modelValue"]),a(j,{modelValue:M.value,"onUpdate:modelValue":e[10]||(e[10]=t=>M.value=t),type:"daterange","range-separator":"至","start-placeholder":"创建开始日期","end-placeholder":"创建结束日期",style:{width:"240px"},class:"filter-item",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:oe},null,8,["modelValue"])]),m("div",We,[a(d,{class:"filter-item",type:"primary",onClick:f},{default:o(()=>[a(s,null,{default:o(()=>[a(p(A))]),_:1}),e[15]||(e[15]=i(" 搜索 "))]),_:1,__:[15]}),a(d,{class:"filter-item",type:"info",onClick:le},{default:o(()=>[a(s,null,{default:o(()=>[a(p(Ue))]),_:1}),e[16]||(e[16]=i(" 重置 "))]),_:1,__:[16]}),a(d,{class:"filter-item",type:"success",onClick:J},{default:o(()=>[a(s,null,{default:o(()=>[a(p(S))]),_:1}),e[17]||(e[17]=i(" 导出全部订单 "))]),_:1,__:[17]}),a(d,{class:"filter-item",type:"info",onClick:ee},{default:o(()=>[a(s,null,{default:o(()=>[a(p(S))]),_:1}),e[18]||(e[18]=i(" 导出全部车辆 "))]),_:1,__:[18]}),a(d,{class:"filter-item",type:"warning",onClick:X,disabled:v.value.length===0},{default:o(()=>[a(s,null,{default:o(()=>[a(p(S))]),_:1}),i(" 导出选中 ("+b(v.value.length)+") ",1)]),_:1},8,["disabled"]),a(d,{class:"filter-item",type:"info",onClick:ae,disabled:v.value.length===0},{default:o(()=>[a(s,null,{default:o(()=>[a(p(S))]),_:1}),i(" 导出选中 ("+b(v.value.length)+")车辆 ",1)]),_:1},8,["disabled"])])]),m("div",Xe,[Ve((_(),E(_e,{data:z.value,border:"",fit:"","highlight-current-row":"",style:{width:"100%",cursor:"pointer"},onRowClick:re,onSelectionChange:te},{default:o(()=>[a(g,{type:"selection",width:"55",align:"center"}),a(g,{label:"订单号",prop:"order_no",align:"left","min-width":"180"}),a(g,{label:"险种",prop:"insurance_type",align:"center","min-width":"100"}),a(g,{label:"借款人",prop:"loan_name",align:"left","min-width":"230"}),a(g,{label:"数量",prop:"insurance_count",align:"center",width:"100"},{default:o(({row:t})=>[t.insurance_type==="车险"?(_(),w("span",ea,b(t.insurance_count)+"台",1)):t.insurance_type==="货运险"?(_(),w("span",aa,b(t.insurance_count)+"单",1)):(_(),w("span",ta,b(t.insurance_count)+"笔",1))]),_:1}),a(g,{label:"总保费",prop:"total_premium",align:"center",width:"120"},{default:o(({row:t})=>[m("span",null,b(t.total_premium?F(t.total_premium):"-"),1)]),_:1}),a(g,{label:"贷款金额",prop:"loan_amount",align:"center",width:"120"},{default:o(({row:t})=>[m("span",null,b(t.loan_amount?F(t.loan_amount):"-"),1)]),_:1}),a(g,{label:"进件时间",prop:"created_at",align:"center",width:"180"},{default:o(({row:t})=>[m("span",null,b(t.created_at?p(Je)(t.created_at):"-"),1)]),_:1}),a(g,{label:"状态",prop:"status",align:"center",width:"110"},{default:o(({row:t})=>[a(ce,{type:ie(t.status)},{default:o(()=>[i(b(t.status),1)]),_:2},1032,["type"])]),_:1}),a(g,{label:"操作",align:"center",width:"120"},{default:o(({row:t})=>[a(d,{type:"primary",link:"",onClick:N(ve=>pe(t.order_no),["stop"]),class:"copy-btn"},{default:o(()=>e[19]||(e[19]=[i(" 复制 ")])),_:2,__:[19]},1032,["onClick"]),a(d,{type:"success",link:"",onClick:N(ve=>Q(t),["stop"]),class:"copy-btn"},{default:o(()=>e[20]||(e[20]=[i(" 导出 ")])),_:2,__:[20]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ge,O.value]])]),m("div",la,[a(me,{"current-page":n.page,"onUpdate:currentPage":e[11]||(e[11]=t=>n.page=t),"page-size":n.page_size,"onUpdate:pageSize":e[12]||(e[12]=t=>n.page_size=t),"page-sizes":[10,20,50,100],total:Y.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:de,onCurrentChange:ue},null,8,["current-page","page-size","total"])]),a(fe,{modelValue:h.value,"onUpdate:modelValue":e[14]||(e[14]=t=>h.value=t),title:"选择导出类型",width:"400px","close-on-click-modal":!1},{footer:o(()=>[m("span",oa,[a(d,{onClick:e[13]||(e[13]=t=>h.value=!1)},{default:o(()=>e[25]||(e[25]=[i("取消")])),_:1,__:[25]})])]),default:o(()=>[m("div",na,[a(d,{type:"primary",size:"large",style:{width:"100%","margin-bottom":"12px","margin-left":"12px"},onClick:G},{default:o(()=>[a(s,{style:{"margin-right":"8px"}},{default:o(()=>[a(p(ze))]),_:1}),e[21]||(e[21]=i(" 导出当前订单全部信息 "))]),_:1,__:[21]}),a(d,{type:"success",size:"large",style:{width:"100%","margin-bottom":"12px"},onClick:Z},{default:o(()=>[a(s,{style:{"margin-right":"8px"}},{default:o(()=>[a(p(Ye))]),_:1}),e[22]||(e[22]=i(" 导出投保信息 "))]),_:1,__:[22]}),a(d,{type:"warning",size:"large",style:{width:"100%","margin-bottom":"12px"},onClick:q},{default:o(()=>[a(s,{style:{"margin-right":"8px"}},{default:o(()=>[a(p(Pe))]),_:1}),e[23]||(e[23]=i(" 导出分期计划 "))]),_:1,__:[23]}),a(d,{type:"info",size:"large",style:{width:"100%"},onClick:W},{default:o(()=>[a(s,{style:{"margin-right":"8px"}},{default:o(()=>[a(p(Ie))]),_:1}),e[24]||(e[24]=i(" 导出收款记录 "))]),_:1,__:[24]})])]),_:1},8,["modelValue"])])}}},Ca=ye(sa,[["__scopeId","data-v-bbe8ca22"]]);export{Ca as default};
