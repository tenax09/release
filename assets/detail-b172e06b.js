import{_ as Ye,b as Ze,u as et,a as tt}from"./index-86e0e316.js";/* empty css               *//* empty css                 *//* empty css                         *//* empty css                        *//* empty css                     *//* empty css               *//* empty css                *//* empty css                             *//* empty css                   *//* empty css                       */import{f as A,a as f}from"./format-20468769.js";import{a as at,r as lt,b as ve,d as nt,f as st,h as ot}from"./order-95b27da5.js";import{A as X,a as Y,d as rt,u as it}from"./AttachmentUpload-0e56480c.js";import{m as ut}from"./receivable-ab84f759.js";import{r as w,ae as dt,l as v,B as h,C as c,F as t,G as a,p as $,S as k,E as b,aE as ct,ag as _t,ah as mt,M as pt,u as _,O as i,af as fe,D as o,ac as vt,av as ft,aF as yt,H as gt,I as bt,J as z,K as ht,az as wt,am as kt,aA as Ct,ao as xt,al as $t,an as Et,ap as Vt,aq as At,ar as Mt,a5 as It,a6 as St,a7 as Tt,ai as Ut}from"./element-plus-eb4b90a0.js";/* empty css                    */const Dt={class:"order-detail"},Pt={class:"page-header"},Bt={class:"header-actions"},Nt={class:"overview-section"},zt={class:"key-metrics"},Rt={class:"metric-item"},Ft={class:"metric-value"},Ot={class:"metric-item"},Lt={class:"metric-value"},qt={class:"metric-item"},Gt={class:"metric-value"},Ht={class:"metric-item"},Jt={class:"metric-value"},Kt={class:"metric-item"},Qt={class:"metric-value"},jt={key:0,class:"empty-state"},Wt={key:0,class:"empty-state"},Xt={style:{color:"#67c23a","font-weight":"bold"}},Yt={style:{color:"#e6a23c","font-weight":"bold"}},Zt={style:{color:"#409eff"}},ea={style:{color:"#67c23a"}},ta={key:0,style:{color:"#67c23a","font-weight":"bold"}},aa={key:1},la={key:0,style:{color:"#f56c6c"}},na={key:1},sa={key:0,style:{color:"#f56c6c"}},oa={key:1},ra={key:0,style:{color:"#f56c6c","font-weight":"bold"}},ia={key:1},ua={key:1,style:{color:"#67c23a"}},da={class:"log-content"},ca={class:"operator"},_a={class:"action"},ma={key:1,class:"empty-logs"},pa={class:"dialog-footer"},va={class:"payment-info"},fa={key:1,class:"payment-section"},ya={key:2,class:"payment-section"},ga={key:3,class:"payment-section"},ba={class:"remark-content"},ha={class:"dialog-footer"},wa={__name:"detail",setup(ka){const ye=Ze(),Z=et(),M=w(!1),n=w({}),S=tt(),T=w(!1),R=w(null),F=w(!1),U=w({remark:""}),P=w(!1),O=w(!1),p=w({}),L=w(!1),q=w(!1),G=w(!1),H=w(!1),J=w(!1),K=w(!1),C=w(null),ge={remark:[{required:!0,message:"请输入备注内容",trigger:"blur"}]},I=async()=>{M.value=!0;try{const s=await at(ye.params.id);n.value=s.data,n.value.total_commercial=0,n.value.insurance_type==="车险"&&n.value.car_insurance&&n.value.car_insurance.length>0?n.value.total_commercial=n.value.car_insurance.reduce((e,r)=>e+(r.commercial_amount||0),0):n.value.insurance_type==="货运险"&&n.value.cargo_insurance&&n.value.cargo_insurance.length>0&&(n.value.total_commercial=n.value.cargo_insurance.reduce((e,r)=>e+(r.commercial_amount||0),0))}catch{b.error("获取订单详情失败")}M.value=!1},be=()=>{Z.back()},B=async()=>{try{let s="",e="下一状态";n.value.status==="待初审"?(s="初审通过",e="待复审"):n.value.status==="待复审"&&(s="复审通过",e="待客户签约"),await z.confirm(`确定要将订单状态从 [${n.value.status}] 更新为 [${e}] 吗？`,"审核确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),M.value=!0,await lt(n.value.id,{audit_note:s}),b.success("审核成功"),I()}catch(s){s!=="cancel"&&b.error("审核失败")}M.value=!1},he=s=>{const{columns:e,data:r}=s,m=[];return e.forEach((u,g)=>{if(g===0){m[g]="合计";return}if(u.property==="total_amount"){const y=r.reduce((E,V)=>E+(V.commercial_amount||0)+(V.compulsory_amount||0)+(V.vehicle_tax_amount||0),0);m[g]=f(y);return}const x=r.map(y=>Number(y[u.property]));if(x.every(y=>isNaN(y)))m[g]="-";else{const y=x.reduce((E,V)=>{const d=Number(V);return isNaN(d)?E:E+d},0);u.property==="commercial_amount"||u.property==="compulsory_amount"||u.property==="vehicle_tax_amount"?m[g]=f(y):m[g]="-"}}),m},we=s=>{const{columns:e,data:r}=s,m=[];return e.forEach((u,g)=>{if(g===0){m[g]="合计";return}const x=r.map(y=>Number(y[u.property]));if(x.every(y=>isNaN(y)))m[g]="-";else{const y=x.reduce((E,V)=>{const d=Number(V);return isNaN(d)?E:E+d},0);u.property==="commercial_amount"?m[g]=f(y):m[g]="-"}}),m},ke=s=>({待审核:"warning",待复审:"warning",待客户签约:"info",待资方签约:"info",待放款:"warning",已放款:"success",已退保:"danger",已结清:"success",已作废:"danger"})[s]||"info",Ce=s=>({create:"primary",update:"success",review:"warning",delete:"danger",info:"info"})[s]||"info",Q=()=>{Z.push(`/order/insurance/${n.value.id}`)},xe=(s,e)=>{if(!n.value.attachments||n.value.attachments.length===0){b.warning("暂无附件可查看");return}const r=s.find(m=>m.remark===e);if(!r){b.warning("暂无附件可查看");return}window.open(`/api/admin/attachments/${r.id}/view`)},$e=()=>{W(n.value.attachments,"缴费通知书")?xe(n.value.attachments,"缴费通知书"):Ee("缴费通知书")},Ee=s=>{const e=document.createElement("input");e.type="file",e.accept="*/*",e.style.display="none",e.onchange=async r=>{const m=r.target.files[0];if(m){try{const u=new FormData;u.append("files",m),u.append("remarks",s),await it(n.value.id,0,u),b.success("上传成功"),I()}catch(u){console.error("上传失败:",u),b.error("上传失败")}document.body.removeChild(e)}},document.body.appendChild(e),e.click()},Ve=async s=>{try{await rt(s)}catch(e){b.error("删除失败："+(e.message||"未知错误"))}},Ae=()=>{L.value=!0},Me=()=>{q.value=!0},j=()=>{b.success("附件上传成功")},Ie=s=>{ve(n.value.id,s.id).then(e=>{C.value=e.data,G.value=!0})},Se=s=>{C.value=s,H.value=!0},Te=s=>{ve(n.value.id,s.id).then(e=>{C.value=e.data,J.value=!0})},Ue=s=>{C.value=s,K.value=!0},De=async()=>{try{await z.confirm("确定要作废该订单吗？作废后不可恢复！","作废确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),M.value=!0,await nt(n.value.id),b.success("订单已作废"),I()}catch(s){s!=="cancel"&&b.error("作废失败")}M.value=!1},ee=(s,e)=>{if(!s){b.warning(`${e}链接不存在`);return}try{if(typeof window<"u"&&window.open)window.open(s,"_blank","noopener,noreferrer");else throw new Error("window.open不可用")}catch(r){console.error(`${e}失败:`,r);try{const m=document.createElement("a");m.href=s,m.target="_blank",m.rel="noopener noreferrer",m.style.display="none",document.body.appendChild(m),m.click(),document.body.removeChild(m),b.success(`${e}链接已打开`)}catch(m){console.error("备选方案失败:",m)}}},Pe=s=>{if(!s){b.warning("签署链接不存在");return}te(s,"签署链接")},te=(s,e)=>{const r=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);navigator.clipboard&&(window.isSecureContext||r)?navigator.clipboard.writeText(s).then(()=>{b.success(`${e}已复制到剪贴板`)}).catch(m=>{console.error("使用 Clipboard API 复制失败:",m),ae(s,e)}):ae(s,e)},ae=(s,e)=>{try{const r=document.createElement("textarea");r.value=s,r.style.position="fixed",r.style.left="-999999px",r.style.top="-999999px",document.body.appendChild(r),r.focus(),r.select();const m=document.execCommand("copy");if(document.body.removeChild(r),m)b.success(`${e}已复制到剪贴板`);else throw new Error("execCommand 复制失败")}catch(r){console.error("复制失败:",r),z.alert(s,`请手动复制${e}`,{confirmButtonText:"确定",type:"info",customClass:"copy-url-dialog"})}},Be=s=>({已签署:"success",未签署:"warning",已作废:"danger"})[s]||"info",Ne=s=>({首付:"primary",还款:"success",利息:"warning",本金:"info",退保:"danger"})[s]||"info",ze=s=>({微信:"success",支付宝:"primary",银行卡:"warning"})[s]||"info",Re=s=>({待收款:"warning",已收款:"success",已逾期:"danger"})[s]||"info",Fe=async s=>{try{const{value:e}=await z.prompt(`请输入第${s.period}期的实际收款金额`,"标记收款",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\d+(\.\d{1,2})?$/,inputErrorMessage:"请输入正确的金额格式",inputValue:s.amount.toString()});if(!e){b.warning("请输入收款金额");return}M.value=!0,await ut(s.id,{actual_amount:parseFloat(e),actual_date:new Date().toISOString().split("T")[0]}),b.success("标记收款成功"),I()}catch(e){e!=="cancel"&&b.error("标记收款失败")}M.value=!1},Oe=()=>{U.value.remark="",T.value=!0},Le=async()=>{R.value&&await R.value.validate(async s=>{if(s){F.value=!0;try{await st(n.value.id,{remark:U.value.remark}),b.success("添加备注成功"),T.value=!1,I()}catch(e){b.error("添加备注失败："+(e.message||"未知错误"))}F.value=!1}})},qe=async()=>{if(!n.value.id){b.warning("订单信息不存在");return}O.value=!0;try{const s=await ot(n.value.id);p.value=s.data,P.value=!0,b.success("前置款信息生成成功")}catch(s){b.error("生成前置款信息失败："+(s.message||"未知错误"))}O.value=!1},Ge=()=>{if(!p.value.batch_no){b.warning("暂无前置款信息可复制");return}const s=`
批次号：${p.value.batch_no}
借款人：${p.value.borrower}
${p.value.vehicle_info}
总放款金额：${f(p.value.total_loan_amount)}

支付服务费：${f(p.value.service_fee)}
户名：${p.value.service_account_name}
账户：${p.value.service_account_no}
开户行：${p.value.service_bank_name}

支付首付款：${f(p.value.total_down_payment)}
${p.value.down_payment_detail}
户名：${p.value.funder_account_name}
账户：${p.value.funder_account_no}
开户行：${p.value.funder_bank_name}

${p.value.remark||""}
  `.trim();te(s,"前置款信息")},He=s=>{const{columns:e,data:r}=s,m=[];return e.forEach((u,g)=>{if(g===0){m[g]="合计";return}const x=r.map(y=>Number(y[u.property]));if(x.every(y=>isNaN(y)))m[g]="-";else{const y=x.reduce((E,V)=>{const d=Number(V);return isNaN(d)?E:E+d},0);u.property==="amount"||u.property==="principal_amount"||u.property==="interest_amount"||u.property==="penalty_amount"||u.property==="forfeit_amount"||u.property==="actual_amount"?m[g]=f(y):m[g]="-"}}),m},W=(s,e)=>!s||s.length===0?!1:s.some(r=>r.remark===e);return dt(()=>{I()}),(s,e)=>{var se,oe,re,ie,ue,de,ce,_e,me,pe;const r=ht,m=ct,u=wt,g=kt,x=Ct,y=_t,E=xt,V=mt,d=$t,D=Et,Je=Vt,Ke=At,Qe=Mt,je=It,We=St,Xe=Tt,le=pt,ne=Ut;return v(),h("div",Dt,[c("div",Pt,[t(m,{onBack:be,title:n.value.order_no||"订单详情"},{extra:a(()=>[c("div",Bt,[n.value.status==="待初审"&&_(S).riskBasicPrivate?(v(),$(r,{key:0,type:"success",onClick:B},{default:a(()=>e[13]||(e[13]=[i("初审通过")])),_:1,__:[13]})):k("",!0),n.value.status==="待复审"&&_(S).riskManagerPrivate?(v(),$(r,{key:1,type:"warning",onClick:B},{default:a(()=>e[14]||(e[14]=[i("复审通过")])),_:1,__:[14]})):k("",!0),n.value.status==="待放款"&&_(S).operationManagerPrivate?(v(),$(r,{key:2,type:"info",onClick:B},{default:a(()=>e[15]||(e[15]=[i("放款")])),_:1,__:[15]})):k("",!0),n.value.status!=="已作废"&&(_(S).operationManagerPrivate||_(S).riskManagerPrivate)?(v(),$(r,{key:3,type:"danger",onClick:De},{default:a(()=>e[16]||(e[16]=[i("作废订单")])),_:1,__:[16]})):k("",!0),_(S).superPrivate?(v(),$(r,{key:4,type:"primary",onClick:B},{default:a(()=>e[17]||(e[17]=[i("下一状态（调试用）")])),_:1,__:[17]})):k("",!0),t(r,{type:"default",onClick:Q},{default:a(()=>e[18]||(e[18]=[i("管理投保单")])),_:1,__:[18]}),t(r,{type:"default",onClick:qe},{default:a(()=>e[19]||(e[19]=[i("生成前置款")])),_:1,__:[19]}),t(r,{type:"default",onClick:Oe},{default:a(()=>e[20]||(e[20]=[i("添加日志")])),_:1,__:[20]}),t(r,{type:"default",onClick:e[0]||(e[0]=l=>Ae())},{default:a(()=>e[21]||(e[21]=[i("查看附件")])),_:1,__:[21]}),t(r,{type:"default",onClick:e[1]||(e[1]=l=>Me())},{default:a(()=>e[22]||(e[22]=[i("上传附件")])),_:1,__:[22]})])]),_:1},8,["title"])]),c("div",Nt,[t(V,{gutter:20},{default:a(()=>[t(E,{span:18},{default:a(()=>[fe((v(),$(y,{class:"info-card"},{default:a(()=>[t(x,{column:2,border:""},{default:a(()=>[t(u,{label:"订单编号"},{default:a(()=>[i(o(n.value.order_no),1)]),_:1}),t(u,{label:"订单状态"},{default:a(()=>[t(g,{type:ke(n.value.status)},{default:a(()=>[i(o(n.value.status),1)]),_:1},8,["type"]),e[23]||(e[23]=c("span",{style:{"margin-left":"10px"}},null,-1)),t(g,{style:{cursor:"pointer"},onClick:$e,type:W(n.value.attachments,"缴费通知书")?"success":"info"},{default:a(()=>[i(o(W(n.value.attachments,"缴费通知书")?"缴费通知书已上传":"缴费通知书未上传"),1)]),_:1},8,["type"])]),_:1,__:[23]}),t(u,{label:"保险类型"},{default:a(()=>[i(o(n.value.insurance_type),1)]),_:1}),t(u,{label:"借款主体"},{default:a(()=>{var l;return[i(o(n.value.loan_name||((l=n.value.user)==null?void 0:l.company_name)),1)]}),_:1}),t(u,{label:"业务归属"},{default:a(()=>{var l;return[i(o(n.value.sell_mode==="直销"?"直销":((l=n.value.agent)==null?void 0:l.company_name)||"无"),1)]}),_:1}),t(u,{label:"销售员"},{default:a(()=>[i(o(n.value.seller),1)]),_:1}),t(u,{label:"服务费"},{default:a(()=>[i(o(n.value.service_fee)+"%",1)]),_:1}),t(u,{label:"渠道成本"},{default:a(()=>[i(o(n.value.agent_cost)+"%",1)]),_:1}),t(u,{span:2,label:"金融产品"},{default:a(()=>{var l;return[i(o((l=n.value.product)==null?void 0:l.name),1)]}),_:1}),t(u,{label:"承保机构",span:2},{default:a(()=>{var l;return[i(o((l=n.value.insurer)==null?void 0:l.name),1)]}),_:1})]),_:1}),t(x,{column:2,border:""},{default:a(()=>[t(u,{label:"进件时间"},{default:a(()=>[i(o(_(A)(n.value.created_at)),1)]),_:1}),t(u,{label:"初审时间"},{default:a(()=>[i(o(_(A)(n.value.first_review_time)||"-"),1)]),_:1}),t(u,{label:"复审时间"},{default:a(()=>[i(o(_(A)(n.value.second_review_time)||"-"),1)]),_:1}),t(u,{label:"用户签约时间"},{default:a(()=>[i(o(_(A)(n.value.user_sign_time)||"-"),1)]),_:1}),t(u,{label:"资方签约时间"},{default:a(()=>[i(o(_(A)(n.value.funder_sign_time)||"-"),1)]),_:1}),t(u,{label:"放款时间"},{default:a(()=>[i(o(_(A)(n.value.loan_time)||"-"),1)]),_:1}),t(u,{label:"最后更新时间"},{default:a(()=>[i(o(_(A)(n.value.updated_at)),1)]),_:1})]),_:1})]),_:1})),[[ne,M.value]])]),_:1}),t(E,{span:6},{default:a(()=>[t(y,{class:"key-metrics-card"},{default:a(()=>[c("div",zt,[c("div",Rt,[e[24]||(e[24]=c("div",{class:"metric-label"},"总保费",-1)),c("div",Ft,o(_(f)(n.value.total_premium)),1)]),c("div",Ot,[e[25]||(e[25]=c("div",{class:"metric-label"},"商业险",-1)),c("div",Lt,o(_(f)(n.value.total_commercial)),1)]),c("div",qt,[e[26]||(e[26]=c("div",{class:"metric-label"},"首付金额",-1)),c("div",Gt,o(_(f)(n.value.down_payment)),1)]),c("div",Ht,[e[27]||(e[27]=c("div",{class:"metric-label"},"贷款金额",-1)),c("div",Jt,o(_(f)(n.value.loan_amount)),1)]),c("div",Kt,[e[28]||(e[28]=c("div",{class:"metric-label"},"服务费",-1)),c("div",Qt,o(_(f)(n.value.service_fee*n.value.total_commercial/100)),1)])])]),_:1})]),_:1})]),_:1})]),n.value.insurance_type==="车险"?(v(),$(y,{key:0,class:"detail-card insurance-card"},{default:a(()=>[t(D,{data:n.value.car_insurance||[],border:"",style:{width:"100%"},"empty-text":"暂无车险投保信息","max-height":"300","show-summary":n.value.car_insurance&&n.value.car_insurance.length>0,"sum-text":"合计","summary-method":he},{default:a(()=>[t(d,{prop:"car_no",label:"车牌号",width:"120",align:"left"}),t(d,{prop:"vin",label:"车架号",width:"180",align:"left"}),t(d,{prop:"insured",label:"被保人",width:"170",align:"left"}),t(d,{prop:"commercial_amount",label:"商业险",width:"110",align:"right"},{default:a(({row:l})=>[i(o(_(f)(l.commercial_amount)),1)]),_:1}),t(d,{prop:"compulsory_amount",label:"交强险",width:"110",align:"right"},{default:a(({row:l})=>[i(o(_(f)(l.compulsory_amount)),1)]),_:1}),t(d,{prop:"vehicle_tax_amount",label:"车船税",width:"110",align:"right"},{default:a(({row:l})=>[i(o(_(f)(l.vehicle_tax_amount)),1)]),_:1}),t(d,{prop:"total_amount",label:"总保费",width:"110",align:"right"},{default:a(({row:l})=>[i(o(_(f)((l.commercial_amount||0)+(l.compulsory_amount||0)+(l.vehicle_tax_amount||0))),1)]),_:1}),t(d,{label:"操作",width:"200",align:"center",fixed:"right"},{default:a(({row:l})=>[t(r,{type:"info",size:"small",onClick:N=>Ie(l)},{default:a(()=>e[29]||(e[29]=[i(" 查看附件 ")])),_:2,__:[29]},1032,["onClick"]),t(r,{type:"primary",size:"small",onClick:N=>Se(l)},{default:a(()=>e[30]||(e[30]=[i(" 上传附件 ")])),_:2,__:[30]},1032,["onClick"])]),_:1})]),_:1},8,["data","show-summary"]),!n.value.car_insurance||n.value.car_insurance.length===0?(v(),h("div",jt,[t(r,{type:"primary",onClick:Q},{default:a(()=>e[31]||(e[31]=[i("录入车险信息")])),_:1,__:[31]})])):k("",!0)]),_:1})):k("",!0),n.value.insurance_type==="货运险"?(v(),$(y,{key:1,class:"detail-card insurance-card"},{default:a(()=>[t(D,{data:n.value.cargo_insurance||[],border:"",style:{width:"100%"},"empty-text":"暂无货运险投保信息","max-height":"300","show-summary":n.value.cargo_insurance&&n.value.cargo_insurance.length>0,"sum-text":"合计","summary-method":we},{default:a(()=>[t(d,{prop:"track_no",label:"运输编号",width:"200",align:"left"}),t(d,{prop:"insured",label:"被保人",width:"170",align:"left"}),t(d,{prop:"name",label:"货物名称",width:"150",align:"left"}),t(d,{prop:"quantity",label:"货物数量",width:"120",align:"right"}),t(d,{prop:"carrier",label:"承运人",width:"130",align:"left"}),t(d,{prop:"consignee",label:"收货人",width:"130",align:"left"}),t(d,{prop:"commercial_amount",label:"保费",width:"140",align:"right"},{default:a(({row:l})=>[i(o(_(f)(l.commercial_amount)),1)]),_:1}),t(d,{label:"操作",width:"200",align:"center",fixed:"right"},{default:a(({row:l})=>[t(r,{type:"info",size:"small",onClick:N=>Te(l)},{default:a(()=>e[32]||(e[32]=[i(" 查看附件 ")])),_:2,__:[32]},1032,["onClick"]),t(r,{type:"primary",size:"small",onClick:N=>Ue(l)},{default:a(()=>e[33]||(e[33]=[i(" 上传附件 ")])),_:2,__:[33]},1032,["onClick"])]),_:1})]),_:1},8,["data","show-summary"]),!n.value.cargo_insurance||n.value.cargo_insurance.length===0?(v(),h("div",Wt,[t(r,{type:"primary",onClick:Q},{default:a(()=>e[34]||(e[34]=[i("录入货运险信息")])),_:1,__:[34]})])):k("",!0)]),_:1})):k("",!0),t(y,{class:"detail-card"},{default:a(()=>[t(D,{data:n.value.contacts||[],border:"",style:{width:"100%"},"empty-text":"暂无合同信息","max-height":"200"},{default:a(()=>[t(d,{prop:"contact_id",label:"合同编号",width:"250"}),t(d,{prop:"sign_status",label:"签署状态",width:"120",align:"center"},{default:a(({row:l})=>[t(g,{type:Be(l.sign_status)},{default:a(()=>[i(o(l.sign_status),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"sign_time",label:"签署时间",width:"170",align:"center"},{default:a(({row:l})=>[i(o(l.sign_time||"-"),1)]),_:1}),t(d,{prop:"created_at",label:"创建时间",width:"170",align:"center"},{default:a(({row:l})=>[i(o(_(A)(l.created_at)),1)]),_:1}),t(d,{label:"操作",width:"300",align:"center",fixed:"right"},{default:a(({row:l})=>[t(r,{type:"primary",size:"small",icon:_(vt),onClick:()=>ee(l.view_pdf_url,"查看PDF"),disabled:!l.view_pdf_url,class:"action-btn"},{default:a(()=>e[35]||(e[35]=[i(" 查看 ")])),_:2,__:[35]},1032,["icon","onClick","disabled"]),t(r,{type:"success",size:"small",icon:_(ft),onClick:()=>ee(l.download_url,"下载PDF"),disabled:!l.download_url,class:"action-btn"},{default:a(()=>e[36]||(e[36]=[i(" 下载 ")])),_:2,__:[36]},1032,["icon","onClick","disabled"]),t(r,{type:"info",size:"small",icon:_(yt),onClick:()=>Pe(l.sign_url),disabled:!l.sign_url,class:"action-btn"},{default:a(()=>e[37]||(e[37]=[i(" 签署链接 ")])),_:2,__:[37]},1032,["icon","onClick","disabled"])]),_:1})]),_:1},8,["data"])]),_:1}),t(y,{class:"detail-card"},{default:a(()=>[t(D,{data:n.value.receiveds||[],border:"",style:{width:"100%"},"empty-text":"暂无收款记录","max-height":"200"},{default:a(()=>[t(d,{prop:"trans_no",label:"收款流水号",width:"250"}),t(d,{prop:"rec_type",label:"收款类型",width:"100"},{default:a(({row:l})=>[t(g,{type:Ne(l.rec_type)},{default:a(()=>[i(o(l.rec_type),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"amount",label:"收款金额",width:"120"},{default:a(({row:l})=>[c("span",Xt,o(_(f)(l.amount)),1)]),_:1}),t(d,{prop:"period",label:"期数",width:"80"},{default:a(({row:l})=>[i(o(l.period||"-"),1)]),_:1}),t(d,{prop:"method",label:"收款方式",width:"100"},{default:a(({row:l})=>[t(g,{type:ze(l.method),size:"small"},{default:a(()=>[i(o(l.method),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"date_time",label:"收款时间",width:"160"}),t(d,{prop:"created_at",label:"录入时间",width:"160"},{default:a(({row:l})=>[i(o(_(A)(l.created_at)),1)]),_:1}),t(d,{prop:"remark",label:"备注","min-width":"120"},{default:a(({row:l})=>[i(o(l.remark||"-"),1)]),_:1})]),_:1},8,["data"])]),_:1}),t(y,{class:"detail-card"},{default:a(()=>[t(D,{data:n.value.receivables||[],border:"",style:{width:"100%"},"empty-text":"暂无还款计划","show-summary":n.value.receivables&&n.value.receivables.length>0,"sum-text":"合计","summary-method":He},{default:a(()=>[t(d,{prop:"period",label:"期数",width:"80",align:"center"}),t(d,{prop:"status",label:"状态",width:"100",align:"center"},{default:a(({row:l})=>[t(g,{type:Re(l.status)},{default:a(()=>[i(o(l.status),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"date",label:"应还日期",width:"120",align:"center"}),t(d,{prop:"amount",label:"应还金额",width:"120",align:"right"},{default:a(({row:l})=>[c("span",Yt,o(_(f)(l.amount)),1)]),_:1}),t(d,{prop:"principal_amount",label:"本金",width:"120",align:"right"},{default:a(({row:l})=>[c("span",Zt,o(_(f)(l.principal_amount)),1)]),_:1}),t(d,{prop:"interest_amount",label:"利息",width:"120",align:"right"},{default:a(({row:l})=>[c("span",ea,o(_(f)(l.interest_amount)),1)]),_:1}),t(d,{prop:"actual_amount",label:"实际收款",width:"120",align:"right"},{default:a(({row:l})=>[l.actual_amount>0?(v(),h("span",ta,o(_(f)(l.actual_amount)),1)):(v(),h("span",aa,"-"))]),_:1}),t(d,{prop:"actual_date",label:"实际收款日期",width:"120",align:"center"},{default:a(({row:l})=>[i(o(l.actual_date||"-"),1)]),_:1}),t(d,{prop:"penalty_amount",label:"违约金",width:"100",align:"right"},{default:a(({row:l})=>[l.penalty_amount>0?(v(),h("span",la,o(_(f)(l.penalty_amount)),1)):(v(),h("span",na,"-"))]),_:1}),t(d,{prop:"forfeit_amount",label:"滞纳金",width:"100",align:"right"},{default:a(({row:l})=>[l.forfeit_amount>0?(v(),h("span",sa,o(_(f)(l.forfeit_amount)),1)):(v(),h("span",oa,"-"))]),_:1}),t(d,{prop:"overdue_days",label:"逾期天数",width:"100",align:"center"},{default:a(({row:l})=>[l.overdue_days>0?(v(),h("span",ra,o(l.overdue_days)+"天",1)):(v(),h("span",ia,"-"))]),_:1}),t(d,{label:"操作",width:"120",align:"center",fixed:"right"},{default:a(({row:l})=>[l.status==="待收款"||l.status==="已逾期"?(v(),$(r,{key:0,type:"primary",size:"small",onClick:N=>Fe(l)},{default:a(()=>e[38]||(e[38]=[i(" 标记收款 ")])),_:2,__:[38]},1032,["onClick"])):(v(),h("span",ua,"已收款"))]),_:1})]),_:1},8,["data","show-summary"])]),_:1}),t(y,{class:"detail-card"},{default:a(()=>[n.value.logs&&n.value.logs.length>0?(v(),$(Ke,{key:0},{default:a(()=>[(v(!0),h(gt,null,bt(n.value.logs,l=>(v(),$(Je,{key:l.id,timestamp:_(A)(l.created_at),type:Ce(l.action)},{default:a(()=>[c("div",da,[c("span",ca,o(l.admin_name),1),c("span",_a,o(l.content),1)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})):(v(),h("div",ma,[t(Qe,{description:"暂无操作日志","image-size":80})]))]),_:1}),t(le,{modelValue:T.value,"onUpdate:modelValue":e[4]||(e[4]=l=>T.value=l),title:"添加备注",width:"500px"},{footer:a(()=>[c("span",pa,[t(r,{onClick:e[3]||(e[3]=l=>T.value=!1)},{default:a(()=>e[39]||(e[39]=[i("取消")])),_:1,__:[39]}),t(r,{type:"primary",onClick:Le,loading:F.value},{default:a(()=>e[40]||(e[40]=[i("确定")])),_:1,__:[40]},8,["loading"])])]),default:a(()=>[t(Xe,{ref_key:"remarkFormRef",ref:R,model:U.value,rules:ge,"label-width":"80px"},{default:a(()=>[t(We,{label:"备注内容",prop:"remark"},{default:a(()=>[t(je,{modelValue:U.value.remark,"onUpdate:modelValue":e[2]||(e[2]=l=>U.value.remark=l),type:"textarea",rows:4,placeholder:"请输入备注内容",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),e[41]||(e[41]=c("div",{style:{"margin-top":"10px","text-align":"right"}},"添加的备注将显示在日志列表里",-1))]),_:1,__:[41]},8,["modelValue"]),t(le,{modelValue:P.value,"onUpdate:modelValue":e[6]||(e[6]=l=>P.value=l),title:"前置款信息",width:"600px","close-on-click-modal":!1},{footer:a(()=>[c("span",ha,[t(r,{onClick:e[5]||(e[5]=l=>P.value=!1)},{default:a(()=>e[42]||(e[42]=[i("关闭")])),_:1,__:[42]}),t(r,{type:"primary",onClick:Ge},{default:a(()=>e[43]||(e[43]=[i("复制信息")])),_:1,__:[43]})])]),default:a(()=>[fe((v(),h("div",va,[p.value.batch_no?(v(),$(x,{key:0,column:1,border:"",size:"small"},{default:a(()=>[t(u,{label:"批次号"},{default:a(()=>[c("span",null,o(p.value.batch_no),1)]),_:1}),t(u,{label:"借款人"},{default:a(()=>[c("span",null,o(p.value.borrower),1)]),_:1}),t(u,{label:"车辆信息"},{default:a(()=>[c("span",null,o(p.value.vehicle_info),1)]),_:1}),t(u,{label:"总保费"},{default:a(()=>[c("span",null,o(_(f)(p.value.total_premium)),1)]),_:1}),p.value.repay_type==="利息前置"?(v(),$(u,{key:0,label:"总利息"},{default:a(()=>[c("span",null,o(_(f)(p.value.total_interest)),1)]),_:1})):k("",!0)]),_:1})):k("",!0),p.value.service_fee?(v(),h("div",fa,[t(x,{column:1,border:"",size:"small"},{default:a(()=>[t(u,{label:"服务费"},{default:a(()=>[c("span",null,o(_(f)(p.value.service_fee)),1)]),_:1}),p.value.repay_type==="利息前置"?(v(),$(u,{key:0,label:"支付总服务费"},{default:a(()=>[c("span",null,o(_(f)(p.value.total_service_fee))+" (服务费+总利息)",1)]),_:1})):k("",!0),t(u,{label:"收款户名"},{default:a(()=>[c("span",null,o(p.value.service_account_name),1)]),_:1}),t(u,{label:"收款账户"},{default:a(()=>[c("span",null,o(p.value.service_account_no),1)]),_:1}),t(u,{label:"开户行"},{default:a(()=>[c("span",null,o(p.value.service_bank_name),1)]),_:1})]),_:1})])):k("",!0),p.value.total_down_payment?(v(),h("div",ya,[t(x,{column:1,border:"",size:"small"},{default:a(()=>[t(u,{label:"支付首付款"},{default:a(()=>[c("span",null,o(_(f)(p.value.total_down_payment)),1)]),_:1}),t(u,{label:"明细"},{default:a(()=>[c("span",null,o(p.value.down_payment_detail),1)]),_:1}),t(u,{label:"收款户名"},{default:a(()=>[c("span",null,o(p.value.funder_account_name),1)]),_:1}),t(u,{label:"收款账户"},{default:a(()=>[c("span",null,o(p.value.funder_account_no),1)]),_:1}),t(u,{label:"开户行"},{default:a(()=>[c("span",null,o(p.value.funder_bank_name),1)]),_:1})]),_:1})])):k("",!0),p.value.remark?(v(),h("div",ga,[c("div",ba,o(p.value.remark),1)])):k("",!0)])),[[ne,O.value]])]),_:1},8,["modelValue"]),t(X,{visible:L.value,"onUpdate:visible":e[7]||(e[7]=l=>L.value=l),title:"订单附件",attachments:n.value.attachments||[],"order-id":n.value.id,"ref-id":0,type:"order",onRefresh:I,onDelete:Ve,"allow-delete":!0},null,8,["visible","attachments","order-id"]),t(Y,{visible:q.value,"onUpdate:visible":e[8]||(e[8]=l=>q.value=l),title:"上传订单附件","order-id":n.value.id,"ref-id":0,type:"order",onSuccess:j},null,8,["visible","order-id"]),t(X,{visible:G.value,"onUpdate:visible":e[9]||(e[9]=l=>G.value=l),title:`车险附件 - ${((se=C.value)==null?void 0:se.car_no)||""}`,attachments:((oe=C.value)==null?void 0:oe.attachments)||[],"order-id":n.value.id,"ref-id":((re=C.value)==null?void 0:re.id)||0,type:"car","allow-delete":!1},null,8,["visible","title","attachments","order-id","ref-id"]),t(Y,{visible:H.value,"onUpdate:visible":e[10]||(e[10]=l=>H.value=l),title:`上传车险附件 - ${((ie=C.value)==null?void 0:ie.car_no)||""}`,"order-id":n.value.id,"ref-id":((ue=C.value)==null?void 0:ue.id)||0,type:"car",onSuccess:j},null,8,["visible","title","order-id","ref-id"]),t(X,{visible:J.value,"onUpdate:visible":e[11]||(e[11]=l=>J.value=l),title:`货运险附件 - ${((de=C.value)==null?void 0:de.track_no)||""}`,attachments:((ce=C.value)==null?void 0:ce.attachments)||[],"order-id":n.value.id,"ref-id":((_e=C.value)==null?void 0:_e.id)||0,type:"cargo","allow-delete":!1},null,8,["visible","title","attachments","order-id","ref-id"]),t(Y,{visible:K.value,"onUpdate:visible":e[12]||(e[12]=l=>K.value=l),title:`上传货运险附件 - ${((me=C.value)==null?void 0:me.track_no)||""}`,"order-id":n.value.id,"ref-id":((pe=C.value)==null?void 0:pe.id)||0,type:"cargo",onSuccess:j},null,8,["visible","title","order-id","ref-id"])])}}},Fa=Ye(wa,[["__scopeId","data-v-aae2b138"]]);export{Fa as default};
