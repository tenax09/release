import{_ as ma,b as pa,u as _a,a as va}from"./index-823243b1.js";/* empty css               *//* empty css                       *//* empty css                     *//* empty css                  *//* empty css                        *//* empty css                        *//* empty css               *//* empty css                *//* empty css                             *//* empty css                   *//* empty css                       */import{f as S,a as y}from"./format-20468769.js";import{a as fa,r as ya,b as ga,d as ba}from"./order-885ca52d.js";import{A as G,a as J,u as ha}from"./AttachmentUpload-abaa4a43.js";import{m as wa}from"./receivable-0fb2f396.js";import{c as ka}from"./received-e3c82e30.js";import{r as b,ae as Ca,l as g,B as V,C as m,F as a,G as l,p as A,S as $,E as h,aE as Va,ag as $a,ah as xa,M as Aa,u as p,O as u,af as Re,D as s,ac as Ma,av as Ea,aF as Ua,J as ce,K as Da,az as Sa,am as Pa,aA as Ra,ao as Na,al as Ia,an as Ta,a5 as Ba,a6 as za,aG as Ya,ax as Fa,ay as Oa,aH as qa,a7 as Ha,ai as La}from"./element-plus-8eb596e2.js";import{L as Ga}from"./LogList-01f5b3f9.js";/* empty css                 *//* empty css                    *//* empty css                      *//* empty css                         */import"./log-d12b6c5f.js";const Ja={class:"order-detail"},Ka={class:"page-header"},Qa={class:"header-actions"},ja={class:"overview-section"},Wa={class:"key-metrics"},Xa={class:"metric-item"},Za={class:"metric-value"},et={class:"metric-item"},at={class:"metric-value"},tt={class:"metric-item"},lt={class:"metric-value"},nt={class:"metric-item"},ot={class:"metric-value"},rt={class:"metric-item"},st={class:"metric-value"},ut={key:0,class:"empty-state"},it={key:0,class:"empty-state"},dt={style:{color:"#67c23a","font-weight":"bold"}},ct={style:{color:"#e6a23c","font-weight":"bold"}},mt={style:{color:"#409eff"}},pt={style:{color:"#67c23a"}},_t={key:0,style:{color:"#67c23a","font-weight":"bold"}},vt={key:1},ft={key:0,style:{color:"#f56c6c"}},yt={key:1},gt={key:0,style:{color:"#f56c6c"}},bt={key:1},ht={key:0,style:{color:"#f56c6c","font-weight":"bold"}},wt={key:1},kt={key:1,style:{color:"#67c23a"}},Ct={class:"payment-info"},Vt={key:1,class:"payment-section"},$t={key:2,class:"payment-section"},xt={key:3,class:"payment-section"},At={class:"remark-content"},Mt={class:"dialog-footer"},Et={class:"dialog-footer"},Ut={class:"dialog-footer"},Dt={__name:"detail",setup(St){const me=pa(),pe=_a(),P=b(!1),n=b({}),R=va(),B=b(!1),K=b(null),Q=b(!1),w=b({rec_type:"",amount:0,method:"",date_time:"",remark:""}),z=b(!1),j=b(null),W=b(!1),F=b(null),E=b({actual_amount:0,method:"",actual_date:""}),O=b(!1),X=b(!1),_=b({}),Z=b(!1),ee=b(!1),ae=b(!1),te=b(!1),le=b(!1),ne=b(!1),oe=b(!1),re=b(!1),M=b(null),I=b(null),Ne={rec_type:[{required:!0,message:"请选择收款类型",trigger:"change"}],amount:[{required:!0,message:"请输入还款金额",trigger:"blur"},{type:"number",min:.01,message:"金额必须大于0",trigger:"blur"}],method:[{required:!0,message:"请选择还款方式",trigger:"change"}],date_time:[{required:!0,message:"请选择还款时间",trigger:"change"}]},Ie={actual_amount:[{required:!0,message:"请输入实际收款金额",trigger:"blur"},{type:"number",min:.01,message:"金额必须大于0",trigger:"blur"}],method:[{required:!0,message:"请选择收款方式",trigger:"change"}],actual_date:[{required:!0,message:"请选择收款日期",trigger:"change"}]},N=async()=>{P.value=!0;try{const o=await fa(me.params.id);n.value=o.data,n.value.total_commercial=0,n.value.insurance_type==="车险"&&n.value.car_insurance&&n.value.car_insurance.length>0?n.value.total_commercial=n.value.car_insurance.reduce((e,r)=>e+(r.commercial_amount||0),0):n.value.insurance_type==="货运险"&&n.value.cargo_insurance&&n.value.cargo_insurance.length>0&&(n.value.total_commercial=n.value.cargo_insurance.reduce((e,r)=>e+(r.commercial_amount||0),0))}catch{h.error("获取订单详情失败")}P.value=!1},Te=()=>{pe.back()},q=async()=>{try{let o="",e="下一状态";n.value.status==="待初审"?(o="初审通过",e="待复审"):n.value.status==="待复审"&&(o="复审通过",e="待客户签约"),await ce.confirm(`确定要将订单状态从 [${n.value.status}] 更新为 [${e}] 吗？`,"审核确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),P.value=!0,await ya(n.value.id,{audit_note:o}),h.success("审核成功"),N()}catch(o){o!=="cancel"&&h.error("审核失败")}P.value=!1},Be=o=>{const{columns:e,data:r}=o,c=[];return e.forEach((i,f)=>{if(f===0){c[f]="合计";return}if(i.property==="total_amount"){const v=r.reduce((C,x)=>C+(x.commercial_amount||0)+(x.compulsory_amount||0)+(x.vehicle_tax_amount||0),0);c[f]=y(v);return}const k=r.map(v=>Number(v[i.property]));if(k.every(v=>isNaN(v)))c[f]="-";else{const v=k.reduce((C,x)=>{const d=Number(x);return isNaN(d)?C:C+d},0);i.property==="commercial_amount"||i.property==="compulsory_amount"||i.property==="vehicle_tax_amount"?c[f]=y(v):c[f]="-"}}),c},ze=o=>{const{columns:e,data:r}=o,c=[];return e.forEach((i,f)=>{if(f===0){c[f]="合计";return}const k=r.map(v=>Number(v[i.property]));if(k.every(v=>isNaN(v)))c[f]="-";else{const v=k.reduce((C,x)=>{const d=Number(x);return isNaN(d)?C:C+d},0);i.property==="commercial_amount"?c[f]=y(v):c[f]="-"}}),c},_e=o=>({正常:"success",结清退保:"success",逾期退保:"danger",提前结清:"success",逾期结清:"danger",退保结清:"danger"})[o]||"info",Ye=o=>({待审核:"warning",待复审:"warning",待客户签约:"info",待资方签约:"info",待放款:"warning",已放款:"success",已退保:"danger",已结清:"success",已作废:"danger"})[o]||"info",se=()=>{pe.push(`/order/insurance/${n.value.id}`)},Fe=(o,e)=>{if(!n.value.attachments||n.value.attachments.length===0){h.warning("暂无附件可查看");return}const r=o.find(c=>c.remark===e);if(!r){h.warning("暂无附件可查看");return}window.open(`/api/admin/attachments/${r.id}/view`)},Oe=()=>{ue(n.value.attachments,"缴费通知书")?Fe(n.value.attachments,"缴费通知书"):qe("缴费通知书")},qe=o=>{const e=document.createElement("input");e.type="file",e.accept="*/*",e.style.display="none",e.onchange=async r=>{const c=r.target.files[0];if(c){try{const i=new FormData;i.append("files",c),i.append("remarks",o),await ha(n.value.id,0,i),h.success("上传成功"),N()}catch(i){console.error("上传失败:",i),h.error("上传失败")}document.body.removeChild(e)}},document.body.appendChild(e),e.click()},He=()=>{Z.value=!0},Le=()=>{ee.value=!0},H=()=>{h.success("附件上传成功"),N()},Ge=o=>{M.value=o,ae.value=!0},Je=o=>{M.value=o,te.value=!0},Ke=o=>{M.value=o,le.value=!0},Qe=o=>{M.value=o,ne.value=!0},je=async()=>{try{await ce.confirm("确定要作废该订单吗？作废后不可恢复！","作废确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),P.value=!0,await ga(n.value.id),h.success("订单已作废"),N()}catch(o){o!=="cancel"&&h.error("作废失败")}P.value=!1},ve=(o,e)=>{if(!o){h.warning(`${e}链接不存在`);return}try{if(typeof window<"u"&&window.open)window.open(o,"_blank","noopener,noreferrer");else throw new Error("window.open不可用")}catch(r){console.error(`${e}失败:`,r);try{const c=document.createElement("a");c.href=o,c.target="_blank",c.rel="noopener noreferrer",c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c),h.success(`${e}链接已打开`)}catch(c){console.error("备选方案失败:",c)}}},We=o=>{if(!o){h.warning("签署链接不存在");return}fe(o,"签署链接")},fe=(o,e)=>{const r=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);navigator.clipboard&&(window.isSecureContext||r)?navigator.clipboard.writeText(o).then(()=>{h.success(`${e}已复制到剪贴板`)}).catch(c=>{console.error("使用 Clipboard API 复制失败:",c),ye(o,e)}):ye(o,e)},ye=(o,e)=>{try{const r=document.createElement("textarea");r.value=o,r.style.position="fixed",r.style.left="-999999px",r.style.top="-999999px",document.body.appendChild(r),r.focus(),r.select();const c=document.execCommand("copy");if(document.body.removeChild(r),c)h.success(`${e}已复制到剪贴板`);else throw new Error("execCommand 复制失败")}catch(r){console.error("复制失败:",r),ce.alert(o,`请手动复制${e}`,{confirmButtonText:"确定",type:"info",customClass:"copy-url-dialog"})}},Xe=o=>({已签署:"success",未签署:"warning",已作废:"danger"})[o]||"info",Ze=o=>({还款:"success",本金:"primary",利息:"info",退保:"danger",违约金:"warning",滞纳金:"warning"})[o]||"info",ea=o=>({微信:"success",支付宝:"primary",银行卡:"warning"})[o]||"info",aa=o=>({待收款:"warning",已收款:"success",已逾期:"danger"})[o]||"info",ta=()=>{w.value={rec_type:"",amount:0,method:"",date_time:new Date().toISOString().slice(0,19).replace("T"," "),remark:""},B.value=!0},la=async()=>{K.value&&await K.value.validate(async o=>{if(o){Q.value=!0;try{const e={rec_type:w.value.rec_type,user_id:n.value.user_id,order_id:n.value.id,order_no:n.value.order_no,amount:w.value.amount,method:w.value.method,date_time:w.value.date_time,remark:w.value.remark||w.value.rec_type};await ka(e),h.success("提前还款记录创建成功"),B.value=!1,N()}catch(e){h.error("创建提前还款记录失败："+(e.message||"未知错误"))}Q.value=!1}})},na=o=>{F.value=o,E.value={actual_amount:o.amount,method:"微信",actual_date:new Date().toISOString().split("T")[0]},z.value=!0},oa=async()=>{j.value&&await j.value.validate(async o=>{if(o){W.value=!0;try{await wa(F.value.id,{actual_amount:E.value.actual_amount,actual_date:E.value.actual_date,method:E.value.method}),h.success("标记收款成功"),z.value=!1,N()}catch(e){h.error("标记收款失败："+(e.message||"未知错误"))}W.value=!1}})},ra=o=>{I.value=o,oe.value=!0},sa=o=>{I.value=o,re.value=!0},ua=async()=>{if(!n.value.id){h.warning("订单信息不存在");return}X.value=!0;try{const o=await ba(n.value.id);_.value=o.data,O.value=!0,h.success("前置款信息生成成功")}catch(o){h.error("生成前置款信息失败："+(o.message||"未知错误"))}X.value=!1},ia=()=>{if(!_.value.batch_no){h.warning("暂无前置款信息可复制");return}const o=`
批次号：${_.value.batch_no}
借款人：${_.value.borrower}
${_.value.vehicle_info}
总放款金额：${y(_.value.total_loan_amount)}

支付服务费：${y(_.value.service_fee)}
户名：${_.value.service_account_name}
账户：${_.value.service_account_no}
开户行：${_.value.service_bank_name}

支付首付款：${y(_.value.total_down_payment)}
${_.value.down_payment_detail}
户名：${_.value.funder_account_name}
账户：${_.value.funder_account_no}
开户行：${_.value.funder_bank_name}

${_.value.remark||""}
  `.trim();fe(o,"前置款信息")},da=o=>{const{columns:e,data:r}=o,c=[];return e.forEach((i,f)=>{if(f===0){c[f]="合计";return}const k=r.map(v=>Number(v[i.property]));if(k.every(v=>isNaN(v)))c[f]="-";else{const v=k.reduce((C,x)=>{const d=Number(x);return isNaN(d)?C:C+d},0);i.property==="amount"||i.property==="principal_amount"||i.property==="interest_amount"||i.property==="penalty_amount"||i.property==="forfeit_amount"||i.property==="actual_amount"?c[f]=y(v):c[f]="-"}}),c},ca=o=>{const{columns:e,data:r}=o,c=[];return e.forEach((i,f)=>{if(f===0){c[f]="合计";return}const k=r.map(v=>Number(v[i.property]));if(k.every(v=>isNaN(v)))c[f]="-";else{const v=k.reduce((C,x)=>{const d=Number(x);return isNaN(d)?C:C+d},0);i.property==="amount"?c[f]=y(v):c[f]="-"}}),c},ue=(o,e)=>!o||o.length===0?!1:o.some(r=>r.remark===e);return Ca(()=>{N()}),(o,e)=>{var ke,Ce,Ve,$e,xe,Ae,Me,Ee,Ue,De,Se,Pe;const r=Da,c=Va,i=Sa,f=Pa,k=Ra,v=$a,C=Na,x=xa,d=Ia,Y=Ta,ie=Aa,L=Ba,U=za,ge=Ya,D=Fa,de=Oa,be=qa,he=Ha,we=La;return g(),V("div",Ja,[m("div",Ka,[a(c,{onBack:Te,title:n.value.order_no||"订单详情"},{extra:l(()=>[m("div",Qa,[n.value.status==="待初审"&&p(R).riskBasicPrivate?(g(),A(r,{key:0,type:"success",onClick:q},{default:l(()=>e[24]||(e[24]=[u("初审通过")])),_:1,__:[24]})):$("",!0),n.value.status==="待复审"&&p(R).riskManagerPrivate?(g(),A(r,{key:1,type:"warning",onClick:q},{default:l(()=>e[25]||(e[25]=[u("复审通过")])),_:1,__:[25]})):$("",!0),n.value.status==="待放款"&&p(R).operationManagerPrivate?(g(),A(r,{key:2,type:"info",onClick:q},{default:l(()=>e[26]||(e[26]=[u("放款")])),_:1,__:[26]})):$("",!0),n.value.status==="已放款"&&p(R).operationManagerPrivate?(g(),A(r,{key:3,type:"success",onClick:ta},{default:l(()=>e[27]||(e[27]=[u("提前还款")])),_:1,__:[27]})):$("",!0),n.value.status!=="已作废"&&(p(R).operationManagerPrivate||p(R).riskManagerPrivate)?(g(),A(r,{key:4,type:"danger",onClick:je},{default:l(()=>e[28]||(e[28]=[u("作废订单")])),_:1,__:[28]})):$("",!0),p(R).superPrivate?(g(),A(r,{key:5,type:"primary",onClick:q},{default:l(()=>e[29]||(e[29]=[u("下一状态（调试用）")])),_:1,__:[29]})):$("",!0),a(r,{type:"default",onClick:se},{default:l(()=>e[30]||(e[30]=[u("管理投保单")])),_:1,__:[30]}),a(r,{type:"default",onClick:ua},{default:l(()=>e[31]||(e[31]=[u("生成前置款")])),_:1,__:[31]}),a(r,{type:"default",onClick:e[0]||(e[0]=t=>He())},{default:l(()=>e[32]||(e[32]=[u("查看附件")])),_:1,__:[32]}),a(r,{type:"default",onClick:e[1]||(e[1]=t=>Le())},{default:l(()=>e[33]||(e[33]=[u("上传附件")])),_:1,__:[33]})])]),_:1},8,["title"])]),m("div",ja,[a(x,{gutter:20},{default:l(()=>[a(C,{span:18},{default:l(()=>[Re((g(),A(v,{class:"info-card"},{default:l(()=>[a(k,{column:2,border:""},{default:l(()=>[a(i,{label:"订单编号"},{default:l(()=>[u(s(n.value.order_no),1)]),_:1}),a(i,{label:"订单状态"},{default:l(()=>[a(f,{type:Ye(n.value.status)},{default:l(()=>[u(s(n.value.status),1)]),_:1},8,["type"]),e[34]||(e[34]=m("span",{style:{"margin-left":"10px"}},null,-1)),a(f,{style:{cursor:"pointer"},onClick:Oe,type:ue(n.value.attachments,"缴费通知书")?"success":"info"},{default:l(()=>[u(s(ue(n.value.attachments,"缴费通知书")?"缴费通知书已上传":"缴费通知书未上传"),1)]),_:1},8,["type"])]),_:1,__:[34]}),a(i,{label:"保险类型"},{default:l(()=>[u(s(n.value.insurance_type),1)]),_:1}),a(i,{label:"借款主体"},{default:l(()=>{var t;return[u(s(n.value.loan_name||((t=n.value.user)==null?void 0:t.company_name)),1)]}),_:1}),a(i,{label:"业务归属"},{default:l(()=>{var t;return[u(s(n.value.sell_mode==="直销"?"直销":((t=n.value.agent)==null?void 0:t.company_name)||"无"),1)]}),_:1}),a(i,{label:"销售员"},{default:l(()=>[u(s(n.value.seller),1)]),_:1}),a(i,{label:"服务费"},{default:l(()=>[u(s(n.value.service_fee)+"%",1)]),_:1}),a(i,{label:"渠道成本"},{default:l(()=>[u(s(n.value.agent_cost)+"%",1)]),_:1}),a(i,{span:2,label:"金融产品"},{default:l(()=>{var t;return[u(s((t=n.value.product)==null?void 0:t.name),1)]}),_:1}),a(i,{label:"承保机构",span:2},{default:l(()=>{var t;return[u(s((t=n.value.insurer)==null?void 0:t.name),1)]}),_:1})]),_:1}),a(k,{column:2,border:""},{default:l(()=>[a(i,{label:"进件时间"},{default:l(()=>[u(s(p(S)(n.value.created_at)),1)]),_:1}),a(i,{label:"初审时间"},{default:l(()=>[u(s(p(S)(n.value.first_review_time)||"-"),1)]),_:1}),a(i,{label:"复审时间"},{default:l(()=>[u(s(p(S)(n.value.second_review_time)||"-"),1)]),_:1}),a(i,{label:"用户签约时间"},{default:l(()=>[u(s(p(S)(n.value.user_sign_time)||"-"),1)]),_:1}),a(i,{label:"资方签约时间"},{default:l(()=>[u(s(p(S)(n.value.funder_sign_time)||"-"),1)]),_:1}),a(i,{label:"放款时间"},{default:l(()=>[u(s(p(S)(n.value.loan_time)||"-"),1)]),_:1}),a(i,{label:"最后更新时间"},{default:l(()=>[u(s(p(S)(n.value.updated_at)),1)]),_:1})]),_:1})]),_:1})),[[we,P.value]])]),_:1}),a(C,{span:6},{default:l(()=>[a(v,{class:"key-metrics-card"},{default:l(()=>[m("div",Wa,[m("div",Xa,[e[35]||(e[35]=m("div",{class:"metric-label"},"总保费",-1)),m("div",Za,s(p(y)(n.value.total_premium)),1)]),m("div",et,[e[36]||(e[36]=m("div",{class:"metric-label"},"商业险",-1)),m("div",at,s(p(y)(n.value.total_commercial)),1)]),m("div",tt,[e[37]||(e[37]=m("div",{class:"metric-label"},"首付金额",-1)),m("div",lt,s(p(y)(n.value.down_payment)),1)]),m("div",nt,[e[38]||(e[38]=m("div",{class:"metric-label"},"贷款金额",-1)),m("div",ot,s(p(y)(n.value.loan_amount)),1)]),m("div",rt,[e[39]||(e[39]=m("div",{class:"metric-label"},"服务费",-1)),m("div",st,s(p(y)(n.value.service_fee*n.value.total_commercial/100)),1)])])]),_:1})]),_:1})]),_:1})]),n.value.insurance_type==="车险"?(g(),A(v,{key:0,class:"detail-card insurance-card"},{default:l(()=>[a(Y,{data:n.value.car_insurance||[],border:"",style:{width:"100%"},"empty-text":"暂无车险投保信息","max-height":"500","show-summary":n.value.car_insurance&&n.value.car_insurance.length>0,"sum-text":"合计","summary-method":Be},{default:l(()=>[a(d,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(({row:t})=>[a(f,{type:_e(t.status)},{default:l(()=>[u(s(t.status),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"car_no",label:"车牌号",width:"120",align:"left"}),a(d,{prop:"vin",label:"车架号",width:"180",align:"left"}),a(d,{prop:"insured",label:"被保人",width:"230",align:"left"}),a(d,{prop:"commercial_amount",label:"商业险",width:"110",align:"right"},{default:l(({row:t})=>[u(s(p(y)(t.commercial_amount)),1)]),_:1}),a(d,{prop:"compulsory_amount",label:"交强险",width:"110",align:"center"},{default:l(({row:t})=>[u(s(p(y)(t.compulsory_amount)),1)]),_:1}),a(d,{prop:"vehicle_tax_amount",label:"车船税",width:"110",align:"center"},{default:l(({row:t})=>[u(s(p(y)(t.vehicle_tax_amount)),1)]),_:1}),a(d,{prop:"total_amount",label:"总保费",width:"110",align:"center"},{default:l(({row:t})=>[u(s(p(y)((t.commercial_amount||0)+(t.compulsory_amount||0)+(t.vehicle_tax_amount||0))),1)]),_:1}),a(d,{label:"操作",width:"200",align:"center",fixed:"right"},{default:l(({row:t})=>[a(r,{type:"info",size:"small",onClick:T=>Ge(t)},{default:l(()=>e[40]||(e[40]=[u(" 查看附件 ")])),_:2,__:[40]},1032,["onClick"]),a(r,{type:"primary",size:"small",onClick:T=>Je(t)},{default:l(()=>e[41]||(e[41]=[u(" 上传附件 ")])),_:2,__:[41]},1032,["onClick"])]),_:1})]),_:1},8,["data","show-summary"]),!n.value.car_insurance||n.value.car_insurance.length===0?(g(),V("div",ut,[a(r,{type:"primary",onClick:se},{default:l(()=>e[42]||(e[42]=[u("录入车险信息")])),_:1,__:[42]})])):$("",!0)]),_:1})):$("",!0),n.value.insurance_type==="货运险"?(g(),A(v,{key:1,class:"detail-card insurance-card"},{default:l(()=>[a(Y,{data:n.value.cargo_insurance||[],border:"",style:{width:"100%"},"empty-text":"暂无货运险投保信息","max-height":"500","show-summary":n.value.cargo_insurance&&n.value.cargo_insurance.length>0,"sum-text":"合计","summary-method":ze},{default:l(()=>[a(d,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(({row:t})=>[a(f,{type:_e(t.status)},{default:l(()=>[u(s(t.status),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"track_no",label:"运输编号",width:"200",align:"left"}),a(d,{prop:"insured",label:"被保人",width:"170",align:"left"}),a(d,{prop:"name",label:"货物名称",width:"150",align:"left"}),a(d,{prop:"quantity",label:"货物数量",width:"120",align:"right"}),a(d,{prop:"carrier",label:"承运人",width:"130",align:"left"}),a(d,{prop:"consignee",label:"收货人",width:"130",align:"left"}),a(d,{prop:"commercial_amount",label:"保费",width:"140",align:"center"},{default:l(({row:t})=>[u(s(p(y)(t.commercial_amount)),1)]),_:1}),a(d,{label:"操作",width:"200",align:"center",fixed:"right"},{default:l(({row:t})=>[a(r,{type:"info",size:"small",onClick:T=>Ke(t)},{default:l(()=>e[43]||(e[43]=[u(" 查看附件 ")])),_:2,__:[43]},1032,["onClick"]),a(r,{type:"primary",size:"small",onClick:T=>Qe(t)},{default:l(()=>e[44]||(e[44]=[u(" 上传附件 ")])),_:2,__:[44]},1032,["onClick"])]),_:1})]),_:1},8,["data","show-summary"]),!n.value.cargo_insurance||n.value.cargo_insurance.length===0?(g(),V("div",it,[a(r,{type:"primary",onClick:se},{default:l(()=>e[45]||(e[45]=[u("录入货运险信息")])),_:1,__:[45]})])):$("",!0)]),_:1})):$("",!0),a(v,{class:"detail-card"},{default:l(()=>[a(Y,{data:n.value.contacts||[],border:"",style:{width:"100%"},"empty-text":"暂无合同信息","max-height":"300"},{default:l(()=>[a(d,{prop:"contact_id",label:"合同编号",width:"250"}),a(d,{prop:"sign_status",label:"签署状态",width:"120",align:"center"},{default:l(({row:t})=>[a(f,{type:Xe(t.sign_status)},{default:l(()=>[u(s(t.sign_status),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"sign_time",label:"签署时间",width:"170",align:"center"},{default:l(({row:t})=>[u(s(t.sign_time||"-"),1)]),_:1}),a(d,{prop:"created_at",label:"创建时间",width:"170",align:"center"},{default:l(({row:t})=>[u(s(p(S)(t.created_at)),1)]),_:1}),a(d,{label:"操作",width:"300",align:"center",fixed:"right"},{default:l(({row:t})=>[a(r,{type:"primary",size:"small",icon:p(Ma),onClick:()=>ve(t.view_pdf_url,"查看PDF"),disabled:!t.view_pdf_url},{default:l(()=>e[46]||(e[46]=[u(" 查看 ")])),_:2,__:[46]},1032,["icon","onClick","disabled"]),a(r,{type:"success",size:"small",icon:p(Ea),onClick:()=>ve(t.download_url,"下载PDF"),disabled:!t.download_url},{default:l(()=>e[47]||(e[47]=[u(" 下载 ")])),_:2,__:[47]},1032,["icon","onClick","disabled"]),a(r,{type:"info",size:"small",icon:p(Ua),onClick:()=>We(t.sign_url),disabled:!t.sign_url},{default:l(()=>e[48]||(e[48]=[u(" 签署链接 ")])),_:2,__:[48]},1032,["icon","onClick","disabled"])]),_:1})]),_:1},8,["data"])]),_:1}),a(v,{class:"detail-card"},{default:l(()=>[a(Y,{data:n.value.receiveds||[],border:"",style:{width:"100%"},"empty-text":"暂无收款记录","max-height":"500","show-summary":n.value.receiveds&&n.value.receiveds.length>0,"sum-text":"合计","summary-method":ca},{default:l(()=>[a(d,{prop:"trans_no",label:"收款流水号",width:"200"}),a(d,{prop:"rec_type",label:"收款类型",width:"80",align:"center"},{default:l(({row:t})=>[a(f,{type:Ze(t.rec_type)},{default:l(()=>[u(s(t.rec_type),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"amount",label:"收款金额",width:"100",align:"center"},{default:l(({row:t})=>[m("span",dt,s(p(y)(t.amount)),1)]),_:1}),a(d,{prop:"method",label:"收款方式",width:"80",align:"center"},{default:l(({row:t})=>[a(f,{type:ea(t.method),size:"small"},{default:l(()=>[u(s(t.method),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"date_time",label:"收款时间",width:"150",align:"center"}),a(d,{prop:"created_at",label:"录入时间",width:"150",align:"center"},{default:l(({row:t})=>[u(s(p(S)(t.created_at)),1)]),_:1}),a(d,{prop:"remark",label:"备注","min-width":"80"},{default:l(({row:t})=>[u(s(t.remark||"-"),1)]),_:1}),a(d,{label:"操作",width:"200",align:"center",fixed:"right"},{default:l(({row:t})=>[a(r,{type:"info",size:"small",onClick:T=>ra(t)},{default:l(()=>e[49]||(e[49]=[u(" 查看附件 ")])),_:2,__:[49]},1032,["onClick"]),a(r,{type:"primary",size:"small",onClick:T=>sa(t)},{default:l(()=>e[50]||(e[50]=[u(" 上传附件 ")])),_:2,__:[50]},1032,["onClick"])]),_:1})]),_:1},8,["data","show-summary"])]),_:1}),a(v,{class:"detail-card"},{default:l(()=>[a(Y,{data:n.value.receivables||[],border:"",style:{width:"100%"},"empty-text":"暂无还款计划","show-summary":n.value.receivables&&n.value.receivables.length>0,"sum-text":"合计","summary-method":da},{default:l(()=>[a(d,{prop:"period",label:"期数",width:"80",align:"center"}),a(d,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(({row:t})=>[a(f,{type:aa(t.status)},{default:l(()=>[u(s(t.status),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"date",label:"应还日期",width:"120",align:"center"}),a(d,{prop:"amount",label:"应还金额",width:"120",align:"right"},{default:l(({row:t})=>[m("span",ct,s(p(y)(t.amount)),1)]),_:1}),a(d,{prop:"principal_amount",label:"本金",width:"120",align:"right"},{default:l(({row:t})=>[m("span",mt,s(p(y)(t.principal_amount)),1)]),_:1}),a(d,{prop:"interest_amount",label:"利息",width:"120",align:"right"},{default:l(({row:t})=>[m("span",pt,s(p(y)(t.interest_amount)),1)]),_:1}),a(d,{prop:"actual_amount",label:"实际收款",width:"120",align:"right"},{default:l(({row:t})=>[t.actual_amount>0?(g(),V("span",_t,s(p(y)(t.actual_amount)),1)):(g(),V("span",vt,"-"))]),_:1}),a(d,{prop:"actual_date",label:"实际收款日期",width:"120",align:"center"},{default:l(({row:t})=>[u(s(t.actual_date||"-"),1)]),_:1}),a(d,{prop:"penalty_amount",label:"违约金",width:"100",align:"right"},{default:l(({row:t})=>[t.penalty_amount>0?(g(),V("span",ft,s(p(y)(t.penalty_amount)),1)):(g(),V("span",yt,"-"))]),_:1}),a(d,{prop:"forfeit_amount",label:"滞纳金",width:"100",align:"right"},{default:l(({row:t})=>[t.forfeit_amount>0?(g(),V("span",gt,s(p(y)(t.forfeit_amount)),1)):(g(),V("span",bt,"-"))]),_:1}),a(d,{prop:"overdue_days",label:"逾期天数",width:"100",align:"center"},{default:l(({row:t})=>[t.overdue_days>0?(g(),V("span",ht,s(t.overdue_days)+"天",1)):(g(),V("span",wt,"-"))]),_:1}),a(d,{label:"操作",width:"120",align:"center",fixed:"right"},{default:l(({row:t})=>[t.status==="待收款"||t.status==="已逾期"?(g(),A(r,{key:0,type:"primary",size:"small",onClick:T=>na(t)},{default:l(()=>e[51]||(e[51]=[u(" 标记收款 ")])),_:2,__:[51]},1032,["onClick"])):(g(),V("span",kt,"已收款"))]),_:1})]),_:1},8,["data","show-summary"])]),_:1}),a(v,{class:"detail-card"},{default:l(()=>[a(Ga,{"reference-id":p(me).params.id,"reference-type":"order","show-filter":!0,"show-pagination":!0,"page-size":20,"auto-load":!0},null,8,["reference-id"])]),_:1}),a(ie,{modelValue:O.value,"onUpdate:modelValue":e[3]||(e[3]=t=>O.value=t),title:"前置款信息",width:"600px","close-on-click-modal":!1},{footer:l(()=>[m("span",Mt,[a(r,{onClick:e[2]||(e[2]=t=>O.value=!1)},{default:l(()=>e[52]||(e[52]=[u("关闭")])),_:1,__:[52]}),a(r,{type:"primary",onClick:ia},{default:l(()=>e[53]||(e[53]=[u("复制信息")])),_:1,__:[53]})])]),default:l(()=>[Re((g(),V("div",Ct,[_.value.batch_no?(g(),A(k,{key:0,column:1,border:"",size:"small"},{default:l(()=>[a(i,{label:"批次号"},{default:l(()=>[m("span",null,s(_.value.batch_no),1)]),_:1}),a(i,{label:"借款人"},{default:l(()=>[m("span",null,s(_.value.borrower),1)]),_:1}),a(i,{label:"车辆信息"},{default:l(()=>[m("span",null,s(_.value.vehicle_info),1)]),_:1}),a(i,{label:"总保费"},{default:l(()=>[m("span",null,s(p(y)(_.value.total_premium)),1)]),_:1}),_.value.repay_type==="利息前置"?(g(),A(i,{key:0,label:"总利息"},{default:l(()=>[m("span",null,s(p(y)(_.value.total_interest)),1)]),_:1})):$("",!0)]),_:1})):$("",!0),_.value.service_fee?(g(),V("div",Vt,[a(k,{column:1,border:"",size:"small"},{default:l(()=>[a(i,{label:"服务费"},{default:l(()=>[m("span",null,s(p(y)(_.value.service_fee)),1)]),_:1}),_.value.repay_type==="利息前置"?(g(),A(i,{key:0,label:"支付总服务费"},{default:l(()=>[m("span",null,s(p(y)(_.value.total_service_fee))+" (服务费+总利息)",1)]),_:1})):$("",!0),a(i,{label:"收款户名"},{default:l(()=>[m("span",null,s(_.value.service_account_name),1)]),_:1}),a(i,{label:"收款账户"},{default:l(()=>[m("span",null,s(_.value.service_account_no),1)]),_:1}),a(i,{label:"开户行"},{default:l(()=>[m("span",null,s(_.value.service_bank_name),1)]),_:1})]),_:1})])):$("",!0),_.value.total_down_payment?(g(),V("div",$t,[a(k,{column:1,border:"",size:"small"},{default:l(()=>[a(i,{label:"支付首付款"},{default:l(()=>[m("span",null,s(p(y)(_.value.total_down_payment)),1)]),_:1}),a(i,{label:"明细"},{default:l(()=>[m("span",null,s(_.value.down_payment_detail),1)]),_:1}),a(i,{label:"收款户名"},{default:l(()=>[m("span",null,s(_.value.funder_account_name),1)]),_:1}),a(i,{label:"收款账户"},{default:l(()=>[m("span",null,s(_.value.funder_account_no),1)]),_:1}),a(i,{label:"开户行"},{default:l(()=>[m("span",null,s(_.value.funder_bank_name),1)]),_:1})]),_:1})])):$("",!0),_.value.remark?(g(),V("div",xt,[m("div",At,s(_.value.remark),1)])):$("",!0)])),[[we,X.value]])]),_:1},8,["modelValue"]),a(G,{visible:Z.value,"onUpdate:visible":e[4]||(e[4]=t=>Z.value=t),title:"订单附件","order-id":n.value.id,"ref-id":0,type:"order","allow-delete":!0},null,8,["visible","order-id"]),a(J,{visible:ee.value,"onUpdate:visible":e[5]||(e[5]=t=>ee.value=t),title:"上传订单附件","order-id":n.value.id,"ref-id":0,type:"order",onSuccess:H},null,8,["visible","order-id"]),a(G,{visible:ae.value,"onUpdate:visible":e[6]||(e[6]=t=>ae.value=t),title:`车险附件 - ${((ke=M.value)==null?void 0:ke.car_no)||""}`,"order-id":n.value.id,"ref-id":((Ce=M.value)==null?void 0:Ce.id)||0,type:"car","allow-delete":!1},null,8,["visible","title","order-id","ref-id"]),a(J,{visible:te.value,"onUpdate:visible":e[7]||(e[7]=t=>te.value=t),title:`上传车险附件 - ${((Ve=M.value)==null?void 0:Ve.car_no)||""}`,"order-id":n.value.id,"ref-id":(($e=M.value)==null?void 0:$e.id)||0,type:"car",onSuccess:H},null,8,["visible","title","order-id","ref-id"]),a(G,{visible:le.value,"onUpdate:visible":e[8]||(e[8]=t=>le.value=t),title:`货运险附件 - ${((xe=M.value)==null?void 0:xe.track_no)||""}`,"order-id":n.value.id,"ref-id":((Ae=M.value)==null?void 0:Ae.id)||0,type:"cargo","allow-delete":!1},null,8,["visible","title","order-id","ref-id"]),a(J,{visible:ne.value,"onUpdate:visible":e[9]||(e[9]=t=>ne.value=t),title:`上传货运险附件 - ${((Me=M.value)==null?void 0:Me.track_no)||""}`,"order-id":n.value.id,"ref-id":((Ee=M.value)==null?void 0:Ee.id)||0,type:"cargo",onSuccess:H},null,8,["visible","title","order-id","ref-id"]),a(G,{visible:oe.value,"onUpdate:visible":e[10]||(e[10]=t=>oe.value=t),title:`收款记录附件 - ${((Ue=I.value)==null?void 0:Ue.trans_no)||""}`,"order-id":n.value.id,"ref-id":((De=I.value)==null?void 0:De.id)||0,type:"received","allow-delete":!1},null,8,["visible","title","order-id","ref-id"]),a(J,{visible:re.value,"onUpdate:visible":e[11]||(e[11]=t=>re.value=t),title:`上传收款记录附件 - ${((Se=I.value)==null?void 0:Se.trans_no)||""}`,"order-id":n.value.id,"ref-id":((Pe=I.value)==null?void 0:Pe.id)||0,type:"received",onSuccess:H},null,8,["visible","title","order-id","ref-id"]),a(ie,{modelValue:B.value,"onUpdate:modelValue":e[18]||(e[18]=t=>B.value=t),title:"提前还款",width:"600px","close-on-click-modal":!1},{footer:l(()=>[m("span",Et,[a(r,{onClick:e[17]||(e[17]=t=>B.value=!1)},{default:l(()=>e[54]||(e[54]=[u("取消")])),_:1,__:[54]}),a(r,{type:"primary",onClick:la,loading:Q.value},{default:l(()=>e[55]||(e[55]=[u(" 确定 ")])),_:1,__:[55]},8,["loading"])])]),default:l(()=>[a(he,{ref_key:"advanceRepaymentFormRef",ref:K,model:w.value,rules:Ne,"label-width":"120px"},{default:l(()=>[a(U,{label:"订单信息"},{default:l(()=>{var t;return[a(L,{value:`${n.value.order_no} - ${n.value.loan_name||((t=n.value.user)==null?void 0:t.company_name)}`,disabled:""},null,8,["value"])]}),_:1}),a(U,{label:"金额",prop:"amount"},{default:l(()=>[a(ge,{modelValue:w.value.amount,"onUpdate:modelValue":e[12]||(e[12]=t=>w.value.amount=t),min:.01,precision:2,step:100,style:{width:"100%"},placeholder:"请输入金额"},null,8,["modelValue"])]),_:1}),a(U,{label:"收款类型",prop:"rec_type"},{default:l(()=>[a(de,{modelValue:w.value.rec_type,"onUpdate:modelValue":e[13]||(e[13]=t=>w.value.rec_type=t),placeholder:"请选择收款类型",style:{width:"100%"},filterable:"","allow-create":"","default-first-option":""},{default:l(()=>[a(D,{label:"本金",value:"本金"}),a(D,{label:"利息",value:"利息"}),a(D,{label:"退保",value:"退保"}),a(D,{label:"违约金",value:"违约金"}),a(D,{label:"滞纳金",value:"滞纳金"})]),_:1},8,["modelValue"])]),_:1}),a(U,{label:"支付方式",prop:"method"},{default:l(()=>[a(de,{modelValue:w.value.method,"onUpdate:modelValue":e[14]||(e[14]=t=>w.value.method=t),placeholder:"请选择支付方式",style:{width:"100%"}},{default:l(()=>[a(D,{label:"微信",value:"微信"}),a(D,{label:"支付宝",value:"支付宝"}),a(D,{label:"银行卡",value:"银行卡"})]),_:1},8,["modelValue"])]),_:1}),a(U,{label:"支付时间",prop:"date_time"},{default:l(()=>[a(be,{modelValue:w.value.date_time,"onUpdate:modelValue":e[15]||(e[15]=t=>w.value.date_time=t),type:"datetime",placeholder:"选择支付时间",style:{width:"100%"},format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),a(U,{label:"备注",prop:"remark"},{default:l(()=>[a(L,{modelValue:w.value.remark,"onUpdate:modelValue":e[16]||(e[16]=t=>w.value.remark=t),type:"textarea",rows:3,placeholder:"请输入备注信息（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(ie,{modelValue:z.value,"onUpdate:modelValue":e[23]||(e[23]=t=>z.value=t),title:"标记收款",width:"500px","close-on-click-modal":!1},{footer:l(()=>[m("span",Ut,[a(r,{onClick:e[22]||(e[22]=t=>z.value=!1)},{default:l(()=>e[56]||(e[56]=[u("取消")])),_:1,__:[56]}),a(r,{type:"primary",onClick:oa,loading:W.value},{default:l(()=>e[57]||(e[57]=[u(" 确定 ")])),_:1,__:[57]},8,["loading"])])]),default:l(()=>[a(he,{ref_key:"markAsPaidFormRef",ref:j,model:E.value,rules:Ie,"label-width":"120px"},{default:l(()=>[a(U,{label:"期数"},{default:l(()=>{var t;return[a(L,{value:`第${(t=F.value)==null?void 0:t.period}期`,disabled:""},null,8,["value"])]}),_:1}),a(U,{label:"应还金额"},{default:l(()=>{var t;return[a(L,{value:p(y)((t=F.value)==null?void 0:t.amount),disabled:""},null,8,["value"])]}),_:1}),a(U,{label:"实际收款金额",prop:"actual_amount"},{default:l(()=>[a(ge,{modelValue:E.value.actual_amount,"onUpdate:modelValue":e[19]||(e[19]=t=>E.value.actual_amount=t),min:0,precision:2,step:100,style:{width:"100%"},placeholder:"请输入实际收款金额"},null,8,["modelValue"])]),_:1}),a(U,{label:"收款方式",prop:"method"},{default:l(()=>[a(de,{modelValue:E.value.method,"onUpdate:modelValue":e[20]||(e[20]=t=>E.value.method=t),placeholder:"请选择收款方式",style:{width:"100%"}},{default:l(()=>[a(D,{label:"微信",value:"微信"}),a(D,{label:"支付宝",value:"支付宝"}),a(D,{label:"银行卡",value:"银行卡"})]),_:1},8,["modelValue"])]),_:1}),a(U,{label:"实际收款日期",prop:"actual_date"},{default:l(()=>[a(be,{modelValue:E.value.actual_date,"onUpdate:modelValue":e[21]||(e[21]=t=>E.value.actual_date=t),type:"date",placeholder:"选择收款日期",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ll=ma(Dt,[["__scopeId","data-v-31f35017"]]);export{ll as default};
