import{r as B,_ as Y}from"./index-823243b1.js";/* empty css               *//* empty css                      *//* empty css                  *//* empty css                     *//* empty css                        */import{r as m,b as M,ae as Z,l as g,B as V,F as t,G as a,C as v,a1 as ee,af as te,p as ae,E as k,a5 as le,ay as se,K as oe,M as ne,an as re,aK as pe,ai as ie,O as r,D as y,S as ue,u as h,aV as de,aL as me,aM as ce,aW as _e,as as fe,H as ge,I as ve,a6 as ye,ax as he,a7 as be,a2 as we,al as Se,am as Ve}from"./element-plus-8eb596e2.js";function xe(b){return B({url:"/api/admin/sms/send",method:"post",data:b})}function Ce(b){return B({url:"/api/admin/sms/logs",method:"get",params:b})}const Ee={class:"sms-container"},ze={class:"form-tip"},Me={key:0,class:"phone-count"},ke={class:"dialog-footer"},Fe={class:"filter-container"},De={class:"pagination"},Ie={__name:"index",setup(b){const c=m(),x=m(!1),C=m(!1),w=m(""),F=m([]),_=m(!1),n=M({phones:[],content:"",sms_type:"1"}),N={phones:[{required:!0,message:"请输入手机号",trigger:"blur"}],content:[{required:!0,message:"请输入短信内容",trigger:"blur"}],sms_type:[{required:!0,message:"请选择短信类型",trigger:"change"}]},p=M({phone:"",success:""}),o=M({page:1,pageSize:20,total:0}),q=()=>{const s=w.value.split(`
`).map(e=>e.trim()).filter(e=>e&&/^1[3-9]\d{9}$/.test(e));n.phones=s},K=()=>{_.value=!0,D()},R=async()=>{if(c.value)try{await c.value.validate(),C.value=!0;const s=await xe(n);k.success("短信发送成功"),_.value=!1,i()}catch(s){k.error(s.message||"发送失败")}finally{C.value=!1}},D=()=>{c.value&&c.value.resetFields(),w.value="",n.phones=[],n.content="",n.sms_type="1"},i=async()=>{try{x.value=!0;const s={page:o.page,page_size:o.pageSize,...p},e=await Ce(s);F.value=e.data.list,o.total=e.data.total}catch{k.error("加载日志失败")}finally{x.value=!1}},I=()=>{o.page=1,i()},P=()=>{p.phone="",p.success="",o.page=1,i()},O=s=>{o.pageSize=s,o.page=1,i()},$=s=>{o.page=s,i()},j=s=>({1:"info",3:"success"})[s]||"info",G=s=>({1:"通知",3:"营销"})[s]||"未知",H=s=>s?new Date(s).toLocaleString("zh-CN"):"";return Z(()=>{i()}),(s,e)=>{const E=le,z=ye,S=he,U=se,W=be,d=oe,A=ne,f=we,u=Se,L=Ve,J=re,Q=pe,X=ie;return g(),V("div",Ee,[t(A,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=l=>_.value=l),title:"发送短信",width:"600px","close-on-click-modal":!1,onClose:D},{footer:a(()=>[v("div",ke,[t(d,{onClick:e[3]||(e[3]=l=>_.value=!1)},{default:a(()=>e[11]||(e[11]=[r("取消")])),_:1,__:[11]}),t(d,{type:"primary",onClick:R,loading:C.value},{default:a(()=>e[12]||(e[12]=[r(" 发送短信 ")])),_:1,__:[12]},8,["loading"])])]),default:a(()=>[t(W,{ref_key:"smsFormRef",ref:c,model:n,rules:N,"label-width":"120px"},{default:a(()=>[t(z,{label:"手机号列表",prop:"phones"},{default:a(()=>[t(E,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=l=>w.value=l),type:"textarea",rows:3,placeholder:"请输入手机号，多个手机号用换行分隔",onInput:q},null,8,["modelValue"]),v("div",ze,[e[9]||(e[9]=r(" 支持多个手机号，每行一个 ")),n.phones.length>0?(g(),V("span",Me," （已识别 "+y(n.phones.length)+" 个有效手机号） ",1)):ue("",!0)])]),_:1}),t(z,{label:"短信类型",prop:"sms_type"},{default:a(()=>[t(U,{modelValue:n.sms_type,"onUpdate:modelValue":e[1]||(e[1]=l=>n.sms_type=l),placeholder:"请选择短信类型",style:{width:"100%"}},{default:a(()=>[t(S,{label:"通知",value:"1"}),t(S,{label:"营销",value:"3"})]),_:1},8,["modelValue"])]),_:1}),t(z,{label:"短信内容",prop:"content"},{default:a(()=>[t(E,{modelValue:n.content,"onUpdate:modelValue":e[2]||(e[2]=l=>n.content=l),type:"textarea",rows:4,placeholder:"请输入短信内容","show-word-limit":"",maxlength:"500"},null,8,["modelValue"]),e[10]||(e[10]=v("div",{class:"form-tip"},"最多500字符",-1))]),_:1,__:[10]})]),_:1},8,["model"])]),_:1},8,["modelValue"]),v("div",Fe,[t(E,{modelValue:p.phone,"onUpdate:modelValue":e[5]||(e[5]=l=>p.phone=l),placeholder:"手机号",style:{width:"200px"},class:"filter-item",onKeyup:ee(I,["enter","native"])},{prefix:a(()=>[t(f,null,{default:a(()=>[t(h(de))]),_:1})]),_:1},8,["modelValue"]),t(U,{modelValue:p.success,"onUpdate:modelValue":e[6]||(e[6]=l=>p.success=l),placeholder:"发送状态",clearable:"",class:"filter-item",style:{width:"120px"}},{default:a(()=>[t(S,{label:"成功",value:!0}),t(S,{label:"失败",value:!1})]),_:1},8,["modelValue"]),t(d,{class:"filter-item",type:"primary",onClick:I},{default:a(()=>[t(f,null,{default:a(()=>[t(h(me))]),_:1}),e[13]||(e[13]=r(" 搜索 "))]),_:1,__:[13]}),t(d,{class:"filter-item",onClick:P},{default:a(()=>[t(f,null,{default:a(()=>[t(h(ce))]),_:1}),e[14]||(e[14]=r(" 重置 "))]),_:1,__:[14]}),t(d,{class:"filter-item",onClick:i},{default:a(()=>[t(f,null,{default:a(()=>[t(h(_e))]),_:1}),e[15]||(e[15]=r(" 刷新 "))]),_:1,__:[15]}),t(d,{class:"filter-item",type:"primary",onClick:K},{default:a(()=>[t(f,null,{default:a(()=>[t(h(fe))]),_:1}),e[16]||(e[16]=r(" 发送短信 "))]),_:1,__:[16]})]),te((g(),ae(J,{data:F.value,border:"",fit:"","highlight-current-row":"",style:{width:"100%"}},{default:a(()=>[t(u,{prop:"phones",label:"手机号",width:"160"},{default:a(({row:l})=>[(g(!0),V(ge,null,ve(l.phones,T=>(g(),V("div",{key:T},y(T),1))),128))]),_:1}),t(u,{prop:"content",label:"内容","show-overflow-tooltip":""}),t(u,{prop:"sms_type",label:"类型",width:"100",align:"center"},{default:a(({row:l})=>[t(L,{type:j(l.sms_type)},{default:a(()=>[r(y(G(l.sms_type)),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"success",label:"状态",width:"100",align:"center"},{default:a(({row:l})=>[t(L,{type:l.success?"success":"danger"},{default:a(()=>[r(y(l.success?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"response_code",label:"响应码",width:"100",align:"center"}),t(u,{prop:"response_msg",label:"响应消息",width:"150","show-overflow-tooltip":""}),t(u,{prop:"created_at",label:"发送时间",width:"180"},{default:a(({row:l})=>[r(y(H(l.created_at)),1)]),_:1})]),_:1},8,["data"])),[[X,x.value]]),v("div",De,[t(Q,{"current-page":o.page,"onUpdate:currentPage":e[7]||(e[7]=l=>o.page=l),"page-size":o.pageSize,"onUpdate:pageSize":e[8]||(e[8]=l=>o.pageSize=l),"page-sizes":[10,20,50,100],total:o.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:O,onCurrentChange:$},null,8,["current-page","page-size","total"])])])}}},Re=Y(Ie,[["__scopeId","data-v-927cc6ca"]]);export{Re as default};
