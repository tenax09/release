import{_ as M}from"./index-d036b99c.js";/* empty css                         *//* empty css                             *//* empty css               *//* empty css                *//* empty css                    */import{b as O}from"./caxt-6d367474.js";import{r as p,b as P,l as n,B as m,F as o,G as t,p as k,S as f,ag as X,C as l,O as i,D as d,H,I as J,X as K,E as c,K as Q,aC as W,a6 as Y,a5 as Z,a7 as $,am as ee,az as te,aA as ae,ap as oe,aq as le}from"./element-plus-b8725afa.js";const se={class:"contact-sign-container"},re={key:1},ne={class:"card-header"},ie={class:"logs-container"},de={class:"log-header"},ce={class:"log-operation"},ue={class:"log-content"},pe={key:0,class:"log-section"},me={class:"log-data"},_e={key:1,class:"log-section"},fe={class:"log-data"},ge={key:2,class:"log-section"},ye={class:"error-message"},ve="#",be={__name:"index",setup(xe){const w=p(),h=p(),C=p(!1),g=p([]),u=p(null),y=p([]),r=P({title:"",companyName:"",contract:null}),F={title:[{required:!0,message:"请输入合同标题",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],companyName:[{required:!0,message:"请输入公司名称",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],contract:[{required:!0,message:"请选择合同文件",trigger:"change"}]},I=a=>{if(r.contract=a.raw,a.size>32*1024*1024){c.error("文件大小不能超过 32MB"),g.value=[],r.contract=null;return}if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png"].includes(a.raw.type)){c.error("不支持的文件格式"),g.value=[],r.contract=null;return}},V=()=>{r.contract=null},B=async()=>{if(!r.contract){c.error("请选择合同文件");return}try{await w.value.validate()}catch{return}C.value=!0;try{const a=new FormData;a.append("contract",r.contract),a.append("title",r.title),a.append("companyName",r.companyName);const{data:e}=await O(a);u.value=e,e.logs&&R(e.logs),c.success("合同签署成功！"),E()}catch(a){console.error("签署失败:",a),c.error("签署失败: "+(a.message||"未知错误"))}finally{C.value=!1}},E=()=>{w.value.resetFields(),g.value=[],r.contract=null,h.value.clearFiles()},z=()=>{var a;(a=u.value)!=null&&a.downloadUrl&&c.info("下载功能需要根据实际文件存储方式实现")},T=a=>a?new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"",q=()=>{y.value=[],c.success("日志已清空")},R=a=>{a&&Array.isArray(a)&&(y.value=a)};return(a,e)=>{const _=Q,U=W,v=Y,N=Z,A=$,b=X,D=ee,x=te,S=ae,j=oe,G=le;return n(),m("div",se,[o(b,{class:"box-card"},{header:t(()=>e[2]||(e[2]=[l("div",{class:"card-header"},[l("span",null,"信托合同签署")],-1)])),default:t(()=>[o(A,{ref_key:"formRef",ref:w,model:r,rules:F,"label-width":"120px",class:"contact-form"},{default:t(()=>[o(v,{label:"合同文件",prop:"contract"},{default:t(()=>[o(U,{ref_key:"uploadRef",ref:h,class:"upload-demo",action:ve,"auto-upload":!1,"on-change":I,"on-remove":V,"file-list":g.value,limit:1,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png"},{trigger:t(()=>[o(_,{type:"primary"},{default:t(()=>e[3]||(e[3]=[i("选择文件")])),_:1,__:[3]})]),tip:t(()=>e[4]||(e[4]=[l("div",{class:"el-upload__tip"}," 支持 PDF、DOC、DOCX、JPG、PNG 格式，文件大小不超过 32MB ",-1)])),_:1},8,["file-list"])]),_:1}),o(v,{label:"合同标题",prop:"title"},{default:t(()=>[o(N,{modelValue:r.title,"onUpdate:modelValue":e[0]||(e[0]=s=>r.title=s),placeholder:"请输入合同标题",clearable:"",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(v,{label:"公司名称",prop:"companyName"},{default:t(()=>[o(N,{modelValue:r.companyName,"onUpdate:modelValue":e[1]||(e[1]=s=>r.companyName=s),placeholder:"请输入公司名称",clearable:"",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(v,null,{default:t(()=>[o(_,{type:"primary",loading:C.value,onClick:B},{default:t(()=>e[5]||(e[5]=[i(" 发起签署 ")])),_:1,__:[5]},8,["loading"]),o(_,{onClick:E},{default:t(()=>e[6]||(e[6]=[i("重置")])),_:1,__:[6]})]),_:1})]),_:1},8,["model"])]),_:1}),u.value?(n(),k(b,{key:0,class:"result-card",style:{"margin-top":"20px"}},{header:t(()=>e[7]||(e[7]=[l("div",{class:"card-header"},[l("span",null,"签署结果")],-1)])),default:t(()=>[o(S,{column:2,border:""},{default:t(()=>[o(x,{label:"签署状态"},{default:t(()=>[o(D,{type:"success"},{default:t(()=>e[8]||(e[8]=[i("签署成功")])),_:1,__:[8]})]),_:1}),o(x,{label:"合同ID"},{default:t(()=>[i(d(u.value.contractId),1)]),_:1}),o(x,{label:"文档ID"},{default:t(()=>[i(d(u.value.documentId),1)]),_:1}),o(x,{label:"下载链接"},{default:t(()=>[u.value.downloadUrl?(n(),k(_,{key:0,type:"primary",size:"small",onClick:z},{default:t(()=>e[9]||(e[9]=[i(" 下载签署后的合同 ")])),_:1,__:[9]})):(n(),m("span",re,"暂无下载链接"))]),_:1})]),_:1})]),_:1})):f("",!0),y.value.length>0?(n(),k(b,{key:1,class:"logs-card",style:{"margin-top":"20px"}},{header:t(()=>[l("div",ne,[e[11]||(e[11]=l("span",null,"操作日志",-1)),o(_,{type:"info",size:"small",onClick:q},{default:t(()=>e[10]||(e[10]=[i("清空日志")])),_:1,__:[10]})])]),default:t(()=>[l("div",ie,[o(G,null,{default:t(()=>[(n(!0),m(H,null,J(y.value,(s,L)=>(n(),k(j,{key:L,type:s.error?"danger":"success",timestamp:T(s.timestamp),placement:"top"},{default:t(()=>[o(b,{class:K(["log-card",{"error-log":s.error}])},{header:t(()=>[l("div",de,[l("span",ce,d(s.operation),1),o(D,{type:s.error?"danger":"success",size:"small"},{default:t(()=>[i(d(s.error?"失败":"成功"),1)]),_:2},1032,["type"])])]),default:t(()=>[l("div",ue,[s.request?(n(),m("div",pe,[e[12]||(e[12]=l("h4",null,"请求数据:",-1)),l("pre",me,d(s.request),1)])):f("",!0),s.response?(n(),m("div",_e,[e[13]||(e[13]=l("h4",null,"响应数据:",-1)),l("pre",fe,d(s.response),1)])):f("",!0),s.error?(n(),m("div",ge,[e[14]||(e[14]=l("h4",null,"错误信息:",-1)),l("div",ye,d(s.error),1)])):f("",!0)])]),_:2},1032,["class"])]),_:2},1032,["type","timestamp"]))),128))]),_:1})])]),_:1})):f("",!0)])}}},Ie=M(be,[["__scopeId","data-v-37aa0dee"]]);export{Ie as default};
