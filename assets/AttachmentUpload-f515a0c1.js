import{_ as j}from"./index-e1227d2d.js";/* empty css                     *//* empty css                   *//* empty css                    */import{r as p,w as E,j as H,l as d,p as I,G as t,C as n,F as o,O as c,u as M,aw as T,B as g,H as V,I as x,D as k,aX as X,S as Y,E as m,a2 as Z,aC as J,aD as P,a5 as Q,K as $,aY as ee,aZ as le,a_ as ae,M as te}from"./element-plus-b8725afa.js";import{u as oe}from"./AttachmentList-82d403fa.js";const se={class:"upload-content"},ne={key:0,class:"attachment-files"},re={class:"file-list"},ue={class:"file-info"},ie={class:"file-name"},de={class:"file-size"},ce={class:"file-remark"},pe={class:"dialog-footer"},me={__name:"AttachmentUpload",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"上传附件"},orderId:{type:[String,Number],required:!0},refId:{type:[String,Number],required:!0},type:{type:String,default:"order"}},emits:["update:visible","success"],setup(y,{emit:C}){const _=y,B=C,u=p(!1),b=p(null),h=p(!1),a=p([]),f=p([]);E(()=>_.visible,l=>{u.value=l,l&&(a.value=[],f.value=[])}),E(u,l=>{B("update:visible",l)});const F=H(()=>{switch(_.type){case"car":return[{value:"行驶证",label:"行驶证"},{value:"驾驶证",label:"驾驶证"},{value:"投保单",label:"投保单"},{value:"其他",label:"其他"}];case"cargo":return[{value:"运单",label:"运单"},{value:"发货单",label:"发货单"},{value:"货物清单",label:"货物清单"},{value:"投保单",label:"投保单"},{value:"其他",label:"其他"}];case"received":return[{value:"收款凭证",label:"收款凭证"},{value:"其他",label:"其他"}];default:return[{value:"缴费通知书",label:"缴费通知书"},{value:"其他文件",label:"其他文件"}]}}),S=l=>{if(l.raw.size>10*1024*1024)return m.error("文件大小不能超过10MB"),!1;a.value.push({raw:l.raw,name:l.name,size:l.raw.size,remark:""})},z=l=>{const e=a.value.findIndex(s=>s.name===l.name);e!==-1&&a.value.splice(e,1)},U=(l,e)=>{e!==void 0&&a.value[e]&&(a.value[e].remark=l)},N=l=>{if(l===0)return"0 B";const e=1024,s=["B","KB","MB","GB"],v=Math.floor(Math.log(l)/Math.log(e));return parseFloat((l/Math.pow(e,v)).toFixed(2))+" "+s[v]},R=()=>{u.value=!1,a.value=[],f.value=[],b.value&&b.value.clearFiles()},A=async()=>{if(a.value.length===0){m.error("请选择要上传的文件");return}if(a.value.filter(e=>!e.remark.trim()).length>0){m.error("请为所有文件填写备注");return}h.value=!0;try{for(const e of a.value){const s=new FormData;s.append("files",e.raw),s.append("remarks",e.remark),await oe(_.orderId,_.refId,s)}m.success("附件上传成功"),u.value=!1,a.value=[],f.value=[],B("success")}catch(e){m.error("附件上传失败："+(e.message||"未知错误"))}h.value=!1};return(l,e)=>{const s=Z,v=J,G=P,q=Q,w=$,K=ee,L=le,O=ae,W=te;return d(),I(W,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=i=>u.value=i),title:y.title,width:"900px",center:""},{footer:t(()=>[n("span",pe,[o(w,{onClick:R},{default:t(()=>e[5]||(e[5]=[c("取消")])),_:1,__:[5]}),o(w,{type:"primary",onClick:A,loading:h.value,disabled:a.value.length===0},{default:t(()=>e[6]||(e[6]=[c(" 开始上传 ")])),_:1,__:[6]},8,["loading","disabled"])])]),default:t(()=>[n("div",se,[o(v,{ref_key:"uploadRef",ref:b,class:"upload-demo",drag:"",multiple:"","auto-upload":!1,limit:10,accept:"*/*","on-change":S,"on-remove":z,"file-list":f.value},{tip:t(()=>e[1]||(e[1]=[n("div",{class:"el-upload__tip"}," 支持多种格式文件，单个文件不超过10MB ",-1)])),default:t(()=>[o(s,{class:"el-icon--upload"},{default:t(()=>[o(M(T))]),_:1}),e[2]||(e[2]=n("div",{class:"el-upload__text"},[c(" 将文件拖到此处，或"),n("em",null,"点击上传")],-1))]),_:1,__:[2]},8,["file-list"]),a.value.length>0?(d(),g("div",ne,[o(G,{"content-position":"left"},{default:t(()=>e[3]||(e[3]=[c("文件列表")])),_:1,__:[3]}),n("div",re,[(d(!0),g(V,null,x(a.value,(i,D)=>(d(),g("div",{key:D,class:"file-item"},[n("div",ue,[n("span",ie,k(i.name),1),n("span",de,k(N(i.size)),1)]),n("div",ce,[o(q,{modelValue:i.remark,"onUpdate:modelValue":r=>i.remark=r,placeholder:"请输入备注",style:{width:"200px"}},null,8,["modelValue","onUpdate:modelValue"]),o(O,{onCommand:r=>U(r,D),trigger:"click",placement:"bottom-end"},{dropdown:t(()=>[o(L,null,{default:t(()=>[(d(!0),g(V,null,x(F.value,r=>(d(),I(K,{key:r.value,command:r.value},{default:t(()=>[c(k(r.label),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:t(()=>[o(w,{type:"primary",size:"small",style:{"margin-left":"8px"}},{default:t(()=>[e[4]||(e[4]=c(" 选择 ")),o(s,{class:"el-icon--right"},{default:t(()=>[o(M(X))]),_:1})]),_:1,__:[4]})]),_:2},1032,["onCommand"])])]))),128))])])):Y("",!0)])]),_:1},8,["modelValue","title"])}}},we=j(me,[["__scopeId","data-v-b86f4f56"]]);export{we as A};
