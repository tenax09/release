import{_ as P,b as R,u as z}from"./index-5e7125b4.js";/* empty css                   *//* empty css                *//* empty css                             *//* empty css               *//* empty css                   *//* empty css                       */import{b as G,a as H}from"./contact-20314705.js";import{f as J}from"./format-20468769.js";import{A as K}from"./AttachmentList-ccd2a85d.js";import{r as f,ae as O,l as d,B as y,C as b,F as l,G as a,af as j,p as _,E as u,aE as q,ag as Q,ai as W,O as r,S as B,D as s,u as X,J as w,K as Y,az as Z,am as ee,aA as te,a5 as ae}from"./element-plus-b8725afa.js";/* empty css                    *//* empty css                 */const le={class:"contact-detail"},ne={class:"page-header"},re={class:"header-actions"},oe={class:"sign-url-container"},se={key:1},ue={key:1},ie={__name:"detail",setup(de){const D=R(),T=z(),k=D.params.id,p=f(!1),t=f({}),m=f(!1);f(!1);const V=n=>{switch(n){case"已签署":return"success";case"未签署":return"info";case"已作废":return"danger";case"已拒签":return"danger";default:return"info"}},I=n=>{switch(n){case"已签署":return"success";case"未签署":return"info";case"已作废":return"danger";case"签署失败":return"danger";case"信托签署中":return"warning";default:return"info"}},S=async()=>{p.value=!0;try{const{data:n}=await G(k);t.value=n}catch(n){console.error("获取合同详情失败:",n),u.error("获取合同详情失败")}p.value=!1},A=async()=>{try{await w.confirm("确认作废该合同?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await H(k),u.success("作废成功"),x()}catch(n){n!=="cancel"&&(console.error("作废合同失败:",n),u.error("作废合同失败"))}},N=async()=>{try{await w.confirm("确定要手动触发资方签署吗？这将调用信托签署接口。","资方签署确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),u.success("资方签署已触发，请查看订单日志了解进度")}catch(n){n!=="cancel"&&u.error("操作失败")}},x=()=>{T.back()},U=()=>{m.value=!0},F=()=>{if(!t.value.user_sign_url){u.warning("请先获取签署链接");return}navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(t.value.user_sign_url).then(()=>{u.success("签署链接已复制到剪贴板")}).catch(n=>{console.error("使用 Clipboard API 复制失败:",n),C(t.value.user_sign_url)}):C(t.value.user_sign_url)},C=n=>{try{const e=document.createElement("textarea");e.value=n,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();const i=document.execCommand("copy");if(document.body.removeChild(e),i)u.success("签署链接已复制到剪贴板");else throw new Error("execCommand 复制失败")}catch(e){console.error("复制失败:",e),w.alert(t.value.sign_url,"请手动复制签署链接",{confirmButtonText:"确定",type:"info"})}},E=n=>{try{if(typeof window<"u"&&window.open)window.open(n,"_blank");else{const e=document.createElement("a");e.href=n,e.target="_blank",e.rel="noopener noreferrer",document.body.appendChild(e),e.click(),document.body.removeChild(e)}}catch(e){console.error("打开下载链接失败:",e),u.error("无法打开下载链接")}};return O(()=>{S()}),(n,e)=>{const i=Y,M=q,o=Z,h=ee,v=te,g=Q,$=ae,L=W;return d(),y("div",le,[b("div",ne,[l(M,{onBack:x,title:t.value.title||"合同详情"},{extra:a(()=>[b("div",re,[t.value.user_sign_status==="未签署"?(d(),_(i,{key:0,type:"danger",onClick:A},{default:a(()=>e[4]||(e[4]=[r(" 作废合同 ")])),_:1,__:[4]})):B("",!0),t.value.user_sign_status==="已签署"&&t.value.funder_sign_status!=="已签署"?(d(),_(i,{key:1,type:"warning",onClick:N},{default:a(()=>e[5]||(e[5]=[r(" 资方签署 ")])),_:1,__:[5]})):B("",!0),l(i,{type:"primary",onClick:U},{default:a(()=>e[6]||(e[6]=[r("查看附件")])),_:1,__:[6]})])]),_:1},8,["title"])]),j((d(),_(g,{class:"detail-card"},{default:a(()=>[l(v,{column:3,border:""},{default:a(()=>[l(o,{label:"合同标题"},{default:a(()=>[r(s(t.value.title),1)]),_:1}),l(o,{label:"订单号"},{default:a(()=>[r(s(t.value.order_no),1)]),_:1}),l(o,{label:"借款人姓名"},{default:a(()=>[r(s(t.value.customer_name||"-"),1)]),_:1}),l(o,{label:"用户签署状态"},{default:a(()=>[l(h,{type:V(t.value.user_sign_status)},{default:a(()=>[r(s(t.value.user_sign_status||"未签署"),1)]),_:1},8,["type"])]),_:1}),l(o,{label:"用户签署时间"},{default:a(()=>[r(s(t.value.user_sign_time||"-"),1)]),_:1}),l(o,{label:"创建时间"},{default:a(()=>[r(s(X(J)(t.value.created_at)),1)]),_:1})]),_:1})]),_:1})),[[L,p.value]]),l(g,{class:"detail-card"},{default:a(()=>[l(v,{column:3,border:""},{default:a(()=>[l(o,{label:"资方签署状态"},{default:a(()=>[l(h,{type:I(t.value.funder_sign_status)},{default:a(()=>[r(s(t.value.funder_sign_status||"未签署"),1)]),_:1},8,["type"])]),_:1}),l(o,{label:"资方签署时间"},{default:a(()=>[r(s(t.value.funder_sign_time||"-"),1)]),_:1}),l(o,{label:"信托合同ID"},{default:a(()=>[r(s(t.value.funder_contact_id||"-"),1)]),_:1}),l(o,{label:"信托文档ID"},{default:a(()=>[r(s(t.value.funder_document_id||"-"),1)]),_:1}),l(o,{label:"法大大合同ID"},{default:a(()=>[r(s(t.value.user_contact_id||"-"),1)]),_:1}),l(o,{label:"客户ID"},{default:a(()=>[r(s(t.value.customer_id||"-"),1)]),_:1})]),_:1})]),_:1}),l(g,{class:"detail-card"},{default:a(()=>[l(v,{column:1,border:""},{default:a(()=>[l(o,{label:"用户签署链接"},{default:a(()=>[b("div",oe,[l($,{modelValue:t.value.user_sign_url,"onUpdate:modelValue":e[0]||(e[0]=c=>t.value.user_sign_url=c),readonly:"",class:"sign-url-input"},{append:a(()=>[l(i,{onClick:F},{default:a(()=>e[7]||(e[7]=[r("复制")])),_:1,__:[7]})]),_:1},8,["modelValue"])])]),_:1}),l(o,{label:"用户合同下载地址"},{default:a(()=>[t.value.user_download_url?(d(),_(i,{key:0,type:"primary",onClick:e[1]||(e[1]=c=>E(t.value.user_download_url))},{default:a(()=>e[8]||(e[8]=[r(" 点击下载 ")])),_:1,__:[8]})):(d(),y("span",se,"-"))]),_:1}),l(o,{label:"资方合同下载地址"},{default:a(()=>[t.value.funder_download_url?(d(),_(i,{key:0,type:"primary",onClick:e[2]||(e[2]=c=>E(t.value.funder_download_url))},{default:a(()=>e[9]||(e[9]=[r(" 点击下载 ")])),_:1,__:[9]})):(d(),y("span",ue,"-"))]),_:1})]),_:1})]),_:1}),l(K,{visible:m.value,"onUpdate:visible":e[3]||(e[3]=c=>m.value=c),title:`合同附件 - ${t.value.title||""}`,"order-id":t.value.order_id||0,"ref-id":t.value.id||0,type:"contact","allow-delete":!1},null,8,["visible","title","order-id","ref-id"])])}}},Ee=P(ie,[["__scopeId","data-v-bb7a8545"]]);export{Ee as default};
