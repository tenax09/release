import{r as D,_ as ve}from"./index-977e0fd9.js";/* empty css               *//* empty css                             *//* empty css                       *//* empty css                     *//* empty css                        *//* empty css                      *//* empty css                  *//* empty css                        */import{b as Q,r as _,ae as ye,l as v,B as U,C as p,F as e,G as a,a1 as G,af as be,p as S,E as V,a5 as he,ay as Ve,K as xe,an as ke,aS as we,M as Ce,ai as Ee,u as E,b1 as Ue,Q as De,aT as ze,O as n,as as Fe,D as i,H as J,I as W,S as I,J as Me,a2 as Se,ax as $e,al as Re,am as Oe,a6 as Le,aK as Te,aL as qe,a7 as Be,az as Ie,aA as Ye}from"./element-plus-eb4b90a0.js";import{g as He}from"./user-dc016a7a.js";import{o as Ke}from"./order-d005cce5.js";import{f as X}from"./format-20468769.js";function Ne(f){return D({url:"/api/admin/receiveds",method:"get",params:f})}function Pe(f){return D({url:`/api/admin/receiveds/${f}`,method:"get"})}function je(f){return D({url:"/api/admin/receiveds",method:"post",data:f})}function Ae(f,s){return D({url:`/api/admin/receiveds/${f}`,method:"put",data:s})}function Qe(f){return D({url:`/api/admin/receiveds/${f}`,method:"delete"})}const Ge={class:"received-container"},Je={class:"filter-container"},We={style:{color:"#67c23a","font-weight":"bold"}},Xe={class:"pagination"},Ze={class:"form-section"},et={class:"form-content"},tt={class:"form-section"},lt={class:"form-content"},at={class:"form-section"},ot={class:"form-content"},rt=["src"],nt={class:"dialog-footer"},dt={style:{color:"#67c23a","font-weight":"bold"}},it={key:0,style:{"margin-top":"20px"}},st={key:1,style:{"margin-top":"18px"}},ut=["src"],pt={class:"dialog-footer"},mt={__name:"index",setup(f){const s=Q({page:1,pageSize:10,trans_no:"",order_no:"",rec_type:"",method:""}),Y=_([]),H=_(0),$=_(!1),K=_([]),R=_([]);_([]);const x=_(!1),z=_(!1),O=_(""),L=_(),r=Q({id:void 0,rec_type:"",user_id:void 0,order_id:void 0,order_no:"",amount:void 0,method:"",date_time:"",remark:"",receipt:""}),d=_({}),Z={rec_type:[{required:!0,message:"请选择收款类型",trigger:"change"}],user_id:[{required:!0,message:"请选择用户",trigger:"change"}],order_id:[{required:!0,message:"请选择订单",trigger:"change"}],amount:[{required:!0,message:"请输入收款金额",trigger:"blur"}],method:[{required:!0,message:"请选择收款方式",trigger:"change"}],date_time:[{required:!0,message:"请选择收款时间",trigger:"change"}]},k=async()=>{$.value=!0;try{const o=await Ne(s);Y.value=o.data.list,H.value=o.data.total}catch(o){console.error("获取收款记录列表失败:",o),V.error("获取收款记录列表失败")}$.value=!1},ee=async()=>{try{const o=await He({page:1,pageSize:1e3});K.value=o.data.list}catch(o){console.error("获取用户列表失败:",o)}},F=async(o="")=>{try{const t={page:1,pageSize:1e3};o&&(t.user_id=o);const c=await Ke(t);R.value=c.data.list}catch(t){console.error("获取订单列表失败:",t)}},te=o=>{r.order_id=void 0,r.order_no="",o&&F(o)},le=o=>{const t=R.value.find(c=>c.id===o);t&&(r.order_no=t.order_no)},T=_(""),q=_(null);function ae(o){const t=o.target.files[0];if(!t)return;const c=new FileReader;c.onload=function(w){T.value=w.target.result,r.receipt=w.target.result,q.value=t},c.readAsDataURL(t)}const B=()=>{s.page=1,k()},oe=()=>{O.value="新增收款记录",x.value=!0,Object.assign(r,{id:void 0,rec_type:"",user_id:void 0,order_id:void 0,order_no:"",amount:void 0,method:"",date_time:"",remark:"",receipt:""}),T.value="",q.value=null,F()},re=o=>{O.value="编辑收款记录",x.value=!0,Object.assign(r,{id:o.id,rec_type:o.rec_type,user_id:o.user_id,order_id:o.order_id,order_no:o.order_no,amount:o.amount,method:o.method,date_time:o.date_time,remark:o.remark,receipt:o.receipt||""}),T.value=o.receipt||"",q.value=null,o.user_id?F(o.user_id):F()},ne=async o=>{try{const t=await Pe(o.id);d.value=t.data,z.value=!0}catch(t){console.error("获取收款记录详情失败:",t),V.error("获取收款记录详情失败")}},de=o=>{Me.confirm("确认要删除该收款记录吗？","警告",{type:"warning"}).then(async()=>{try{await Qe(o.id),V.success("删除成功"),k()}catch(t){console.error("删除收款记录失败:",t),V.error("删除失败")}})},ie=async()=>{L.value&&await L.value.validate(async o=>{if(o)try{r.id?(await Ae(r.id,r),V.success("编辑成功")):(await je(r),V.success("新增成功")),x.value=!1,k()}catch(t){console.error("提交表单失败:",t),V.error("操作失败")}})},se=o=>{s.pageSize=o,k()},ue=o=>{s.page=o,k()},N=o=>({首付:"primary",还款:"success",利息:"warning",本金:"info",退保:"danger"})[o]||"info",P=o=>({微信:"success",支付宝:"primary",银行卡:"warning"})[o]||"info";return ye(()=>{k(),ee()}),(o,t)=>{const c=Se,w=he,u=$e,C=Ve,y=xe,h=Re,M=Oe,pe=ke,me=we,g=Le,_e=Te,ce=qe,fe=Be,j=Ce,m=Ie,A=Ye,ge=Ee;return v(),U("div",Ge,[p("div",Je,[e(w,{modelValue:s.trans_no,"onUpdate:modelValue":t[0]||(t[0]=l=>s.trans_no=l),placeholder:"流水号",style:{width:"200px"},class:"filter-item",onKeyup:G(B,["enter","native"])},{prefix:a(()=>[e(c,null,{default:a(()=>[e(E(Ue))]),_:1})]),_:1},8,["modelValue"]),e(w,{modelValue:s.order_no,"onUpdate:modelValue":t[1]||(t[1]=l=>s.order_no=l),placeholder:"订单号",style:{width:"200px"},class:"filter-item",onKeyup:G(B,["enter","native"])},{prefix:a(()=>[e(c,null,{default:a(()=>[e(E(De))]),_:1})]),_:1},8,["modelValue"]),e(C,{modelValue:s.rec_type,"onUpdate:modelValue":t[2]||(t[2]=l=>s.rec_type=l),placeholder:"收款类型",clearable:"",class:"filter-item",style:{width:"120px"}},{default:a(()=>[e(u,{label:"首付",value:"首付"}),e(u,{label:"还款",value:"还款"}),e(u,{label:"利息",value:"利息"}),e(u,{label:"本金",value:"本金"}),e(u,{label:"退保",value:"退保"})]),_:1},8,["modelValue"]),e(C,{modelValue:s.method,"onUpdate:modelValue":t[3]||(t[3]=l=>s.method=l),placeholder:"收款方式",clearable:"",class:"filter-item",style:{width:"120px"}},{default:a(()=>[e(u,{label:"微信",value:"微信"}),e(u,{label:"支付宝",value:"支付宝"}),e(u,{label:"银行卡",value:"银行卡"})]),_:1},8,["modelValue"]),e(y,{class:"filter-item",type:"primary",onClick:B},{default:a(()=>[e(c,null,{default:a(()=>[e(E(ze))]),_:1}),t[17]||(t[17]=n(" 搜索 "))]),_:1,__:[17]}),e(y,{class:"filter-item",type:"primary",onClick:oe},{default:a(()=>[e(c,null,{default:a(()=>[e(E(Fe))]),_:1}),t[18]||(t[18]=n(" 新增收款记录 "))]),_:1,__:[18]})]),be((v(),S(pe,{data:Y.value,border:"",fit:"","highlight-current-row":"",style:{width:"100%"}},{default:a(()=>[e(h,{prop:"trans_no",label:"流水号",width:"240"}),e(h,{prop:"order_no",label:"订单号",width:"220"}),e(h,{prop:"rec_type",label:"收款类型",width:"100",align:"center"},{default:a(({row:l})=>[e(M,{type:N(l.rec_type)},{default:a(()=>[n(i(l.rec_type),1)]),_:2},1032,["type"])]),_:1}),e(h,{prop:"amount",label:"金额",width:"120",align:"center"},{default:a(({row:l})=>{var b;return[p("span",We,"¥"+i((b=l.amount)==null?void 0:b.toFixed(2)),1)]}),_:1}),e(h,{prop:"method",label:"收款方式",width:"100",align:"center"},{default:a(({row:l})=>[e(M,{type:P(l.method)},{default:a(()=>[n(i(l.method),1)]),_:2},1032,["type"])]),_:1}),e(h,{prop:"date_time",label:"收款时间",width:"180"},{default:a(({row:l})=>[n(i(l.date_time||"--"),1)]),_:1}),e(h,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[e(y,{type:"primary",link:"",onClick:b=>re(l)},{default:a(()=>t[19]||(t[19]=[n("编辑")])),_:2,__:[19]},1032,["onClick"]),e(y,{type:"primary",link:"",onClick:b=>ne(l)},{default:a(()=>t[20]||(t[20]=[n("详情")])),_:2,__:[20]},1032,["onClick"]),e(y,{type:"danger",link:"",onClick:b=>de(l)},{default:a(()=>t[21]||(t[21]=[n("删除")])),_:2,__:[21]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ge,$.value]]),p("div",Xe,[e(me,{"current-page":s.page,"onUpdate:currentPage":t[4]||(t[4]=l=>s.page=l),"page-size":s.pageSize,"onUpdate:pageSize":t[5]||(t[5]=l=>s.pageSize=l),"page-sizes":[10,20,50,100],total:H.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:se,onCurrentChange:ue},null,8,["current-page","page-size","total"])]),e(j,{title:O.value,modelValue:x.value,"onUpdate:modelValue":t[14]||(t[14]=l=>x.value=l),width:"900px","close-on-click-modal":!1,draggable:"","destroy-on-close":"",class:"custom-dialog"},{footer:a(()=>[p("div",nt,[e(y,{onClick:t[13]||(t[13]=l=>x.value=!1)},{default:a(()=>t[22]||(t[22]=[n("取 消")])),_:1,__:[22]}),e(y,{type:"primary",onClick:ie},{default:a(()=>t[23]||(t[23]=[n("确 定")])),_:1,__:[23]})])]),default:a(()=>[e(fe,{ref_key:"receivedFormRef",ref:L,model:r,rules:Z,"label-position":"right","label-width":"120px",class:"form-container"},{default:a(()=>[p("div",Ze,[p("div",et,[e(g,{label:"收款类型",prop:"rec_type"},{default:a(()=>[e(C,{modelValue:r.rec_type,"onUpdate:modelValue":t[6]||(t[6]=l=>r.rec_type=l),placeholder:"请选择收款类型",style:{width:"100%"}},{default:a(()=>[e(u,{label:"首付",value:"首付"}),e(u,{label:"还款",value:"还款"}),e(u,{label:"利息",value:"利息"}),e(u,{label:"本金",value:"本金"}),e(u,{label:"退保",value:"退保"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"收款方式",prop:"method"},{default:a(()=>[e(C,{modelValue:r.method,"onUpdate:modelValue":t[7]||(t[7]=l=>r.method=l),placeholder:"请选择收款方式",style:{width:"100%"}},{default:a(()=>[e(u,{label:"微信",value:"微信"}),e(u,{label:"支付宝",value:"支付宝"}),e(u,{label:"银行卡",value:"银行卡"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"用户",prop:"user_id"},{default:a(()=>[e(C,{modelValue:r.user_id,"onUpdate:modelValue":t[8]||(t[8]=l=>r.user_id=l),placeholder:"请选择用户",filterable:"",style:{width:"100%"},onChange:te},{default:a(()=>[(v(!0),U(J,null,W(K.value,l=>(v(),S(u,{key:l.id,label:`${l.name||l.username} (${l.username})`,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"订单",prop:"order_id"},{default:a(()=>[e(C,{modelValue:r.order_id,"onUpdate:modelValue":t[9]||(t[9]=l=>r.order_id=l),placeholder:"请选择订单",filterable:"",style:{width:"100%"},onChange:le},{default:a(()=>[(v(!0),U(J,null,W(R.value,l=>(v(),S(u,{key:l.id,label:`${l.order_no} (¥${l.total_premium})`,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),p("div",tt,[p("div",lt,[e(g,{label:"金额",prop:"amount"},{default:a(()=>[e(_e,{modelValue:r.amount,"onUpdate:modelValue":t[10]||(t[10]=l=>r.amount=l),precision:2,step:100,min:0,max:999999999,"controls-position":o.right,style:{width:"100%"}},null,8,["modelValue","controls-position"])]),_:1}),e(g,{label:"收款时间",prop:"date_time"},{default:a(()=>[e(ce,{modelValue:r.date_time,"onUpdate:modelValue":t[11]||(t[11]=l=>r.date_time=l),type:"datetime",placeholder:"请选择收款时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])]),p("div",at,[p("div",ot,[e(g,{label:"备注",prop:"remark",class:"full-width"},{default:a(()=>[e(w,{modelValue:r.remark,"onUpdate:modelValue":t[12]||(t[12]=l=>r.remark=l),type:"textarea",rows:3,placeholder:"请输入备注信息",maxlength:"255","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(g,{label:"收款凭证"},{default:a(()=>[p("input",{type:"file",accept:"image/*",onChange:ae},null,32)]),_:1}),r.receipt?(v(),S(g,{key:0},{default:a(()=>[p("img",{src:r.receipt,alt:"收款凭证预览",style:{"max-width":"180px","max-height":"120px",border:"1px solid #eee"}},null,8,rt)]),_:1})):I("",!0)])])]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),e(j,{title:"收款记录详情",modelValue:z.value,"onUpdate:modelValue":t[16]||(t[16]=l=>z.value=l),width:"700px","close-on-click-modal":!1,draggable:"","destroy-on-close":""},{footer:a(()=>[p("div",pt,[e(y,{onClick:t[15]||(t[15]=l=>z.value=!1)},{default:a(()=>t[26]||(t[26]=[n("关 闭")])),_:1,__:[26]})])]),default:a(()=>[e(A,{column:2,border:""},{default:a(()=>[e(m,{label:"流水号"},{default:a(()=>[n(i(d.value.trans_no),1)]),_:1}),e(m,{label:"收款类型"},{default:a(()=>[e(M,{type:N(d.value.rec_type)},{default:a(()=>[n(i(d.value.rec_type),1)]),_:1},8,["type"])]),_:1}),e(m,{label:"用户"},{default:a(()=>{var l,b;return[n(i(((l=d.value.user)==null?void 0:l.name)||((b=d.value.user)==null?void 0:b.username)||"未知用户"),1)]}),_:1}),e(m,{label:"订单号"},{default:a(()=>[n(i(d.value.order_no),1)]),_:1}),e(m,{label:"收款金额"},{default:a(()=>{var l;return[p("span",dt,"¥"+i((l=d.value.amount)==null?void 0:l.toFixed(2)),1)]}),_:1}),e(m,{label:"收款方式"},{default:a(()=>[e(M,{type:P(d.value.method)},{default:a(()=>[n(i(d.value.method),1)]),_:1},8,["type"])]),_:1}),e(m,{label:"收款时间"},{default:a(()=>[n(i(d.value.date_time),1)]),_:1}),e(m,{label:"创建时间"},{default:a(()=>[n(i(E(X)(d.value.created_at)),1)]),_:1}),e(m,{label:"更新时间"},{default:a(()=>[n(i(E(X)(d.value.updated_at)),1)]),_:1}),e(m,{label:"备注",span:"2"},{default:a(()=>[n(i(d.value.remark||"无"),1)]),_:1})]),_:1}),d.value.order?(v(),U("div",it,[t[24]||(t[24]=p("h4",{style:{margin:"0 0 16px 0",color:"#303133"}},"关联订单信息",-1)),e(A,{column:2,border:"",size:"small"},{default:a(()=>[e(m,{label:"订单号"},{default:a(()=>[n(i(d.value.order.order_no),1)]),_:1}),e(m,{label:"总保费"},{default:a(()=>{var l;return[n("¥"+i((l=d.value.order.total_premium)==null?void 0:l.toFixed(2)),1)]}),_:1}),e(m,{label:"贷款金额"},{default:a(()=>{var l;return[n("¥"+i((l=d.value.order.loan_amount)==null?void 0:l.toFixed(2)),1)]}),_:1}),e(m,{label:"首付金额"},{default:a(()=>{var l;return[n("¥"+i((l=d.value.order.down_payment)==null?void 0:l.toFixed(2)),1)]}),_:1}),e(m,{label:"订单状态"},{default:a(()=>[n(i(d.value.order.status),1)]),_:1}),e(m,{label:"保险类型"},{default:a(()=>[n(i(d.value.order.insurance_type),1)]),_:1})]),_:1})])):I("",!0),d.value.receipt?(v(),U("div",st,[t[25]||(t[25]=p("div",{style:{"font-weight":"bold","margin-bottom":"6px"}},"收款凭证：",-1)),p("img",{src:d.value.receipt,alt:"收款凭证",style:{"max-width":"320px","max-height":"200px",border:"1px solid #eee"}},null,8,ut)])):I("",!0)]),_:1},8,["modelValue"])])}}},Et=ve(mt,[["__scopeId","data-v-4e631f43"]]);export{Et as default};
