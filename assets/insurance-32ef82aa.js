import{_ as Ea,b as Ma,u as Ya}from"./index-7ec644a6.js";/* empty css                   *//* empty css                   *//* empty css                    *//* empty css                 *//* empty css                       *//* empty css                     *//* empty css                        *//* empty css                    *//* empty css               *//* empty css                  *//* empty css                        *//* empty css                *//* empty css               *//* empty css                       */import{r,j as Pe,w as Ia,ae as Ra,l as b,B as h,C as o,F as a,G as l,p as R,S as D,af as je,u as q,E as p,aE as La,ag as Ba,M as $a,ai as qa,aI as Na,O as n,as as za,D as _,H as se,I as oe,X as Ge,aw as fe,J as Aa,a2 as Oa,K as Pa,am as ja,ao as Ga,ah as Wa,al as Ja,an as Ha,a5 as Ka,a6 as Xa,ax as Qa,ay as Za,aJ as el,aG as al,aH as ll,a7 as tl,aB as sl,aC as ol,aD as ul}from"./element-plus-b8725afa.js";import{f as nl,a as rl,h as We,i as il,j as dl,u as pl,e as ml,k as cl,l as vl}from"./order-f9b097d7.js";import{a as _l}from"./user-273e027f.js";import{A as fl}from"./AttachmentUpload-b2e32c38.js";import{A as gl}from"./AttachmentList-3d065a80.js";/* empty css                 */import"./format-20468769.js";const bl={class:"insurance-detail"},yl={class:"page-header"},wl={class:"header-actions"},Vl={class:"status-stat-item"},kl={class:"status-stat-count"},xl={class:"attachment-status"},hl={class:"status-item"},Ul={class:"status-item"},Cl={class:"status-stat-item"},Fl={class:"status-stat-count"},Dl={class:"insured-input"},Sl={class:"dialog-footer"},Tl={class:"insured-input"},El={class:"dialog-footer"},Ml={class:"upload-content"},Yl={class:"upload-tips"},Il={key:0,class:"import-result"},Rl={class:"result-summary"},Ll={class:"stat-item"},Bl={class:"stat-number total"},$l={class:"stat-item"},ql={class:"stat-number success"},Nl={class:"stat-item"},zl={class:"stat-number fail"},Al={key:0,class:"error-list"},Ol={class:"dialog-footer"},Pl={class:"upload-content"},jl={class:"upload-tips"},Gl={key:0,class:"upload-status"},Wl={class:"status-content"},Jl={class:"dialog-footer"},Hl={class:"upload-content"},Kl={class:"upload-tips"},Xl={key:0,class:"upload-status"},Ql={class:"status-content"},Zl={class:"dialog-footer"},et={class:"dialog-footer"},at={class:"upload-content"},lt={class:"upload-tips"},tt={class:"tips-content"},st={key:0},ot={key:1},ut={key:0,class:"import-result"},nt={class:"result-summary"},rt={class:"stat-item"},it={class:"stat-number total"},dt={class:"stat-item"},pt={class:"stat-number success"},mt={class:"stat-item"},ct={class:"stat-number fail"},vt={key:0,class:"result-details"},_t={class:"dialog-footer"},ft={__name:"insurance",setup(gt){const U=Ma(),Me=Ya(),ue=r(!1),P=r(!1),E=r([]),f=r("车险"),Je=r({}),He=r({}),N=r([]),ne=r(!1),G=r(null),ge=r(!1),L=r(null),be=r([]),C=r(null),W=r(!1),ye=r(null),J=r(!1),M=r([]),we=r([]),H=r(!1),Ve=r(null),re=r(!1),Y=r([]),ke=r([]),K=r(!1),xe=r(null),he=r(!1),S=r(null),X=r({status:""}),Ke={status:[{required:!0,message:"请选择新状态",trigger:"change"}]},ie=r(!1),Q=r(null),Ue=r(!1),B=r(null),Ce=r([]),F=r(null),Fe=r(!1),Z=r(0),ee=r(""),de=r(""),pe=r(!1),ae=r(!1),De=r(null),c=r({car_no:"",vin:"",insurance_no:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,compulsory_amount:void 0,vehicle_tax_amount:void 0,start_date:"",end_date:""}),Xe={car_no:[{required:!0,message:"请输入车牌号",trigger:"blur"}],vin:[{required:!0,message:"请输入车架号",trigger:"blur"}],insurance_no:[{required:!0,message:"请输入投保单号",trigger:"blur"}],insured:[{required:!0,message:"请选择被保人",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}]},le=r(!1),Se=r(null),m=r({track_no:"",insurance_no:"",name:"",quantity:"",carrier:"",consignee:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,start_date:"",end_date:""}),Qe={track_no:[{required:!0,message:"请输入运输编号",trigger:"blur"}],insurance_no:[{required:!0,message:"请输入投保单号",trigger:"blur"}],name:[{required:!0,message:"请输入货物名称",trigger:"blur"}],quantity:[{required:!0,message:"请输入货物数量",trigger:"blur"}],carrier:[{required:!0,message:"请输入承运人",trigger:"blur"}],consignee:[{required:!0,message:"请输入收货人",trigger:"blur"}],insured:[{required:!0,message:"请选择被保人",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}]},te=s=>({正常:"success",结清退保:"success",逾期退保:"danger",提前结清:"success",逾期结清:"danger",退保结清:"danger"})[s]||"info",Ye=s=>({正常:"status-normal",结清退保:"status-success",逾期退保:"status-danger",提前结清:"status-success",逾期结清:"status-danger",退保结清:"status-danger"})[s]||"status-info",Ze=s=>{const{columns:e,data:i}=s,u=[];return e.forEach((x,g)=>{if(g===0){u[g]="合计";return}const V=i.map(k=>{const w=x.property;return w==="commercial_amount"?Number(k.commercial_amount)||0:w==="compulsory_amount"?Number(k.compulsory_amount)||0:w==="vehicle_tax_amount"&&Number(k.vehicle_tax_amount)||0});if(V.length>0){const k=V.reduce((w,d)=>{const z=Number(d);return isNaN(z)?w:w+d},0);x.property==="commercial_amount"||x.property==="compulsory_amount"||x.property==="vehicle_tax_amount"?u[g]=$(k):u[g]=""}else u[g]=""}),u},ea=s=>{const{columns:e,data:i}=s,u=[];return e.forEach((x,g)=>{if(g===0){u[g]="合计";return}const V=i.map(k=>x.property==="commercial_amount"&&Number(k.commercial_amount)||0);if(V.length>0){const k=V.reduce((w,d)=>{const z=Number(d);return isNaN(z)?w:w+d},0);x.property==="commercial_amount"?u[g]=$(k):u[g]=""}else u[g]=""}),u},aa=()=>{Me.back()},la=()=>{Me.push(`/order/detail/${U.params.id}`)},T=async()=>{ue.value=!0;try{const s=await nl(U.params.id);E.value=s.data.insurances||[],s.data.type&&(f.value=s.data.type)}catch{p.error("获取投保信息失败")}ue.value=!1},$=s=>s?`¥${s.toFixed(2)}`:"¥0.00",ta=Pe(()=>{if(f.value!=="车险"||!E.value.length)return{commercialTotal:0,compulsoryTotal:0,vehicleTaxTotal:0,grandTotal:0,statusStats:{}};const s=E.value.reduce((e,i)=>{e.commercialTotal+=i.commercial_amount||0,e.compulsoryTotal+=i.compulsory_amount||0,e.vehicleTaxTotal+=i.vehicle_tax_amount||0;const u=i.status||"未知";return e.statusStats[u]||(e.statusStats[u]={total:0,count:0}),e.statusStats[u].total+=i.commercial_amount||0,e.statusStats[u].count+=1,e},{commercialTotal:0,compulsoryTotal:0,vehicleTaxTotal:0,statusStats:{}});return s.grandTotal=s.commercialTotal+s.compulsoryTotal+s.vehicleTaxTotal,s}),sa=Pe(()=>{if(f.value!=="货运险"||!E.value.length)return{commercialTotal:0,averageAmount:0,statusStats:{}};const s=E.value.reduce((u,x)=>u+(x.commercial_amount||0),0),e=s/E.value.length,i={};return E.value.forEach(u=>{const x=u.status||"未知";i[x]||(i[x]={total:0,count:0}),i[x].total+=u.commercial_amount||0,i[x].count+=1}),{commercialTotal:s,averageAmount:e,statusStats:i}}),oa=()=>{if(f.value==="车险"){if(c.value={car_no:"",vin:"",insurance_no:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,compulsory_amount:void 0,vehicle_tax_amount:void 0,start_date:"",end_date:""},N.value.length===2){const s=N.value.find(e=>e.value!=="同借款人");s&&(c.value.insured=s.value)}ae.value=!0}else if(f.value==="货运险"){if(m.value={track_no:"",insurance_no:"",name:"",quantity:"",carrier:"",consignee:"",insured:"",same_as_borrower:!1,commercial_amount:void 0,start_date:"",end_date:""},N.value.length===2){const s=N.value.find(e=>e.value!=="同借款人");s&&(m.value.insured=s.value)}le.value=!0}},ua=async()=>{De.value&&await De.value.validate(async s=>{if(s){P.value=!0;try{await We(U.params.id,c.value),p.success("添加车险信息成功"),ae.value=!1,T()}catch(e){p.error("添加车险信息失败："+(e.message||"未知错误"))}P.value=!1}})},na=async()=>{Se.value&&await Se.value.validate(async s=>{if(s){P.value=!0;try{await We(U.params.id,m.value),p.success("添加货运险信息成功"),le.value=!1,T()}catch(e){p.error("添加货运险信息失败："+(e.message||"未知错误"))}P.value=!1}})},Ie=async s=>{try{await Aa.confirm("确定要删除该投保信息吗？","提示",{type:"warning"}),await il(U.params.id,s.id),p.success("删除成功"),T()}catch(e){e!=="cancel"&&p.error("删除失败："+(e.message||"未知错误"))}},Re=(s,e)=>{const i=e==="car"?s.car_no:s.track_no;de.value=i,Z.value=s.id,ee.value=e,Fe.value=!0},Le=(s,e)=>{const i=e==="car"?s.car_no:s.track_no;de.value=i,Z.value=s.id,ee.value=e,pe.value=!0};Ia(pe,s=>{s||(Z.value=0,ee.value="")});const ra=async()=>{window.open(`/api/admin/orders/insurances/download-template?type=${f.value}`,"_blank")},ia=async()=>{window.open(`/api/admin/orders/insurances/download-status-template?type=${f.value}`,"_blank")},da=()=>{B.value=null,Ce.value=[],F.value=null,ie.value=!0},pa=s=>{if(B.value=s.raw,!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(s.raw.type)&&!s.name.toLowerCase().endsWith(".xlsx")&&!s.name.toLowerCase().endsWith(".xls")){p.error("请上传Excel文件(.xlsx或.xls)"),Q.value.clearFiles(),B.value=null;return}if(s.raw.size>10*1024*1024){p.error("文件大小不能超过10MB"),Q.value.clearFiles(),B.value=null;return}},ma=async()=>{if(!B.value){p.error("请选择要上传的文件");return}const s=new FormData;s.append("file",B.value),Ue.value=!0,F.value=null;try{const e=await dl(U.params.id,s);F.value=e.data,e.data.success_count>0?(T(),p.success(`更新完成：成功${e.data.success_count}条，失败${e.data.fail_count}条`)):p.warning("没有成功更新任何数据，请检查文件格式")}catch(e){p.error("更新失败："+(e.message||"未知错误"))}Ue.value=!1},ca=()=>{ie.value=!1,B.value=null,Ce.value=[],F.value=null,Q.value&&Q.value.clearFiles()},Be=s=>{S.value=s,X.value.status="",K.value=!0},va=async()=>{xe.value&&await xe.value.validate(async s=>{if(s){he.value=!0;try{await pl(U.params.id,S.value.id,X.value),p.success("状态更新成功"),K.value=!1,T()}catch(e){p.error("状态更新失败："+(e.message||"未知错误"))}he.value=!1}})},_a=()=>{L.value=null,be.value=[],C.value=null,ne.value=!0},fa=s=>{if(L.value=s.raw,!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(s.raw.type)&&!s.name.toLowerCase().endsWith(".xlsx")&&!s.name.toLowerCase().endsWith(".xls")){p.error("请上传Excel文件(.xlsx或.xls)"),G.value.clearFiles(),L.value=null;return}if(s.raw.size>10*1024*1024){p.error("文件大小不能超过10MB"),G.value.clearFiles(),L.value=null;return}},ga=async()=>{if(!L.value){p.error("请选择要上传的文件");return}const s=new FormData;s.append("file",L.value),ge.value=!0,C.value=null;try{const e=await ml(U.params.id,s);C.value=e.data,e.data.success>0?(T(),p.success(`导入完成：成功${e.data.success}条，失败${e.data.fail}条`)):p.warning("没有成功导入任何数据，请检查文件格式")}catch(e){p.error("导入失败："+(e.message||"未知错误"))}ge.value=!1},ba=()=>{ne.value=!1,L.value=null,be.value=[],C.value=null,G.value&&G.value.clearFiles()},$e=s=>{s==="car"?c.value.same_as_borrower?c.value.insured="同借款人":c.value.insured="":s==="cargo"&&(m.value.same_as_borrower?m.value.insured="同借款人":m.value.insured="")},ya=()=>{M.value=[],we.value=[],W.value=!0},wa=s=>{if(!["image/jpeg","image/jpg","image/png","image/bmp","image/tiff","image/webp"].includes(s.raw.type))return p.error("请上传图片文件"),!1;if(s.raw.size>5*1024*1024)return p.error("图片大小不能超过5MB"),!1;M.value.push(s.raw)},Va=s=>{const e=M.value.findIndex(i=>i.name===s.name);e!==-1&&M.value.splice(e,1)},ka=()=>{W.value=!1,M.value=[],we.value=[],ye.value&&ye.value.clearFiles()},xa=async()=>{if(M.value.length===0){p.error("请选择要上传的行驶证图片");return}const s=new FormData;M.value.forEach(e=>{s.append("images",e)}),J.value=!0;try{await cl(U.params.id,s),p.success("行驶证上传成功，正在后台处理OCR识别"),setTimeout(()=>{J.value=!1,W.value=!1,T()},2e3)}catch(e){p.error("行驶证上传失败："+(e.message||"未知错误"))}J.value=!1},ha=()=>{Y.value=[],ke.value=[],H.value=!0},Ua=s=>{if(!["image/jpeg","image/jpg","image/png","image/bmp","image/tiff","image/webp"].includes(s.raw.type))return p.error("请上传图片文件"),!1;if(s.raw.size>5*1024*1024)return p.error("图片大小不能超过5MB"),!1;Y.value.push(s.raw)},Ca=s=>{const e=Y.value.findIndex(i=>i.name===s.name);e!==-1&&Y.value.splice(e,1)},Fa=()=>{H.value=!1,Y.value=[],ke.value=[],Ve.value&&Ve.value.clearFiles()},Da=async()=>{if(Y.value.length===0){p.error("请选择要上传的投保单图片");return}const s=new FormData;Y.value.forEach(e=>{s.append("images",e)}),re.value=!0;try{await vl(U.params.id,s),p.success("投保单上传成功，正在后台处理OCR识别"),setTimeout(()=>{re.value=!1,H.value=!1,T()},2e3)}catch(e){p.error("投保单上传失败："+(e.message||"未知错误"))}},me=(s,e)=>!s||s.length===0?!1:s.some(i=>i.remark===e),Sa=async()=>{try{const s=await rl(U.params.id);Je.value=s.data,s.data.user_id&&await Ta(s.data.user_id)}catch{p.error("获取订单详情失败")}},Ta=async s=>{try{const e=await _l(s);He.value=e.data;const i=e.data.insureds||"",u=[];u.push({value:"同借款人",label:"同借款人"}),i&&i.split(";").filter(g=>g.trim()).forEach(g=>{const V=g.split(",");if(V.length>=2){const k=V[0].trim(),w=V[1].trim();u.push({value:k,label:w?`${k} (${w})`:k})}}),N.value=u}catch{p.error("获取用户配置失败")}};return Ra(()=>{T(),Sa()}),(s,e)=>{var Ae,Oe;const i=Oa,u=Pa,x=La,g=ja,V=Ga,k=Wa,w=Ba,d=Ja,z=Ha,I=Ka,y=Xa,A=Qa,Te=Za,qe=el,ce=al,ve=ll,Ee=tl,O=$a,j=sl,_e=ol,Ne=ul,ze=qa;return b(),h("div",bl,[o("div",yl,[a(x,{onBack:aa,title:`${f.value}`},{extra:l(()=>[o("div",wl,[a(u,{onClick:la},{default:l(()=>[a(i,null,{default:l(()=>[a(q(Na))]),_:1}),e[36]||(e[36]=n(" 返回详情 "))]),_:1,__:[36]}),a(u,{onClick:ra},{default:l(()=>e[37]||(e[37]=[n(" 下载模板 ")])),_:1,__:[37]}),a(u,{type:"success",onClick:_a},{default:l(()=>e[38]||(e[38]=[n(" 批量导入 ")])),_:1,__:[38]}),f.value==="车险"?(b(),R(u,{key:0,type:"warning",onClick:ya},{default:l(()=>e[39]||(e[39]=[n(" 上传行驶证 ")])),_:1,__:[39]})):D("",!0),a(u,{type:"info",onClick:ha},{default:l(()=>e[40]||(e[40]=[n(" 上传投保单 ")])),_:1,__:[40]}),a(u,{type:"warning",onClick:ia},{default:l(()=>e[41]||(e[41]=[n(" 下载状态模板 ")])),_:1,__:[41]}),a(u,{type:"danger",onClick:da},{default:l(()=>e[42]||(e[42]=[n(" 批量更新状态 ")])),_:1,__:[42]}),a(u,{type:"primary",onClick:oa},{default:l(()=>[a(i,null,{default:l(()=>[a(q(za))]),_:1}),n(" 添加"+_(f.value),1)]),_:1})])]),_:1},8,["title"])]),f.value==="车险"?(b(),R(w,{key:0,class:"detail-card"},{default:l(()=>[a(k,{gutter:16},{default:l(()=>[(b(!0),h(se,null,oe(ta.value.statusStats,(t,v)=>(b(),R(V,{span:5,key:v},{default:l(()=>[o("div",Vl,[a(g,{type:te(v),size:"small"},{default:l(()=>[n(_(v),1)]),_:2},1032,["type"]),o("span",{class:Ge(["status-stat-number",Ye(v)])},_($(t.total)),3),o("span",kl,_(t.count)+"笔",1)])]),_:2},1024))),128))]),_:1})]),_:1})):D("",!0),f.value==="车险"?je((b(),R(w,{key:1,class:"detail-card"},{default:l(()=>[a(z,{data:E.value,border:"",style:{width:"100%"},"show-summary":"","sum-text":"合计","summary-method":Ze},{default:l(()=>[a(d,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(({row:t})=>[a(g,{type:te(t.status)},{default:l(()=>[n(_(t.status),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"car_no",label:"车牌号",width:"110"}),a(d,{prop:"vin",label:"车架号","min-width":"180"}),a(d,{prop:"issue_date",label:"附件标记",width:"120",align:"center"},{default:l(t=>[o("div",xl,[o("div",hl,[e[43]||(e[43]=o("span",{class:"status-label"},"行驶证:",-1)),a(g,{type:me(t.row.attachments,"行驶证")?"success":"info",size:"small"},{default:l(()=>[n(_(me(t.row.attachments,"行驶证")?"已上传":"未上传"),1)]),_:2},1032,["type"])]),o("div",Ul,[e[44]||(e[44]=o("span",{class:"status-label"},"投保单:",-1)),a(g,{type:me(t.row.attachments,"投保单")?"success":"info",size:"small"},{default:l(()=>[n(_(me(t.row.attachments,"投保单")?"已上传":"未上传"),1)]),_:2},1032,["type"])])])]),_:1}),a(d,{prop:"insured",label:"被保人",width:"280"}),a(d,{prop:"commercial_amount",label:"商业险",width:"100"},{default:l(t=>[n(_($(t.row.commercial_amount)),1)]),_:1}),a(d,{prop:"compulsory_amount",label:"交强险",width:"100"},{default:l(t=>[n(_($(t.row.compulsory_amount)),1)]),_:1}),a(d,{prop:"vehicle_tax_amount",label:"车船税",width:"100"},{default:l(t=>[n(_($(t.row.vehicle_tax_amount)),1)]),_:1}),a(d,{prop:"start_date",label:"开始日期",width:"110"}),a(d,{prop:"end_date",label:"结束日期",width:"110"}),a(d,{label:"操作",width:"200",fixed:"right"},{default:l(t=>[a(u,{type:"info",link:"",onClick:v=>Le(t.row,"car")},{default:l(()=>e[45]||(e[45]=[n("附件")])),_:2,__:[45]},1032,["onClick"]),a(u,{type:"primary",link:"",onClick:v=>Re(t.row,"car")},{default:l(()=>e[46]||(e[46]=[n("上传")])),_:2,__:[46]},1032,["onClick"]),a(u,{type:"warning",link:"",onClick:v=>Be(t.row)},{default:l(()=>e[47]||(e[47]=[n("更新")])),_:2,__:[47]},1032,["onClick"]),a(u,{type:"danger",link:"",onClick:v=>Ie(t.row)},{default:l(()=>e[48]||(e[48]=[n("删除")])),_:2,__:[48]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[ze,ue.value]]):D("",!0),f.value==="货运险"?(b(),R(w,{key:2,class:"detail-card"},{default:l(()=>[a(k,{gutter:16},{default:l(()=>[(b(!0),h(se,null,oe(sa.value.statusStats,(t,v)=>(b(),R(V,{span:5,key:v},{default:l(()=>[o("div",Cl,[a(g,{type:te(v),size:"small"},{default:l(()=>[n(_(v),1)]),_:2},1032,["type"]),o("span",{class:Ge(["status-stat-number",Ye(v)])},_($(t.total)),3),o("span",Fl,_(t.count)+"笔",1)])]),_:2},1024))),128))]),_:1})]),_:1})):D("",!0),f.value==="货运险"?je((b(),R(w,{key:3,class:"detail-card"},{default:l(()=>[a(z,{data:E.value,border:"",style:{width:"100%"},"show-summary":"","sum-text":"合计","summary-method":ea},{default:l(()=>[a(d,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(({row:t})=>[a(g,{type:te(t.status)},{default:l(()=>[n(_(t.status),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"track_no",label:"运输编号",width:"140"}),a(d,{prop:"insurance_no",label:"投保单号","min-width":"180"}),a(d,{prop:"name",label:"货物名称",width:"120"}),a(d,{prop:"quantity",label:"货物数量",width:"100"}),a(d,{prop:"carrier",label:"承运人",width:"120"}),a(d,{prop:"consignee",label:"收货人",width:"120"}),a(d,{prop:"insured",label:"被保人",width:"280"}),a(d,{prop:"commercial_amount",label:"商业险",width:"120"},{default:l(t=>[n(_($(t.row.commercial_amount)),1)]),_:1}),a(d,{prop:"start_date",label:"开始日期",width:"110"}),a(d,{prop:"end_date",label:"结束日期",width:"110"}),a(d,{label:"操作",width:"250",fixed:"right"},{default:l(t=>[a(u,{type:"info",link:"",onClick:v=>Le(t.row,"cargo")},{default:l(()=>e[49]||(e[49]=[n("附件")])),_:2,__:[49]},1032,["onClick"]),a(u,{type:"primary",link:"",onClick:v=>Re(t.row,"cargo")},{default:l(()=>e[50]||(e[50]=[n("上传")])),_:2,__:[50]},1032,["onClick"]),a(u,{type:"warning",link:"",onClick:v=>Be(t.row)},{default:l(()=>e[51]||(e[51]=[n("更新")])),_:2,__:[51]},1032,["onClick"]),a(u,{type:"danger",link:"",onClick:v=>Ie(t.row)},{default:l(()=>e[52]||(e[52]=[n("删除")])),_:2,__:[52]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[ze,ue.value]]):D("",!0),a(O,{modelValue:ae.value,"onUpdate:modelValue":e[12]||(e[12]=t=>ae.value=t),title:"添加车险信息",width:"600px"},{footer:l(()=>[o("span",Sl,[a(u,{onClick:e[11]||(e[11]=t=>ae.value=!1)},{default:l(()=>e[54]||(e[54]=[n("取消")])),_:1,__:[54]}),a(u,{type:"primary",onClick:ua,loading:P.value},{default:l(()=>e[55]||(e[55]=[n("确定")])),_:1,__:[55]},8,["loading"])])]),default:l(()=>[a(Ee,{ref_key:"carFormRef",ref:De,model:c.value,rules:Xe,"label-width":"120px"},{default:l(()=>[a(y,{label:"车牌号",prop:"car_no"},{default:l(()=>[a(I,{modelValue:c.value.car_no,"onUpdate:modelValue":e[0]||(e[0]=t=>c.value.car_no=t),placeholder:"请输入车牌号"},null,8,["modelValue"])]),_:1}),a(y,{label:"车架号",prop:"vin"},{default:l(()=>[a(I,{modelValue:c.value.vin,"onUpdate:modelValue":e[1]||(e[1]=t=>c.value.vin=t),placeholder:"请输入车架号"},null,8,["modelValue"])]),_:1}),a(y,{label:"投保单号",prop:"insurance_no"},{default:l(()=>[a(I,{modelValue:c.value.insurance_no,"onUpdate:modelValue":e[2]||(e[2]=t=>c.value.insurance_no=t),placeholder:"请输入投保单号"},null,8,["modelValue"])]),_:1}),a(y,{label:"被保人",prop:"insured"},{default:l(()=>[o("div",Dl,[a(Te,{modelValue:c.value.insured,"onUpdate:modelValue":e[3]||(e[3]=t=>c.value.insured=t),placeholder:"请选择被保人",style:{width:"300px"},disabled:c.value.same_as_borrower},{default:l(()=>[(b(!0),h(se,null,oe(N.value,t=>(b(),R(A,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),a(qe,{modelValue:c.value.same_as_borrower,"onUpdate:modelValue":e[4]||(e[4]=t=>c.value.same_as_borrower=t),onChange:e[5]||(e[5]=t=>$e("car")),class:"same-borrower-checkbox",style:{"margin-left":"10px"}},{default:l(()=>e[53]||(e[53]=[n(" 同借款人 ")])),_:1,__:[53]},8,["modelValue"])])]),_:1}),a(y,{label:"商业险",prop:"commercial_amount"},{default:l(()=>[a(ce,{modelValue:c.value.commercial_amount,"onUpdate:modelValue":e[6]||(e[6]=t=>c.value.commercial_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),a(y,{label:"交强险",prop:"compulsory_amount"},{default:l(()=>[a(ce,{modelValue:c.value.compulsory_amount,"onUpdate:modelValue":e[7]||(e[7]=t=>c.value.compulsory_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),a(y,{label:"车船税",prop:"vehicle_tax_amount"},{default:l(()=>[a(ce,{modelValue:c.value.vehicle_tax_amount,"onUpdate:modelValue":e[8]||(e[8]=t=>c.value.vehicle_tax_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),a(y,{label:"开始日期",prop:"start_date"},{default:l(()=>[a(ve,{modelValue:c.value.start_date,"onUpdate:modelValue":e[9]||(e[9]=t=>c.value.start_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择开始日期"},null,8,["modelValue"])]),_:1}),a(y,{label:"结束日期",prop:"end_date"},{default:l(()=>[a(ve,{modelValue:c.value.end_date,"onUpdate:modelValue":e[10]||(e[10]=t=>c.value.end_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择结束日期"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(O,{modelValue:le.value,"onUpdate:modelValue":e[26]||(e[26]=t=>le.value=t),title:"添加货运险信息",width:"700px"},{footer:l(()=>[o("span",El,[a(u,{onClick:e[25]||(e[25]=t=>le.value=!1)},{default:l(()=>e[57]||(e[57]=[n("取消")])),_:1,__:[57]}),a(u,{type:"primary",onClick:na,loading:P.value},{default:l(()=>e[58]||(e[58]=[n("确定")])),_:1,__:[58]},8,["loading"])])]),default:l(()=>[a(Ee,{ref_key:"cargoFormRef",ref:Se,model:m.value,rules:Qe,"label-width":"120px"},{default:l(()=>[a(y,{label:"运输编号",prop:"track_no"},{default:l(()=>[a(I,{modelValue:m.value.track_no,"onUpdate:modelValue":e[13]||(e[13]=t=>m.value.track_no=t),placeholder:"请输入运输编号"},null,8,["modelValue"])]),_:1}),a(y,{label:"投保单号",prop:"insurance_no"},{default:l(()=>[a(I,{modelValue:m.value.insurance_no,"onUpdate:modelValue":e[14]||(e[14]=t=>m.value.insurance_no=t),placeholder:"请输入投保单号"},null,8,["modelValue"])]),_:1}),a(y,{label:"货物名称",prop:"name"},{default:l(()=>[a(I,{modelValue:m.value.name,"onUpdate:modelValue":e[15]||(e[15]=t=>m.value.name=t),placeholder:"请输入货物名称"},null,8,["modelValue"])]),_:1}),a(y,{label:"货物数量",prop:"quantity"},{default:l(()=>[a(I,{modelValue:m.value.quantity,"onUpdate:modelValue":e[16]||(e[16]=t=>m.value.quantity=t),placeholder:"请输入货物数量"},null,8,["modelValue"])]),_:1}),a(y,{label:"承运人",prop:"carrier"},{default:l(()=>[a(I,{modelValue:m.value.carrier,"onUpdate:modelValue":e[17]||(e[17]=t=>m.value.carrier=t),placeholder:"请输入承运人"},null,8,["modelValue"])]),_:1}),a(y,{label:"收货人",prop:"consignee"},{default:l(()=>[a(I,{modelValue:m.value.consignee,"onUpdate:modelValue":e[18]||(e[18]=t=>m.value.consignee=t),placeholder:"请输入收货人"},null,8,["modelValue"])]),_:1}),a(y,{label:"被保人",prop:"insured"},{default:l(()=>[o("div",Tl,[a(Te,{modelValue:m.value.insured,"onUpdate:modelValue":e[19]||(e[19]=t=>m.value.insured=t),placeholder:"请选择被保人",style:{width:"300px"},disabled:m.value.same_as_borrower},{default:l(()=>[(b(!0),h(se,null,oe(N.value,t=>(b(),R(A,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),a(qe,{modelValue:m.value.same_as_borrower,"onUpdate:modelValue":e[20]||(e[20]=t=>m.value.same_as_borrower=t),onChange:e[21]||(e[21]=t=>$e("cargo")),class:"same-borrower-checkbox",style:{"margin-left":"10px"}},{default:l(()=>e[56]||(e[56]=[n(" 同借款人 ")])),_:1,__:[56]},8,["modelValue"])])]),_:1}),a(y,{label:"商业险",prop:"commercial_amount"},{default:l(()=>[a(ce,{modelValue:m.value.commercial_amount,"onUpdate:modelValue":e[22]||(e[22]=t=>m.value.commercial_amount=t),precision:2,step:100,min:0,style:{width:"100%"},placeholder:"0.00"},null,8,["modelValue"])]),_:1}),a(y,{label:"开始日期",prop:"start_date"},{default:l(()=>[a(ve,{modelValue:m.value.start_date,"onUpdate:modelValue":e[23]||(e[23]=t=>m.value.start_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择开始日期"},null,8,["modelValue"])]),_:1}),a(y,{label:"结束日期",prop:"end_date"},{default:l(()=>[a(ve,{modelValue:m.value.end_date,"onUpdate:modelValue":e[24]||(e[24]=t=>m.value.end_date=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},placeholder:"选择结束日期"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(O,{modelValue:ne.value,"onUpdate:modelValue":e[27]||(e[27]=t=>ne.value=t),title:"批量导入投保信息",width:"600px"},{footer:l(()=>[o("span",Ol,[a(u,{onClick:ba},{default:l(()=>e[67]||(e[67]=[n("取消")])),_:1,__:[67]}),a(u,{type:"primary",onClick:ga,loading:ge.value,disabled:!L.value},{default:l(()=>e[68]||(e[68]=[n(" 开始导入 ")])),_:1,__:[68]},8,["loading","disabled"])])]),default:l(()=>[o("div",Ml,[o("div",Yl,[a(j,{title:"导入说明",type:"info","show-icon":"",closable:!1},{default:l(()=>e[59]||(e[59]=[o("div",{class:"tips-content"},[o("p",null,"1. 请先下载模板，按照模板格式填写数据"),o("p",null,"2. 支持 .xlsx 和 .xls 格式文件"),o("p",null,"3. 必填字段不能为空，金额字段请填写数字"),o("p",null,"4. 日期格式：YYYY-MM-DD，如：2024-01-01")],-1)])),_:1,__:[59]})]),a(_e,{ref_key:"excelUploadRef",ref:G,class:"upload-demo",drag:"","auto-upload":!1,limit:1,accept:".xlsx,.xls","on-change":fa,"file-list":be.value},{tip:l(()=>e[60]||(e[60]=[o("div",{class:"el-upload__tip"}," 只能上传 .xlsx/.xls 文件，且不超过 10MB ",-1)])),default:l(()=>[a(i,{class:"el-icon--upload"},{default:l(()=>[a(q(fe))]),_:1}),e[61]||(e[61]=o("div",{class:"el-upload__text"},[n(" 将Excel文件拖到此处，或"),o("em",null,"点击上传")],-1))]),_:1,__:[61]},8,["file-list"]),C.value?(b(),h("div",Il,[a(w,null,{header:l(()=>e[62]||(e[62]=[o("span",null,"导入结果",-1)])),default:l(()=>[o("div",Rl,[a(k,{gutter:20},{default:l(()=>[a(V,{span:8},{default:l(()=>[o("div",Ll,[o("div",Bl,_(C.value.total),1),e[63]||(e[63]=o("div",{class:"stat-label"},"总数",-1))])]),_:1}),a(V,{span:8},{default:l(()=>[o("div",$l,[o("div",ql,_(C.value.success),1),e[64]||(e[64]=o("div",{class:"stat-label"},"成功",-1))])]),_:1}),a(V,{span:8},{default:l(()=>[o("div",Nl,[o("div",zl,_(C.value.fail),1),e[65]||(e[65]=o("div",{class:"stat-label"},"失败",-1))])]),_:1})]),_:1})]),C.value.errors&&C.value.errors.length>0?(b(),h("div",Al,[a(Ne,{"content-position":"left"},{default:l(()=>e[66]||(e[66]=[n("错误详情")])),_:1,__:[66]}),(b(!0),h(se,null,oe(C.value.errors,(t,v)=>(b(),h("div",{class:"error-item",key:v},[a(g,{type:"danger",size:"small"},{default:l(()=>[n(_(t),1)]),_:2},1024)]))),128))])):D("",!0)]),_:1})])):D("",!0)])]),_:1},8,["modelValue"]),a(O,{modelValue:W.value,"onUpdate:modelValue":e[28]||(e[28]=t=>W.value=t),title:"批量上传行驶证",width:"700px"},{footer:l(()=>[o("span",Jl,[a(u,{onClick:ka},{default:l(()=>e[73]||(e[73]=[n("取消")])),_:1,__:[73]}),a(u,{type:"primary",onClick:xa,loading:J.value,disabled:M.value.length===0},{default:l(()=>e[74]||(e[74]=[n(" 开始上传识别 ")])),_:1,__:[74]},8,["loading","disabled"])])]),default:l(()=>[o("div",Pl,[o("div",jl,[a(j,{type:"info","show-icon":"",closable:!1},{default:l(()=>e[69]||(e[69]=[o("div",{class:"tips-content"},[o("p",null,"1. 支持 JPG、PNG、BMP、TIFF、WEBP 格式"),o("p",null,"2. 系统将自动OCR识别行驶证信息并匹配车险记录"),o("p",null,"3. 请确保先录入车险信息再上传对应的行驶证")],-1)])),_:1,__:[69]})]),a(_e,{ref_key:"driverLicenseUploadRef",ref:ye,class:"upload-demo",drag:"",multiple:"","auto-upload":!1,limit:0,accept:"image/*","on-change":wa,"on-remove":Va,"file-list":we.value},{tip:l(()=>e[70]||(e[70]=[o("div",{class:"el-upload__tip"}," 支持多张图片同时上传，每张不超过5MB ",-1)])),default:l(()=>[a(i,{class:"el-icon--upload"},{default:l(()=>[a(q(fe))]),_:1}),e[71]||(e[71]=o("div",{class:"el-upload__text"},[n(" 将行驶证图片拖到此处，或"),o("em",null,"点击上传")],-1))]),_:1,__:[71]},8,["file-list"]),J.value?(b(),h("div",Gl,[a(j,{title:"正在上传处理中...",type:"info","show-icon":"",closable:!1},{default:l(()=>[o("div",Wl,[o("p",null,"已选择 "+_(M.value.length)+" 张图片",1),e[72]||(e[72]=o("p",null,"正在后台进行OCR识别和匹配处理，请稍后查看结果",-1))])]),_:1})])):D("",!0)])]),_:1},8,["modelValue"]),a(O,{modelValue:H.value,"onUpdate:modelValue":e[29]||(e[29]=t=>H.value=t),title:"批量上传投保单",width:"700px"},{footer:l(()=>[o("span",Zl,[a(u,{onClick:Fa},{default:l(()=>e[79]||(e[79]=[n("取消")])),_:1,__:[79]}),a(u,{type:"primary",onClick:Da,loading:re.value,disabled:Y.value.length===0},{default:l(()=>e[80]||(e[80]=[n(" 开始上传识别 ")])),_:1,__:[80]},8,["loading","disabled"])])]),default:l(()=>[o("div",Hl,[o("div",Kl,[a(j,{type:"info","show-icon":"",closable:!1},{default:l(()=>e[75]||(e[75]=[o("div",{class:"tips-content"},[o("p",null,"1. 支持 JPG、PNG、BMP、TIFF、WEBP 格式"),o("p",null,"2. 系统将自动OCR识别投保单信息并匹配保险记录"),o("p",null,"3. 请确保先录入保险信息再上传对应的投保单")],-1)])),_:1,__:[75]})]),a(_e,{ref_key:"insuranceFormUploadRef",ref:Ve,class:"upload-demo",drag:"",multiple:"","auto-upload":!1,limit:0,accept:"image/*","on-change":Ua,"on-remove":Ca,"file-list":ke.value},{tip:l(()=>e[76]||(e[76]=[o("div",{class:"el-upload__tip"}," 支持多张图片同时上传，每张不超过5MB ",-1)])),default:l(()=>[a(i,{class:"el-icon--upload"},{default:l(()=>[a(q(fe))]),_:1}),e[77]||(e[77]=o("div",{class:"el-upload__text"},[n(" 将投保单图片拖到此处，或"),o("em",null,"点击上传")],-1))]),_:1,__:[77]},8,["file-list"]),re.value?(b(),h("div",Xl,[a(j,{title:"正在上传处理中...",type:"info","show-icon":"",closable:!1},{default:l(()=>[o("div",Ql,[o("p",null,"已选择 "+_(Y.value.length)+" 张图片",1),e[78]||(e[78]=o("p",null,"正在后台进行OCR识别和匹配处理，请稍后查看结果",-1))])]),_:1})])):D("",!0)])]),_:1},8,["modelValue"]),a(fl,{visible:Fe.value,"onUpdate:visible":e[30]||(e[30]=t=>Fe.value=t),title:de.value,"order-id":q(U).params.id,"ref-id":Z.value,type:ee.value,onSuccess:T},null,8,["visible","title","order-id","ref-id","type"]),a(gl,{visible:pe.value,"onUpdate:visible":e[31]||(e[31]=t=>pe.value=t),title:de.value,"order-id":q(U).params.id,"ref-id":Z.value,type:ee.value,"allow-delete":!0},null,8,["visible","title","order-id","ref-id","type"]),a(O,{modelValue:K.value,"onUpdate:modelValue":e[34]||(e[34]=t=>K.value=t),title:`更新${f.value}状态 - ${f.value==="车险"?(Ae=S.value)==null?void 0:Ae.car_no:(Oe=S.value)==null?void 0:Oe.track_no}`,width:"500px"},{footer:l(()=>[o("span",et,[a(u,{onClick:e[33]||(e[33]=t=>K.value=!1)},{default:l(()=>e[81]||(e[81]=[n("取消")])),_:1,__:[81]}),a(u,{type:"primary",onClick:va,loading:he.value},{default:l(()=>e[82]||(e[82]=[n(" 确定 ")])),_:1,__:[82]},8,["loading"])])]),default:l(()=>[a(Ee,{ref_key:"updateStatusFormRef",ref:xe,model:X.value,rules:Ke,"label-width":"100px"},{default:l(()=>[a(y,{label:f.value==="车险"?"车牌号":"运单号"},{default:l(()=>{var t,v;return[o("span",null,_(f.value==="车险"?(t=S.value)==null?void 0:t.car_no:(v=S.value)==null?void 0:v.track_no),1)]}),_:1},8,["label"]),a(y,{label:f.value==="车险"?"车架号":"承运车辆"},{default:l(()=>{var t,v;return[o("span",null,_(f.value==="车险"?(t=S.value)==null?void 0:t.vin:(v=S.value)==null?void 0:v.carrier),1)]}),_:1},8,["label"]),a(y,{label:"当前状态"},{default:l(()=>{var t;return[a(g,{type:te((t=S.value)==null?void 0:t.status)},{default:l(()=>{var v;return[n(_(((v=S.value)==null?void 0:v.status)||"未知"),1)]}),_:1},8,["type"])]}),_:1}),a(y,{label:"新状态",prop:"status"},{default:l(()=>[a(Te,{modelValue:X.value.status,"onUpdate:modelValue":e[32]||(e[32]=t=>X.value.status=t),placeholder:"请选择新状态",style:{width:"100%"}},{default:l(()=>[a(A,{label:"正常",value:"正常"}),a(A,{label:"逾期退保",value:"逾期退保"}),a(A,{label:"提前结清",value:"提前结清"}),a(A,{label:"逾期结清",value:"逾期结清"}),a(A,{label:"退保结清",value:"退保结清"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(O,{modelValue:ie.value,"onUpdate:modelValue":e[35]||(e[35]=t=>ie.value=t),title:"批量更新保险状态",width:"700px"},{footer:l(()=>[o("span",_t,[a(u,{onClick:ca},{default:l(()=>e[93]||(e[93]=[n("取消")])),_:1,__:[93]}),a(u,{type:"primary",onClick:ma,loading:Ue.value,disabled:!B.value},{default:l(()=>e[94]||(e[94]=[n(" 开始更新 ")])),_:1,__:[94]},8,["loading","disabled"])])]),default:l(()=>[o("div",at,[o("div",lt,[a(j,{title:"更新说明",type:"info","show-icon":"",closable:!1},{default:l(()=>[o("div",tt,[e[83]||(e[83]=o("p",null,"1. 请先下载状态模板，按照模板格式填写数据",-1)),e[84]||(e[84]=o("p",null,"2. 支持 .xlsx 和 .xls 格式文件",-1)),f.value==="车险"?(b(),h("p",st,"3. 车牌号和车架号至少填写一个")):(b(),h("p",ot,"3. 运单号和承运车辆至少填写一个")),e[85]||(e[85]=o("p",null,"4. 新状态必须是：正常、逾期退保、提前结清、逾期结清、退保结清",-1))])]),_:1})]),a(_e,{ref_key:"batchUpdateStatusUploadRef",ref:Q,class:"upload-demo",drag:"","auto-upload":!1,limit:1,accept:".xlsx,.xls","on-change":pa,"file-list":Ce.value},{tip:l(()=>e[86]||(e[86]=[o("div",{class:"el-upload__tip"}," 只能上传 .xlsx/.xls 文件，且不超过 10MB ",-1)])),default:l(()=>[a(i,{class:"el-icon--upload"},{default:l(()=>[a(q(fe))]),_:1}),e[87]||(e[87]=o("div",{class:"el-upload__text"},[n(" 将Excel文件拖到此处，或"),o("em",null,"点击上传")],-1))]),_:1,__:[87]},8,["file-list"]),F.value?(b(),h("div",ut,[a(w,null,{header:l(()=>e[88]||(e[88]=[o("span",null,"更新结果",-1)])),default:l(()=>[o("div",nt,[a(k,{gutter:20},{default:l(()=>[a(V,{span:8},{default:l(()=>[o("div",rt,[o("div",it,_(F.value.total_count),1),e[89]||(e[89]=o("div",{class:"stat-label"},"总数",-1))])]),_:1}),a(V,{span:8},{default:l(()=>[o("div",dt,[o("div",pt,_(F.value.success_count),1),e[90]||(e[90]=o("div",{class:"stat-label"},"成功",-1))])]),_:1}),a(V,{span:8},{default:l(()=>[o("div",mt,[o("div",ct,_(F.value.fail_count),1),e[91]||(e[91]=o("div",{class:"stat-label"},"失败",-1))])]),_:1})]),_:1})]),F.value.results&&F.value.results.length>0?(b(),h("div",vt,[a(Ne,{"content-position":"left"},{default:l(()=>e[92]||(e[92]=[n("详细结果")])),_:1,__:[92]}),a(z,{data:F.value.results,border:"",size:"small","max-height":"300"},{default:l(()=>[a(d,{prop:"row",label:"行号",width:"60",align:"center"}),a(d,{prop:f.value==="车险"?"car_no":"track_no",label:f.value==="车险"?"车牌号":"运单号",width:"120"},null,8,["prop","label"]),a(d,{prop:f.value==="车险"?"vin":"carrier",label:f.value==="车险"?"车架号":"承运车辆",width:"150"},null,8,["prop","label"]),a(d,{prop:"new_status",label:"新状态",width:"100"}),a(d,{prop:"status",label:"处理状态",width:"100",align:"center"},{default:l(({row:t})=>[a(g,{type:t.status==="success"?"success":"danger",size:"small"},{default:l(()=>[n(_(t.status==="success"?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"message",label:"消息","min-width":"200"})]),_:1},8,["data"])])):D("",!0)]),_:1})])):D("",!0)])]),_:1},8,["modelValue"])])}}},Nt=Ea(ft,[["__scopeId","data-v-2ebb6273"]]);export{Nt as default};
