import{_ as ga,b as ba,u as ha,a as wa}from"./index-8c2402d9.js";/* empty css                   *//* empty css                       *//* empty css                     *//* empty css               *//* empty css                  *//* empty css                        *//* empty css                        *//* empty css                    *//* empty css               *//* empty css                *//* empty css                             *//* empty css                   *//* empty css                       */import{f as R,a as y}from"./format-20468769.js";import{a as ka,r as Ca,b as Va,m as $a,d as Aa}from"./order-dc146777.js";import{A as F,u as Ma}from"./AttachmentList-7f15d247.js";import{m as xa}from"./receivable-004bb536.js";import{c as Ua}from"./received-ac1a3836.js";import{r as b,ae as Sa,l as g,B as V,C as m,F as a,G as l,p as M,S as $,E as h,aE as Ea,ag as Da,ah as Na,M as Ra,u as p,O as s,af as Te,D as o,aF as Pa,J,K as Ia,az as Ta,am as Ba,aA as za,ao as Ya,al as Fa,an as Oa,a5 as qa,a6 as Ha,aG as La,ax as Ga,ay as Ja,aH as Ka,a7 as Qa,ai as ja}from"./element-plus-b8725afa.js";import{A as K}from"./AttachmentUpload-eefc5aad.js";import{L as Wa}from"./LogList-5621fdb4.js";/* empty css                 *//* empty css                    *//* empty css                      *//* empty css                         */import"./log-d49f5ddd.js";const Xa={class:"order-detail"},Za={class:"page-header"},et={class:"header-actions"},at={class:"overview-section"},tt={class:"key-metrics"},lt={class:"metric-item"},nt={class:"metric-value"},rt={class:"metric-item"},st={class:"metric-value"},ot={class:"metric-item"},ut={class:"metric-value"},it={class:"metric-item"},dt={class:"metric-value"},ct={class:"metric-item"},mt={class:"metric-value"},pt={key:0,class:"empty-state"},_t={key:0,class:"empty-state"},vt={style:{color:"#67c23a","font-weight":"bold"}},ft={style:{color:"#e6a23c","font-weight":"bold"}},yt={style:{color:"#409eff"}},gt={style:{color:"#67c23a"}},bt={key:0,style:{color:"#67c23a","font-weight":"bold"}},ht={key:1},wt={key:0,style:{color:"#f56c6c"}},kt={key:1},Ct={key:0,style:{color:"#f56c6c"}},Vt={key:1},$t={key:0,style:{color:"#f56c6c","font-weight":"bold"}},At={key:1},Mt={key:1,style:{color:"#67c23a"}},xt={class:"payment-info"},Ut={key:1,class:"payment-section"},St={class:"payment-section"},Et={key:2,class:"payment-section"},Dt={class:"remark-content"},Nt={class:"dialog-footer"},Rt={class:"dialog-footer"},Pt={class:"dialog-footer"},It={__name:"detail",setup(Tt){const _e=ba(),ve=ha(),D=b(!1),n=b({}),P=wa(),B=b(!1),Q=b(null),j=b(!1),w=b({rec_type:"",amount:0,method:"",date_time:"",remark:""}),z=b(!1),W=b(null),X=b(!1),O=b(null),U=b({actual_amount:0,method:"",actual_date:""}),q=b(!1),Z=b(!1),c=b({}),ee=b(!1),ae=b(!1),te=b(!1),le=b(!1),ne=b(!1),re=b(!1),se=b(!1),oe=b(!1),x=b(null),I=b(null),ue=b(!1),ie=b(null),Be={rec_type:[{required:!0,message:"请选择收款类型",trigger:"change"}],amount:[{required:!0,message:"请输入还款金额",trigger:"blur"},{type:"number",min:.01,message:"金额必须大于0",trigger:"blur"}],method:[{required:!0,message:"请选择还款方式",trigger:"change"}],date_time:[{required:!0,message:"请选择还款时间",trigger:"change"}]},ze={actual_amount:[{required:!0,message:"请输入实际收款金额",trigger:"blur"},{type:"number",min:.01,message:"金额必须大于0",trigger:"blur"}],method:[{required:!0,message:"请选择收款方式",trigger:"change"}],actual_date:[{required:!0,message:"请选择收款日期",trigger:"change"}]},N=async()=>{D.value=!0;try{const r=await ka(_e.params.id);n.value=r.data,n.value.total_commercial=0,n.value.insurance_type==="车险"&&n.value.car_insurance&&n.value.car_insurance.length>0?n.value.total_commercial=n.value.car_insurance.reduce((e,u)=>e+(u.commercial_amount||0),0):n.value.insurance_type==="货运险"&&n.value.cargo_insurance&&n.value.cargo_insurance.length>0&&(n.value.total_commercial=n.value.cargo_insurance.reduce((e,u)=>e+(u.commercial_amount||0),0))}catch{h.error("获取订单详情失败")}D.value=!1},Ye=()=>{ve.back()},H=async()=>{try{let r="",e="下一状态";n.value.status==="待初审"?(r="初审通过",e="待复审"):n.value.status==="待复审"&&(r="复审通过",e="待客户签约"),await J.confirm(`确定要将订单状态从 [${n.value.status}] 更新为 [${e}] 吗？`,"审核确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),D.value=!0,await Ca(n.value.id,{audit_note:r}),h.success("审核成功"),N()}catch(r){r!=="cancel"&&h.error("审核失败")}D.value=!1},Fe=r=>{const{columns:e,data:u}=r,_=[];return e.forEach((d,v)=>{if(v===0){_[v]="合计";return}if(d.property==="total_amount"){const f=u.reduce((C,A)=>C+(A.commercial_amount||0)+(A.compulsory_amount||0)+(A.vehicle_tax_amount||0),0);_[v]=y(f);return}const k=u.map(f=>Number(f[d.property]));if(k.every(f=>isNaN(f)))_[v]="-";else{const f=k.reduce((C,A)=>{const i=Number(A);return isNaN(i)?C:C+i},0);d.property==="commercial_amount"||d.property==="compulsory_amount"||d.property==="vehicle_tax_amount"?_[v]=y(f):_[v]="-"}}),_},Oe=r=>{const{columns:e,data:u}=r,_=[];return e.forEach((d,v)=>{if(v===0){_[v]="合计";return}const k=u.map(f=>Number(f[d.property]));if(k.every(f=>isNaN(f)))_[v]="-";else{const f=k.reduce((C,A)=>{const i=Number(A);return isNaN(i)?C:C+i},0);d.property==="commercial_amount"?_[v]=y(f):_[v]="-"}}),_},fe=r=>({正常:"success",结清退保:"success",逾期退保:"danger",提前结清:"success",逾期结清:"danger",退保结清:"danger"})[r]||"info",qe=r=>({待审核:"warning",待复审:"warning",待客户签约:"info",待资方签约:"info",待放款:"warning",已放款:"success",已退保:"danger",已结清:"success",已作废:"danger"})[r]||"info",de=()=>{ve.push(`/order/insurance/${n.value.id}`)},He=(r,e)=>{if(!n.value.attachments||n.value.attachments.length===0){h.warning("暂无附件可查看");return}const u=r.find(_=>_.remark===e);if(!u){h.warning("暂无附件可查看");return}window.open(`/api/admin/attachments/${u.id}/view`)},Le=()=>{ce(n.value.attachments,"缴费通知书")?He(n.value.attachments,"缴费通知书"):Ge("缴费通知书")},Ge=r=>{const e=document.createElement("input");e.type="file",e.accept="*/*",e.style.display="none",e.onchange=async u=>{const _=u.target.files[0];if(_){try{const d=new FormData;d.append("files",_),d.append("remarks",r),await Ma(n.value.id,0,d),h.success("上传成功"),N()}catch(d){console.error("上传失败:",d),h.error("上传失败")}document.body.removeChild(e)}},document.body.appendChild(e),e.click()},Je=()=>{ee.value=!0},Ke=()=>{ae.value=!0},L=()=>{h.success("附件上传成功"),N()},Qe=r=>{x.value=r,te.value=!0},je=r=>{x.value=r,le.value=!0},We=r=>{x.value=r,ne.value=!0},Xe=r=>{x.value=r,re.value=!0},Ze=async()=>{try{await J.confirm("确定要作废该订单吗？作废后不可恢复！","作废确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),D.value=!0,await Va(n.value.id),h.success("订单已作废"),N()}catch(r){r!=="cancel"&&h.error("作废失败")}D.value=!1},ea=r=>{if(!r){h.warning("签署链接不存在");return}ye(r,"签署链接")},ye=(r,e)=>{const u=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);navigator.clipboard&&(window.isSecureContext||u)?navigator.clipboard.writeText(r).then(()=>{h.success(`${e}已复制到剪贴板`)}).catch(_=>{console.error("使用 Clipboard API 复制失败:",_),ge(r,e)}):ge(r,e)},ge=(r,e)=>{try{const u=document.createElement("textarea");u.value=r,u.style.position="fixed",u.style.left="-999999px",u.style.top="-999999px",document.body.appendChild(u),u.focus(),u.select();const _=document.execCommand("copy");if(document.body.removeChild(u),_)h.success(`${e}已复制到剪贴板`);else throw new Error("execCommand 复制失败")}catch(u){console.error("复制失败:",u),J.alert(r,`请手动复制${e}`,{confirmButtonText:"确定",type:"info",customClass:"copy-url-dialog"})}},aa=r=>({已签署:"success",未签署:"warning",已作废:"danger"})[r]||"info",ta=r=>({已签署:"success",未签署:"warning",已作废:"danger",签署失败:"danger",信托签署中:"warning"})[r]||"info",la=r=>({还款:"success",本金:"primary",利息:"info",退保:"danger",违约金:"warning",滞纳金:"warning"})[r]||"info",na=r=>({微信:"success",支付宝:"primary",银行卡:"warning"})[r]||"info",ra=r=>({待收款:"warning",已收款:"success",已逾期:"danger"})[r]||"info",sa=()=>{w.value={rec_type:"",amount:0,method:"",date_time:new Date().toISOString().slice(0,19).replace("T"," "),remark:""},B.value=!0},oa=async()=>{Q.value&&await Q.value.validate(async r=>{if(r){j.value=!0;try{const e={rec_type:w.value.rec_type,user_id:n.value.user_id,order_id:n.value.id,order_no:n.value.order_no,amount:w.value.amount,method:w.value.method,date_time:w.value.date_time,remark:w.value.remark||w.value.rec_type};await Ua(e),h.success("提前还款记录创建成功"),B.value=!1,N()}catch(e){h.error("创建提前还款记录失败："+(e.message||"未知错误"))}j.value=!1}})},ua=r=>{O.value=r,U.value={actual_amount:r.amount,method:"微信",actual_date:new Date().toISOString().split("T")[0]},z.value=!0},ia=async()=>{W.value&&await W.value.validate(async r=>{if(r){X.value=!0;try{await xa(O.value.id,{actual_amount:U.value.actual_amount,actual_date:U.value.actual_date,method:U.value.method}),h.success("标记收款成功"),z.value=!1,N()}catch(e){h.error("标记收款失败："+(e.message||"未知错误"))}X.value=!1}})},da=r=>{I.value=r,se.value=!0},ca=r=>{I.value=r,oe.value=!0},ma=async r=>{try{await J.confirm("确定要手动触发资方签署吗？这将调用信托签署接口。","资方签署确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),D.value=!0,await $a(n.value.id,r.id),h.success("资方签署已触发，请查看订单日志了解进度"),await N()}catch(e){e!=="cancel"&&(console.error("手动资方签署失败:",e),h.error("资方签署失败："+(e.message||"未知错误")))}finally{D.value=!1}},pa=r=>{ie.value=r,ue.value=!0},_a=async()=>{if(!n.value.id){h.warning("订单信息不存在");return}Z.value=!0;try{const r=await Aa(n.value.id);c.value=r.data,q.value=!0,h.success("前置款信息生成成功")}catch(r){h.error("生成前置款信息失败："+(r.message||"未知错误"))}Z.value=!1},va=()=>{if(!c.value.batch_no){h.warning("暂无前置款信息可复制");return}let r="";c.value.is_recv_srv_fee=="是"?r=`
批次号：${c.value.batch_no}
借款人：${c.value.borrower}
${c.value.vehicle_info}
总保费：${y(c.value.total_premium)}

支付首付款：${y(c.value.total_down_payment)}
${c.value.down_payment_detail}
户名：${c.value.funder_account_name}
账户：${c.value.funder_account_no}
开户行：${c.value.funder_bank_name}

${c.value.remark||""}
  `.trim():r=`
批次号：${c.value.batch_no}
借款人：${c.value.borrower}
${c.value.vehicle_info}
总保费：${y(c.value.total_premium)}

支付服务费：${y(c.value.service_fee)}
户名：${c.value.service_account_name}
账户：${c.value.service_account_no}
开户行：${c.value.service_bank_name}

支付首付款：${y(c.value.total_down_payment)}
${c.value.down_payment_detail}
户名：${c.value.funder_account_name}
账户：${c.value.funder_account_no}
开户行：${c.value.funder_bank_name}

${c.value.remark||""}
  `.trim(),ye(r,"前置款信息")},fa=r=>{const{columns:e,data:u}=r,_=[];return e.forEach((d,v)=>{if(v===0){_[v]="合计";return}const k=u.map(f=>Number(f[d.property]));if(k.every(f=>isNaN(f)))_[v]="-";else{const f=k.reduce((C,A)=>{const i=Number(A);return isNaN(i)?C:C+i},0);d.property==="amount"||d.property==="principal_amount"||d.property==="interest_amount"||d.property==="penalty_amount"||d.property==="forfeit_amount"||d.property==="actual_amount"?_[v]=y(f):_[v]="-"}}),_},ya=r=>{const{columns:e,data:u}=r,_=[];return e.forEach((d,v)=>{if(v===0){_[v]="合计";return}const k=u.map(f=>Number(f[d.property]));if(k.every(f=>isNaN(f)))_[v]="-";else{const f=k.reduce((C,A)=>{const i=Number(A);return isNaN(i)?C:C+i},0);d.property==="amount"?_[v]=y(f):_[v]="-"}}),_},ce=(r,e)=>!r||r.length===0?!1:r.some(u=>u.remark===e);return Sa(()=>{N()}),(r,e)=>{var Ce,Ve,$e,Ae,Me,xe,Ue,Se,Ee,De,Ne,Re,Pe,Ie;const u=Ia,_=Ea,d=Ta,v=Ba,k=za,f=Da,C=Ya,A=Na,i=Fa,Y=Oa,me=Ra,G=qa,S=Ha,be=La,E=Ga,pe=Ja,he=Ka,we=Qa,ke=ja;return g(),V("div",Xa,[m("div",Za,[a(_,{onBack:Ye,title:n.value.order_no||"订单详情"},{extra:l(()=>[m("div",et,[n.value.status==="待初审"&&p(P).riskBasicPrivate?(g(),M(u,{key:0,type:"success",onClick:H},{default:l(()=>e[25]||(e[25]=[s("初审通过")])),_:1,__:[25]})):$("",!0),n.value.status==="待复审"&&p(P).riskManagerPrivate?(g(),M(u,{key:1,type:"warning",onClick:H},{default:l(()=>e[26]||(e[26]=[s("复审通过")])),_:1,__:[26]})):$("",!0),n.value.status==="待放款"&&p(P).operationManagerPrivate?(g(),M(u,{key:2,type:"info",onClick:H},{default:l(()=>e[27]||(e[27]=[s("放款")])),_:1,__:[27]})):$("",!0),n.value.status==="已放款"&&p(P).operationManagerPrivate?(g(),M(u,{key:3,type:"success",onClick:sa},{default:l(()=>e[28]||(e[28]=[s("提前还款")])),_:1,__:[28]})):$("",!0),n.value.status!=="已作废"&&(p(P).operationManagerPrivate||p(P).riskManagerPrivate)?(g(),M(u,{key:4,type:"danger",onClick:Ze},{default:l(()=>e[29]||(e[29]=[s("作废订单")])),_:1,__:[29]})):$("",!0),p(P).superPrivate?(g(),M(u,{key:5,type:"primary",onClick:H},{default:l(()=>e[30]||(e[30]=[s("下一状态（调试用）")])),_:1,__:[30]})):$("",!0),a(u,{type:"default",onClick:de},{default:l(()=>e[31]||(e[31]=[s("管理投保单")])),_:1,__:[31]}),a(u,{type:"default",onClick:_a},{default:l(()=>e[32]||(e[32]=[s("生成前置款")])),_:1,__:[32]}),a(u,{type:"default",onClick:e[0]||(e[0]=t=>Je())},{default:l(()=>e[33]||(e[33]=[s("查看附件")])),_:1,__:[33]}),a(u,{type:"default",onClick:e[1]||(e[1]=t=>Ke())},{default:l(()=>e[34]||(e[34]=[s("上传附件")])),_:1,__:[34]})])]),_:1},8,["title"])]),m("div",at,[a(A,{gutter:20},{default:l(()=>[a(C,{span:18},{default:l(()=>[Te((g(),M(f,{class:"info-card"},{default:l(()=>[a(k,{column:2,border:""},{default:l(()=>[a(d,{label:"订单编号"},{default:l(()=>[s(o(n.value.order_no),1)]),_:1}),a(d,{label:"订单状态"},{default:l(()=>[a(v,{type:qe(n.value.status)},{default:l(()=>[s(o(n.value.status),1)]),_:1},8,["type"]),e[35]||(e[35]=m("span",{style:{"margin-left":"10px"}},null,-1)),a(v,{style:{cursor:"pointer"},onClick:Le,type:ce(n.value.attachments,"缴费通知书")?"success":"info"},{default:l(()=>[s(o(ce(n.value.attachments,"缴费通知书")?"缴费通知书已上传":"缴费通知书未上传"),1)]),_:1},8,["type"])]),_:1,__:[35]}),a(d,{label:"保险类型"},{default:l(()=>[s(o(n.value.insurance_type),1)]),_:1}),a(d,{label:"借款主体"},{default:l(()=>{var t;return[s(o(n.value.loan_name||((t=n.value.user)==null?void 0:t.company_name)),1)]}),_:1}),a(d,{label:"业务归属"},{default:l(()=>{var t;return[s(o(n.value.sell_mode==="直销"?"直销":((t=n.value.agent)==null?void 0:t.company_name)||"无"),1)]}),_:1}),a(d,{label:"销售员"},{default:l(()=>[s(o(n.value.seller),1)]),_:1}),a(d,{label:"服务费"},{default:l(()=>[s(o(n.value.service_fee)+"%",1)]),_:1}),a(d,{label:"渠道成本"},{default:l(()=>[s(o(n.value.agent_cost)+"%",1)]),_:1}),a(d,{span:2,label:"金融产品"},{default:l(()=>{var t;return[s(o((t=n.value.product)==null?void 0:t.name),1)]}),_:1}),a(d,{label:"承保机构",span:2},{default:l(()=>{var t;return[s(o((t=n.value.insurer)==null?void 0:t.name),1)]}),_:1})]),_:1}),a(k,{column:2,border:""},{default:l(()=>[a(d,{label:"进件时间"},{default:l(()=>[s(o(p(R)(n.value.created_at)),1)]),_:1}),a(d,{label:"初审时间"},{default:l(()=>[s(o(p(R)(n.value.first_review_time)||"-"),1)]),_:1}),a(d,{label:"复审时间"},{default:l(()=>[s(o(p(R)(n.value.second_review_time)||"-"),1)]),_:1}),a(d,{label:"用户签约时间"},{default:l(()=>[s(o(p(R)(n.value.user_sign_time)||"-"),1)]),_:1}),a(d,{label:"资方签约时间"},{default:l(()=>[s(o(p(R)(n.value.funder_sign_time)||"-"),1)]),_:1}),a(d,{label:"放款时间"},{default:l(()=>[s(o(p(R)(n.value.loan_time)||"-"),1)]),_:1}),a(d,{label:"最后更新时间"},{default:l(()=>[s(o(p(R)(n.value.updated_at)),1)]),_:1})]),_:1})]),_:1})),[[ke,D.value]])]),_:1}),a(C,{span:6},{default:l(()=>[a(f,{class:"key-metrics-card"},{default:l(()=>[m("div",tt,[m("div",lt,[e[36]||(e[36]=m("div",{class:"metric-label"},"总保费",-1)),m("div",nt,o(p(y)(n.value.total_premium)),1)]),m("div",rt,[e[37]||(e[37]=m("div",{class:"metric-label"},"商业险",-1)),m("div",st,o(p(y)(n.value.total_commercial)),1)]),m("div",ot,[e[38]||(e[38]=m("div",{class:"metric-label"},"首付金额",-1)),m("div",ut,o(p(y)(n.value.down_payment)),1)]),m("div",it,[e[39]||(e[39]=m("div",{class:"metric-label"},"贷款金额",-1)),m("div",dt,o(p(y)(n.value.loan_amount)),1)]),m("div",ct,[e[40]||(e[40]=m("div",{class:"metric-label"},"服务费",-1)),m("div",mt,o(p(y)(n.value.service_fee*n.value.total_commercial/100)),1)])])]),_:1})]),_:1})]),_:1})]),n.value.insurance_type==="车险"?(g(),M(f,{key:0,class:"detail-card insurance-card"},{default:l(()=>[a(Y,{data:n.value.car_insurance||[],border:"",style:{width:"100%"},"empty-text":"暂无车险投保信息","max-height":"500","show-summary":n.value.car_insurance&&n.value.car_insurance.length>0,"sum-text":"合计","summary-method":Fe},{default:l(()=>[a(i,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(({row:t})=>[a(v,{type:fe(t.status)},{default:l(()=>[s(o(t.status),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"car_no",label:"车牌号",width:"120",align:"left"}),a(i,{prop:"vin",label:"车架号",width:"180",align:"left"}),a(i,{prop:"insured",label:"被保人",width:"230",align:"left"}),a(i,{prop:"commercial_amount",label:"商业险",width:"110",align:"right"},{default:l(({row:t})=>[s(o(p(y)(t.commercial_amount)),1)]),_:1}),a(i,{prop:"compulsory_amount",label:"交强险",width:"110",align:"center"},{default:l(({row:t})=>[s(o(p(y)(t.compulsory_amount)),1)]),_:1}),a(i,{prop:"vehicle_tax_amount",label:"车船税",width:"110",align:"center"},{default:l(({row:t})=>[s(o(p(y)(t.vehicle_tax_amount)),1)]),_:1}),a(i,{prop:"total_amount",label:"总保费",width:"110",align:"center"},{default:l(({row:t})=>[s(o(p(y)((t.commercial_amount||0)+(t.compulsory_amount||0)+(t.vehicle_tax_amount||0))),1)]),_:1}),a(i,{label:"操作",width:"200",align:"center",fixed:"right"},{default:l(({row:t})=>[a(u,{type:"info",size:"small",onClick:T=>Qe(t)},{default:l(()=>e[41]||(e[41]=[s(" 查看附件 ")])),_:2,__:[41]},1032,["onClick"]),a(u,{type:"primary",size:"small",onClick:T=>je(t)},{default:l(()=>e[42]||(e[42]=[s(" 上传附件 ")])),_:2,__:[42]},1032,["onClick"])]),_:1})]),_:1},8,["data","show-summary"]),!n.value.car_insurance||n.value.car_insurance.length===0?(g(),V("div",pt,[a(u,{type:"primary",onClick:de},{default:l(()=>e[43]||(e[43]=[s("录入车险信息")])),_:1,__:[43]})])):$("",!0)]),_:1})):$("",!0),n.value.insurance_type==="货运险"?(g(),M(f,{key:1,class:"detail-card insurance-card"},{default:l(()=>[a(Y,{data:n.value.cargo_insurance||[],border:"",style:{width:"100%"},"empty-text":"暂无货运险投保信息","max-height":"500","show-summary":n.value.cargo_insurance&&n.value.cargo_insurance.length>0,"sum-text":"合计","summary-method":Oe},{default:l(()=>[a(i,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(({row:t})=>[a(v,{type:fe(t.status)},{default:l(()=>[s(o(t.status),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"track_no",label:"运输编号",width:"200",align:"left"}),a(i,{prop:"insured",label:"被保人",width:"170",align:"left"}),a(i,{prop:"name",label:"货物名称",width:"150",align:"left"}),a(i,{prop:"quantity",label:"货物数量",width:"120",align:"right"}),a(i,{prop:"carrier",label:"承运人",width:"130",align:"left"}),a(i,{prop:"consignee",label:"收货人",width:"130",align:"left"}),a(i,{prop:"commercial_amount",label:"保费",width:"140",align:"center"},{default:l(({row:t})=>[s(o(p(y)(t.commercial_amount)),1)]),_:1}),a(i,{label:"操作",width:"200",align:"center",fixed:"right"},{default:l(({row:t})=>[a(u,{type:"info",size:"small",onClick:T=>We(t)},{default:l(()=>e[44]||(e[44]=[s(" 查看附件 ")])),_:2,__:[44]},1032,["onClick"]),a(u,{type:"primary",size:"small",onClick:T=>Xe(t)},{default:l(()=>e[45]||(e[45]=[s(" 上传附件 ")])),_:2,__:[45]},1032,["onClick"])]),_:1})]),_:1},8,["data","show-summary"]),!n.value.cargo_insurance||n.value.cargo_insurance.length===0?(g(),V("div",_t,[a(u,{type:"primary",onClick:de},{default:l(()=>e[46]||(e[46]=[s("录入货运险信息")])),_:1,__:[46]})])):$("",!0)]),_:1})):$("",!0),a(f,{class:"detail-card"},{default:l(()=>[a(Y,{data:n.value.contacts||[],border:"",style:{width:"100%"},"empty-text":"暂无合同信息","max-height":"350"},{default:l(()=>[a(i,{prop:"title",label:"合同标题","min-width":"150"}),a(i,{prop:"user_contact_id",label:"法大大合同ID",width:"180"}),a(i,{prop:"user_sign_status",label:"用户签署状态",width:"120",align:"center"},{default:l(({row:t})=>[a(v,{type:aa(t.user_sign_status)},{default:l(()=>[s(o(t.user_sign_status||"未签署"),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"user_sign_time",label:"用户签署时间",width:"150",align:"center"},{default:l(({row:t})=>[s(o(t.user_sign_time||"-"),1)]),_:1}),a(i,{prop:"funder_sign_status",label:"资方签署状态",width:"120",align:"center"},{default:l(({row:t})=>[a(v,{type:ta(t.funder_sign_status)},{default:l(()=>[s(o(t.funder_sign_status||"未签署"),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"funder_sign_time",label:"资方签署时间",width:"170",align:"center"},{default:l(({row:t})=>[s(o(t.funder_sign_time||"-"),1)]),_:1}),a(i,{label:"操作",width:"200",align:"center",fixed:"right"},{default:l(({row:t})=>[t.user_sign_status!=="已签署"?(g(),M(u,{key:0,type:"primary",size:"small",icon:p(Pa),onClick:()=>ea(t.user_sign_url),disabled:!t.user_sign_url},{default:l(()=>e[47]||(e[47]=[s(" 用户签署 ")])),_:2,__:[47]},1032,["icon","onClick","disabled"])):$("",!0),t.user_sign_status==="已签署"&&t.funder_sign_status!=="已签署"?(g(),M(u,{key:1,type:"warning",size:"small",onClick:()=>ma(t)},{default:l(()=>e[48]||(e[48]=[s(" 资方签署 ")])),_:2,__:[48]},1032,["onClick"])):$("",!0),a(u,{type:"info",size:"small",onClick:()=>pa(t)},{default:l(()=>e[49]||(e[49]=[s(" 查看附件 ")])),_:2,__:[49]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),a(f,{class:"detail-card"},{default:l(()=>[a(Y,{data:n.value.receiveds||[],border:"",style:{width:"100%"},"empty-text":"暂无收款记录","max-height":"500","show-summary":n.value.receiveds&&n.value.receiveds.length>0,"sum-text":"合计","summary-method":ya},{default:l(()=>[a(i,{prop:"trans_no",label:"收款流水号",width:"200"}),a(i,{prop:"rec_type",label:"收款类型",width:"80",align:"center"},{default:l(({row:t})=>[a(v,{type:la(t.rec_type)},{default:l(()=>[s(o(t.rec_type),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"amount",label:"收款金额",width:"100",align:"center"},{default:l(({row:t})=>[m("span",vt,o(p(y)(t.amount)),1)]),_:1}),a(i,{prop:"method",label:"收款方式",width:"80",align:"center"},{default:l(({row:t})=>[a(v,{type:na(t.method),size:"small"},{default:l(()=>[s(o(t.method),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"date_time",label:"收款时间",width:"150",align:"center"}),a(i,{prop:"created_at",label:"录入时间",width:"150",align:"center"},{default:l(({row:t})=>[s(o(p(R)(t.created_at)),1)]),_:1}),a(i,{prop:"remark",label:"备注","min-width":"80"},{default:l(({row:t})=>[s(o(t.remark||"-"),1)]),_:1}),a(i,{label:"操作",width:"200",align:"center",fixed:"right"},{default:l(({row:t})=>[a(u,{type:"info",size:"small",onClick:T=>da(t)},{default:l(()=>e[50]||(e[50]=[s(" 查看附件 ")])),_:2,__:[50]},1032,["onClick"]),a(u,{type:"primary",size:"small",onClick:T=>ca(t)},{default:l(()=>e[51]||(e[51]=[s(" 上传附件 ")])),_:2,__:[51]},1032,["onClick"])]),_:1})]),_:1},8,["data","show-summary"])]),_:1}),a(f,{class:"detail-card"},{default:l(()=>[a(Y,{data:n.value.receivables||[],border:"",style:{width:"100%"},"empty-text":"暂无还款计划","show-summary":n.value.receivables&&n.value.receivables.length>0,"sum-text":"合计","summary-method":fa},{default:l(()=>[a(i,{prop:"period",label:"期数",width:"80",align:"center"}),a(i,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(({row:t})=>[a(v,{type:ra(t.status)},{default:l(()=>[s(o(t.status),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"date",label:"应还日期",width:"120",align:"center"}),a(i,{prop:"amount",label:"应还金额",width:"120",align:"right"},{default:l(({row:t})=>[m("span",ft,o(p(y)(t.amount)),1)]),_:1}),a(i,{prop:"principal_amount",label:"本金",width:"120",align:"right"},{default:l(({row:t})=>[m("span",yt,o(p(y)(t.principal_amount)),1)]),_:1}),a(i,{prop:"interest_amount",label:"利息",width:"120",align:"right"},{default:l(({row:t})=>[m("span",gt,o(p(y)(t.interest_amount)),1)]),_:1}),a(i,{prop:"actual_amount",label:"实际收款",width:"120",align:"right"},{default:l(({row:t})=>[t.actual_amount>0?(g(),V("span",bt,o(p(y)(t.actual_amount)),1)):(g(),V("span",ht,"-"))]),_:1}),a(i,{prop:"actual_date",label:"实际收款日期",width:"120",align:"center"},{default:l(({row:t})=>[s(o(t.actual_date||"-"),1)]),_:1}),a(i,{prop:"penalty_amount",label:"违约金",width:"100",align:"right"},{default:l(({row:t})=>[t.penalty_amount>0?(g(),V("span",wt,o(p(y)(t.penalty_amount)),1)):(g(),V("span",kt,"-"))]),_:1}),a(i,{prop:"forfeit_amount",label:"滞纳金",width:"100",align:"right"},{default:l(({row:t})=>[t.forfeit_amount>0?(g(),V("span",Ct,o(p(y)(t.forfeit_amount)),1)):(g(),V("span",Vt,"-"))]),_:1}),a(i,{prop:"overdue_days",label:"逾期天数",width:"100",align:"center"},{default:l(({row:t})=>[t.overdue_days>0?(g(),V("span",$t,o(t.overdue_days)+"天",1)):(g(),V("span",At,"-"))]),_:1}),a(i,{label:"操作",width:"120",align:"center",fixed:"right"},{default:l(({row:t})=>[t.status==="待收款"||t.status==="已逾期"?(g(),M(u,{key:0,type:"primary",size:"small",onClick:T=>ua(t)},{default:l(()=>e[52]||(e[52]=[s(" 标记收款 ")])),_:2,__:[52]},1032,["onClick"])):(g(),V("span",Mt,"已收款"))]),_:1})]),_:1},8,["data","show-summary"])]),_:1}),a(f,{class:"detail-card"},{default:l(()=>[a(Wa,{"reference-id":p(_e).params.id,"reference-type":"order","show-filter":!0,"show-pagination":!0,"page-size":20,"auto-load":!0},null,8,["reference-id"])]),_:1}),a(me,{modelValue:q.value,"onUpdate:modelValue":e[3]||(e[3]=t=>q.value=t),title:"前置款信息",width:"600px","close-on-click-modal":!1},{footer:l(()=>[m("span",Nt,[a(u,{onClick:e[2]||(e[2]=t=>q.value=!1)},{default:l(()=>e[53]||(e[53]=[s("关闭")])),_:1,__:[53]}),a(u,{type:"primary",onClick:va},{default:l(()=>e[54]||(e[54]=[s("复制信息")])),_:1,__:[54]})])]),default:l(()=>[Te((g(),V("div",xt,[c.value.batch_no?(g(),M(k,{key:0,column:1,border:"",size:"small"},{default:l(()=>[a(d,{label:"批次号"},{default:l(()=>[m("span",null,o(c.value.batch_no),1)]),_:1}),a(d,{label:"借款人"},{default:l(()=>[m("span",null,o(c.value.borrower),1)]),_:1}),a(d,{label:"车辆信息"},{default:l(()=>[m("span",null,o(c.value.vehicle_info),1)]),_:1}),a(d,{label:"总保费"},{default:l(()=>[m("span",null,o(p(y)(c.value.total_premium)),1)]),_:1})]),_:1})):$("",!0),c.value.is_recv_srv_fee==="否"?(g(),V("div",Ut,[a(k,{column:1,border:"",size:"small"},{default:l(()=>[a(d,{label:"服务费"},{default:l(()=>[m("span",null,o(p(y)(c.value.service_fee)),1)]),_:1}),a(d,{label:"收款户名"},{default:l(()=>[m("span",null,o(c.value.service_account_name),1)]),_:1}),a(d,{label:"收款账户"},{default:l(()=>[m("span",null,o(c.value.service_account_no),1)]),_:1}),a(d,{label:"开户行"},{default:l(()=>[m("span",null,o(c.value.service_bank_name),1)]),_:1})]),_:1})])):$("",!0),m("div",St,[a(k,{column:1,border:"",size:"small"},{default:l(()=>[a(d,{label:"首付款"},{default:l(()=>[m("span",null,o(p(y)(c.value.total_down_payment)),1)]),_:1}),a(d,{label:"明细"},{default:l(()=>[m("span",null,o(c.value.down_payment_detail),1)]),_:1}),a(d,{label:"收款户名"},{default:l(()=>[m("span",null,o(c.value.funder_account_name),1)]),_:1}),a(d,{label:"收款账户"},{default:l(()=>[m("span",null,o(c.value.funder_account_no),1)]),_:1}),a(d,{label:"开户行"},{default:l(()=>[m("span",null,o(c.value.funder_bank_name),1)]),_:1})]),_:1})]),c.value.remark?(g(),V("div",Et,[m("div",Dt,o(c.value.remark),1)])):$("",!0)])),[[ke,Z.value]])]),_:1},8,["modelValue"]),a(F,{visible:ee.value,"onUpdate:visible":e[4]||(e[4]=t=>ee.value=t),title:"订单附件","order-id":n.value.id,"ref-id":0,type:"order","allow-delete":!0},null,8,["visible","order-id"]),a(K,{visible:ae.value,"onUpdate:visible":e[5]||(e[5]=t=>ae.value=t),title:"上传订单附件","order-id":n.value.id,"ref-id":0,type:"order",onSuccess:L},null,8,["visible","order-id"]),a(F,{visible:te.value,"onUpdate:visible":e[6]||(e[6]=t=>te.value=t),title:`车险附件 - ${((Ce=x.value)==null?void 0:Ce.car_no)||""}`,"order-id":n.value.id,"ref-id":((Ve=x.value)==null?void 0:Ve.id)||0,type:"car","allow-delete":!1},null,8,["visible","title","order-id","ref-id"]),a(K,{visible:le.value,"onUpdate:visible":e[7]||(e[7]=t=>le.value=t),title:`上传车险附件 - ${(($e=x.value)==null?void 0:$e.car_no)||""}`,"order-id":n.value.id,"ref-id":((Ae=x.value)==null?void 0:Ae.id)||0,type:"car",onSuccess:L},null,8,["visible","title","order-id","ref-id"]),a(F,{visible:ne.value,"onUpdate:visible":e[8]||(e[8]=t=>ne.value=t),title:`货运险附件 - ${((Me=x.value)==null?void 0:Me.track_no)||""}`,"order-id":n.value.id,"ref-id":((xe=x.value)==null?void 0:xe.id)||0,type:"cargo","allow-delete":!1},null,8,["visible","title","order-id","ref-id"]),a(K,{visible:re.value,"onUpdate:visible":e[9]||(e[9]=t=>re.value=t),title:`上传货运险附件 - ${((Ue=x.value)==null?void 0:Ue.track_no)||""}`,"order-id":n.value.id,"ref-id":((Se=x.value)==null?void 0:Se.id)||0,type:"cargo",onSuccess:L},null,8,["visible","title","order-id","ref-id"]),a(F,{visible:se.value,"onUpdate:visible":e[10]||(e[10]=t=>se.value=t),title:`收款记录附件 - ${((Ee=I.value)==null?void 0:Ee.trans_no)||""}`,"order-id":n.value.id,"ref-id":((De=I.value)==null?void 0:De.id)||0,type:"received","allow-delete":!1},null,8,["visible","title","order-id","ref-id"]),a(K,{visible:oe.value,"onUpdate:visible":e[11]||(e[11]=t=>oe.value=t),title:`上传收款记录附件 - ${((Ne=I.value)==null?void 0:Ne.trans_no)||""}`,"order-id":n.value.id,"ref-id":((Re=I.value)==null?void 0:Re.id)||0,type:"received",onSuccess:L},null,8,["visible","title","order-id","ref-id"]),a(F,{visible:ue.value,"onUpdate:visible":e[12]||(e[12]=t=>ue.value=t),title:`合同附件 - ${((Pe=ie.value)==null?void 0:Pe.title)||""}`,"order-id":n.value.id,"ref-id":((Ie=ie.value)==null?void 0:Ie.id)||0,type:"contact","allow-delete":!1},null,8,["visible","title","order-id","ref-id"]),a(me,{modelValue:B.value,"onUpdate:modelValue":e[19]||(e[19]=t=>B.value=t),title:"提前还款",width:"600px","close-on-click-modal":!1},{footer:l(()=>[m("span",Rt,[a(u,{onClick:e[18]||(e[18]=t=>B.value=!1)},{default:l(()=>e[55]||(e[55]=[s("取消")])),_:1,__:[55]}),a(u,{type:"primary",onClick:oa,loading:j.value},{default:l(()=>e[56]||(e[56]=[s(" 确定 ")])),_:1,__:[56]},8,["loading"])])]),default:l(()=>[a(we,{ref_key:"advanceRepaymentFormRef",ref:Q,model:w.value,rules:Be,"label-width":"120px"},{default:l(()=>[a(S,{label:"订单信息"},{default:l(()=>{var t;return[a(G,{value:`${n.value.order_no} - ${n.value.loan_name||((t=n.value.user)==null?void 0:t.company_name)}`,disabled:""},null,8,["value"])]}),_:1}),a(S,{label:"金额",prop:"amount"},{default:l(()=>[a(be,{modelValue:w.value.amount,"onUpdate:modelValue":e[13]||(e[13]=t=>w.value.amount=t),min:.01,precision:2,step:100,style:{width:"100%"},placeholder:"请输入金额"},null,8,["modelValue"])]),_:1}),a(S,{label:"收款类型",prop:"rec_type"},{default:l(()=>[a(pe,{modelValue:w.value.rec_type,"onUpdate:modelValue":e[14]||(e[14]=t=>w.value.rec_type=t),placeholder:"请选择收款类型",style:{width:"100%"},filterable:"","allow-create":"","default-first-option":""},{default:l(()=>[a(E,{label:"本金",value:"本金"}),a(E,{label:"利息",value:"利息"}),a(E,{label:"退保",value:"退保"}),a(E,{label:"违约金",value:"违约金"}),a(E,{label:"滞纳金",value:"滞纳金"})]),_:1},8,["modelValue"])]),_:1}),a(S,{label:"支付方式",prop:"method"},{default:l(()=>[a(pe,{modelValue:w.value.method,"onUpdate:modelValue":e[15]||(e[15]=t=>w.value.method=t),placeholder:"请选择支付方式",style:{width:"100%"}},{default:l(()=>[a(E,{label:"微信",value:"微信"}),a(E,{label:"支付宝",value:"支付宝"}),a(E,{label:"银行卡",value:"银行卡"})]),_:1},8,["modelValue"])]),_:1}),a(S,{label:"支付时间",prop:"date_time"},{default:l(()=>[a(he,{modelValue:w.value.date_time,"onUpdate:modelValue":e[16]||(e[16]=t=>w.value.date_time=t),type:"datetime",placeholder:"选择支付时间",style:{width:"100%"},format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),a(S,{label:"备注",prop:"remark"},{default:l(()=>[a(G,{modelValue:w.value.remark,"onUpdate:modelValue":e[17]||(e[17]=t=>w.value.remark=t),type:"textarea",rows:3,placeholder:"请输入备注信息（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(me,{modelValue:z.value,"onUpdate:modelValue":e[24]||(e[24]=t=>z.value=t),title:"标记收款",width:"500px","close-on-click-modal":!1},{footer:l(()=>[m("span",Pt,[a(u,{onClick:e[23]||(e[23]=t=>z.value=!1)},{default:l(()=>e[57]||(e[57]=[s("取消")])),_:1,__:[57]}),a(u,{type:"primary",onClick:ia,loading:X.value},{default:l(()=>e[58]||(e[58]=[s(" 确定 ")])),_:1,__:[58]},8,["loading"])])]),default:l(()=>[a(we,{ref_key:"markAsPaidFormRef",ref:W,model:U.value,rules:ze,"label-width":"120px"},{default:l(()=>[a(S,{label:"期数"},{default:l(()=>{var t;return[a(G,{value:`第${(t=O.value)==null?void 0:t.period}期`,disabled:""},null,8,["value"])]}),_:1}),a(S,{label:"应还金额"},{default:l(()=>{var t;return[a(G,{value:p(y)((t=O.value)==null?void 0:t.amount),disabled:""},null,8,["value"])]}),_:1}),a(S,{label:"实际收款金额",prop:"actual_amount"},{default:l(()=>[a(be,{modelValue:U.value.actual_amount,"onUpdate:modelValue":e[20]||(e[20]=t=>U.value.actual_amount=t),min:0,precision:2,step:100,style:{width:"100%"},placeholder:"请输入实际收款金额"},null,8,["modelValue"])]),_:1}),a(S,{label:"收款方式",prop:"method"},{default:l(()=>[a(pe,{modelValue:U.value.method,"onUpdate:modelValue":e[21]||(e[21]=t=>U.value.method=t),placeholder:"请选择收款方式",style:{width:"100%"}},{default:l(()=>[a(E,{label:"微信",value:"微信"}),a(E,{label:"支付宝",value:"支付宝"}),a(E,{label:"银行卡",value:"银行卡"})]),_:1},8,["modelValue"])]),_:1}),a(S,{label:"实际收款日期",prop:"actual_date"},{default:l(()=>[a(he,{modelValue:U.value.actual_date,"onUpdate:modelValue":e[22]||(e[22]=t=>U.value.actual_date=t),type:"date",placeholder:"选择收款日期",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},cl=ga(It,[["__scopeId","data-v-778d211b"]]);export{cl as default};
